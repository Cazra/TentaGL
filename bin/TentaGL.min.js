GL_DEPTH_BUFFER_BIT=256;GL_STENCIL_BUFFER_BIT=1024;GL_COLOR_BUFFER_BIT=16384;GL_POINTS=0;GL_LINES=1;GL_LINE_LOOP=2;GL_LINE_STRIP=3;GL_TRIANGLES=4;GL_TRIANGLE_STRIP=5;GL_TRIANGLE_FAN=6;GL_ZERO=0;GL_ONE=1;GL_SRC_COLOR=768;GL_ONE_MINUS_SRC_COLOR=769;GL_SRC_ALPHA=770;GL_ONE_MINUS_SRC_ALPHA=771;GL_DST_ALPHA=772;GL_ONE_MINUS_DST_ALPHA=773;GL_DST_COLOR=774;GL_ONE_MINUS_DST_COLOR=775;GL_SRC_ALPHA_SATURATE=776;GL_FUNC_ADD=32774;GL_BLEND_EQUATION_RGB=GL_BLEND_EQUATION=32777;GL_BLEND_EQUATION_ALHPA=34877;
GL_FUNC_SUBTRACT=32778;GL_FUNC_REVERSE_SUBTRACT=32779;GL_BLEND_DST_RGB=32968;GL_BLEND_SRC_RGB=32969;GL_BLEND_DST_ALPHA=32970;GL_BLEND_SRC_ALPHA=32971;GL_CONSTANT_COLOR=32769;GL_ONE_MINUS_CONSTANT_COLOR=32770;GL_CONSTANT_ALPHA=32771;GL_ONE_MINUS_CONSTANT_ALPHA=32772;GL_BLEND_COLOR=32773;GL_ARRAY_BUFFER=34962;GL_ELEMENT_ARRAY_BUFFER=34963;GL_ARRAY_BUFFER_BINDING=34964;GL_ELEMENT_ARRAY_BUFFER_BINDING=34965;GL_STREAM_DRAW=35040;GL_STATIC_DRAW=35044;GL_DYNAMIC_DRAW=35048;GL_BUFFER_SIZE=34660;
GL_BUFFER_USAGE=34661;GL_CURRENT_VERTEX_ATTRIB=34342;GL_FRONT=1028;GL_BACK=1029;GL_FRONT_AND_BACK=1032;GL_CULL_FACE=2884;GL_BLEND=3042;GL_DITHER=3024;GL_STENCIL_TEST=2960;GL_DEPTH_TEST=2929;GL_SCISSOR_TEST=3089;GL_POLYGON_OFFSET_FILL=32823;GL_SAMPLE_ALPHA_TO_COVERAGE=32926;GL_SAMPLE_COVERAGE=32928;GL_NO_ERROR=0;GL_INVALID_ENUM=1280;GL_INVALID_VALUE=1281;GL_INVALID_OPERATION=1282;GL_OUT_OF_MEMORY=1285;GL_CW=2304;GL_CCW=2305;GL_LINE_WIDTH=2849;GL_ALIASED_POINT_SIZE_RANGE=33901;
GL_ALIASED_LINE_WIDTH_RANGE=33902;GL_CULL_FACE_MODE=2885;GL_FRONT_FACE=2886;GL_DEPTH_RANGE=2928;GL_DEPTH_WRITEMASK=2930;GL_DEPTH_CLEAR_VALUE=2931;GL_DEPTH_FUNC=2932;GL_STENCIL_CLEAR_VALUE=2961;GL_STENCIL_FUNC=2962;GL_STENCIL_FAIL=2964;GL_STENCIL_PASS_DEPTH_FAIL=2965;GL_STENCIL_PASS_DEPTH_PASS=2966;GL_STENCIL_REF=2967;GL_STENCIL_VALUE_MASK=2963;GL_STENCIL_WRITEMASK=2968;GL_STENCIL_BACK_FUNC=34816;GL_STENCIL_BACK_FAIL=34817;GL_STENCIL_BACK_PASS_DEPTH_FAIL=34818;GL_STENCIL_BACK_PASS_DEPTH_PASS=34819;
GL_STENCIL_REF=36003;GL_STENCIL_BACK_VALUE_MASK=36004;GL_STENCIL_BACK_WRITEMASK=36005;GL_VIEWPORT=2978;GL_SCISSOR_BOX=3088;GL_COLOR_CLEAR_VALUE=3106;GL_COLOR_WRITEMASK=3107;GL_UNPACK_ALIGNMENT=3317;GL_PACK_ALIGNMENT=3333;GL_MAX_TEXTURE_SIZE=3379;GL_MAX_VIEWPORT_DIMS=3386;GL_SUBPIXEL_BITS=3408;GL_RED_BITS=3410;GL_GREEN_BITS=3411;GL_BLUE_BITS=3412;GL_ALPHA_BITS=3413;GL_DEPTH_BITS=3414;GL_STENCIL_BITS=3415;GL_POLYGON_OFFSET_UNITS=10752;GL_POLYGON_OFFSET_FACTOR=32824;GL_TEXTURE_BINDING_2D=32873;
GL_SAMPLE_BUFFERS=32936;GL_SAMPLES=32937;GL_SAMPLE_COVERAGE_VALUE=32938;GL_SAMPLE_COVERAGE_INVERT=32939;GL_COMPRESSED_TEXTURE_FORMATS=34467;GL_DONT_CARE=4352;GL_FASTEST=4353;GL_NICEST=4354;GL_GENERATE_MIPMAP_HINT=33170;GL_BYTE=5120;GL_UNSIGNED_BYTE=5121;GL_SHORT=5122;GL_UNSIGNED_SHORT=5123;GL_INT=5124;GL_UNSIGNED_INT=5125;GL_FLOAT=5126;GL_FLOAT_VEC2=35664;GL_FLOAT_VEC3=35665;GL_FLOAT_VEC4=35666;GL_INT_VEC2=35667;GL_INT_VEC3=35668;GL_INT_VEC4=35669;GL_BOOL=35670;GL_BOOL_VEC2=35671;GL_BOOL_VEC3=35672;
GL_BOOL_VEC4=35673;GL_FLOAT_MAT2=35674;GL_FLOAT_MAT3=35675;GL_FLOAT_MAT4=35676;GL_SAMPLER_2D=35678;GL_SAMPLER_CUBE=35680;GL_DEPTH_COMPONENT=6402;GL_ALPHA=6406;GL_RGB=6407;GL_RGBA=6408;GL_LUMINANCE=6409;GL_LUMINANCE_ALPHA=6410;GL_UNSIGNED_SHORT_4_4_4_4=32819;GL_UNSIGNED_SHORT_5_5_5_1=32820;GL_UNSIGNED_SHORT_5_6_5=33635;GL_FRAGMENT_SHADER=35632;GL_VERTEX_SHADER=35633;GL_MAX_VERTEX_ATTRIBS=34921;GL_MAX_VERTEX_UNIFORM_VECTORS=36347;GL_MAX_VARYING_VECTORS=36348;GL_MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661;
GL_MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660;GL_MAX_TEXTURE_IMAGE_UNITS=34930;GL_MAX_FRAGMENT_UNIFORM_VECTORS=36349;GL_SHADER_TYPE=35663;GL_DELETE_STATUS=35712;GL_LINK_STATUS=35714;GL_VALIDATE_STATUS=35715;GL_ATTACHED_SHADERS=35717;GL_ACTIVE_UNIFORMS=35718;GL_ACTIVE_ATTRIBUTES=35721;GL_SHADING_LANGUAGE_VERSION=35724;GL_CURRENT_PROGRAM=35725;GL_NEVER=512;GL_LESS=513;GL_EQUAL=514;GL_LEQUAL=515;GL_GREATER=516;GL_NOTEQUAL=517;GL_GEQUAL=518;GL_ALWAYS=519;GL_KEEP=7680;GL_REPLACE=7681;GL_INCR=7682;GL_DECR=7683;
GL_INVERT=5386;GL_INCR_WRAP=34055;GL_DECR_WRAP=34056;GL_VENDOR=7936;GL_RENDERER=7937;GL_VERSION=7938;GL_NEAREST=9728;GL_LINEAR=9729;GL_NEAREST_MIPMAP_NEAREST=9984;GL_LINEAR_MIPMAP_NEAREST=9985;GL_NEAREST_MIPMAP_LINEAR=9986;GL_LINEAR_MIPMAP_LINEAR=9987;GL_TEXTURE_MAG_FILTER=10240;GL_TEXTURE_MIN_FILTER=10241;GL_TEXTURE_WRAP_S=10242;GL_TEXTURE_WRAP_T=10243;GL_TEXTURE_2D=3553;GL_TEXTURE=5890;GL_TEXTURE_CUBE_MAP=34067;GL_TEXTURE_BINDING_CUBE_MAP=34068;GL_TEXTURE_CUBE_MAP_POSITIVE_X=34069;
GL_TEXTURE_CUBE_MAP_NEGATIVE_X=34070;GL_TEXTURE_CUBE_MAP_POSITIVE_Y=34071;GL_TEXTURE_CUBE_MAP_NEGATIVE_Y=34072;GL_TEXTURE_CUBE_MAP_POSITIVE_Z=34073;GL_TEXTURE_CUBE_MAP_NEGATIVE_Z=34074;GL_MAX_CUBE_MAP_TEXTURE_SIZE=34076;GL_TEXTURE0=33984;GL_TEXTURE1=33985;GL_TEXTURE2=33986;GL_TEXTURE3=33987;GL_TEXTURE4=33988;GL_TEXTURE5=33989;GL_TEXTURE6=33990;GL_TEXTURE7=33991;GL_TEXTURE8=33992;GL_TEXTURE9=33993;GL_TEXTURE10=33994;GL_TEXTURE11=33995;GL_TEXTURE12=33996;GL_TEXTURE13=33997;GL_TEXTURE14=33998;
GL_TEXTURE15=33999;GL_TEXTURE16=34E3;GL_TEXTURE17=34001;GL_TEXTURE18=34002;GL_TEXTURE19=34003;GL_TEXTURE20=34004;GL_TEXTURE21=34005;GL_TEXTURE22=34006;GL_TEXTURE23=34007;GL_TEXTURE24=34008;GL_TEXTURE25=34009;GL_TEXTURE26=34010;GL_TEXTURE27=34011;GL_TEXTURE28=34012;GL_TEXTURE29=34013;GL_TEXTURE30=34014;GL_TEXTURE31=34015;GL_ACTIVE_TEXTURE=34016;GL_REPEAT=10497;GL_CLAMP_TO_EDGE=33071;GL_MIRRORED_REPEAT=33648;GL_VERTEX_ATTRIB_ARRAY_ENABLED=34338;GL_VERTEX_ATTRIB_ARRAY_SIZE=34339;
GL_VERTEX_ATTRIB_ARRAY_STRIDE=34340;GL_VERTEX_ATTRIB_ARRAY_TYPE=34341;GL_VERTEX_ATTRIB_ARRAY_NORMALIZED=34922;GL_VERTEX_ATTRIB_ARRAY_POINTER=34373;GL_VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975;GL_IMPLEMENTATION_COLOR_READ_TYPE=35738;GL_IMPLEMENTATION_COLOR_READ_FORMAT=35739;GL_COMPILE_STATUS=35713;GL_LOW_FLOAT=36336;GL_MEDIUM_FLOAT=36337;GL_HIGH_FLOAT=36338;GL_LOW_INT=36339;GL_MEDIUM_INT=36340;GL_HIGH_INT=36341;GL_FRAMEBUFFER=36160;GL_RENDERBUFFER=36161;GL_RGBA4=32854;GL_RGB5_1=32855;GL_RGB565=36194;
GL_DEPTH_COMPONENT16=33189;GL_STENCIL_INDEX=6401;GL_STENCIL_INDEX8=36168;GL_DEPTH_STENCIL=34041;GL_RENDERBUFFER_WIDTH=36162;GL_RENDERBUFFER_HEIGHT=36163;GL_RENDERBUFFER_INTERNAL_FORMAT=36164;GL_RENDERBUFFER_RED_SIZE=36176;GL_RENDERBUFFER_GREEN_SIZE=36177;GL_RENDERBUFFER_BLUE_SIZE=36178;GL_RENDERBUFFER_ALPHA_SIZE=36179;GL_RENDERBUFFER_DEPTH_SIZE=36180;GL_RENDERBUFFER_STENCIL_SIZE=36181;GL_FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048;GL_FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049;
GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050;GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051;GL_COLOR_ATTACHMENT0=36064;GL_DEPTH_ATTACHMENT=36096;GL_STENCIL_ATTACHMENT=36128;GL_DEPTH_STENCIL_ATTACHMENT=33306;GL_NONE=0;GL_FRAMEBUFFER_COMPLETE=36053;GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054;GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055;GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057;GL_FRAMEBUFFER_UNSUPPORTED=36061;GL_FRAMEBUFFER_BINDING=36006;GL_RENDERBUFFER_BINDING=36007;
GL_MAX_RENDERBUFFER_SIZE=34024;GL_INVALID_FRAMEBUFFER_OPERATION=1286;GL_UNPACK_FLIP_Y_WEBGL=37440;GL_UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441;GL_CONTEXT_LOST_WEBGL=37442;GL_UNPACK_COLORSPACE_CONVERSION_WEBGL=37443;GL_BROWSER_DEFAULT_WEBGL=37444;
var TentaGL={versionMajor:0,versionMinor:19,createGL:function(a,b){b=b||{alpha:!1};try{var c=a.getContext("webgl",b)||a.getContext("experimental-webgl",b)||a.getContext("webkit-3d",b)||a.getContext("moz-webgl",b);TentaGL.Blend.reset(c);TentaGL.ClippingArea.reset(c);TentaGL.ColorBuffer.reset(c);TentaGL.Cull.reset(c);TentaGL.DepthBuffer.reset(c);TentaGL.Scissor.reset(c);TentaGL.Stencil.reset(c);TentaGL.Viewport.reset(c);TentaGL.ViewTrans.reset(c);this._normalTrans=mat3.create();this._mvpTrans=mat4.create();
return c}catch(d){throw Error("Error creating WebGL context: "+d.toString());}},createCanvas:function(a){var b=document.createElement("canvas");a.appendChild(b);b.width=a.offsetWidth;b.height=a.offsetHeight;return b},clear:function(a,b){TentaGL.ColorBuffer.setClearColor(a,b);a.clear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT)},glTypeName:function(a){return TentaGL._glTypeName[a]},glSizeUnits:function(a){return TentaGL._glSizeUnits[a]},glSizeBytes:function(a){var b=TentaGL.glSizeUnits(a);a=TentaGL.glUnitType(a);
return b*TentaGL._glSizeBytes[a]},glUnitType:function(a){return TentaGL._glUnitTypes[a]},_defaultRenderFilter:function(a){return!0},_glTypeName:[]};TentaGL._glTypeName[GL_BYTE]="BYTE";TentaGL._glTypeName[GL_UNSIGNED_BYTE]="UNSIGNED_BYTE";TentaGL._glTypeName[GL_SHORT]="SHORT";TentaGL._glTypeName[GL_UNSIGNED_SHORT]="UNSIGNED_SHORT";TentaGL._glTypeName[GL_INT]="INT";TentaGL._glTypeName[GL_UNSIGNED_INT]="UNSIGNED_INT";TentaGL._glTypeName[GL_FLOAT]="FLOAT";TentaGL._glTypeName[GL_FLOAT_VEC2]="FLOAT_VEC2";
TentaGL._glTypeName[GL_FLOAT_VEC3]="FLOAT_VEC3";TentaGL._glTypeName[GL_FLOAT_VEC4]="FLOAT_VEC4";TentaGL._glTypeName[GL_INT_VEC2]="INT_VEC2";TentaGL._glTypeName[GL_INT_VEC3]="INT_VEC3";TentaGL._glTypeName[GL_INT_VEC4]="INT_VEC4";TentaGL._glTypeName[GL_BOOL]="BOOL";TentaGL._glTypeName[GL_BOOL_VEC2]="BOOL_VEC2";TentaGL._glTypeName[GL_BOOL_VEC3]="BOOL_VEC3";TentaGL._glTypeName[GL_BOOL_VEC4]="BOOL_VEC4";TentaGL._glTypeName[GL_FLOAT_MAT2]="FLOAT_MAT2";TentaGL._glTypeName[GL_FLOAT_MAT3]="FLOAT_MAT3";
TentaGL._glTypeName[GL_FLOAT_MAT4]="FLOAT_MAT4";TentaGL._glTypeName[GL_SAMPLER_2D]="SAMPLER_2D";TentaGL._glTypeName[GL_SAMPLER_CUBE]="SAMPLER_CUBE";TentaGL._glSizeUnits=[];TentaGL._glSizeUnits[GL_BYTE]=1;TentaGL._glSizeUnits[GL_UNSIGNED_BYTE]=1;TentaGL._glSizeUnits[GL_SHORT]=1;TentaGL._glSizeUnits[GL_UNSIGNED_SHORT]=1;TentaGL._glSizeUnits[GL_INT]=1;TentaGL._glSizeUnits[GL_UNSIGNED_INT]=1;TentaGL._glSizeUnits[GL_FLOAT]=1;TentaGL._glSizeUnits[GL_FLOAT_VEC2]=2;TentaGL._glSizeUnits[GL_FLOAT_VEC3]=3;
TentaGL._glSizeUnits[GL_FLOAT_VEC4]=4;TentaGL._glSizeUnits[GL_INT_VEC2]=2;TentaGL._glSizeUnits[GL_INT_VEC3]=3;TentaGL._glSizeUnits[GL_INT_VEC4]=4;TentaGL._glSizeUnits[GL_BOOL]=1;TentaGL._glSizeUnits[GL_BOOL_VEC2]=2;TentaGL._glSizeUnits[GL_BOOL_VEC3]=3;TentaGL._glSizeUnits[GL_BOOL_VEC4]=4;TentaGL._glSizeUnits[GL_FLOAT_MAT2]=4;TentaGL._glSizeUnits[GL_FLOAT_MAT3]=9;TentaGL._glSizeUnits[GL_FLOAT_MAT4]=16;TentaGL._glSizeBytes=[];TentaGL._glSizeBytes[GL_BYTE]=1;TentaGL._glSizeBytes[GL_UNSIGNED_BYTE]=1;
TentaGL._glSizeBytes[GL_SHORT]=2;TentaGL._glSizeBytes[GL_UNSIGNED_SHORT]=2;TentaGL._glSizeBytes[GL_INT]=4;TentaGL._glSizeBytes[GL_UNSIGNED_INT]=4;TentaGL._glSizeBytes[GL_FLOAT]=4;TentaGL._glSizeBytes[GL_BOOL]=4;TentaGL._glUnitTypes=[];TentaGL._glUnitTypes[GL_BYTE]=GL_BYTE;TentaGL._glUnitTypes[GL_UNSIGNED_BYTE]=GL_UNSIGNED_BYTE;TentaGL._glUnitTypes[GL_SHORT]=GL_SHORT;TentaGL._glUnitTypes[GL_UNSIGNED_SHORT]=GL_UNSIGNED_SHORT;TentaGL._glUnitTypes[GL_INT]=GL_INT;
TentaGL._glUnitTypes[GL_UNSIGNED_INT]=GL_UNSIGNED_INT;TentaGL._glUnitTypes[GL_FLOAT]=GL_FLOAT;TentaGL._glUnitTypes[GL_FLOAT_VEC2]=GL_FLOAT;TentaGL._glUnitTypes[GL_FLOAT_VEC3]=GL_FLOAT;TentaGL._glUnitTypes[GL_FLOAT_VEC4]=GL_FLOAT;TentaGL._glUnitTypes[GL_INT_VEC2]=GL_INT;TentaGL._glUnitTypes[GL_INT_VEC3]=GL_INT;TentaGL._glUnitTypes[GL_INT_VEC4]=GL_INT;TentaGL._glUnitTypes[GL_BOOL]=GL_BOOL;TentaGL._glUnitTypes[GL_BOOL_VEC2]=GL_BOOL;TentaGL._glUnitTypes[GL_BOOL_VEC3]=GL_BOOL;
TentaGL._glUnitTypes[GL_BOOL_VEC4]=GL_BOOL;TentaGL._glUnitTypes[GL_FLOAT_MAT2]=GL_FLOAT;TentaGL._glUnitTypes[GL_FLOAT_MAT3]=GL_FLOAT;TentaGL._glUnitTypes[GL_FLOAT_MAT4]=GL_FLOAT;var Util;Util||(Util={});Util.Debug={arrayString:function(a){for(var b="[",c=!0,d=0;d<a.length;d++)c?c=!1:b+=", ",b+=a[d];return b+"]"},objString:function(a){var b="{",c=!0,d;for(d in a)c?c=!1:b+=", ",b+=d+":"+a[d];return b+"}"}};
TentaGL.DOM={getAbsolutePosition:function(a){for(var b=0,c=0;"BODY"!=a.nodeName;)b+=a.offsetLeft,c+=a.offsetTop,a=a.parentNode;return[b,c]},extractScriptText:function(a){var b=document.getElementById(a);if(!b)throw Error("Script ID "+a+" doesn't exist in the document.");a="";var c=b.firstChild;for(console.log(b);c;)c.nodeType==Node.TEXT_NODE&&(a+=c.textContent),c=c.nextSibling;return a}};
Util.Downloader={invisInput:void 0,saveAsText:function(a,b){var c=document.createElement("a");c.href="data:text;charset=utf-8,"+encodeURIComponent(b);c.download=a;c.click()},openDialog:function(a,b){var c=document.createElement("INPUT");c.setAttribute("type","file");b&&c.setAttribute("accept",b);c.style.display="none";var d=document.getElementsByTagName("body")[0];d.appendChild(c);c.onchange=function(b){var f=new FileReader;f.onload=function(b){a(b.target.result);d.removeChild(c)};f.readAsText(b.target.files[0])};
c.click()}};Util||(Util={});Util.Inheritance={inherit:function(a,b){for(var c in b.prototype)a.prototype[c]||(a.prototype[c]=b.prototype[c])}};TentaGL.Renderable={};TentaGL.Renderable.prototype={isaRenderable:!0,render:function(a){}};
TentaGL.Blend={setEnabled:function(a,b){a._blendEnabled==b||TentaGL.Picker.isPicking(a)||((a._blendEnabled=b)?a.enable(GL_BLEND):a.disable(GL_BLEND))},isEnabled:function(a){return a._blendEnabled},enabled:function(a,b){void 0!==b&&this.setEnabled(a,b);return a._blendEnabled},setEquation:function(a,b,c,d){a._blendEquation!=b&&(a._blendEquation=b,a.blendEquation(b));if(a._blendSrcFunc!=c||a._blendDstFunc!=d)a._blendSrcFunc=c,a._blendDstFunc=d,a.blendFunc(c,d)},getEquation:function(a){return a._blendEquation},
equation:function(a,b,c,d){void 0!==b&&this.setEquation(a,b,c,d);return a._blendEquation},getSrcFunc:function(a){return a._blendSrcFunc},getDstFunc:function(a){return a._blendDstFunc},color:function(a,b){void 0===b||b.equals(a._blendColor)||(a._blendColor=b.clone(),a.blendColor(b.r(),b.g(),b.b(),b.a()));return a._blendColor.clone()},reset:function(a){a._blendEnabled=!1;a._blendEquation=GL_FUNC_ADD;a._blendSrcFunc=GL_ONE;a._blendDstFunc=GL_ZERO;a._blendColor=TentaGL.Color.RGBA(0,0,0,0);a._blendStack=
[]},push:function(a){a._blendStack.push({_blendEnabled:a._blendEnabled,_blendEquation:a._blendEquation,_blendSrcFunc:a._blendSrcFunc,_blendDstFunc:a._blendDstFunc,_blendColor:a._blendColor})},pop:function(a){var b=a._blendStack.pop();this.enabled(a,b._blendEnabled);this.equation(a,b._blendEquation,b._blendSrcFunc,b._blendDstFunc);this.color(a,b._blendColor)}};
TentaGL.ColorBuffer={reset:function(a){a._cbClear=TentaGL.Color.RGBA(0,0,0,0);a._cbWriteRed=!0;a._cbWriteGreen=!0;a._cbWriteBlue=!0;a._cbWriteAlpha=!0;a._cbStack=[]},setClearColor:function(a,b){TentaGL.Picker.isPicking(a)||(a._cbClear=b.clone(),a.clearColor(b.getRed(),b.getGreen(),b.getBlue(),b.getAlpha()))},getClearColor:function(a){return a._cbClear.clone()},clearColor:function(a,b){b&&this.setClearColor(a,b);return a._cbClear.clone()},setWriteable:function(a,b,c,d,e){a._cbWriteRed=b;a._cbWriteGreen=
c;a._cbWriteBlue=d;a._cbWriteAlpha=e;a.colorMask(b,c,d,e)},mask:function(a,b,c,d,e){void 0!==b&&(a._cbWriteRed=b,a._cbWriteGreen=c,a._cbWriteBlue=d,a._cbWriteAlpha=e,a.colorMask(b,c,d,e));return[a._cbWriteRed,a._cbWriteGreen,a._cbWriteBlue,a._cbWriteAlpha]},clear:function(a,b){b&&this.setClearColor(a,b);a.clear(GL_COLOR_BUFFER_BIT)},push:function(a){a._cbStack.push({_cbClear:a._cbClear,_cbWriteRed:a._cbWriteRed,_cbWriteGreen:a._cbWriteGreen,_cbWriteBlue:a._cbWriteBlue,_cbWriteAlpha:a._cbWriteAlpha})},
pop:function(a){var b=a._cbStack.pop();this.clearColor(a,b._cbClear);this.setWriteable(a,b._cbWriteRed,b._cbWriteGreen,b._cbWriteBlue,b._cbWriteAlpha)}};
TentaGL.Cull={setMode:function(a,b){a._cullMode!=b&&(a._cullMode=b,b==GL_NONE?a.disable(GL_CULL_FACE):(a.enable(GL_CULL_FACE),a.cullFace(b)))},getMode:function(a){return a._cullMode},mode:function(a,b){void 0!==b&&this.setMode(a,b);return a._cullMode},frontFace:function(a,b){void 0!==b&&b!=a._frontFace&&(a._frontFace=b,a.frontFace(b));return a._frontFace},reset:function(a){a._cullMode=GL_NONE;a._frontFace=GL_CCW;a._cullStack=[]},push:function(a){a._cullStack.push({_cullMode:a._cullMode,_frontFace:a._frontFace})},
pop:function(a){var b=a._cullStack.pop();this.mode(a,b._cullMode);this.frontFace(a,b._frontFace)}};
TentaGL.DepthBuffer={reset:function(a){a._depthEnabled=!1;a._depthFunc=GL_LESS;a._depthWrite=!0;a._depthRange=[0,1];a._depthClearVal=1;a._depthStack=[]},setEnabled:function(a,b){a._depthEnabled!=b&&((a._depthEnabled=b)?a.enable(GL_DEPTH_TEST):a.disable(GL_DEPTH_TEST))},isTestEnabled:function(a){return a._depthEnabled},enabled:function(a,b){void 0!==b&&this.setEnabled(a,b);return a._depthEnabled},setFunc:function(a,b){a._depthFunc!=b&&(a._depthFunc=b,a.depthFunc(b))},getFunc:function(a){return a._depthFunc},
func:function(a,b){void 0!==b&&this.setFunc(a,b);return a._depthFunc},setMaskEnabled:function(a,b){a._depthWrite!=b&&(a._depthWrite=b,a.depthMask(b))},isMaskEnabled:function(a){return a._depthWrite},mask:function(a,b){void 0!==b&&this.setMaskEnabled(a,b);return a._depthWrite},setRange:function(a,b){var c=TentaGL.Math.clamp(b[0],0,1),d=TentaGL.Math.clamp(b[1],0,1);if(c!=a._depthRange[0]||d!=a._depthRange[1])a._depthRange[0]=c,a._depthRange[1]=d,a.depthRange(c,d)},range:function(a,b){void 0!==b&&this.setRange(a,
b);return a._depthRange},getRangeNear:function(a){return a._depthRange[0]},getRangeFar:function(a){return a._depthRange[1]},setClearValue:function(a,b){b=TentaGL.Math.clamp(b,0,1);a._depthClearVal!=b&&(a._depthClearVal=b,a.clearDepth(b))},getClearValue:function(){return gl._depthClearVal},clearValue:function(a,b){void 0!==b&&this.setClearValue(a,b);return a._depthClearVal},clear:function(a){a.clear(GL_DEPTH_BUFFER_BIT)},createBuffer:function(a,b,c){var d=a.createRenderbuffer();a.bindRenderbuffer(GL_RENDERBUFFER,
d);a.renderbufferStorage(GL_RENDERBUFFER,GL_DEPTH_COMPONENT16,b,c);a.bindRenderbuffer(GL_RENDERBUFFER,null);return d},push:function(a){var b={_depthEnabled:a._depthEnabled,_depthFunc:a._depthFunc,_depthWrite:a._depthWrite,_depthRange:a._depthRange.slice(0),_depthClearVal:a._depthClearVal};a._depthStack.push(b)},pop:function(a){var b=a._depthStack.pop();this.enabled(a,b._depthEnabled);this.func(a,b._depthFunc);this.mask(a,b._depthWrite);this.range(a,b._depthRange);this.clearValue(a,b._depthClearVal)}};
TentaGL.RenderMode={};TentaGL.RenderMode.set3DOpaque=function(a){TentaGL.Blend.setEnabled(a,!1);TentaGL.DepthBuffer.setEnabled(a,!0);TentaGL.DepthBuffer.setMaskEnabled(a,!0);TentaGL.Cull.setMode(a,GL_NONE)};TentaGL.RenderMode.set3DTrans=function(a){TentaGL.Blend.setEnabled(a,!0);TentaGL.Blend.setEquation(a,GL_FUNC_ADD,GL_SRC_ALPHA,GL_ONE_MINUS_SRC_ALPHA);TentaGL.DepthBuffer.setEnabled(a,!0);TentaGL.DepthBuffer.setMaskEnabled(a,!1);TentaGL.Cull.setMode(a,GL_NONE)};
TentaGL.RenderMode.set2D=function(a){TentaGL.Blend.setEnabled(a,!0);TentaGL.Blend.setEquation(a,GL_FUNC_ADD,GL_SRC_ALPHA,GL_ONE_MINUS_SRC_ALPHA);TentaGL.DepthBuffer.setEnabled(a,!1);TentaGL.Cull.setMode(a,GL_NONE)};
TentaGL.Scissor={reset:function(a){a._scissorEnabled=!1;a._scissorXYWH=[0,0,a.canvas.width,a.canvas.height];a._scissorStack=[]},enabled:function(a,b){void 0!==b&&a._scissorEnabled!=b&&((a._scissorEnabled=b)?a.enable(GL_SCISSOR_TEST):a.disable(GL_SCISSOR_TEST));return a._scissorEnabled},xywh:function(a,b){void 0!==b&&(a._scissorXYWH=b.slice(0),a.scissor(b[0],b[1],b[2],b[3]));return a._scissorXYWH.slice(0)},push:function(a){var b={_scissorEnabled:a._scissorEnabled,_scissorXYWH:a._scissorXYWH.slice(0)};
a._scissorStack.push(b)},pop:function(a){this.xywh(a,a._scissorStack.pop())}};
TentaGL.Stencil={enabled:function(a,b){void 0!==b&&b!=a._stencilEnabled&&((a._stencilEnabled=b)?a.enable(GL_STENCIL_TEST):a.disable(GL_STENCIL_TEST));return a._stencilEnabled},clearValue:function(a,b){void 0!==b&&b!=a._stencilClearVal&&(a._stencilClearVal=b,a.clearStencil(b));return a._stencilClearVal},clear:function(a,b){void 0!==b&&this.clearValue(a,b);a.clear(GL_STENCIL_BUFFER_BIT)},func:function(a,b,c,d){void 0!==b&&(void 0===d&&(d=255),a._stencilFunc=b,a._stencilRef=c,a._stencilMask=d,a.stencilFunc(b,
c,d));return a._stencilFunc},getRef:function(a){return a._stencilRef},mask:function(a,b){void 0!==b&&(a._stencilWriteMask=b,a.stencilMask(b));return a._stencilWriteMask},op:function(a,b,c,d){void 0!==b&&(a._stencilFailS=b,a._stencilFailDP=c,a._stencilPassDP=d,a.stencilOp(b,c,d));return[a._stencilFailS,a._stencilFailDP,a._stencilPassDP]},createStencilBuffer:function(a,b,c){var d=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,d);a.renderbufferStorage(a.RENDERBUFFER,a.STENCIL_INDEX8,b,c);a.bindRenderbuffer(a.RENDERBUFFER,
null);return d},reset:function(a){a._stencilEnabled=!1;a._stencilClearVal=0;a._stencilFunc=GL_ALWAYS;a._stencilRef=0;a._stencilMask=255;a._stencilWriteMask=255;a._stencilFailS=GL_KEEP;a._stencilFailDP=GL_KEEP;a._stencilPassDP=GL_KEEP;a._stencilStack=[]},push:function(a){a._stencilStack.push({_stencilEnabled:a._stencilEnabled,_stencilClearVal:a._stencilClearVal,_stencilFunc:a._stencilFunc,_stencilRef:a._stencilRef,_stencilMask:a._stencilMask,_stencilWriteMask:a._stencilWriteMask,_stencilFailS:a._stencilFailS,
_stencilFailDP:a._stencilFailDP,_stencilPassDP:a._stencilPassDP})},pop:function(a){var b=a._stencilStack.pop();this.enabled(a,b._stencilEnabled);this.clearValue(a,b._stencilClearVal);this.func(a,b._stencilFunc,b._stencilRef,b._stencilMask);this.mask(a,b._stencilWriteMask);this.op(a,b._stencilFailS,b._stencilFailDP,b._stencilPassDP)}};
TentaGL.Viewport={xywh:function(a,b){void 0!==b&&(a._viewportXYWH=b.slice(0),a.viewport(b[0],b[1],b[2],b[3]));return a._viewportXYWH.slice(0)},getX:function(a){return a._viewX},getY:function(a){return a._viewY},getWidth:function(a){return a._viewWidth},getHeight:function(a){return a._viewHeight},reset:function(a){a._viewportXYWH=[0,0,a.canvas.width,a.canvas.height];a._viewportStack=[]},push:function(a){var b={_viewportXYWH:a._viewportXYWH.slice(0)};a._viewportStack.push(b)},pop:function(a){var b=
a._viewportStack.pop();this.xywh(a,b._viewportXYWH)}};TentaGL.TAU=2*Math.PI;
TentaGL.Math={toPolar:function(a){var b=vec3.fromValues(a[0],a[1],a[2]),c=vec3.length(b),b=vec3.normalize(b,b),b=Math.asin(this.clamp(b[1],-1,1)),d;0==a[0]?d=0<a[2]?.75*TentaGL.TAU:.25*TentaGL.TAU:(d=Math.atan(-a[2]/a[0]),0>a[0]&&(d+=TentaGL.TAU/2));return vec3.fromValues(c,d,b)},toCartesian:function(a){var b=a[0]*Math.cos(a[1])*Math.cos(a[2]),c=a[0]*Math.sin(a[2]);a=0-a[0]*Math.sin(a[1])*Math.cos(a[2]);return vec3.fromValues(b,c,a)},clamp:function(a,b,c){return Math.min(c,Math.max(a,b))},wrap:function(a,
b,c){c-=b;a=(a-b)%c;0>a&&(a+=c);return a+b},linearMap:function(a,b,c){return c[0]+(a-b[0])/(b[1]-b[0])*(c[1]-c[0])},ptsMinX:function(a){for(var b,c=0;c<a.length;c++){var d=a[c];if(!b||d[0]<b[0])b=d}return b},ptsMaxX:function(a){for(var b,c=0;c<a.length;c++){var d=a[c];if(!b||d[0]>b[0])b=d}return b},ptsMinY:function(a){for(var b,c=0;c<a.length;c++){var d=a[c];if(!b||d[1]<b[1])b=d}return b},ptsMaxY:function(a){for(var b,c=0;c<a.length;c++){var d=a[c];if(!b||d[1]>b[1])b=d}return b},ptsMinZ:function(a){for(var b,
c=0;c<a.length;c++){var d=a[c];if(!b||d[2]<b[2])b=d}return b},ptsMaxZ:function(a){for(var b,c=0;c<a.length;c++){var d=a[c];if(!b||d[2]>b[2])b=d}return b},ptsEqual:function(a,b,c){c||(c=0);var d=Math.abs(a[0]-b[0]);a=Math.abs(a[1]-b[1]);return d<=c&&a<=c},vectorAngle:function(a,b){var c=vec3.normalize(vec3.create(),a),d=vec3.normalize(vec3.create(),b),e=vec3.cross(vec3.create(),a,b);nMag=vec3.length(e);c=Math.acos(vec3.dot(c,d));0>nMag&&(c=TentaGL.TAU-c);return c},tweenVector:function(a,b,c){var d=
vec3.normalize(vec3.create(),a),e=vec3.normalize(vec3.create(),b);a=vec3.cross(vec3.create(),a,b);nMag=vec3.length(a);e=Math.acos(vec3.dot(d,e));0>nMag?e=TentaGL.TAU-e:0==nMag&&(a=[0,0,1]);a=vec3.normalize(a,a);c=quat.setAxisAngle(quat.create(),a,e*c);return vec3.transformQuat(vec3.create(),d,c)},matChangeBasis:function(a,b,c){var d=mat3.create();d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b[0];d[4]=b[1];d[5]=b[2];d[6]=c[0];d[7]=c[1];d[8]=c[2];return d},getQuatFromTo:function(a,b){var c=vec3.normalize(this._vec3_1,
a),d=vec3.normalize(this._vec3_2,b),e=vec3.cross(this._vec3_3,c,d);vec3.normalize(e,e);d=TentaGL.Math.clamp(vec3.dot(c,d),-1,1);c=vec3.length(e);d=Math.acos(d);0>c&&(d=0-d);e=quat.setAxisAngle(quat.create(),e,d);return quat.normalize(e,e)},getOrientation:function(a,b,c,d){a=this.getQuatFromTo(a,c);b=vec3.transformQuat(vec3.create(),b,a);d=this.getQuatFromTo(b,d);quat.mul(a,d,a);return a},getPowerOfTwo:function(a){for(var b=1;b<a;)b*=2;return b},_vec3_1:vec3.create(),_vec3_2:vec3.create(),_vec3_3:vec3.create()};
TentaGL.Math.Shape2D=function(){};TentaGL.Math.Shape2D.prototype={constructor:TentaGL.Math.Shape2D,isaShape2D:!0,containsPt:function(a){},getBoundingBox:function(){},render:function(a,b){}};Util.Inheritance.inherit(TentaGL.Math.Shape2D,TentaGL.Renderable);TentaGL.Math.Ellipse2D=function(a,b,c){void 0===c&&(c=b);this._pt=a;this._rx=b;this._ry=c};
TentaGL.Math.Ellipse2D.prototype={constructor:TentaGL.Math.Ellipse2D,isaEllipse2D:!0,clone:function(){return new TentaGL.Math.Ellipse2D(this._pt.slice(0),this._rx,this._ry)},x:function(a){void 0!==a&&(this._pt[0]=a);return this._pt[0]},y:function(a){void 0!==a&&(this._pt[1]=a);return this._pt[1]},xy:function(a){void 0!==a&&(this._pt=vec2.clone(a));return vec2.clone(this._pt)},radius:function(a){void 0!==a&&(this._ry=this._rx=a);return this._rx},radiusX:function(a){void 0!==a&&(this._rx=a);return this._rx},
radiusY:function(a){void 0!==a&&(this._ry=a);return this._ry},containsPt:function(a){a=a.slice(0);a[0]-=this._pt[0];a[1]-=this._pt[1];var b=mat3.create();mat3.scale(b,b,[1/this._rx,1/this._ry,0]);vec2.transformMat3(a,a,b);return 1>=a[0]*a[0]+a[1]*a[1]},getBoundingBox:function(){return new TentaGL.Math.Rect2D([this._pt[0]-this._rx,this._pt[1]-this._ry,2*this._rx,2*this._ry])},render:function(a,b){TentaGL.ShaderLib.push(a);TentaGL.ViewTrans.push(a);TentaGL.ShaderLib.use(a,a._circleShaderProgramName);
b&&TentaGL.MaterialLib.use(a,b);TentaGL.ViewTrans.translate(a,this._pt);TentaGL.ViewTrans.scale(a,[2*this._rx,2*this._ry]);TentaGL.ViewTrans.translate(a,[-.5,-.5]);TentaGL.ModelLib.render(a,"unitPlane");TentaGL.ViewTrans.pop(a);TentaGL.ShaderLib.pop(a)}};TentaGL.Math.Ellipse2D.fromRect=function(a){var b=a.width()/2,c=a.height()/2,d=a.x()+b;a=a.y()+c;return new TentaGL.Math.Ellipse2D([d,a],b,c)};Util.Inheritance.inherit(TentaGL.Math.Ellipse2D,TentaGL.Math.Shape2D);
TentaGL.Math.Line2D=function(a,b){this._p1=vec3.clone(a);this._p1[2]=1;this._p2=vec3.clone(b);this._p2[2]=1;this._length=vec2.dist(a,b)};
TentaGL.Math.Line2D.prototype={constructor:TentaGL.Math.Line2D,isaLine2D:!0,clone:function(){return new TentaGL.Math.Line2D(this._p1,this._p2)},getPt1:function(){return this._p1},getPt2:function(){return this._p2},getLength:function(){return this._length},getVec3:function(){return vec3.sub(vec3.create(),this._p2,this._p1)},getAngle:function(){var a=this.getVec3();return Math.atan2(a[1],a[0])},distToPt:function(a){var b=this.getVec3(),c=vec2.sub(vec2.create(),a,this._p1);a=vec2.sub(vec2.create(),a,
this._p2);if(0>=vec2.dot(b,c))return vec2.len(c);if(0<=vec2.dot(b,a))return vec2.len(a);b=vec2.normalize(vec2.create(),b);a=vec2.normalize(vec2.create(),c);b=vec2.cross(vec2.create(),b,a);return vec2.len(c)*vec3.len(b)},distToLine:function(a){if(this.intersects(a))return 0;var b=this.distToPt(a._p1),c=this.distToPt(a._p2),d=a.distToPt(this._p1);a=a.distToPt(this._p2);return Math.min(b,c,d,a)},containsPt:function(a,b){b||(b=0);var c=this.getVec3(),d;d=0==this._length?0:0==c[0]?(a[1]-this._p1[1])/c[1]:
(a[0]-this._p1[0])/c[0];return Math.ptsEqual(a,[this._p1[0]+d*c[0],this._p1[1]+d*c[1]],b)},intersects:function(a){return void 0!=this.intersection(a)},intersection:function(a,b){b||(b=0);if(0==this._length&&a.containsPt(this._p1))return this._p1;if(0==a._length&&this.containsPt(a._p1))return a._p1;var c=mat3.create();mat3.scale(c,c,[1/this._length,1,1]);mat3.rotate(c,c,-this.getAngle());mat3.translate(c,c,[-this._p1[0],-this._p1[1]]);var d=mat3.invert(mat3.create(),c),c=a.transformMat3(c),e=c.getVec3();
if(0==e[1]&&0!=c._p1[1]){if(0==c._p1[1]){if(c.containsPt([0,0],b)){if(c.containsPt([1,0],b))return this.clone();c=TentaGL.Math.ptsMaxX([c._p1,c._p2]);vec3.transformMat3(c,c,d);return new TentaGL.Math.Line2D(this._p1,c)}if(c.containsPt([1,0],b))return c=TentaGL.Math.ptsMinX([c._p1,c._p2]),vec3.transformMat3(c,c,d),new TentaGL.Math.Line2D(c,this._p2)}}else if(c=c._p1[0]+-c._p1[1]/e[1]*e[0],c>=0-b&&c<=1+b)return c=[c,0,1],vec3.transformMat3(c,c,d),c},transformMat3:function(a){var b=vec3.clone(this._p1),
b=vec3.transformMat3(vec3.create(),b,a),c=vec3.clone(this._p2);vec3.transformMat3(c,c,a);return new TentaGL.Math.Line2D(b,c)},transformMat4:function(a){var b=vec3.clone(this._p1);vec3.transformMat4(b,b,a);var c=vec3.clone(this._p2);vec3.transformMat4(c,c,a);return new TentaGL.Math.Line2D(b,c)},relativeCCW:function(a){var b=this.getVec3();a=vec3.sub(vec3.create(),a,this._p1);b=vec3.cross(a,b,a);return 0<b[2]?-1:0>b[2]?1:0},ptIsAbove:function(a,b){var c=this.relativeCCW(a);b&&(c*=-1);return 0>c},ptIsBelow:function(a,
b){var c=this.relativeCCW(a);b&&(c*=-1);return 0<c},render:function(a,b){var c=vec3.clone(this._p1);c[2]=0;var d=vec3.clone(this._p2);d[2]=0;var e=d[0]-c[0],d=d[1]-c[1];TentaGL.ViewTrans.push(a);var f=mat4.create();mat4.translate(f,f,[c[0],c[1],0]);mat4.scale(f,f,[e,d,0]);TentaGL.ViewTrans.mul(a,f);TentaGL.ViewTrans.updateMVPUniforms(a);TentaGL.MaterialLib.use(a,b);TentaGL.ModelLib.render(a,"unitLine");TentaGL.ViewTrans.pop(a)}};
TentaGL.Math.Rect2D=function(a,b,c){void 0===c&&(c=b);this._xy=a;this._w=b;this._h=c};
TentaGL.Math.Rect2D.prototype={constructor:TentaGL.Math.Rect2D,isaRect2D:!0,clone:function(){return new TentaGL.Math.Rect2D(this._xy.slice(0),this._w,this._h)},xy:function(a){void 0!==a&&(this._xy=a);return this._xy},x:function(a){void 0!==a&&(this._xy[0]=a);return this._xy[0]},y:function(a){void 0!==a&&(this._xy[1]=a);return this._xy[1]},width:function(a){void 0!==a&&(this._w=a);return this._w},height:function(a){void 0!==a&&(this._h=a);return this._h},xywh:function(a){void 0!==a&&(this._xy=a.slice(0,
2),this._w=a[2],this._h=a[3]);return[this._xy[0],this._xy[1],this._w,this._h]},containsPt:function(a){return!(a[0]<this._xy[0]||a[1]<this._xy[1]||a[0]>this._xy[0]+this._w||a[1]>this._xy[1]+this._h)},getBoundingBox:function(){return this.clone()},intersection:function(a){if(this.intersectsRect(a)){var b=Math.max(this._xy[0],a._xy[0]),c=Math.min(this._xy[0]+this._w,a._xy[0]+a._w),d=Math.max(this._xy[1],a._xy[1]);a=Math.min(this._xy[1]+this._h,a._xy[1]+a._h);return new TentaGL.Math.Rect2D([b,d],c-b,
a-d)}},intersectsRect:function(a){return!(this._xy[0]>a._xy[0]+a._w||this._xy[0]+this._w<a._xy[0]||this._xy[1]>a._xy[1]+a._h||this._xy[1]+this._h<a._xy[1])},intersectsLine:function(a){if(this.containsPt(a.getPt1())||this.containsPt(a.getPt2()))return!0;var b=this._xy[1]+this._h,c=this._xy[1],d=this._xy[0],e=this._xy[0]+this._w;return a.intersects(new TentaGL.Math.Line2D([d,b],[e,b]))||a.intersects(new TentaGL.Math.Line2D([d,c],[e,c]))||a.intersects(new TentaGL.Math.Line2D([d,b],[d,c]))||a.intersects(new TentaGL.Math.Line2D([e,
b],[e,c]))},render:function(a,b){TentaGL.ViewTrans.push(a);b&&TentaGL.MaterialLib.use(a,b);TentaGL.ViewTrans.translate(a,this._xy);TentaGL.ViewTrans.scale(a,[this._w,this._h]);TentaGL.ModelLib.render(a,"unitPlane");TentaGL.ViewTrans.pop(a)}};Util.Inheritance.inherit(TentaGL.Math.Rect2D,TentaGL.Math.Shape2D);TentaGL.Math.Shape3D=function(){};TentaGL.Math.Shape3D.prototype={constructor:TentaGL.Math.Shape3D,isaShape3D:!0,containsPt:function(a,b){},getBoundingBox:function(){},render:function(a,b){}};
Util.Inheritance.inherit(TentaGL.Math.Shape3D,TentaGL.Renderable);TentaGL.Math.Line3D=function(a,b){this._p1=vec4.clone(a);this._p1[3]=1;this._p2=vec4.clone(b);this._p2[3]=1;this._length=vec3.dist(a,b)};
TentaGL.Math.Line3D.prototype={constructor:TentaGL.Math.Line3D,isaLine3D:!0,clone:function(){return new TentaGL.Math.Line3D(this._p1,this._p2)},getPt1:function(){return this._p1},getPt2:function(){return this._p2},getLength:function(){return this._length},getVec3:function(){return vec3.sub([],this._p2,this._p1)},getQuat:function(){var a=this.getVec3();return TentaGL.Math.getQuatFromTo([1,0,0],a)},distToPt:function(a){var b=this.getVec3(),c=vec3.sub(vec3.create(),a,this._p1);a=vec3.sub(vec3.create(),
a,this._p2);if(0>=vec3.dot(b,c))return vec3.len(c);if(0<=vec3.dot(b,a))return vec3.len(a);b=vec3.normalize(vec3.create(),b);a=vec3.normalize(vec3.create(),c);b=vec3.cross(vec3.create(),b,a);return vec3.len(c)*vec3.len(b)},distToLine:function(a){var b=vec4.clone(this._p1),c=this.getVec3(),d=vec4.clone(a._p1);d[3]=1;a=a.getVec3();var e=TentaGL.Math.getQuatFromTo(c,[1,0,0]),e=mat4.fromQuat(mat4.create(),e),f=mat4.create();mat4.translate(f,f,[-b[0],-b[1],-b[2]]);var g=mat4.create();mat4.scale(g,g,1/vec3.length(c));
e=mat4.mul(mat4.create(),e,f);mat4.mul(e,g,e);g=vec4.transformMat4(vec4.create(),d,e);f=vec3.transformMat4(vec3.create(),a,e);e=mat2.create();e[0]=f[0]*f[0]+f[1]*f[1]+f[2]*f[2];e[1]=f[0];e[2]=f[0];e[3]=1;g=vec2.fromValues(-vec3.dot(g,f),-g[0]);e=vec2.transformMat2(vec2.create(),mat2.invert(e,e),g);b=vec3.add(vec3.create(),b,vec3.scale(vec3.create(),c,e[1]));d=vec3.add(vec3.create(),d,vec3.scale(vec3.create(),a,e[0]));return vec3.dist(b,d)},render:function(a,b){var c=vec3.clone(this._p1);vec3.clone(this._p2);
var d=this.getVec3();TentaGL.ViewTrans.push(a);TentaGL.ViewTrans.translate(a,c);TentaGL.ViewTrans.scale(a,d);TentaGL.ViewTrans.updateMVPUniforms(a);b&&TentaGL.MaterialLib.use(a,b);TentaGL.ModelLib.render(a,"unitLine");TentaGL.ViewTrans.pop(a)}};TentaGL.Math.Plane=function(a,b){b||(b=[0,0,0]);this._normal=vec3.clone(a);this._nHat=vec3.normalize(vec3.create(),this._normal);this._pt=vec3.clone(b)};
TentaGL.Math.Plane.prototype={constructor:TentaGL.Math.Plane,isaInfinitePlane:!0,getNormal:function(){return this._normal},getUnitNormal:function(){return this._nHat},getPoint:function(){return this._pt},distToPt:function(a){var b=vec3.sub(vec3.create(),a,this._pt);a=vec3.len(b);if(0==a)return 0;b=vec3.normalize(vec3.create(),b);b=vec3.dot(b,this._nHat);return Math.abs(a*b)},getCoefficients:function(){var a=this._normal[0],b=this._normal[1],c=this._normal[2];return[a,b,c,-a*this._pt[0]-b*this._pt[1]-
c*this._pt[2]]},getParallelVectors:function(){var a=this._pt,b;if(0==this._normal[0])b=[a[0]+1,a[1],a[2]];else if(0==this._normal[1])b=[a[0],a[1]+1,a[2]];else if(0==this._normal[2])b=[a[0],a[1],a[2]+1];else{b=this.getCoefficients();var c=a[0]+1;b=[c,0,(-b[0]*c-b[3])/b[2]]}a=vec3.sub(vec3.create(),b,a);b=vec3.cross(vec3.create(),a,this._normal);return[a,b]},containsPt:function(a,b){b||(b=0);var c=this.getCoefficients();return Math.abs(c[0]*a[0]+c[1]*a[1]+c[2]*a[2]+c[3])<b},ptRelative:function(a){a=
vec3.sub(vec3.create(),a,this._pt);vec3.normalize(a,a);a=vec3.dot(this._nHat,a);return 0<a?1:0>a?-1:0},ptIsAbove:function(a){return 1==ptRelative(a)},ptIsBelow:function(a){return-1==ptRelative(a)},lineIntersection:function(a){var b=this.getPoint(),c=a.getPt1(),d=this.getNormal(),e=a.getVec3(),b=vec3.dot(d,vec3.sub(vec3.create(),b,c)),d=vec3.dot(d,e);if(0==d){if(0==b)return a}else return a=b/d,vec4.fromValues(c[0]+a*e[0],c[1]+a*e[1],c[2]+a*e[2],1)},segmentIntersection:function(a){var b=this.getPoint(),
c=a.getPt1(),d=this.getNormal(),e=a.getVec3(),b=vec3.dot(d,vec3.sub(vec3.create(),b,c)),d=vec3.dot(d,e);if(0==d){if(0==b)return a}else if(a=b/d,a=vec4.fromValues(c[0]+a*e[0],c[1]+a*e[1],c[2]+a*e[2],1),c=0!=e[0]?(a[0]-c[0])/e[0]:0!=e[1]?(a[1]-c[1])/e[1]:(a[2]-c[2])/e[2],0<=c&&1>=c)return a},getBoundingBox:function(){},getQuad:function(){var a=this.getParallelVectors();return new TentaGL.Math.Quad(this._pt,a[0],a[1])},render:function(a,b){TentaGL.ViewTrans.push(a);b&&TentaGL.MaterialLib.use(a,b);var c=
TentaGL.ViewTrans.getMVP(a),d=vec3.copy([],this._pt);d[3]=1;var e=vec3.add([],this._pt,this._normal);e[3]=1;vec4.transformMat4(d,d,c);vec4.transformMat4(e,e,c);vec4.scale(d,d,1/d[3]);vec4.scale(e,e,1/e[3]);for(var e=vec3.sub([],e,d),f=new TentaGL.Math.Plane(e,d),g=(new TentaGL.Math.Rect3D([-1,-1,-1],2,2,2)).getEdges(),d=[],e=0;e<g.length;e++){var h=f.segmentIntersection(g[e]);void 0===h||h.isaLine3D||(h=vec3.copy([],h),h[3]=1,d.push(h))}if(0<d.length){f=new TentaGL.Model(GL_TRIANGLES,GL_NONE);mat4.invert(c,
c);for(e=0;e<d.length;e++)vec4.transformMat4(d[e],d[e],c),vec4.scale(d[e],d[e],1/d[e][3]),g=new TentaGL.Vertex(d[e]),g.normal(this._normal),g.st([0,0]),f.addVertex(g);console.log(d.slice(0));for(e=0;e<d.length-2;e++)for(c=e+1;c<d.length-1;c++)for(g=c+1;g<d.length;g++)f.addFace(e,c,g);c=new TentaGL.VBOData(a,f,TentaGL.getDefaultAttrProfileSet());TentaGL.ViewTrans.updateMVPUniforms(a);TentaGL.VBORenderer.render(a,c);c.clean(a)}TentaGL.ViewTrans.pop(a);this.getQuad().render(a,"blue")}};
Util.Inheritance.inherit(TentaGL.Math.Plane,TentaGL.Math.Shape3D);TentaGL.Math.Quad=function(a,b,c){this._pts=[];this._pts[0]=a;this._u=b;this._v=c;this._update()};
TentaGL.Math.Quad.prototype={constructor:TentaGL.Math.Quad,isaQuad:!0,_update:function(){this._pts[1]=vec3.add(vec3.create(),this._pts[0],this._u);this._pts[2]=vec3.add(vec3.create(),this._pts[1],this._v);this._pts[3]=vec3.add(vec3.create(),this._pts[0],this._v);this._n=vec3.cross(vec3.create(),this._u,this._v);vec3.normalize(this._n,this._n);this._initModel()},_initModel:function(){this._model=new TentaGL.Model(GL_TRIANGLES,GL_NONE);var a=new TentaGL.Vertex(this._pts[0]);a.normal(this._n);a.st([0,
0]);this._model.addVertex(a);a=new TentaGL.Vertex(this._pts[1]);a.normal(this._n);a.st(1,0);this._model.addVertex(a);a=new TentaGL.Vertex(this._pts[2]);a.normal(this._n);a.st(1,1);this._model.addVertex(a);a=new TentaGL.Vertex(this._pts[3]);a.normal(this._n);a.st(0,1);this._model.addVertex(a);this._model.addFaceQuad(0,1,2,3)},getPt:function(a){a=TentaGL.Math.clamp(a,0,3);return this._pts[a]},pt:function(a){void 0!==xy&&(this._pts[0]=a,this._update());return this._pts[0]},u:function(a){void 0!==a&&
(this._u=a,this._update());return this._u},v:function(a){void 0!==a&&(this._v=a,this._update());return this._v},containsPt:function(a,b){b||(b=0);var c=mat3.create(),d=this._pts[0];c[0]=this._u[0];c[1]=this._u[1];c[2]=this._u[2];c[3]=this._v[0];c[4]=this._v[1];c[5]=this._v[2];c[6]=d[0];c[7]=d[1];c[8]=d[2];d=mat3.invert(mat3.create(),c);c=vec3.create();vec3.transformMat3(c,a,d);var d=c[0],e=c[1];return 0<=d&&1>=d&&0<=e&&1>=e&&Math.abs(c[2]-1)<=b},getBoundingBox:function(){for(var a=this._pts[0][0],
b=this._pts[0][0],c=this._pts[0][1],d=this._pts[0][1],e=this._pts[0][2],f=this._pts[0][2],g=1;3>=g;g++){var h=this._pts[g];h[0]<a&&(a=h[0]);h[0]>b&&(b=h[0]);h[1]<d&&(d=h[1]);h[1]>c&&(c=h[1]);h[2]<f&&(f=h[2]);h[2]>e&&(e=h[2])}return new TentaGL.Math.Rect3D([a,d,f],b-a,c-d,e-f)},render:function(a,b){TentaGL.ViewTrans.push(a);var c=new TentaGL.VBOData(a,this._model,TentaGL.getDefaultAttrProfileSet());b&&TentaGL.MaterialLib.use(a,b);TentaGL.ViewTrans.updateMVPUniforms(a);TentaGL.VBORenderer.render(a,
c);c.clean(a);TentaGL.ViewTrans.pop(a)}};Util.Inheritance.inherit(TentaGL.Math.Quad,TentaGL.Math.Shape3D);TentaGL.Math.Rect3D=function(a,b,c,d){this._pt=a.slice(0);this._w=b;this._h=c;this._d=d};
TentaGL.Math.Rect3D.prototype={constructor:TentaGL.Math.Rect3D,isaRect3D:!0,clone:function(){return new TentaGL.Math.Rect3D(this._pt,this._w,this._h,this._d)},xyz:function(a){void 0!==a&&(this._pt=a.slice(0));return a.slice(0)},x:function(a){void 0!==a&&(this._pt[0]=a);return this._pt[0]},y:function(a){void 0!==a&&(this._pt[1]=a);return this._pt[1]},z:function(a){void 0!==a&&(this._pt[2]=a);return this._pt[2]},width:function(a){void 0!==a&&(this._w=a);return this._w},height:function(a){void 0!==a&&
(this._h=a);return this._h},depth:function(a){void 0!==a&&(this._d=a);return this._d},getEdges:function(){var a=[],b=this._pt[0],c=this._pt[1],d=this._pt[2],e=b+this._w,f=c+this._h,g=d+this._d;a.push(new TentaGL.Math.Line3D([b,c,d],[e,c,d]));a.push(new TentaGL.Math.Line3D([b,c,d],[b,f,d]));a.push(new TentaGL.Math.Line3D([b,c,d],[b,c,g]));a.push(new TentaGL.Math.Line3D([b,f,d],[e,f,d]));a.push(new TentaGL.Math.Line3D([b,f,d],[b,f,g]));a.push(new TentaGL.Math.Line3D([e,c,d],[e,f,d]));a.push(new TentaGL.Math.Line3D([b,
c,g],[b,f,g]));a.push(new TentaGL.Math.Line3D([b,c,g],[e,c,g]));a.push(new TentaGL.Math.Line3D([e,c,d],[e,c,g]));a.push(new TentaGL.Math.Line3D([e,f,g],[b,f,g]));a.push(new TentaGL.Math.Line3D([e,f,g],[e,c,g]));a.push(new TentaGL.Math.Line3D([e,f,g],[e,f,d]));return a},containsPt:function(a,b){return!(a[0]<this.x()||a[0]>this.x()+this.width()||a[1]<this.y()||a[1]>this.y()+this.height()||a[2]<this.z()||a[2]>this.z()+this.depth())},getBoundingBox:function(){return this.clone()},render:function(a,b){TentaGL.ViewTrans.push(a);
b&&TentaGL.MaterialLib.use(a,b);TentaGL.ViewTrans.translate(a,this._pt);TentaGL.ViewTrans.scale(a,[this._w,this._h,this._d]);TentaGL.ModelLib.render(a,"unitCube");TentaGL.ViewTrans.pop(a)}};Util.Inheritance.inherit(TentaGL.Math.Rect3D,TentaGL.Math.Shape3D);TentaGL.Math.Sphere=function(a,b){b||(b=[0,0,0]);this._pt=vec3.clone(b);this._radius=a};
TentaGL.Math.Sphere.prototype={constructor:TentaGL.Math.Sphere,isaSphere:!0,clone:function(){return new TentaGL.Math.Sphere(this._radius,this._pt)},getRadius:function(){return this._radius},getPoint:function(){return this._pt},distToPt:function(a){a=vec3.sub(vec3.create(),a,this._pt);return Math.abs(vec3.len(a)-this._radius)},containsPt:function(a){a=vec3.sub(vec3.create(),a,this._pt);return vec3.len(a)<=this._radius},getBoundingBox:function(){var a=2*this._radius;return new TentaGL.Math.Rect3D([this._pt[0]-
this._radius,this._pt[1]-this._radius,this._pt[2]-this._radius],a,a,a)},surfaceContainsPt:function(a,b){b||(b=0);var c=vec3.sub(vec3.create(),a,this._pt);return Math.abs(vec3.len(c)-this._radius)<=b},intersectsSphere:function(a){var b=vec3.sqrDist(this._pt,a._pt);a=this._radius+a._radius;return b<=a*a},intersectsPlane:function(a){return a.distToPt(this._pt)<=this._radius},render:function(a,b){var c=vec3.clone(this._pt),d=this._radius;TentaGL.ViewTrans.push(a);var e=mat4.create();mat4.translate(e,
e,c);mat4.scale(e,e,[d,d,d]);TentaGL.ViewTrans.mul(a,e);TentaGL.ViewTrans.updateMVPUniforms(a);b&&TentaGL.MaterialLib.use(a,b);TentaGL.ModelLib.render(a,"unitSphere");TentaGL.ViewTrans.pop(a)}};Util.Inheritance.inherit(TentaGL.Math.Sphere,TentaGL.Math.Shape3D);
TentaGL.Application=function(a,b){console.log("TentaGL version "+TentaGL.versionMajor+"."+TentaGL.versionMinor);this._container=a;var c=TentaGL.createCanvas(a);this._gl=TentaGL.createGL(c,b);this._canvas=this._gl.canvas;this._keyboard=new TentaGL.Keyboard(a);this._mouse=new TentaGL.Mouse(c);this._picker=new TentaGL.Picker(this);this._levelManager=new TentaGL.LevelManager;a.onresize=function(){console.log(a.offsetWidth,a.offsetHeight)};this._resizeListeners=[]};
TentaGL.Application.prototype={construct:TentaGL.Application,start:function(){this.initResources();this.run(0)},initResources:function(){var a=this.getGL();TentaGL.ShaderLib.reset(a);TentaGL.ModelLib.reset(a);TentaGL.MaterialLib.reset(a);this.initShaders();this.initMaterials();this.initModels();this.reset()},run:function(a){this._isRunning=!0;if(!(this._tryEndApp()||this._tryResetApp()||this.isPaused())){this._lastTimestamp||(this._lastFPSTimestamp=this._lastTimestamp=a,this._fpsCount=0);1E3<a-this._lastFPSTimestamp&&
(console.log("running. FPS: "+this._fpsCount),this._lastFPSTimestamp=a,this._fpsCount=0);var b=this.getGL();TentaGL.ViewTrans.reset(b);TentaGL.SceneNode.resetRenderFilter();this._keyboard.poll();this._mouse.poll();this.update();this._lastTimestamp=a;this._fpsCount++;this._nextFrameID=requestAnimationFrame(this.run.bind(this))}},_tryEndApp:function(){return this._endFlag?(console.log("Ending application"),this._isRunning=this._endFlag=!1,!0):!1},_tryResetApp:function(){return this._hardResetFlag?(console.log("Reseting application"),
this._hardResetFlag=!1,this.start(),!0):!1},isPaused:function(){return this._isPaused},isRunning:function(){return this._isRunning},end:function(){this._endFlag=!0},hardReset:function(){this._hardResetFlag=!0},setPaused:function(a){a?this._isPaused=!0:this._isPaused&&(this._isPaused=!1,this._isRunning&&this.run(0))},setLevel:function(a){this._levelManager.set(a)},getLevel:function(){return this._levelManager.get()},getLevelManager:function(){return this._levelManager},getContainer:function(){return this._container},
getCanvas:function(){return this._canvas},getGL:function(){return this._gl},getPicker:function(){return this._picker},getWidth:function(){return this._canvas.offsetWidth},getHeight:function(){return this._canvas.offsetHeight},getAspectRatio:function(){return this.getWidth()/this.getHeight()},resize:function(a,b){var c=this.getCanvas(),d=this.getContainer(),e=this.getWidth(),f=this.getHeight();c.width=a;c.height=b;TentaGL.Viewport.xywh(this.getGL(),[0,0,a,b]);d.style.width=a;d.style.height=b;var c=
new TentaGL.AppResizeEvent(this,a,b,e,f),g;for(g in this._resizeListeners)this._resizeListeners[g].handleAppResizeEvent(c)},addAppResizeListener:function(a){this._resizeListeners.push(a)},removeAppResizeListener:function(a){a=this._resizeListeners.indexOf(a);if(-1==a)throw Error("Failed to unsubscribe AppResizeListener.");this._resizeListeners.splice(a,1)},keyboard:function(){return this._keyboard},mouse:function(){return this._mouse},initShaders:function(){},initMaterials:function(){},initModels:function(){},
reset:function(){},update:function(){}};TentaGL.Level=function(a){this._app=a};TentaGL.Level.prototype={constructor:TentaGL.Level,isaLevel:!0,getApp:function(){return this._app},keyboard:function(){return this._app.keyboard()},mouse:function(){return this._app.mouse()},picker:function(){return this._app.getPicker()},clean:function(a){},reset:function(a){},update:function(a){},render:function(a){}};TentaGL.LevelManager=function(){this._nextLevel=this._curLevel=void 0};
TentaGL.LevelManager.prototype={constructor:TentaGL.LevelManager,isaLevelManager:!0,get:function(){return this._curLevel},set:function(a){this._nextLevel=a},run:function(a){this._nextLevel&&(this._curLevel&&this._curLevel.clean(a),this._nextLevel.reset(a),this._curLevel=this._nextLevel,this._nextLevel=void 0);this._curLevel.update(a);this._curLevel.render(a)}};
TentaGL.AudioLoader={_numLoading:0,load:function(a,b,c){var d=this;this._numLoading++;c||(c=function(){d._numLoading--;throw Error("Could not load image at "+a+".");});var e=new Audio;e.onloadeddata=function(){b(e);d._numLoading--};e.src=a;e.load()},isLoading:function(){return 0<this._numLoading}};TentaGL.Camera=function(){};
TentaGL.Camera.prototype={constructor:TentaGL.Camera,getTransform:function(a){return mat4.mul(mat4.create(),this.getProjectionTransform(a),this.getViewTransform())},getViewTransform:function(){return mat4.create()},getProjectionTransform:function(a){return mat4.create()}};
TentaGL.Camera2D=function(a,b,c,d){void 0==d&&(d=!0);this._yFlipped=d;this._eye=vec2.fromValues(a[0],a[1]);this._width=b;this._height=c;this._anchor=vec2.fromValues(Math.floor(this._width/2),Math.floor(this._height/2));this._angle=0;this._zoom=1};
TentaGL.Camera2D.prototype={constructor:TentaGL.Camera2D,getEye:function(){return vec2.clone(this._eye)},getX:function(){return this._eye[0]},getY:function(){return this._eye[1]},setEye:function(a){this._eye=vec2.fromValues(a[0],a[1])},getWidth:function(){return this._width},getHeight:function(){return this._height},getAnchor:function(){return this._anchor},setAnchor:function(a){this._anchor=vec2.fromValues(a[0],a[1])},moveAnchor:function(a){var b=[a[0]-this._anchor[0],a[1]-this._anchor[1]],c=mat4.invert(mat4.create(),
this._getRotateScaleTransform());dfWorld=vec2.transformMat4(vec2.create(),b,c);this._eye[0]+=dfWorld[0];this._eye[1]+=dfWorld[1];this._anchor[0]=a[0];this._anchor[1]=a[1]},getAngle:function(){return this._angle},setAngle:function(a){this._angle=a},getZoom:function(){return this._zoom},setZoom:function(a){this._zoom=a},controlWithMouse:function(a,b,c){var d=a.getX()*this.getWidth()/b,e=a.getY()*this.getHeight()/c;this._yFlipped||(e=this.getHeight()-e);if(0<a.scrollUpAmount()){this.moveAnchor([d,e]);
for(var f=0;f<a.scrollUpAmount();f++)this.setZoom(10*this.getZoom()/9)}if(0<a.scrollDownAmount())for(this.moveAnchor([d,e]),f=0;f<a.scrollDownAmount();f++)this.setZoom(9*this.getZoom()/10);a.isLeftPressed()&&this.drag(a.getXY(),b,c);a.justLeftReleased()&&this.endDrag()},drag:function(a,b,c){this._yFlipped||(a[1]=c-a[1]);this._dragPrev||this._updatePrevDragPt(a,b,c);var d=this.screenToWorld(a,b,c),e=this._dragPrev[1]-d[1];this._eye[0]=this._dragEyeStart[0]+(this._dragPrev[0]-d[0]);this._eye[1]=this._dragEyeStart[1]+
e;d=a[0]*this.getWidth()/b;e=a[1]*this.getHeight()/c;this.moveAnchor([d,e]);this._updatePrevDragPt(a,b,c)},_updatePrevDragPt:function(a,b,c){this._dragPrev=this.screenToWorld(a,b,c);this._dragEyeStart=vec2.clone(this._eye)},endDrag:function(){this._dragEyeStart=this._dragPrev=void 0},_getRotateScaleTransform:function(){var a=mat4.create(),b=mat4.create();mat4.rotateZ(b,b,this._angle);mat4.mul(a,b,a);b=mat4.create();mat4.scale(b,b,[this._zoom,this._zoom,1]);mat4.mul(a,b,a);return a},getViewTransform:function(){var a=
mat4.create(),b=mat4.create();mat4.translate(b,b,[-this._eye[0],-this._eye[1],0]);mat4.mul(a,b,a);b=this._getRotateScaleTransform();mat4.mul(a,b,a);b=mat4.create();mat4.translate(b,b,[this._anchor[0],this._anchor[1],0]);mat4.mul(a,b,a);return a},getProjectionTransform:function(){var a=mat4.create();a[0]=2/this.getWidth();a[5]=2/this.getHeight();a[12]=-1;this._yFlipped?(a[5]*=-1,a[13]=1):a[13]=-1;return a},screenToWorld:function(a,b,c){a=[a[0],a[1]];a[0]*=this.getWidth()/b;a[1]*=this.getHeight()/c;
b=this.getViewTransform();mat4.invert(b,b);vec2.transformMat4(a,a,b);return a},worldToScreen:function(a,b,c){result=[a[0],a[1]];a=this.getViewTransform();vec2.transformMat4(result,result,a);result[0]*=b/this.getWidth();result[1]*=c/this.getHeight();return result}};Util.Inheritance.inherit(TentaGL.Camera2D,TentaGL.Camera);
TentaGL.Camera3D=function(a,b,c){this._eye=vec3.fromValues(a[0],a[1],a[2]);void 0===b&&(b=[]);this._center=vec3.fromValues(b[0]||0,b[1]||0,b[2]||0);void 0===c&&(c=[]);this._up=vec3.fromValues(c[0]||0,c[1]||1,c[2]||0);this._correctUpVector();this._mode=TentaGL.Camera3D.PERSP;this._fovBase=TentaGL.TAU/8;this._znear=this._zoom=1;this._zfar=1E3};TentaGL.Camera3D.PERSP=1;TentaGL.Camera3D.ORTHO=2;
TentaGL.Camera3D.prototype={constructor:TentaGL.Camera3D,_correctUpVector:function(){var a=this.getLookVector(),b=vec3.cross(vec3.create(),a,this._up);vec3.cross(this._up,b,a);vec3.normalize(this._up,this._up)},getEye:function(){return vec3.clone(this._eye)},setEye:function(a){this._eye=vec3.fromValues(a[0],a[1],a[2]);this._correctUpVector()},getEyeX:function(){return this._eye[0]},getEyeY:function(){return this._eye[1]},getEyeZ:function(){return this._eye[2]},getCenter:function(){return vec3.clone(this._center)},
setCenter:function(a){this._center=vec3.fromValues(a[0],a[1],a[2]);this._correctUpVector()},getCenterX:function(){return this._center[0]},getCenterY:function(){return this._center[1]},getCenterZ:function(){return this._center[2]},getLook:function(){var a=this.getLookVector();return vec3.normalize(a,a)},getLookVector:function(){return vec3.sub(vec3.create(),this._center,this._eye)},getDist:function(){return vec3.length(this.getLookVector())},setDist:function(a){var b=this.getLookVector();vec3.negate(b,
b);vec3.scale(b,b,a/vec3.length(b));vec3.add(this._eye,this._center,b)},getUp:function(){return vec3.clone(this._up)},setUp:function(a){this._up=vec3.fromValues(a[0],a[1],a[2]);this._correctUpVector()},getUpX:function(){return this._up[0]},getUpY:function(){return this._up[1]},getUpZ:function(){return this._up[2]},getRight:function(){var a=vec3.cross(vec3.create(),this.getLook(),this.getUp());vec3.normalize(a,a);return a},getMode:function(){return this._mode},setMode:function(a){if(a!=TentaGL.Camera3D.PERSP&&
a!=TentaGL.Camera3D.ORTHO)throw Error("Mode "+a+" not supported.");this._mode=a},getFOVY:function(){return this._fovBase},setFOVY:function(a){this._fovBase=a},getZoomedFOVY:function(){return this._fovBase*this._zoom},getZoom:function(){return this._zoom},setZoom:function(a){if(0>=a||1<a)throw Error("Invalid zoom value: "+a);this._zoom=a},getZNear:function(){return this._znear},getZFar:function(){return this._zfar},setClippingPlanes:function(a,b){if(0>=a||b<=a)throw Error("Invalid values for zNear and zFar planes: "+
zNear+", "+zFar);this._znear=a;this._zfar=b},getTransform:function(a){return mat4.mul(mat4.create(),this.getProjectionTransform(a),this.getViewTransform())},getViewTransform:function(){return mat4.lookAt(mat4.create(),this._eye,this._center,this._up)},getProjectionTransform:function(a){return this._mode==TentaGL.Camera3D.PERSP?mat4.perspective(mat4.create(),this.getZoomedFOVY(),a,this.getZNear(),this.getZFar()):mat4.create()},projectMouseToPanningPlane:function(a,b,c){a=vec3.fromValues((a[0]-b/2)/
(b/c),-1*(a[1]-c/2),0);vec3.scale(a,a,2/c);a[2]=0-this._dist;b=this.getProjectionTransform(b/c);vec3.transformMat4(a,a,mat4.invert(mat4.create(),b));b=this.getUp();c=this.getRight();return vec3.fromValues((a[0]*c[0]+a[1]*b[0])*this._dist+this._center[0],(a[0]*c[1]+a[1]*b[1])*this._dist+this._center[1],(a[0]*c[2]+a[1]*b[2])*this._dist+this._center[2])},projectToPlane:function(a,b,c,d){var e=c/d;a=vec3.fromValues((a[0]-c/2)/e,-1*(a[1]-d/2),0);vec3.scale(a,a,2/d);a=vec4.fromValues(a[0],a[1],-1,1);d=
this.getTransform(e);mat4.invert(d,d);vec4.transformMat4(a,a,d);a=new TentaGL.Math.Line3D(this._eye,a);if((b=b.lineIntersection(a))&&!b.isaLine3D)return b},projectToClip:function(a,b,c){var d=b/c;a=vec3.fromValues((a[0]-b/2)/d,-1*(a[1]-c/2),0);vec3.scale(a,a,2/c);c=vec4.fromValues(a[0],a[1],-1,1);a=vec4.fromValues(a[0],a[1],1,1);d=this.getTransform(d);mat4.invert(d,d);vec4.transformMat4(c,c,d);vec4.transformMat4(a,a,d);c[3]=1/c[3];c[0]*=c[3];c[1]*=c[3];c[2]*=c[3];a[3]=1/a[3];a[0]*=a[3];a[1]*=a[3];
a[2]*=a[3];return[c,a]}};Util.Inheritance.inherit(TentaGL.Camera3D,TentaGL.Camera);
TentaGL.ArcballCamera=function(a,b,c){TentaGL.Camera3D.call(this,a,b,c);a=this.getLookVector();this._dist=this._origDist=vec3.length(a);this._origLook=vec3.normalize(vec3.create(),a);this._origCenter=vec3.clone(this._center);this._origUp=vec3.clone(this._up);this._origRight=vec3.cross(vec3.create(),this._origLook,this._origUp);this._orientation=TentaGL.Math.getOrientation([0,0,-1],[0,1,0],this._origLook,this._origUp);this._origOrientation=quat.clone(this._orientation)};
TentaGL.ArcballCamera.prototype={constructor:TentaGL.ArcballCamera,projectMouseToUnitSphere:function(a,b,c){var d=1/(Math.max(c,b)/2);a=vec3.fromValues(a[0]-b/2,-1*(a[1]-c/2),0);a=vec3.scale(a,a,d);1<vec3.length(a)&&(a=vec3.normalize(a,a));d=1-(a[0]*a[0]+a[1]*a[1]);a[2]=0>d?0:Math.sqrt(d);return a},getEye:function(){var a=this.getLook();vec3.negate(a,a);vec3.scale(a,a,this._dist);return vec3.add(this._eye,this._center,a)},getLook:function(){var a=mat4.invert(mat4.create(),mat4.fromQuat(mat4.create(),
quat.invert(quat.create(),this._orientation))),a=vec3.transformMat4(vec3.create(),[0,0,-1],a);return vec3.normalize(a,a)},getUp:function(){var a=mat4.invert(mat4.create(),mat4.fromQuat(mat4.create(),quat.invert(quat.create(),this._orientation))),a=vec3.transformMat4(vec3.create(),[0,1,0],a);vec3.normalize(a,a);return a},getRight:function(){var a=mat4.invert(mat4.create(),mat4.fromQuat(mat4.create(),quat.invert(quat.create(),this._orientation))),a=vec3.transformMat4(vec3.create(),[1,0,0],a);return vec3.normalize(a,
a)},getOrientation:function(){return quat.clone(this._orientation)},setOrientation:function(a){this._orientation=a},getDist:function(){return this._dist},setDist:function(a){this._dist=a},controlWithMouse:function(a,b,c){if(0<a.scrollUpAmount())for(var d=0;d<a.scrollUpAmount();d++)this.setDist(9*this.getDist()/10);if(0<a.scrollDownAmount())for(d=0;d<a.scrollDownAmount();d++)this.setDist(10*this.getDist()/9);a.justLeftPressed()&&(this._preVec=this.projectMouseToUnitSphere(a.getXY(),b,c),this._preOrientation=
quat.clone(quat.invert(quat.create(),this._orientation)));if(a.isLeftPressed()||a.justLeftReleased())d=this.projectMouseToUnitSphere(a.getXY(),b,c),d=TentaGL.Math.getQuatFromTo(this._preVec,d),quat.mul(this._orientation,d,this._preOrientation),quat.invert(this._orientation,this._orientation);a.justRightPressed()&&(this._prePan=this.projectMouseToPanningPlane(a.getXY(),b,c),this._preCenter=vec3.clone(this._center));a.isRightPressed()&&(this._center=vec3.clone(this._preCenter),this._curPan=this.projectMouseToPanningPlane(a.getXY(),
b,c),a=vec3.sub(vec3.create(),this._prePan,this._curPan),b=mat4.create(),mat4.translate(b,b,a),vec3.transformMat4(this._center,this._preCenter,b))},resetOrientation:function(){this._center=vec3.clone(this._origCenter);this._dist=this._origDist;this._orientation=quat.clone(this._origOrientation)},getViewTransform:function(){var a=mat4.create();mat4.translate(a,a,[0,0,0-this._dist]);var a=mat4.mul(mat4.create(),a,mat4.fromQuat(mat4.create(),quat.invert(quat.create(),this._orientation))),b=mat4.create();
mat4.translate(b,b,vec3.negate(vec3.create(),this._center));return a=mat4.mul(a,a,b)}};Util.Inheritance.inherit(TentaGL.ArcballCamera,TentaGL.Camera3D);TentaGL.Picker=function(a){this._app=a;this._bytes=new Uint8Array(4)};TentaGL.Picker.SHADER_ID="pickShader";TentaGL.Picker.isPicking=function(a){return a._isPicking};
TentaGL.Picker.prototype={constructor:TentaGL.Picker,update:function(a,b,c){this._pixels=void 0;this._origFilter=TentaGL.SceneNode.getRenderFilter();TentaGL.ShaderLib.push(a);TentaGL.Blend.setEnabled(a,!1);TentaGL.ColorBuffer.setClearColor(a,TentaGL.Color.RGBA(0,0,0,0));TentaGL.MaterialLib.useNone(a);TentaGL.ShaderLib.use(a,TentaGL.Picker.SHADER_ID);a._isPicking=!0;this._nextID=1;this._sprites=[];this._gl=a;TentaGL.SceneNode.setRenderFilter(this._filterFunction.bind(this));c&&(b(a),TentaGL.MaterialLib.useNone(a),
this._nextID=1);c=this._app.getWidth();var d=this._app.getHeight(),e=c*d*4;e>this._bytes.length&&(this._bytes=new Uint8Array(e));e=new TentaGL.BufferTexture(a,c,d);e.renderToMe(a,b);this._pixels=e.getPixelData(a,0,0,c,d,this._bytes);e.clean(a);a._isPicking=!1;TentaGL.ShaderLib.pop(a);TentaGL.SceneNode.setRenderFilter(this._origFilter)},_filterFunction:function(a){if(this._origFilter(a)){var b=this._nextID;this._nextID++;var c=new TentaGL.Color.Hex(b);this._sprites[b]=a;a=c.getRGBA();TentaGL.ShaderLib.current(this._gl).setPickID(this._gl,
a);return!0}return!1},_getPixelAt:function(a,b,c){return this._pixels.getPixelAt(a,b,c)},getSpriteAt:function(a,b,c){if(this._pixels){a=this._getPixelAt(a,b);a=TentaGL.Color.rgba2Hex(a[0],a[1],a[2],a[3]);a=this._sprites[a];if(c||!a)return a;c=a.getCompositePath();return c[c.length-1]}},getSpriteAtMouse:function(a,b){var c=a.getX(),d=this._app.getHeight()-a.getY();return this.getSpriteAt(c,d,b)}};TentaGL.AppResizeListener=function(){};
TentaGL.AppResizeListener.prototype={constructor:TentaGL.AppResizeListener,isaAppResizeListener:!0,handleAppResizeEvent:function(a){}};TentaGL.Event=function(a,b){this._source=a;this._type=b};TentaGL.Event.prototype={constructor:TentaGL.Event,getSource:function(){return this._source},getType:function(){return this._type}};TentaGL.AppResizeEvent=function(a,b,c,d,e){TentaGL.Event.call(this,a,0);this._width=b;this._height=c;this._oldWidth=d;this._oldHeight=e};
TentaGL.AppResizeEvent.prototype={constructor:TentaGL.AppResizeEvent,getWidth:function(){return this._width},getHeight:function(){return this._height},getOldWidth:function(){return this._oldWidth},getOldHeight:function(){return this._oldHeight}};Util.Inheritance.inherit(TentaGL.AppResizeEvent,TentaGL.Event);TentaGL.PickEvent=function(a,b){TentaGL.Event.call(this,a,void 0);this._context=b};TentaGL.PickEvent.prototype={constructor:TentaGL.PickEvent,getContext:function(){return this._context}};
Util.Inheritance.inherit(TentaGL.PickEvent,TentaGL.Event);TentaGL.PickEventListener=function(){};TentaGL.PickEventListener.prototype={constructor:TentaGL.PickEventListener,handlePickEvent:function(a){}};TentaGL.Model=function(a,b){a||(a=GL_TRIANGLES);b||(b=GL_NONE);this._mode=a;this._cull=b;this._vertices=[];this._indices=[]};
TentaGL.Model.prototype={constructor:TentaGL.Model,getID:function(){void 0===this._id&&(this._id=TentaGL.Model.createID());return this._id},setID:function(a){this._id=a;return this},getDrawMode:function(){return this._mode},setDrawMode:function(a){this._mode=a},getCullMode:function(){return this._cull},setCullMode:function(a){this._cull=a},numIndices:function(){return this._indices.length},getIndices:function(){return this._indices.slice(0,this._indices.length)},addVertex:function(a){this._vertices.push(a);
return this},numVertices:function(){return this._vertices.length},getVertex:function(a){if(0>a||a>=this._vertices.length)throw Error("Index "+a+" out of bounds.");return this._vertices[a]},getVertices:function(){return this._vertices.slice(0,this._vertices.length)},indexOfVertex:function(a){for(var b=0;b<this._vertices.length;b++)if(this._vertices[b]==a)return b;return-1},numLines:function(){return Math.floor(this._indices.length/2)},addLine:function(a,b){if(0>a||a>=this._vertices.length)throw Error("Index "+
a+" out of bounds.");if(0>b||b>=this._vertices.length)throw Error("Index "+b+" out of bounds.");this._indices.push(a);this._indices.push(b);var c=this._vertices[a],d=this._vertices[b];c.hasTexST()&&d.hasTexST()&&(c.setTangental(c.computeTangental(d,d)),d.setTangental(d.computeTangental(c,c)))},addLineStrip:function(a){if(2>a.length)throw Error("Not enough indices in line strip array.");for(var b=a[0],c=1;c<a.length;c++)this.addLine(b,a[c])},addLineLoop:function(a){if(2>a.length)throw Error("Not enough indices in line strip array.");
for(var b=a[0],c=1;c<a.length;c++)this.addLine(b,a[c]);this.addLine(a[a.length-1],a[0])},getLines:function(){for(var a=[],b=1;b<v.length;b+=2)a.push([this._indices[b-1],this._indices[b]]);return a},numFaces:function(){return Math.floor(this._indices.length/3)},addFace:function(a,b,c){if(0>a||a>=this._vertices.length)throw Error("Index "+a+" out of bounds.");if(0>b||b>=this._vertices.length)throw Error("Index "+b+" out of bounds.");if(0>c||c>=this._vertices.length)throw Error("Index "+c+" out of bounds.");
this._indices.push(a);this._indices.push(b);this._indices.push(c);a=this._vertices[a];b=this._vertices[b];c=this._vertices[c];a.hasTexST()&&b.hasTexST()&&c.hasTexST()&&(a.setTangental(a.computeTangental(b,c)),b.setTangental(b.computeTangental(c,a)),c.setTangental(c.computeTangental(a,b)))},addFaceQuad:function(a,b,c,d){this.addFace(a,b,c);this.addFace(a,c,d)},addFaceStrip:function(a){if(3>a.length)throw Error("Not enough indices in triangle strip array.");for(var b=!0,c=2;c<a.length;c++)b?this.addFace(a[c-
2],a[c-1],a[c]):this.addFace(a[c-1],a[c-2],a[c]),b=!b},addFaceFan:function(a){if(3>a.length)throw Error("Not enough indices in triangle strip array.");for(var b=2;b<a.length;b++)this.addFace(a[0],a[b-1],a[b])},getFaces:function(){if(void 0===this._faces){this._faces=[];for(var a=2;a<this._indices.length;a+=3)this._faces.push([this._indices[a-2],this._indices[a-1],this._indices[a]])}return this._faces},getFacesContainingVertex:function(a){for(var b=[],c=this.getFaces(),d=0;d<c.length;d++){var e=c[d];
e[0]!=a&&e[1]!=a&&e[2]!=a||b.push(d)}return b},generateVertexNormals:function(){for(var a=this.getFaceNormals(),b=0;b<this._vertices.length;b++){for(var c=this._vertices[b],d=this.getFacesContainingVertex(b),e=[0,0,0],f=0;f<d.length;f++)vec3.add(e,e,a[d[f]]);vec3.normalize(e,e);c.setNormal(e[0],e[1],e[2])}},generate2DTexCoordsSpherical:function(){for(var a=0;a<this._vertices.length;a++){var b=this._vertices[a],c=TentaGL.Math.toPolar(b.getXYZ()),d=TentaGL.Math.wrap(c[1],0,TentaGL.TAU),d=TentaGL.Math.linearMap(d,
[0,TentaGL.TAU],[0,1]),c=TentaGL.Math.linearMap(c[2],[-Math.PI/2,Math.PI/2],[0,1]);b.setTexST(d,c)}},generateSurfaceTangentals:function(){if(this._mode==GL_LINES)for(var a=0;a<this._indices.length;a+=2){var b=this._indices[a],c=this._indices[a+1],b=this._vertices[b],c=this._vertices[c];b.hasTexST()&&c.hasTexST()&&(b.setTangental(b.computeTangental(c,c)),c.setTangental(c.computeTangental(b,b)))}else for(a=0;a<this._indices.length;a+=3){var b=this._indices[a],c=this._indices[a+1],d=this._indices[a+
2],b=this._vertices[b],c=this._vertices[c],d=this._vertices[d];b.hasTexST()&&c.hasTexST()&&d.hasTexST()&&(b.setTangental(b.computeTangental(c,d)),c.setTangental(c.computeTangental(d,b)),d.setTangental(d.computeTangental(b,c)))}},getFaceNormals:function(){if(void 0===this._faceNormals){this._faceNormals=[];for(var a=2;a<this._indices.length;a+=3){var b=this._vertices[this._indices[a-2]],c=this._vertices[this._indices[a-1]],d=this._vertices[this._indices[a]],c=vec3.fromValues(c.getX()-b.getX(),c.getY()-
b.getY(),c.getZ()-b.getZ()),b=vec3.fromValues(d.getX()-b.getX(),d.getY()-b.getY(),d.getZ()-b.getZ()),b=vec3.cross(vec3.create(),c,b);this._faceNormals.push(b)}}return this._faceNormals},getFaceNormal:function(a){if(0>a||a>=this.numFaces())throw Error("Face index out of bounds: "+a);return this.getFaceNormals()[a]},getModelCentroid:function(){if(void 0===this._centroid){for(var a=0,b=0,c=0,d=0;d<this._vertices.length;d++)var e=this._vertices[d],a=a+e.getX(),b=b+e.getY(),c=c+e.getZ();a/=this._vertices.length;
b/=this._vertices.length;c/=this._vertices.length;this._centroid=vec4.fromValues(a,b,c,1)}return this._centroid},getFaceCentroids:function(){if(void 0===this._faceCentroids){this._faceCentroids=[];for(var a=2;a<this._indices.length;a+=3){var b=this._vertices[this._indices[a-2]],c=this._vertices[this._indices[a-1]],d=this._vertices[this._indices[a]],e=(b.getX()+c.getX()+d.getX())/3,f=(b.getY()+c.getY()+d.getY())/3,b=(b.getZ()+c.getZ()+d.getZ())/3;this._faceCentroids.push(vec4.fromValues(e,f,b,1))}}return this._faceCentroids},
getFaceCentroid:function(a){if(0>a||a>=this.numFaces())throw Error("Face index out of bounds: "+a);return this.getFaceCentroids()[a]},clone:function(){return this.transform(mat4.create())},transform:function(a){for(var b=new TentaGL.Model,c=0;c<this._vertices.length;c++)b.addVertex(this._vertices[c].transform(a));for(c=0;c<this._indices.length;c+=3)b.addFace(this._indices[c],this._indices[c+1],this._indices[c+2]);return b},cloneCentered:function(){var a=this.getModelCentroid();return this.transform(mat4.translate(mat4.create(),
mat4.create(),[-a[0],-a[1],-a[2]]))},translate:function(a){var b=mat4.create();mat4.translate(b,b,a);return this.transform(b)},scale:function(a){var b=mat4.create();mat4.scale(b,b,a);return this.transform(b)},rotate:function(a,b){var c=quat.setAxisAngle(quat.create(),a,b);return this.transform(mat4.fromQuat(mat4.create(),c))},scaleTexST:function(a,b){var c=this.clone(),d;for(d in c._vertices){var e=c._vertices[d],f=e.getTexST();e.setTexST(f[0]*a,f[1]*b)}return c},flipTexT:function(){var a=this.clone(),
b;for(b in a._vertices){var c=a._vertices[b],d=c.getTexST();c.setTexST(d[0],1-d[1])}return a},merge:function(a){for(var b=this.clone(),c=b.numVertices(),d=0;d<a._vertices.length;d++)b.addVertex(a._vertices[d]);for(d=0;d<a._indices.length;d+=3)b.addFace(c+a._indices[d],c+a._indices[d+1],c+a._indices[d+2]);return b}};TentaGL.Model._nextID=0;TentaGL.Model.createID=function(){var a="anonID"+TentaGL.Model._nextID;TentaGL.Model._nextID++;return a};
TentaGL.Model.Cone=function(a,b,c){var d=new TentaGL.Model;c||(c=TentaGL.TAU/20);for(var e=Math.floor(TentaGL.TAU/c)+1,f=0;f<e;f++){var g=TentaGL.Math.toCartesian([a,f*c,0]),h=g[0],m=g[2],g=(h/a+1)/2,k=(m/a+1)/2,h=new TentaGL.Vertex(h,0,m);h.setNormal(0,-1,0);h.setTexST(g,k);d.addVertex(h)}for(f=0;f<e;f++){var g=f*c,l=TentaGL.Math.toCartesian([a,g,0]),k=l[0],m=l[2],h=(f+.5)*c,p=TentaGL.Math.toCartesian([a,h,0]),n=p[0],r=p[2],l=vec3.sub(vec3.create(),[0,b,0],l),q=vec3.fromValues(k,0,m),q=vec3.cross(vec3.create(),
q,l),l=vec3.cross(vec3.create(),l,q);vec3.normalize(l,l);p=vec3.sub(vec3.create(),[0,b,0],p);n=vec3.fromValues(n,0,r);n=vec3.cross(vec3.create(),n,p);n=vec3.cross(vec3.create(),p,n);vec3.normalize(n,n);k=new TentaGL.Vertex(k,0,m);k.setTexST(g/TentaGL.TAU,0);k.setNormal(l[0],l[1],l[2]);g=new TentaGL.Vertex(0,b,0);g.setTexST(h/TentaGL.TAU,1);g.setNormal(n[0],n[1],n[2]);d.addVertex(k);d.addVertex(g)}l=TentaGL.Math.toCartesian([a,0,0]);k=l[0];m=l[2];l=vec3.sub(vec3.create(),[0,b,0],l);q=vec3.fromValues(k,
0,m);q=vec3.cross(vec3.create(),q,l);l=vec3.cross(vec3.create(),l,q);vec3.normalize(l,l);k=new TentaGL.Vertex(k,0,m);k.setTexST(TentaGL.TAU,0);k.setNormal(l[0],l[1],l[2]);d.addVertex(k);for(a=2;a<e;a++)b=0,c=a-1,f=a,d.addFace(b,f,c);for(a=0;a<2*e;a+=2)b=e+(a+0),c=e+(a+2),f=e+(a+1),d.addFace(b,c,f);return d};
TentaGL.Model.Cube=function(a,b,c){var d=new TentaGL.Model,e=0,f=function(a,b,c){var f=vec3.cross(vec3.create(),b,c),l=new TentaGL.Vertex(a[0],a[1],a[2]);l.setNormal(f[0],f[1],f[2]);l.setTexST(0,0);d.addVertex(l);l=new TentaGL.Vertex(a[0]+b[0],a[1]+b[1],a[2]+b[2]);l.setNormal(f[0],f[1],f[2]);l.setTexST(1,0);d.addVertex(l);b=new TentaGL.Vertex(a[0]+b[0]+c[0],a[1]+b[1]+c[1],a[2]+b[2]+c[2]);b.setNormal(f[0],f[1],f[2]);b.setTexST(1,1);d.addVertex(b);a=new TentaGL.Vertex(a[0]+c[0],a[1]+c[1],a[2]+c[2]);
a.setNormal(f[0],f[1],f[2]);a.setTexST(0,1);d.addVertex(a);d.addFaceQuad(e,e+1,e+2,e+3);e+=4};f([0,b,c],[a,0,0],[0,0,-c]);f([0,0,0],[a,0,0],[0,0,c]);f([0,0,c],[a,0,0],[0,b,0]);f([a,0,0],[-a,0,0],[0,b,0]);f([a,0,c],[0,0,-c],[0,b,0]);f([0,0,0],[0,0,c],[0,b,0]);return d};
TentaGL.Model.Cylinder=function(a,b,c){var d=new TentaGL.Model(!1);c||(c=TentaGL.TAU/20);for(var e=Math.floor(TentaGL.TAU/c)+1,f=0;f<e;f++){var g=f*c,h=TentaGL.Math.toCartesian([a,g,0]),m=h[0],h=h[2],g=(m/a+1)/2,k=(h/a+1)/2,l=new TentaGL.Vertex(m,0,h);l.setNormal(0,-1,0);l.setTexST(g,k);d.addVertex(l)}for(f=0;f<e;f++)g=f*c,h=TentaGL.Math.toCartesian([a,g,0]),m=h[0],h=h[2],g/=TentaGL.TAU,l=new TentaGL.Vertex(m,0,h),l.setNormal(m,0,h),l.setTexST(g,0),d.addVertex(l);for(f=0;f<e;f++)g=f*c,h=TentaGL.Math.toCartesian([a,
g,0]),m=h[0],h=h[2],g/=TentaGL.TAU,l=new TentaGL.Vertex(m,b,h),l.setNormal(m,0,h),l.setTexST(g,1),d.addVertex(l);for(f=0;f<e;f++)g=f*c,h=TentaGL.Math.toCartesian([a,g,0]),m=h[0],h=h[2],g=(m/a+1)/2,k=(h/a+1)/2,l=new TentaGL.Vertex(m,b,h),l.setNormal(0,1,0),l.setTexST(g,k),d.addVertex(l);for(a=2;a<e;a++)b=0,c=a-1,f=a,d.addFace(b,f,c);for(a=0;a<e-1;a++)b=1*e+(a+0),c=1*e+(a+1),f=2*e+(a+1),d.addFaceQuad(b,c,f,2*e+(a+0));for(a=2;a<e;a++)b=3*e,c=3*e+a-1,f=3*e+a,d.addFace(b,c,f);return d};
TentaGL.Model.Line=function(a,b){var c=new TentaGL.Model(GL_LINES),d=new TentaGL.Vertex(a[0],a[1],a[2]);d.setNormal(0,0,1);d.setTexST(0,0);c.addVertex(d);d=new TentaGL.Vertex(b[0],b[1],b[2]);d.setNormal(0,0,1);d.setTexST(1,0);c.addVertex(d);c.addLine(0,1);return c};
TentaGL.Model.Plane=function(a,b,c){var d=new TentaGL.Model(GL_TRIANGLES,GL_NONE);c=c||!1;var e=vec3.fromValues(a,0,0),f=vec3.fromValues(0,b,0),e=vec3.cross(vec3.create(),e,f);c?(c=new TentaGL.Vertex(0,0,0),c.setNormal(e[0],e[1],e[2]),c.setTexST(0,1),d.addVertex(c),c=new TentaGL.Vertex(0,-b,0),c.setNormal(e[0],e[1],e[2]),c.setTexST(0,0),d.addVertex(c),c=new TentaGL.Vertex(a,-b,0),c.setNormal(e[0],e[1],e[2]),c.setTexST(1,0),d.addVertex(c),a=new TentaGL.Vertex(a,0,0),a.setNormal(e[0],e[1],e[2]),a.setTexST(1,
1)):(c=new TentaGL.Vertex(0,0,0),c.setNormal(e[0],e[1],e[2]),c.setTexST(0,0),d.addVertex(c),c=new TentaGL.Vertex(a,0,0),c.setNormal(e[0],e[1],e[2]),c.setTexST(1,0),d.addVertex(c),c=new TentaGL.Vertex(a,b,0),c.setNormal(e[0],e[1],e[2]),c.setTexST(1,1),d.addVertex(c),a=new TentaGL.Vertex(0,b,0),a.setNormal(e[0],e[1],e[2]),a.setTexST(0,1));d.addVertex(a);d.addFaceQuad(0,1,2,3);return d};
TentaGL.Model.PolyLine=function(a,b){for(var c=new TentaGL.Model(GL_LINES),d=0;d<a.length;d++){var e=a[d],e=new TentaGL.Vertex(e[0],e[1],e[2]);e.setNormal(0,0,1);e.setTexST(d,0);c.addVertex(e);0<d&&c.addLine(d-1,d)}b&&c.addLine(a.length-1,0);return c};
TentaGL.Model.Sphere=function(a,b,c){var d=new TentaGL.Model;b||(b=TentaGL.TAU/20);c||(c=TentaGL.TAU/20);for(var e=Math.floor(TentaGL.TAU/2/b)+1,f=Math.floor(TentaGL.TAU/c)+1,g=0;g<e;g++)for(var h=g*b-TentaGL.TAU/4,m=0;m<f;m++){var k=m*c,l=TentaGL.Math.toCartesian([a,k,h]),p=l[0],n=l[1],l=l[2],k=k/TentaGL.TAU,r=h/(TentaGL.TAU/2)+.5,q=new TentaGL.Vertex(p,n,l);q.setNormal(p,n,l);q.setTexST(k,r);d.addVertex(q)}for(g=0;g<e-1;g++)for(m=0;m<f-1;m++)d.addFaceQuad((g+0)*f+(m+0),(g+0)*f+(m+1),(g+1)*f+(m+
1),(g+1)*f+(m+0));return d};TentaGL.Model.Triangle=function(a,b,c){var d=new TentaGL.Model,e=new TentaGL.Vertex(a[0],a[1],a[2]),f=new TentaGL.Vertex(b[0],b[1],b[2]),g=new TentaGL.Vertex(c[0],c[1],c[2]);d.addVertex(e);d.addVertex(f);d.addVertex(g);b=vec3.subtract(vec3.create(),b,a);a=vec3.subtract(vec3.create(),c,a);a=vec3.cross(vec3.create(),b,a);e.setNormal(a[0],a[1],a[2]);f.setNormal(a[0],a[1],a[2]);g.setNormal(a[0],a[1],a[2]);e.setTexST(0,0);f.setTexST(1,0);g.setTexST(1,1);d.addFace(0,1,2);return d};
TentaGL.ModelLib={clean:function(a){for(var b in a._vboData)a._vboData[b].clean(a);a._vboData={}},reset:function(a){this.clean(a);this.add(a,"unitPlane",new TentaGL.Model.Plane(1,1));this.add(a,"unitLine",new TentaGL.Model.Line([0,0,0],[1,1,1]));this.add(a,"unitCube",new TentaGL.Model.Cube(1,1,1));this.add(a,"unitSphere",new TentaGL.Model.Sphere(1));this.add(a,"unitSprite",(new TentaGL.Model.Plane(1,1)).flipTexT());this.add(a,"unitCone",new TentaGL.Model.Cone(1,1))},add:function(a,b,c,d){d||(d=TentaGL.getDefaultAttrProfileSet());
c=new TentaGL.VBOData(a,c,d);return a._vboData[b]=c},get:function(a,b){if(void 0===a._vboData[b])throw Error("ModelLib does not contain VBOData for "+b+".");return a._vboData[b]},remove:function(a,b){a._vboData[b].clean(a);delete a._vboData[b]},render:function(a,b){TentaGL.ViewTrans.updateMVPUniforms(a);var c=this.get(a,b);TentaGL.VBORenderer.render(a,c)}};
TentaGL.Model.ObjReader={_numLoading:0,fromURL:function(a,b){var c=this,d=new XMLHttpRequest;d.open("get",a);d.onerror=function(a){console.log("AJAX error: ",a);c._numLoading--};d.onreadystatechange=function(a){4==this.readyState&&200==this.status&&(c._processResponse(d.responseText,b),c._numLoading--)};d.send();this._numLoading++},_processResponse:function(a,b){for(var c=[],d="",e=new TentaGL.Model,f=0,g="",h=a.split("\n"),m=0;m<h.length;m++){for(var k=h[m].trim(),k=k.replace("\t"," ");-1!=k.indexOf("  ");)k=
k.replace("  "," ");if(""!=k&&"#"!=k.charAt(0)){k=k.split(" ");k[0]!=g&&(f=0);if("g"==k[0])c[d]=e,e=new TentaGL.Model,d=k[1];else if("v"==k[0]){var l=parseFloat(k[1]),p=parseFloat(k[2]),n=parseFloat(k[3]);e.addVertex(new TentaGL.Vertex(l,p,n))}else if("vn"==k[0])g=e.getVertex(f),l=parseFloat(k[1]),p=parseFloat(k[2]),n=parseFloat(k[3]),g.setNormal(l,p,n);else if("vt"==k[0])g=e.getVertex(f),l=parseFloat(k[1]),p=parseFloat(k[2]),g.setTexST(l,p);else if("f"==k[0])g=parseInt(k[1])-1,l=parseInt(k[2])-1,
p=parseInt(k[3])-1,5==k.length?(n=parseInt(k[4])-1,e.addFaceQuad(g,l,p,n)):e.addFace(g,l,p);else if("usemtl"!=k[0])throw Error("Could not read wavefront object. Error at line "+(m+1));f++;g=k[0]}}c[d]=e;b(c)},isLoading:function(){return 0<this._numLoading},getNumLoading:function(){return this._numLoading}};
TentaGL.VBOData=function(a,b,c){var d=[];this._byteOffsets={};for(var e=b.getVertices(),f=0;f<e.length;f++){var g=e[f],h=0,m;for(m in c){var k=c[m],l=k.getValues(g);this._byteOffsets[m]=h;h+=k.sizeBytes();for(k=0;k<l.length;k++)d.push(l[k])}}this._attrBuffer=a.createBuffer();a.bindBuffer(GL_ARRAY_BUFFER,this._attrBuffer);a.bufferData(GL_ARRAY_BUFFER,new Float32Array(d),GL_STATIC_DRAW);d=b.getIndices();this._numIndices=b.numIndices();this._elemBuffer=a.createBuffer();a.bindBuffer(GL_ELEMENT_ARRAY_BUFFER,
this._elemBuffer);a.bufferData(GL_ELEMENT_ARRAY_BUFFER,new Uint16Array(d),GL_STATIC_DRAW);this._attrSet=c;this._stride=TentaGL.AttrProfiles.getStride(c);this._mode=b.getDrawMode();this._cull=b.getCullMode()};
TentaGL.VBOData.prototype={constructor:TentaGL.VBOData,getAttrBuffer:function(){return this._attrBuffer},getElemBuffer:function(){return this._elemBuffer},numIndices:function(){return this._numIndices},getOffset:function(a){var b=a.id();if(void 0===this._byteOffsets[b])throw Error("VBOData does not contain data for AttrProfile: "+a.toString());return this._byteOffsets[b]},getStride:function(){return this._stride},getShader:function(){return this._shader},getDrawMode:function(){return this._mode},
getCullMode:function(){return this._cull},clean:function(a){a.deleteBuffer(this._attrBuffer);a.deleteBuffer(this._elemBuffer)}};
TentaGL.VBORenderer={_mode:GL_TRIANGLES,getDrawMode:function(){return this._mode},setDrawMode:function(a){this._mode=a},render:function(a,b){var c=TentaGL.ShaderLib.current(a),d=b.getAttrBuffer(),e=b.getElemBuffer(),f=b.getStride();a.bindBuffer(GL_ARRAY_BUFFER,d);c=c.getAttributes();for(d=0;d<c.length;d++){var g=c[d],h=b.getOffset(g.getProfile());a.vertexAttribPointer(g.getLocation(),g.getSizeUnits(),g.getUnitType(),!1,f,h)}f=this._mode;b.getDrawMode()==GL_LINES&&(f=GL_LINES);TentaGL.Cull.setMode(a,
b.getCullMode());a.bindBuffer(GL_ELEMENT_ARRAY_BUFFER,e);a.drawElements(f,b.numIndices(),GL_UNSIGNED_SHORT,0)}};TentaGL.Vertex=function(a,b,c){a.length&&(c=a[2],b=a[1],a=a[0]);this._xyz=vec4.fromValues(a,b,c,1);this._texST=vec2.fromValues(0,0);this._normal=vec3.fromValues(0,0,0);this._tangental=vec3.fromValues(0,0,0)};
TentaGL.Vertex.prototype={constructor:TentaGL.Vertex,getXYZ:function(){return vec4.clone(this._xyz)},setXYZ:function(a,b,c){this._xyz[0]=a;this._xyz[1]=b;this._xyz[2]=c},getX:function(){return this._xyz[0]},getY:function(){return this._xyz[1]},getZ:function(){return this._xyz[2]},setX:function(a){this._xyz[0]=a},setY:function(a){this._xyz[1]=a},setZ:function(a){this._xyz[2]=a},xyz:function(a){void 0!==a&&(this._xyz=vec4.fromValues(a[0],a[1],a[2],1));return vec4.clone(this._xyz)},getTexST:function(){return vec2.clone(this._texST)},
hasTexST:function(){return void 0!=this._texST},setTexST:function(a,b){this._texST=vec2.fromValues(a,b)},getTexS:function(){return this._texST[0]},getTexT:function(){return this._texST[1]},st:function(a){void 0!==a&&(this._texST=vec2.fromValues(a[0],a[1]));return vec2.clone(this._texST)},getNormal:function(){return vec3.clone(this._normal)},hasNormal:function(){return void 0!=this._normal},setNormal:function(a,b,c){this._normal=vec3.fromValues(a,b,c);this._normal=vec3.normalize(this._normal,this._normal)},
normal:function(a){void 0!==a&&(this._normal=vec3.fromValues(a[0],a[1],a[2]));return vec3.clone(this._normal)},getTangental:function(){return vec3.clone(this._tangental)},hasTangental:function(){return void 0!==this._tangental},computeTangental:function(a,b){var c=vec3.sub(vec3.create(),a.getXYZ(),this.getXYZ()),d=vec3.sub(vec3.create(),b.getXYZ(),this.getXYZ()),e=a.getTexS()-this.getTexS(),f=b.getTexS()-this.getTexS(),g=a.getTexT()-this.getTexT(),h=b.getTexT()-this.getTexT(),e=h*e-g*f;if(0==e)return vec3.fromValues(1,
0,0);f=vec3.create();vec3.scale(f,c,h);vec3.sub(f,f,vec3.scale(vec3.create(),d,g));vec3.scale(f,f,1/e);return 0==vec3.length(f)?vec3.fromValues(1,0,0):f},setTangental:function(a){this._tangental=vec3.fromValues(a[0],a[1],a[2]);this._tangental=vec3.normalize(this._tangental,this._tangental)},tangental:function(a){void 0!==a&&(this._tangental=vec3.fromValues(a[0],a[1],a[2]));return vec3.clone(this._tangental)},clone:function(){return this.transform(mat4.create())},transform:function(a){var b=vec4.transformMat4(vec4.create(),
this.getXYZ(),a),b=new TentaGL.Vertex(b[0],b[1],b[2]);if(void 0!==this._normal){var c=this.getNormal(),c=vec4.fromValues(c[0],c[1],c[2],0),c=vec4.transformMat4(c,c,a);b.setNormal(c[0],c[1],c[2])}void 0!==this._tangental&&(c=this.getTangental(),c=vec4.fromValues(c[0],c[1],c[2],0),c=vec4.transformMat4(c,c,a),b.setTangental(c[0],c[1],c[2]));void 0!==this._texST&&b.setTexST(this.getTexS(),this.getTexT());return b}};
TentaGL.ImageLoader={_numLoading:0,load:function(a,b,c){var d=this;this._numLoading++;c||(c=function(){d._numLoading--;throw Error("Could not load image at "+a+".");});var e=new Image;e.onload=function(){b(e);d._numLoading--};e.src=a},isLoading:function(){return 0<this._numLoading}};TentaGL.PixelData=function(a,b,c){this._pixels=a;this._width=b;this._height=c};
TentaGL.PixelData.prototype={constructor:TentaGL.PixelData,clone:function(){for(var a=new Uint8Array(this._pixels.length),b=0;b<this._pixels.length;b++)a[b]=this._pixels[b];return new TentaGL.PixelData(a,this._width,this._height)},getWidth:function(){return this._width},getHeight:function(){return this._height},getData:function(){return this._pixels},getPixelAt:function(a,b,c){c&&(b=this.height-1-b);a=4*(this._width*b+a);return[this._pixels[a],this._pixels[a+1],this._pixels[a+2],this._pixels[a+3]]},
setPixelAt:function(a,b,c,d){d&&(b=this.height-1-b);a=4*(this._width*b+a);this._pixels[a]=c[0];this._pixels[a+1]=c[1];this._pixels[a+2]=c[2];this._pixels[a+3]=c[3]},filter:function(a){for(var b=this.clone(),c=0;c<this._pixels.length;c+=4)a.filter(b._pixels,this._pixels,c,this._width,this._height);return b},crop:function(a,b,c,d){for(var e=new Uint8Array(c*d*4),f=a;f<a+c;f++)for(var g=b;g<b+d;g++){var h=4*(this._width*g+f),m=4*(c*(g-b)+(f-a));e[m]=this._pixels[h];e[m+1]=this._pixels[h+1];e[m+2]=this._pixels[h+
2];e[m+3]=this._pixels[h+3]}return new TentaGL.PixelData(e,c,d)},toCanvas:function(){for(var a=document.createElement("canvas"),b=a.width=this.getWidth(),c=a.height=this.getHeight(),d=a.getContext("2d"),e=d.createImageData(b,c),f=0;f<this._pixels.length;f+=4){var g=TentaGL.PixelData.indexToXY(f,b),g=TentaGL.PixelData.xyToIndex(g[0],c-g[1]-1,b);e.data[g]=this._pixels[f];e.data[g+1]=this._pixels[f+1];e.data[g+2]=this._pixels[f+2];e.data[g+3]=this._pixels[f+3]}d.putImageData(e,0,0);(b=document.getElementById("imgDebug"))&&
b.appendChild(a);return a}};TentaGL.PixelData.fromGLTexture=function(a,b,c,d,e,f,g){var h=a.createFramebuffer();a.bindFramebuffer(GL_FRAMEBUFFER,h);a.framebufferTexture2D(GL_FRAMEBUFFER,GL_COLOR_ATTACHMENT0,GL_TEXTURE_2D,b,0);g||(g=new Uint8Array(e*f*4));a.readPixels(c,d,e,f,GL_RGBA,GL_UNSIGNED_BYTE,g);a.bindFramebuffer(GL_FRAMEBUFFER,null);a.deleteFramebuffer(h);return new TentaGL.PixelData(g,e,f)};
TentaGL.PixelData.fromURL=function(a,b){TentaGL.ImageLoader.load(a,function(a){var d=document.createElement("canvas");d.width=a.width;d.height=a.height;d.getContext("2d").drawImage(a,0,0);a=TentaGL.PixelData.fromCanvas(d);b(a)})};
TentaGL.PixelData.fromCanvas=function(a){var b=document.getElementById("imgDebug");b&&b.appendChild(a);var b=a.width,c=a.height;a=a.getContext("2d").getImageData(0,0,b,c).data;for(var d=new Uint8Array(b*c*4),e=0;e<b;e++)for(var f=0;f<c;f++){var g=4*(f*b+e),h=4*((c-1-f)*b+e);d[h]=a[g];d[h+1]=a[g+1];d[h+2]=a[g+2];d[h+3]=a[g+3]}return new TentaGL.PixelData(d,b,c)};TentaGL.PixelData.indexToXY=function(a,b){a/=4;var c=Math.floor(a/b);return[a-c*b,c]};
TentaGL.PixelData.xyToIndex=function(a,b,c){return 4*(c*b+a)};TentaGL.RGBAFilter={};TentaGL.RGBAFilter.prototype={constructor:TentaGL.RGBAFilter,filter:function(a,b,c,d,e){},setPixel:function(a,b,c,d,e,f){a[b]=c;a[b+1]=d;a[b+2]=e;a[b+3]=f}};TentaGL.RGBAFilter.AddColor=function(a){this._color=a};
TentaGL.RGBAFilter.AddColor.prototype={constructor:TentaGL.RGBAFilter.AddColor,getColor:function(){return this._color},filter:function(a,b,c,d,e){d=b[c];e=b[c+1];var f=b[c+2];b=b[c+3];d=TentaGL.Math.clamp(d+this._color.getRedByte(),0,255);e=TentaGL.Math.clamp(e+this._color.getGreenByte(),0,255);f=TentaGL.Math.clamp(f+this._color.getBlueByte(),0,255);this.setPixel(a,c,d,e,f,b)}};TentaGL.RGBAFilter.AddColor.RGBBytes=function(a,b,c){a=TentaGL.Color.RGBABytes(a,b,c);return new TentaGL.RGBAFilter.AddColor(a)};
Util.Inheritance.inherit(TentaGL.RGBAFilter.AddColor,TentaGL.RGBAFilter);TentaGL.RGBAFilter.AlphaMap=function(a){this._alphaData=a.getData()};TentaGL.RGBAFilter.AlphaMap.prototype={constructor:TentaGL.RGBAFilter.AlphaMap,getAlphaData:function(){return this._alphaData},filter:function(a,b,c,d,e){this.setPixel(a,c,b[c],b[c+1],b[c+2],this._alphaData[c])}};Util.Inheritance.inherit(TentaGL.RGBAFilter.AlphaMap,TentaGL.RGBAFilter);TentaGL.RGBAFilter.AlphaRemoval=function(){};
TentaGL.RGBAFilter.AlphaRemoval.prototype={constructor:TentaGL.RGBAFilter.AlphaRemoval,filter:function(a,b,c,d,e){d=b[c];e=b[c+1];var f=b[c+2];b=b[c+3];255>b&&(b=0);this.setPixel(a,c,d,e,f,b)}};Util.Inheritance.inherit(TentaGL.RGBAFilter.AlphaRemoval,TentaGL.RGBAFilter);TentaGL.RGBAFilter.ClipMap=function(a){this._clipData=a.getData()};
TentaGL.RGBAFilter.ClipMap.prototype={constructor:TentaGL.RGBAFilter.ClipMap,getClipData:function(){return this._clipData},filter:function(a,b,c,d,e){d=b[c];e=b[c+1];var f=b[c+2];b=b[c+3];0==this._clipData[c+3]&&(b=0);this.setPixel(a,c,d,e,f,b)}};Util.Inheritance.inherit(TentaGL.RGBAFilter.ClipMap,TentaGL.RGBAFilter);
TentaGL.RGBAFilter.Convolution=function(a){var b=a[0].length;this._sideLen=b;for(var c=0,d=0;d<b;d++)for(var e=0;e<b;e++)c+=a[d][e];console.log(c);if(0<c)for(d=0;d<b;d++)for(e=0;e<b;e++)a[d][e]/=c;console.log(a);this._matrix=a};
TentaGL.RGBAFilter.Convolution.prototype={constructor:TentaGL.RGBAFilter.Convolution,getMatrix:function(){return this._matrix},getSideLength:function(){return this._sideLen},filter:function(a,b,c,d,e){for(var f=0,g=0,h=0,m=b[c+3],k=this._sideLen,l=TentaGL.PixelData.indexToXY(c,d),p=l[0],l=l[1],n=Math.floor(k/2),r=0;r<k;r++){var q=l+r-n;q>=e&&(q=e-1);0>q&&(q=0);for(var t=0;t<k;t++){var u=this._matrix[r][t],s=p+t-n;s>=d&&(s=d-1);0>s&&(s=0);var s=TentaGL.PixelData.xyToIndex(s,q,d),w=b[s+3]/255,f=f+b[s]*
u*w,g=g+b[s+1]*u*w,h=h+b[s+2]*u*w}}f=TentaGL.Math.clamp(f,-256,255);0>f&&(f+=256);g=TentaGL.Math.clamp(g,-256,255);0>g&&(g+=256);h=TentaGL.Math.clamp(h,-256,255);0>h&&(h+=256);this.setPixel(a,c,f,g,h,m)}};Util.Inheritance.inherit(TentaGL.RGBAFilter.Convolution,TentaGL.RGBAFilter);TentaGL.RGBAFilter.Convolution.Blur3=function(){return new TentaGL.RGBAFilter.Convolution([[1,1,1],[1,1,1],[1,1,1]])};
TentaGL.RGBAFilter.Convolution.GaussianBlur3=function(){return new TentaGL.RGBAFilter.Convolution([[1,2,1],[2,4,2],[1,2,1]])};TentaGL.RGBAFilter.Convolution.Sharpen3=function(){return new TentaGL.RGBAFilter.Convolution([[0,-1,0],[-1,5,-1],[0,-1,0]])};TentaGL.RGBAFilter.Convolution.EdgeDetect3=function(){return new TentaGL.RGBAFilter.Convolution([[1,0,-1],[0,0,0],[-1,0,1]])};TentaGL.RGBAFilter.Convolution.EdgeDetect3_2=function(){return new TentaGL.RGBAFilter.Convolution([[0,1,0],[1,-4,1],[0,1,0]])};
TentaGL.RGBAFilter.Convolution.EdgeDetect3_3=function(){return new TentaGL.RGBAFilter.Convolution([[-1,-1,-1],[-1,8,-1],[-1,-1,-1]])};TentaGL.RGBAFilter.Grayscale=function(){};TentaGL.RGBAFilter.Grayscale.prototype={constructor:TentaGL.RGBAFilter.Grayscale,filter:function(a,b,c,d,e){d=b[c]/255;e=b[c+1]/255;var f=b[c+2]/255;b=b[c+3]/255;b=TentaGL.Color.HSBAtoRGBA(0,0,.2126*d+.7152*e+.0722*f,b);d=255*b[0]&255;e=255*b[1]&255;f=255*b[2]&255;b=255*b[3]&255;this.setPixel(a,c,d,e,f,b)}};
Util.Inheritance.inherit(TentaGL.RGBAFilter.Grayscale,TentaGL.RGBAFilter);TentaGL.RGBAFilter.Invert=function(){};TentaGL.RGBAFilter.Invert.prototype={constructor:TentaGL.RGBAFilter.Invert,filter:function(a,b,c,d,e){d=b[c];e=b[c+1];var f=b[c+2];b=b[c+3];this.setPixel(a,c,255-d,255-e,255-f,b)}};Util.Inheritance.inherit(TentaGL.RGBAFilter.Invert,TentaGL.RGBAFilter);TentaGL.RGBAFilter.MaskMap=function(a){this._maskData=a.getData()};
TentaGL.RGBAFilter.MaskMap.prototype={constructor:TentaGL.RGBAFilter.MaskMap,getMaskData:function(){return this._maskData},filter:function(a,b,c,d,e){d=b[c];e=b[c+1];var f=b[c+2];b=b[c+3];0<this._maskData[c+3]&&(b=0);this.setPixel(a,c,d,e,f,b)}};Util.Inheritance.inherit(TentaGL.RGBAFilter.MaskMap,TentaGL.RGBAFilter);TentaGL.RGBAFilter.MulColor=function(a){this._color=a};
TentaGL.RGBAFilter.MulColor.prototype={constructor:TentaGL.RGBAFilter.MulColor,getColor:function(){return this._color},filter:function(a,b,c,d,e){d=b[c];e=b[c+1];var f=b[c+2];b=b[c+3];d*=this._color.getRed();e*=this._color.getGreen();f*=this._color.getBlue();b*=this._color.getAlpha();this.setPixel(a,c,d,e,f,b)}};TentaGL.RGBAFilter.MulColor.RGBA=function(a,b,c,d){a=TentaGL.Color.RGBA(a,b,c,d);return new TentaGL.RGBAFilter.MulColor(a)};Util.Inheritance.inherit(TentaGL.RGBAFilter.MulColor,TentaGL.RGBAFilter);
TentaGL.RGBAFilter.OneColor=function(a,b){b||(b=0);this._color=a;this._tolerance=b};
TentaGL.RGBAFilter.OneColor.prototype={constructor:TentaGL.RGBAFilter.OneColor,getColor:function(){return this._color},getTolerance:function(){return this._tolerance},filter:function(a,b,c,d,e){var f=b[c];e=b[c+1];d=b[c+2];b=b[c+3];b=Math.abs(f-this._color.getRedByte())/255;e=Math.abs(e-this._color.getGreenByte())/255;d=Math.abs(d-this._color.getBlueByte())/255;b*b+e*e+d*d>this._tolerance*this._tolerance?b=d=e=f=0:(f=this._color.getRedByte(),e=this._color.getGreenByte(),d=this._color.getBlueByte(),
b=255);this.setPixel(a,c,f,e,d,b)}};Util.Inheritance.inherit(TentaGL.RGBAFilter.OneColor,TentaGL.RGBAFilter);TentaGL.RGBAFilter.OutlineColor=function(a){this._color=a};
TentaGL.RGBAFilter.OutlineColor.prototype={constructor:TentaGL.RGBAFilter.OutlineColor,getColor:function(){return this._color},filter:function(a,b,c,d,e){var f=b[c],g=b[c+1],h=b[c+2],m=b[c+3];if(255!=m)for(var k=TentaGL.PixelData.indexToXY(c,d),l=k[0],k=k[1],p=-1;1>=p;p++){var n=k+p;if(!(n>=e||0>n))for(var r=-1;1>=r;r++){var q=l+r;if(!(q>=d||0>q)&&(q=TentaGL.PixelData.xyToIndex(q,n,d),255==b[q+3]))return f=this._color.getRedByte(),g=this._color.getGreenByte(),h=this._color.getBlueByte(),this.setPixel(a,
c,f,g,h,255)}}this.setPixel(a,c,f,g,h,m)}};TentaGL.RGBAFilter.OutlineColor.RGBBytes=function(a,b,c){a=TentaGL.Color.RGBABytes(a,b,c);return new TentaGL.RGBAFilter.OutlineColor(a)};Util.Inheritance.inherit(TentaGL.RGBAFilter.OutlineColor,TentaGL.RGBAFilter);TentaGL.RGBAFilter.SubColor=function(a){this._color=a};
TentaGL.RGBAFilter.SubColor.prototype={constructor:TentaGL.RGBAFilter.SubColor,getColor:function(){return this._color},filter:function(a,b,c,d,e){d=b[c];e=b[c+1];var f=b[c+2];b=b[c+3];d=TentaGL.Math.clamp(d-this._color.getRedByte(),0,255);e=TentaGL.Math.clamp(e-this._color.getGreenByte(),0,255);f=TentaGL.Math.clamp(f-this._color.getBlueByte(),0,255);this.setPixel(a,c,d,e,f,b)}};TentaGL.RGBAFilter.SubColor.RGBBytes=function(a,b,c){a=TentaGL.Color.RGBABytes(a,b,c);return new TentaGL.RGBAFilter.SubColor(a)};
Util.Inheritance.inherit(TentaGL.RGBAFilter.SubColor,TentaGL.RGBAFilter);TentaGL.RGBAFilter.TransparentColor=function(a){this._tColor=a};TentaGL.RGBAFilter.TransparentColor.prototype={constructor:TentaGL.RGBAFilter.TransparentColor,getTransparentColor:function(){return this._tColor},filter:function(a,b,c,d,e){d=b[c];e=b[c+1];var f=b[c+2];b=b[c+3];var g=this._tColor.getRedByte(),h=this._tColor.getGreenByte(),m=this._tColor.getBlueByte();d==g&&e==h&&f==m&&(b=0);this.setPixel(a,c,d,e,f,b)}};
TentaGL.RGBAFilter.TransparentColor.RGBBytes=function(a,b,c){a=TentaGL.Color.RGBABytes(a,b,c);return new TentaGL.RGBAFilter.TransparentColor(a)};Util.Inheritance.inherit(TentaGL.RGBAFilter.TransparentColor,TentaGL.RGBAFilter);
TentaGL.Keyboard=function(a){this._isPressed=[];this._justPressed=[];this._justReleased=[];this._repPressed=[];this._pressedSinceLast=[];this._releasedSinceLast=[];var b=this;a.addEventListener("keydown",function(a){b._pressedSinceLast[a.keyCode]=!0;a.preventDefault()},!1);a.addEventListener("keyup",function(a){b._releasedSinceLast[a.keyCode]=!0;a.preventDefault()},!1)};
TentaGL.Keyboard.prototype={constructor:TentaGL.Keyboard,poll:function(){this._justPressed=[];this._justReleased=[];this._repPressed=[];for(var a in this._pressedSinceLast)this._isPressed[a]||(this._justPressed[a]=!0),this._isPressed[a]=!0,this._repPressed[a]=!0;for(a in this._releasedSinceLast)this._justReleased[a]=!0,this._isPressed[a]=!1;this._pressedSinceLast=[];this._releasedSinceLast=[]},isPressed:function(a){return this._isPressed[a]||!1},justPressed:function(a){return this._justPressed[a]||
!1},justReleased:function(a){return this._justReleased[a]||!1},isPressedRepeating:function(a){return this._repPressed[a]||!1}};
var KeyCode={BACK_SPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,
NUMPAD9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,EQUALS:187,COMMA:188,MINUS:189,PERIOD:190,SLASH:191,BACK_QUOTE:192,BRACELEFT:219,BACK_SLASH:220,BRACERIGHT:221,QUOTE:222};
TentaGL.Mouse=function(a){this._canvas=a;this._xy=[0,0];this._xyPage=[0,0];this._mouseMoved=this._mouseMovedSinceLast=!1;this._pressedSinceLast=[];this._releasedSinceLast=[];this._isPressed=[];this._justPressed=[];this._justReleased=[];this._clickCount=[];this._clickCount[TentaGL.Mouse.LEFT]=0;this._clickCount[TentaGL.Mouse.MIDDLE]=0;this._clickCount[TentaGL.Mouse.MIDDLE]=0;this._lastClickTime=[];this._lastClickTime[TentaGL.Mouse.LEFT]=0;this._lastClickTime[TentaGL.Mouse.MIDDLE]=0;this._lastClickTime[TentaGL.Mouse.MIDDLE]=
0;this._multiClickTime=400;this._wheelTicksZ=this._wheelTicksY=this._wheelTicksX=this._wheelTicksZSinceLast=this._wheelTicksYSinceLast=this._wheelTicksXSinceLast=0;var b=this;a.onmousemove=function(c){var d=TentaGL.DOM.getAbsolutePosition(this),e=a.getBoundingClientRect(),d=TentaGL.Math.clamp(Math.floor(e.left),0,a.width),e=TentaGL.Math.clamp(Math.floor(e.top),0,a.height),d=[c.clientX-d,c.clientY-e];c=[c.pageX,c.pageY];b._xy=d;b._xyPage=c;b._mouseMovedSinceLast=!0};a.oncontextmenu=function(a){return!1};
a.onmousedown=function(a){b._pressedSinceLast[a.which]=!0;var d=Date.now(),e=d-b._lastClickTime[a.which];b._lastClickTime[a.which]=d;e<b._multiClickTime?b._clickCount[a.which]++:b._clickCount[a.which]=1};a.onmouseup=function(a){b._releasedSinceLast[a.which]=!0};a.onwheel=a.onmousewheel=function(a){var d=a.wheelDeltaY;void 0===d&&(d=-a.deltaY);var e=a.wheelDeltaX;void 0===e&&(e=-a.deltaX);var f=a.deltaZ;0>d?b._wheelTicksYSinceLast--:0<d&&b._wheelTicksYSinceLast++;0>e?b._wheelTicksXSinceLast--:0<e&&
b._wheelTicksXSinceLast++;0>f?b._wheelTicksZSinceLast--:0<f&&b._wheelTicksZSinceLast++;a.preventDefault()};a.onclick=function(a){b._fileOpenDialogCB&&(b._fileOpenDialogCB(),b._fileOpenDialogCB=void 0)}};TentaGL.Mouse.LEFT=1;TentaGL.Mouse.MIDDLE=2;TentaGL.Mouse.RIGHT=3;
TentaGL.Mouse.prototype={constructor:TentaGL.Mouse,poll:function(){this._justPressed=[];this._justReleased=[];this._wheelTicksX=this._wheelTicksXSinceLast;this._wheelTicksY=this._wheelTicksYSinceLast;this._wheelTicksZ=this._wheelTicksZSinceLast;this._wheelTicksZSinceLast=this._wheelTicksYSinceLast=this._wheelTicksXSinceLast=0;this._mouseMoved=this._mouseMovedSinceLast;this._mouseMovedSinceLast=!1;for(var a in this._pressedSinceLast)this._isPressed[a]||(this._justPressed[a]=!0),this._isPressed[a]=
!0;for(a in this._releasedSinceLast)this._isPressed[a]=!1,this._justReleased[a]=!0;this._pressedSinceLast=[];this._releasedSinceLast=[]},getXY:function(){return[this._xy[0],this._xy[1]]},getX:function(){return this._xy[0]},getY:function(){return this._xy[1]},getPageXY:function(){return[this._xyPage[0],this._xyPage[1]]},getPageX:function(){return this._xyPage[0]},getPageY:function(){return this._xyPage[1]},hasMoved:function(){return this._mouseMoved},isLeftPressed:function(){return this._isPressed[TentaGL.Mouse.LEFT]||
!1},justLeftPressed:function(){return this._justPressed[TentaGL.Mouse.LEFT]||!1},justLeftReleased:function(){return this._justReleased[TentaGL.Mouse.LEFT]||!1},leftClickCount:function(){return this._clickCount[TentaGL.Mouse.LEFT]},isMiddlePressed:function(){return this._isPressed[TentaGL.Mouse.MIDDLE]||!1},justMiddlePressed:function(){return this._justPressed[TentaGL.Mouse.MIDDLE]||!1},justMiddleReleased:function(){return this._justReleased[TentaGL.Mouse.MIDDLE]||!1},middleClickCount:function(){return this._clickCount[TentaGL.Mouse.MIDDLE]},
isRightPressed:function(){return this._isPressed[TentaGL.Mouse.RIGHT]||!1},justRightPressed:function(){return this._justPressed[TentaGL.Mouse.RIGHT]||!1},justRightReleased:function(){return this._justReleased[TentaGL.Mouse.RIGHT]||!1},rightClickCount:function(){return this._clickCount[TentaGL.Mouse.RIGHT]},scrollUpAmount:function(){return Math.abs(Math.max(this._wheelTicksY,0))},scrollDownAmount:function(){return Math.abs(Math.min(this._wheelTicksY,0))},scrollLeftAmount:function(){return Math.abs(Math.min(this._wheelTicksX,
0))},scrollRightAmount:function(){return Math.abs(Math.max(this._wheelTicksX,0))},getCanvasWidth:function(){return this._canvas.width},getCanvasHeight:function(){return this._canvas.height},getCanvas:function(){return this._canvas},setClickCallback:function(a){this._fileOpenDialogCB=a}};TentaGL.Light=function(a,b,c){a||(a=TentaGL.Color.RGBA(1,1,1,1));b||(b=TentaGL.Color.RGBA(1,1,1,1));c||(c=TentaGL.Color.RGBA(0,0,0,1));this._diffuse=a;this._specular=b;this._ambient=c};
TentaGL.Light.prototype={constructor:TentaGL.Light,isaLight:!0,getDiffuse:function(){return this._diffuse},setDiffuse:function(a){this._diffuse=a},getSpecular:function(){return this._specular},setSpecular:function(a){this._specular=a},getAmbient:function(){return this._ambient},setAmbient:function(a){this._ambient=a},render:function(a){}};TentaGL.AmbientLight=function(a){TentaGL.Light.call(this,TentaGL.Color.RGBA(0,0,0,1),TentaGL.Color.RGBA(0,0,0,1),a)};
TentaGL.AmbientLight.prototype={constructor:TentaGL.AmbientLight,isaAmbientLight:!0};Util.Inheritance.inherit(TentaGL.AmbientLight,TentaGL.Light);TentaGL.DirectionalLight=function(a,b,c,d){TentaGL.Light.call(this,b,c,d);this._direction=a};
TentaGL.DirectionalLight.prototype={constructor:TentaGL.DirectionalLight,isaDirectionalLight:!0,getDirection:function(){return this._direction},setDirection:function(a){this._direction[0]=a[0];this._direction[1]=a[1];this._direction[2]=a[2]},render:function(a){(new TentaGL.Math.Sphere(1,this._direction)).render(a,"white")}};Util.Inheritance.inherit(TentaGL.DirectionalLight,TentaGL.Light);
TentaGL.PointLight=function(a,b,c,d){TentaGL.Light.call(this,b,c,d);this._xyz=vec4.clone(a);this._xyz[3]=1;this._attenuation=[1,0,0]};
TentaGL.PointLight.prototype={constructor:TentaGL.PointLight,isaPointLight:!0,getXYZ:function(){return this._xyz},setXYZ:function(a){this._xyz[0]=a[0];this._xyz[1]=a[1];this._xyz[2]=a[2]},getAttenuation:function(){var a=[];a[0]=this._attenuation[0];a[1]=this._attenuation[1];a[2]=this._attenuation[2];return a},setAttenuation:function(a,b,c){this._attenuation[0]=a;this._attenuation[1]=b;this._attenuation[2]=c},render:function(a){(new TentaGL.Math.Sphere(1,this._xyz)).render(a)}};
Util.Inheritance.inherit(TentaGL.PointLight,TentaGL.Light);TentaGL.SpotLight=function(a,b,c,d,e,f,g){TentaGL.PointLight.call(this,a,e,f,g);TentaGL.DirectionalLight.call(this,b,e,f,g);this._angle=c;this._spotExp=d};TentaGL.SpotLight.prototype={constructor:TentaGL.SpotLight,isaSpotLight:!0,getCutOffAngle:function(){return this._angle},setCutOffAngle:function(a){this._angle=a},getSpotExponent:function(){return this._spotExp},setSpotExponent:function(a){this._spotExp=a}};
Util.Inheritance.inherit(TentaGL.SpotLight,TentaGL.PointLight);Util.Inheritance.inherit(TentaGL.SpotLight,TentaGL.DirectionalLight);TentaGL.LightManager=function(a){this._lights=[];this._maxLights=a};
TentaGL.LightManager.prototype={constructor:TentaGL.LightManager,isaLightManager:!0,add:function(a){if(this._lights.length==this._maxLights)throw Error("Too many lights.");this._lights.push(a)},get:function(a){return this._lights[a]},getAll:function(){for(var a=[],b=0;b<this._lights.length;b++)a.push(this._lights[b]);return a},remove:function(a){a=this._lights.indexOf(a);if(0>a)throw Error("Could not remove light.");this._lights.splice(a,1)},removeAll:function(){this._lights=[]},getCount:function(){return this._lights.length},
getMaxCount:function(){return this._maxLights},useMe:function(a){var b=TentaGL.ShaderLib.current(a);b.setLights&&b.setLights(a,this.getAll())},render:function(a){for(var b=0;b<this._lights.length;b++)this._lights[b].render(a)}};TentaGL.Material=function(){};TentaGL.Material.prototype={isaMaterial:!0,clean:function(a){},useMe:function(a){},isLoaded:function(){}};
TentaGL.BufferTexture=function(a,b,c,d){this._width=b;this._height=c;this._clearColor=d||TentaGL.Color.RGBA(0,0,0,0);this._frameBuffer=a.createFramebuffer();a.bindFramebuffer(GL_FRAMEBUFFER,this._frameBuffer);this._tex=TentaGL.Texture.create(a,null,b,c);a.framebufferTexture2D(GL_FRAMEBUFFER,GL_COLOR_ATTACHMENT0,GL_TEXTURE_2D,this._tex,0);this._depth=TentaGL.DepthBuffer.createBuffer(a,b,c);a.framebufferRenderbuffer(GL_FRAMEBUFFER,GL_DEPTH_ATTACHMENT,GL_RENDERBUFFER,this._depth);a.bindTexture(GL_TEXTURE_2D,
null);a.bindRenderbuffer(GL_RENDERBUFFER,null);a.bindFramebuffer(GL_FRAMEBUFFER,null)};
TentaGL.BufferTexture.prototype={constructor:TentaGL.BufferTexture,isaBufferTexture:!0,clean:function(a){a.deleteFramebuffer(this._frameBuffer);a.deleteTexture(this._tex);a.deleteRenderbuffer(this._depth)},isLoaded:function(){return!0},renderToMe:function(a,b){TentaGL.Viewport.push(a);a.bindFramebuffer(GL_FRAMEBUFFER,this._frameBuffer);TentaGL.Viewport.xywh(a,[0,0,this._width,this._height]);TentaGL.clear(a,this._clearColor);b(a);a.bindFramebuffer(GL_FRAMEBUFFER,null);TentaGL.Viewport.pop(a)},getPixelData:function(a,
b,c,d,e,f){b=b||0;c=c||0;d=d||this._width-b;e=e||this._height-c;return TentaGL.PixelData.fromGLTexture(a,this._tex,b,c,d,e,f)},useMe:function(a){a.activeTexture(GL_TEXTURE0);a.bindTexture(GL_TEXTURE_2D,this._tex);TentaGL.ShaderLib.current(a).setTex(a,0)}};Util.Inheritance.inherit(TentaGL.BufferTexture,TentaGL.Material);TentaGL.BumpMappedTexture=function(a,b){this._color=a;this._bump=b};
TentaGL.BumpMappedTexture.prototype={constructor:TentaGL.BumpMappedTexture,isaBumpMappedTexture:!0,getColorTextureName:function(){return this._color},getColorTexture:function(a){return TentaGL.MaterialLib.get(a,this._color)},getBumpTextureName:function(){return this._bump},getBumpTexture:function(a){return TentaGL.MaterialLib.get(a,this._bump)},useMe:function(a){var b=TentaGL.ShaderLib.current(a);this.getColorTexture(a).useMe(a);b.setBump&&(a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this.getBumpTexture(a).getLocation()),
b.setBump(a,1))}};Util.Inheritance.inherit(TentaGL.BumpMappedTexture,TentaGL.Material);TentaGL.Color=function(){this._rgba=vec4.create();this.setRGBA(0,0,0,1)};
TentaGL.Color.prototype={constructor:TentaGL.Color,isaColor:!0,clean:function(a){},isLoaded:function(){return!0},clone:function(){return TentaGL.Color.RGBA(this.getRed(),this.getGreen(),this.getBlue(),this.getAlpha())},r:function(a){void 0!==a&&(this._rgba[0]=a);return this._rgba[0]},g:function(a){void 0!==a&&(this._rgba[1]=a);return this._rgba[1]},b:function(a){void 0!==a&&(this._rgba[2]=a);return this._rgba[2]},a:function(a){void 0!==a&&(this._rgba[3]=a);return this._rgba[3]},getRGBA:function(){return vec4.clone(this._rgba)},
getRGBABytes:function(){return vec4.fromValues(this.getRedByte(),this.getGreenByte(),this.getBlueByte(),this.getAlphaByte())},getRed:function(){return this._rgba[0]},getRedByte:function(){return 255*this._rgba[0]&255},getGreen:function(){return this._rgba[1]},getGreenByte:function(){return 255*this._rgba[1]&255},getBlue:function(){return this._rgba[2]},getBlueByte:function(){return 255*this._rgba[2]&255},getAlpha:function(){return this._rgba[3]},getAlphaByte:function(){return 255*this._rgba[3]&255},
setRGBA:function(a,b,c,d){this._rgba[0]=a;this._rgba[1]=b;this._rgba[2]=c;void 0!==d&&(this._rgba[3]=d);return this},setRed:function(a){this._rgba[0]=a;return this},setGreen:function(a){this._rgba[1]=a;return this},setBlue:function(a){this._rgba[2]=a;return this},setAlpha:function(a){this._rgba[3]=a;return this},setHex:function(a){return this.setRGBA((a>>>16&255)/255,(a>>>8&255)/255,(a&255)/255,(a>>>24&255)/255)},getHex:function(){return TentaGL.Color.nrgba2Hex(this.getRed(),this.getGreen(),this.getBlue(),
this.getAlpha())},setHSBA:function(a,b,c,d){void 0===d&&(d=this.getAlpha());a=TentaGL.Color.HSBAtoRGBA(a,b,c,d);this.setRGBA(rgab[0],a[1],a[2],a[3])},getHSBA:function(){var a=this.getRed(),b=this.getGreen(),c=this.getBlue(),d=this.getAlpha();return TentaGL.Color.RGBAtoHSBA(a,b,c,d)},getHue:function(){return this.getHSBA()[0]},setHue:function(a){var b=this.getHSBA();this.setHSBA(a,b[1],b[2],b[3])},getSaturation:function(){return this.getHSBA()[1]},setSaturation:function(a){var b=this.getHSBA();this.setHSBA(b[0],
a,b[2],b[3])},getBrightness:function(){return this.getHSBA()[2]},setBrightness:function(a){var b=this.getHSBA();this.setHSBA(b[0],b[1],a,b[3])},useMe:function(a){var b=TentaGL.ShaderLib.current(a);b.setColor&&b.setColor(a,this._rgba)},equals:function(a){return this.getRed()==a.getRed()&&this.getGreen()==a.getGreen()&&this.getBlue()==a.getBlue()&&this.getAlpha()==a.getAlpha()},toCSS:function(){return"rgb("+this.getRedByte()+","+this.getGreenByte()+","+this.getBlueByte()+")"}};
Util.Inheritance.inherit(TentaGL.Color,TentaGL.Material);TentaGL.Color.RGBA=function(a,b,c,d){return(new TentaGL.Color).setRGBA(a,b,c,d)};TentaGL.Color.RGBABytes=function(a,b,c,d){void 0===d&&(d=255);return(new TentaGL.Color).setRGBA(a/255,b/255,c/255,d/255)};TentaGL.Color.Hex=function(a){return(new TentaGL.Color).setHex(a)};TentaGL.Color.HSBA=function(a,b,c,d){return(new TentaGL.Color).setHSBA(a,b,c,d)};
TentaGL.Color.nrgba2Hex=function(a,b,c,d){d=Math.floor(255*d)<<24;d+=Math.floor(255*a)<<16;d+=Math.floor(255*b)<<8;d+=Math.floor(255*c);return d>>>0};TentaGL.Color.rgba2Hex=function(a,b,c,d){a=(d<<24)+(a<<16);a+=b<<8;a+=c;return a>>>0};TentaGL.Color.RGBAtoHSBA=function(a,b,c,d){void 0===d&&(d=1);var e=Math.max(a,b,c),f=Math.min(a,b,c),f=e-f,g=0,g=0==f?0:e==a?(b-c)/f%6:(e=b)?(c-a)/f+2:(a-b)/f+4;a=e;b=0;0!=f&&(b=f/a);return[g/6,b,a,d]};
TentaGL.Color.HSBAtoRGBA=function(a,b,c,d){void 0===d&&(d=1);a=6*(a-Math.floor(a));b*=c;var e=b*(1-Math.abs(a%2-1));c-=b;return 0<=a&&1>a?[b+c,e+c,c,d]:1<=a&&2>a?[e+c,b+c,c,d]:2<=a&&3>a?[c,b+c,e+c,d]:3<=a&&4>a?[c,e+c,b+c,d]:4<=a&&5>a?[e+c,c,b+c,d]:5<=a&&6>a?[b+c,c,e+c,d]:[c,c,c,d]};TentaGL.Color.hexToRGBA=function(a){return vec4.fromValues((a>>>16&255)/255,(a>>>8&255)/255,(a&255)/255,(a>>>24&255)/255)};TentaGL.Color.BLACK=TentaGL.Color.Hex(4278190080);TentaGL.Color.BLUE=TentaGL.Color.Hex(4278190335);
TentaGL.Color.CYAN=TentaGL.Color.Hex(4278255615);TentaGL.Color.GREEN=TentaGL.Color.Hex(4278255360);TentaGL.Color.GREY=TentaGL.Color.Hex(4287137928);TentaGL.Color.MAGENTA=TentaGL.Color.Hex(4294902015);TentaGL.Color.RED=TentaGL.Color.Hex(4294901760);TentaGL.Color.WHITE=TentaGL.Color.Hex(4294967295);TentaGL.Color.YELLOW=TentaGL.Color.Hex(4294967040);TentaGL.Gradient=function(a,b){this._pt=vec2.clone(a);this._vec=vec2.clone(b);this._breakPts=[]};
TentaGL.Gradient.prototype={constructor:TentaGL.Gradient,isaGradient:!0,getStartPoint:function(){return this._pt},getVector:function(){return this._vec},getRadius:function(){return vec2.length(this._vec)},addBreakPt:function(a,b){if(0==this._breakPts.length)this._breakPts[0]=[a,b];else{for(var c=0,d=0;d<this._breakPts.length;d++)a>this._breakPts[d][0]&&(c=d+1);this._breakPts.splice(c,0,[a,b])}return this},getBreakPt:function(a){return this._breakPts[a][0]},getBreakPts:function(){for(var a=[],b=0;b<
this._breakPts.length;b++)a.push(this._breakPts[b][0]);return a},getColor:function(a){return this._breakPts[a][1]},getColors:function(){for(var a=[],b=0;b<this._breakPts.length;b++)a.push(this._breakPts[b][1]);return a},useMe:function(a){var b=TentaGL.ShaderLib.current(a);b.setStartPoint&&(b.setStartPoint(a,this._pt),b.setGradVector(a,this._vec),b.setColors(a,this.getColors()),b.setBreakPoints(a,this.getBreakPts()))}};Util.Inheritance.inherit(TentaGL.Gradient,TentaGL.Material);
TentaGL.Texture=function(a){this._tex=TentaGL.Texture.create(a);this._height=this._width=1};
TentaGL.Texture.prototype={constructor:TentaGL.Texture,isaTexture:!0,setPixelData:function(a,b){var c=b.getData(),d=b.getWidth(),e=b.getHeight();a.bindTexture(a.TEXTURE_2D,this._tex);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,d,e,0,a.RGBA,a.UNSIGNED_BYTE,c);this._width=d;this._height=e;TentaGL.MaterialLib.useNone(a)},clean:function(a){a.deleteTexture(this._tex)},getLocation:function(){return this._tex},getWidth:function(){return this._width},getHeight:function(){return this._height},getMagFilter:function(a){a.bindTexture(a.TEXTURE_2D,
this._tex);return a.getTexParameter(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER)},setMagFilter:function(a,b){a.bindTexture(a.TEXTURE_2D,this._tex);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,b)},getMinFilter:function(a){a.bindTexture(a.TEXTURE_2D,this._tex);return a.getTexParameter(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER)},setMinFilter:function(a,b){a.bindTexture(a.TEXTURE_2D,this._tex);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,b)},getWrapS:function(a){a.bindTexture(a.TEXTURE_2D,this._tex);return a.getTexParameter(a.TEXTURE_2D,
a.TEXTURE_WRAP_S)},setWrapS:function(a,b){a.bindTexture(a.TEXTURE_2D,this._tex);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,b)},getWrapT:function(a){a.bindTexture(a.TEXTURE_2D,this._tex);return a.getTexParameter(a.TEXTURE_2D,a.TEXTURE_WRAP_T)},setWrapT:function(a,b){a.bindTexture(a.TEXTURE_2D,this._tex);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,b)},getPixelData:function(a,b,c,d,e,f){b=b||0;c=c||0;d=d||this._width-b;e=e||this._height-c;return TentaGL.PixelData.fromGLTexture(a,this._tex,b,c,d,
e,f)},useMe:function(a){a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,this._tex);TentaGL.ShaderLib.current(a).setTex(a,0)},render:function(a,b,c){TentaGL.ViewTrans.push(a);this.useMe(a);var d;c?d=c/this.getHeight()*this.getWidth():(d=this.getWidth(),c=this.getHeight());TentaGL.ViewTrans.scale(a,[d,c]);b?TentaGL.ModelLib.render(a,"unitSprite"):TentaGL.ModelLib.render(a,"unitPlane");TentaGL.ViewTrans.pop(a)}};Util.Inheritance.inherit(TentaGL.Texture,TentaGL.Material);
TentaGL.Texture.create=function(a,b,c,d){b=b||null;c=c||1;d=d||1;var e=a.createTexture();a.bindTexture(GL_TEXTURE_2D,e);a.texImage2D(GL_TEXTURE_2D,0,GL_RGBA,c,d,0,GL_RGBA,GL_UNSIGNED_BYTE,b);a.texParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_NEAREST);a.texParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_NEAREST);a.texParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_S,GL_CLAMP_TO_EDGE);a.texParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_T,GL_CLAMP_TO_EDGE);return e};
TentaGL.Texture.fromURL=function(a,b,c,d){var e=new TentaGL.Texture(a);TentaGL.PixelData.fromURL(b,function(b){c&&(b=c(b));e.setPixelData(a,b);d&&d(e)});return e};TentaGL.Texture.fromCanvas=function(a,b,c,d){b=TentaGL.PixelData.fromCanvas(b);return TentaGL.Texture.fromPixelData(a,b,c,d)};TentaGL.Texture.fromPixelData=function(a,b,c,d){c&&(b=c(b));c=new TentaGL.Texture(a);c.setPixelData(a,b);d&&d(c);return c};
TentaGL.Texture.fromColor=function(a,b,c,d){b=TentaGL.Canvas2D.createRect(8,8,!1,0,b);return TentaGL.Texture.fromCanvas(a,b,c,d)};
TentaGL.MaterialLib={_materials:{},clean:function(a){for(var b in a._materialLib)a._materialLib[b].clean(a);a._materialLib={}},reset:function(a){this.clean(a);this.add(a,"default",TentaGL.Color.WHITE)},get:function(a,b){var c=a._materialLib[b];if(void 0===c)throw Error("Material "+b+" doesn't exist.");return c},has:function(a,b){return void 0!==a._materialLib[b]},add:function(a,b,c){if(void 0!==a._materialLib[b])throw Error("Material "+b+" already exists.");if(!c.isaMaterial)throw Error("Object for "+
b+" isn't a material!");return a._materialLib[b]=c},remove:function(a,b){var c=a._materialLib[b];if(void 0===c)throw Error("Material "+b+" doesn't exist.");c.clean(a);delete a._materialLib[b]},use:function(a,b){if(a._materialLibCurrentName!==b){var c=a._materialLib[b];if(void 0===c)throw Error("Material "+b+" doesn't exist.");c.useMe(a);a._materialLibCurrentName=b}},useNone:function(a){a._materialLibCurrentName=void 0}};
TentaGL.MaterialProps=function(a,b,c,d,e){a||(a=TentaGL.Color.RGBA(1,1,1,1));b||(b=TentaGL.Color.RGBA(1,1,1,1));c||(c=10);d||(d=TentaGL.Color.RGBA(1,1,1,1));e||(e=TentaGL.Color.RGBA(0,0,0,1));this._diffuse=a;this._specular=b;this._shininess=c;this._ambient=d;this._emission=e};
TentaGL.MaterialProps.prototype={constructor:TentaGL.MaterialProps,isaMaterialProps:!0,getDiffuse:function(){return this._diffuse},setDiffuse:function(a){this._diffuse=a},getSpecular:function(){return this._specular},setSpecular:function(a){this._specular=a},getShininess:function(){return this._shininess},setShininess:function(a){this._shininess=a},getAmbient:function(){return this._ambient},setAmbient:function(a){this._ambient=a},getEmission:function(){return this._emission},setEmission:function(a){this._emission=
a},useMe:function(a){var b=TentaGL.ShaderLib.current(a);b.setMaterialProps&&b.setMaterialProps(a,this)}};
TentaGL.ClippingArea={reset:function(a){a._clipLevel=0;a._clipFuncs=[];a._clipFuncsStack=[]},clip:function(a,b){TentaGL.ColorBuffer.push(a);TentaGL.DepthBuffer.push(a);TentaGL.Stencil.push(a);a._clipLevel++;TentaGL.DepthBuffer.clear(a);TentaGL.Stencil.enabled(a,!0);TentaGL.Stencil.func(a,GL_GREATER,a._clipLevel);TentaGL.Stencil.op(a,GL_KEEP,GL_INCR,GL_INCR);TentaGL.Stencil.mask(a,255);TentaGL.ColorBuffer.mask(a,!1,!1,!1,!1);TentaGL.DepthBuffer.mask(a,!1);b(a);a._clipFuncs.push(b);TentaGL.Stencil.pop(a);
TentaGL.DepthBuffer.pop(a);TentaGL.ColorBuffer.pop(a);TentaGL.Stencil.enabled(a,!0);TentaGL.Stencil.func(a,GL_EQUAL,a._clipLevel);TentaGL.Stencil.mask(a,0)},getClip:function(a){return a._clipFuncs.slice(0)},setClip:function(a,b){this.clear(a);if("[object Array]"===Object.prototype.toString.call(b))for(var c=0;c<b.length;c++)this.clip(a,b[c]);else this.clip(a,b)},clear:function(a){TentaGL.Stencil.push(a);TentaGL.Stencil.enabled(a,!0);TentaGL.Stencil.mask(a,255);TentaGL.Stencil.clear(a,0);TentaGL.Stencil.pop(a);
a._clipLevel=0;a._clipFuncs=[]},push:function(a){a._clipFuncsStack.push(a._clipFuncs)},pop:function(a){var b=a._clipFuncsStack.pop();this.setClip(a,b)}};TentaGL.SceneNode=function(a){void 0===a&&(a=[0,0,0]);a[2]||(a[2]=0);this._xyz=vec4.fromValues(a[0],a[1],a[2],1);this._scaleXYZ=[1,1,1];this._scaleUni=1;this._quat=quat.create();this._objLook=vec3.fromValues(0,0,1);this._objUp=vec3.fromValues(0,1,0);this._transform=mat4.create();this._isVisible=this._tranDirty=!0;this._opacity=1;this._parent=void 0};
TentaGL.SceneNode.prototype={constructor:TentaGL.SceneNode,isaSceneNode:!0,clean:function(a){},getParent:function(){return this._parent},setParent:function(a){this._parent=a},hasParent:function(){return this._parent?!0:!1},removeFromParent:function(){this._parent&&this._parent.remove&&(this._parent.remove(this),this._parent=null)},getCompositeParent:function(){return this._compositeParent},setCompositeParent:function(a){this._compositeParent=a},getCompositePath:function(){for(var a=[],b=this;b;)a.push(b),
b=b.getCompositeParent();return a},isVisible:function(){return this._isVisible},setVisible:function(a){this._isVisible=a},opacity:function(a){void 0!==a&&(this._opacity=Math.max(0,Math.min(a,1)));return this._opacity},useOpacity:function(a){var b=TentaGL.ShaderLib.current(a);b.setOpacity&&b.setOpacity(a,this._opacity)},getXYZ:function(){return this._xyz},getWorldXYZ:function(){var a=this.getWorldTransform();return vec4.fromValues(a[12],a[13],a[14],1)},setXYZ:function(a){this._xyz[0]=a[0];this._xyz[1]=
a[1];this._xyz[2]=a[2];this._tranDirty=!0},getX:function(){return this._xyz[0]},getY:function(){return this._xyz[1]},getZ:function(){return this._xyz[2]},xyz:function(a){if(void 0!==a)this.setXYZ(a);else return this.getXYZ()},x:function(a){if(void 0!==a)this._xyz[0]=a,this._tranDirty=!0;else return this._xyz[0]},y:function(a){if(void 0!==a)this._xyz[1]=a,this._tranDirty=!0;else return this._xyz[1]},z:function(a){if(void 0!==a)this._xyz[2]=a,this._tranDirty=!0;else return this._xyz[2]},getQuat:function(){return this._quat},
getWorldQuat:function(){return this._getWorldQuat(quat.create())},_getWorldQuat:function(a){quat.mul(a,this.getQuat(),a);return this._parent?this._parent._getWorldQuat(a):a},setQuat:function(a){this._quat=a;this._tranDirty=!0},getParentWorldQuat:function(){return this._parent?this._parent.getWorldQuat():quat.create()},rotate:function(a,b){var c=quat.setAxisAngle(quat.create(),a,b);this.setQuat(quat.mul(this._quat,c,this._quat))},mulQuat:function(a){this.setQuat(quat.mul(this._quat,a,this._quat))},
getBaseLook:function(){return this._objLook},getWorldBaseLook:function(){var a=this.getParentWorldQuat();return vec3.transformQuat(vec3.create(),this._objLook,a)},setBaseLook:function(a){vec3.normalize(this._objLook,a);this._correctUpVector()},getLook:function(){return vec3.transformQuat(vec3.create(),this._objLook,this._quat)},getWorldLook:function(){var a=this.getWorldQuat();return vec3.transformQuat(vec3.create(),this.getBaseLook(),a)},getBaseRight:function(){return vec3.cross(vec3.create(),this._objLook,
this._objUp)},getWorldBaseRight:function(){var a=this.getParentWorldQuat();return vec3.transformQuat(vec3.create(),this.getBaseRight(),a)},getRight:function(){return vec3.transformQuat(vec3.create(),this.getBaseRight(),this._quat)},getWorldRight:function(){var a=this.getWorldQuat();return vec3.transformQuat(vec3.create(),this.getBaseRight(),a)},getUp:function(){return vec3.transformQuat(vec3.create(),this._objUp,this._quat)},getWorldUp:function(){var a=this.getWorldQuat();return vec3.transformQuat(vec3.create(),
this.getBaseUp(),a)},getBaseUp:function(){return this._objUp},getWorldBaseUp:function(){var a=this.getParentWorldQuat();return vec3.transformQuat(vec3.create(),this._objUp,a)},setBaseUp:function(a){vec3.normalize(this._objUp,a);this._correctUpVector()},_correctUpVector:function(){var a=this._objLook,b=this._objUp,c=vec3.cross(vec3.create(),a,b);this._objUp=vec3.cross(b,c,a)},getBaseLookVectors:function(){return[this.getBaseLook(),this.getBaseUp(),this.getBaseRight()]},getLookVectors:function(){this.getQuat();
var a=vec3.transformQuat(vec3.create(),this._objLook,this._quat),b=vec3.transformQuat(vec3.create(),this._objUp,this._quat),c=vec3.transformQuat(vec3.create(),this.getBaseRight,this._quat);return[a,b,c]},getWorldLookVectors:function(){this.getWorldQuat();var a=vec3.transformQuat(vec3.create(),this._objLook,this._quat),b=vec3.transformQuat(vec3.create(),this._objUp,this._quat),c=vec3.transformQuat(vec3.create(),this.getBaseRight,this._quat);return[a,b,c]},orient:function(a,b){this.setQuat(TentaGL.Math.getOrientation(this.getBaseLook(),
this.getBaseUp(),a,b))},orientWorld:function(a,b){var c=this.getParentWorldQuat();quat.invert(c,c);a=vec3.transformQuat(vec3.create(),a,c);b=vec3.transformQuat(vec3.create(),b,c);this.setQuat(TentaGL.Math.getOrientation(this.getBaseLook(),this.getBaseUp(),a,b))},lookAt:function(a){var b=this.getXYZ();a=vec3.fromValues(a[0]-b[0],a[1]-b[1],a[2]-b[2]);b=vec3.cross(vec3.create(),a,this.getBaseUp());b=vec3.cross(vec3.create(),b,a);this.orient(a,b)},lookAtWorld:function(a){var b=this.getWorldXYZ();a=vec3.fromValues(a[0]-
b[0],a[1]-b[1],a[2]-b[2]);b=vec3.cross(vec3.create(),a,this.getWorldBaseUp());b=vec3.cross(vec3.create(),b,a);this.orientWorld(a,b)},billboardPoint:function(a,b){var c=this.getXYZ(),c=vec3.fromValues(a[0]-c[0],a[1]-c[1],a[2]-c[2]),d=vec3.cross(vec3.create(),c,b);b=vec3.cross(vec3.create(),d,c);this.orient(c,b)},billboardWorldPoint:function(a,b){var c=this.getWorldXYZ(),c=vec3.fromValues(a[0]-c[0],a[1]-c[1],a[2]-c[2]),d=vec3.cross(vec3.create(),c,b);b=vec3.cross(vec3.create(),d,c);this.orientWorld(c,
b)},billboardAxis:function(a){var b=this.getXYZ(),c=this.getBaseLook(),d=this.getBaseUp();a=vec3.fromValues(a[0]-b[0],a[1]-b[1],a[2]-b[2]);var b=TentaGL.Math.getQuatFromTo(c,a),e=vec3.transformQuat(vec3.create(),d,b),f=vec3.cross(vec3.create(),a,d),f=vec3.cross(vec3.create(),f,a),e=TentaGL.Math.getQuatFromTo(e,f);quat.mul(b,e,b);e=TentaGL.Math.getQuatFromTo(f,d);quat.mul(b,e,b);a=vec3.transformQuat(a,c,b);this.orient(a,d)},billboardWorldAxis:function(a){var b=this.getWorldXYZ(),c=this.getWorldBaseLook(),
d=this.getWorldBaseUp();a=vec3.fromValues(a[0]-b[0],a[1]-b[1],a[2]-b[2]);var b=TentaGL.Math.getQuatFromTo(c,a),e=vec3.transformQuat(vec3.create(),d,b),f=vec3.cross(vec3.create(),a,d),f=vec3.cross(vec3.create(),f,a),e=TentaGL.Math.getQuatFromTo(e,f);quat.mul(b,e,b);e=TentaGL.Math.getQuatFromTo(f,d);quat.mul(b,e,b);a=vec3.transformQuat(a,c,b);this.orientWorld(a,d)},billboardPlane:function(a,b){this.orient(a,b)},billboardWorldPlane:function(a,b){this.orientWorld(a,b)},getScaleXYZ:function(){return this._ScaleXYZ},
setScaleXYZ:function(a){this._scaleXYZ=vec3.fromValues(a[0],a[1],a[2]);this._tranDirty=!0},getScaleX:function(){return this._scaleXYZ[0]},getScaleY:function(){return this._scaleXYZ[1]},getScaleZ:function(){return this._scaleXYZ[2]},getScaleUni:function(){return this._scaleUni},setScaleUni:function(a){this._scaleUni=a;this._tranDirty=!0},getWorldScaleUni:function(){var a=this.getScaleUni();this._parent&&(a+=this._parent.getWorldScaleUni());return a},scale:function(a){if(void 0!==a)this.setScaleXYZ(a);
else return this.getScaleXYZ()},scaleX:function(a){if(void 0!==a)this._scaleXYZ[0]=a,this._tranDirty=!0;else return this._scaleXYZ[0]},scaleY:function(a){if(void 0!==a)this._scaleXYZ[1]=a,this._tranDirty=!0;else return this._scaleXYZ[1]},scaleZ:function(a){if(void 0!==a)this._scaleXYZ[2]=a,this._tranDirty=!0;else return this._scaleXYZ[2]},scaleU:function(a){if(void 0!==a)this._scaleUni=a,this._tranDirty=!0;else return this._scaleUni},getModelTransform:function(){this._tranDirty&&(this._transform=
this.getTRSTransform(),this._tranDirty=!1);return this._transform},getTRSTransform:function(){var a=this.getX(),b=this.getY(),c=this.getZ(),d=this.getScaleUni(),e=this.getScaleX()*d,f=this.getScaleY()*d,d=this.getScaleZ()*d,g=this._transform;mat4.fromQuat(g,this.getQuat());g[0]*=e;g[1]*=e;g[2]*=e;g[4]*=f;g[5]*=f;g[6]*=f;g[8]*=d;g[9]*=d;g[10]*=d;g[12]=a;g[13]=b;g[14]=c;g[15]=1;return g},getWorldTransform:function(){return this._getWorldTransform(mat4.create())},_getWorldTransform:function(a){mat4.mul(a,
this.getModelTransform(),a);this._parent&&this._parent._getWorldTransform(a);return a},render:function(a){this.isVisible()&&TentaGL.SceneNode.filter(this)&&(TentaGL.ViewTrans.push(a),TentaGL.ViewTrans.mul(a,this.getModelTransform()),this.useOpacity(a),this.draw(a),TentaGL.ViewTrans.pop(a))},draw:function(a){}};TentaGL.SceneNode.defaultRenderFilter=function(a){return!0};TentaGL.SceneNode.getRenderFilter=function(){TentaGL.SceneNode._renderFilter||TentaGL.SceneNode.resetRenderFilter();return TentaGL.SceneNode._renderFilter};
TentaGL.SceneNode.setRenderFilter=function(a){TentaGL.SceneNode._renderFilter=a};TentaGL.SceneNode.resetRenderFilter=function(){TentaGL.SceneNode.setRenderFilter(TentaGL.SceneNode.defaultRenderFilter)};TentaGL.SceneNode.filter=function(a){return TentaGL.SceneNode.getRenderFilter()(a)};Util.Inheritance.inherit(TentaGL.SceneNode,TentaGL.Renderable);TentaGL.SceneGroup=function(a){TentaGL.SceneNode.call(this,a);this._children=[]};
TentaGL.SceneGroup.prototype={constructor:TentaGL.SceneGroup,clean:function(a){for(var b in this._children)this._children[b].clean(a);this.clear()},indexOf:function(a){return this._children.indexOf(a)},get:function(a){return this._children[a]},getChildren:function(){return this._children.concat([])},add:function(a){this._children.push(a);a.setParent(this)},size:function(){return this._children.length},remove:function(a){a=this._children.indexOf(a);if(-1==a)return!1;this._children.splice(a,1);return!0},
clear:function(){this._children=[]},moveBack:function(a){a=this._children.indexOf(a);if(0<a){var b=this._children[a-1];this._children[a-1]=this._children[a];this._children[a]=b}},moveForward:function(a){-1!=index&&index<this._children.length&&(a=this._children[index+1],this._children[index+1]=this._children[index],this._children[index]=a)},moveToFront:function(a){this.remove(a)&&this._children.push(a)},moveToBack:function(a){this.remove(a)&&this._children.unshift(a)},renderSorted:function(a){if(this.isVisible()){var b=
TentaGL.ViewTrans.getCamera(a).getViewTransform();this._children.sort(function(a,d){var e=a.getWorldXYZ();vec3.transformMat4(e,e,b);var f=d.getWorldXYZ();vec3.transformMat4(f,f,b);return e[2]-f[2]});this.render(a)}},draw:function(a){for(var b=0;b<this.size();b++)this._children[b].render(a)}};Util.Inheritance.inherit(TentaGL.SceneGroup,TentaGL.SceneNode);TentaGL.Sprite=function(a){TentaGL.SceneNode.call(this,a);this._anchorXYZ=vec4.fromValues(0,0,0,1)};
TentaGL.Sprite.prototype={constructor:TentaGL.Sprite,isaSprite:!0,getAnchorXYZ:function(){return this._anchorXYZ},setAnchorXYZ:function(a){this._anchorXYZ=vec4.fromValues(a[0],a[1],a[2],1)},getAnchorX:function(){return this._anchorXYZ[0]},getAnchorY:function(){return this._anchorXYZ[1]},getAnchorZ:function(){return this._anchorXYZ[2]},anchor:function(a){if(void 0!==a)this.setAnchorXYZ(a);else return this.getAnchorXYZ()},getTRSTransform:function(){var a=this.getX(),b=this.getY(),c=this.getZ(),d=0-
this.getAnchorX(),e=0-this.getAnchorY(),f=0-this.getAnchorZ(),g=this.getScaleUni(),h=this.getScaleX()*g,m=this.getScaleY()*g,g=this.getScaleZ()*g,k=this._transform;mat4.fromQuat(k,this.getQuat());k[0]*=h;k[1]*=h;k[2]*=h;k[4]*=m;k[5]*=m;k[6]*=m;k[8]*=g;k[9]*=g;k[10]*=g;k[12]=d*k[0]+e*k[4]+f*k[8]+a;k[13]=d*k[1]+e*k[5]+f*k[9]+b;k[14]=d*k[2]+e*k[6]+f*k[10]+c;k[15]=1;return k},draw:function(a){}};Util.Inheritance.inherit(TentaGL.Sprite,TentaGL.SceneNode);
TentaGL.Sprite.create=function(a,b,c,d,e){a=new TentaGL.Sprite(a);e||(e=new TentaGL.MaterialProps);a.draw=function(a){try{TentaGL.ShaderLib.use(a,d),TentaGL.MaterialLib.use(a,c),e.useMe(a),TentaGL.ModelLib.render(a,b)}catch(g){}};return a};TentaGL.BillboardSprite=function(a){TentaGL.Sprite.call(this,a)};
TentaGL.BillboardSprite.prototype={constructor:TentaGL.BillboardSprite,isaBillboardSprite:!0,render:function(a){if(this.isVisible()&&TentaGL.SceneNode.filter(this)){TentaGL.ViewTrans.push(a);var b=TentaGL.ViewTrans.getCamera(a),c=b.getEye();this.billboardWorldPoint(c,b.getUp());TentaGL.ViewTrans.mul(a,this.getModelTransform());this.useOpacity(a);this.draw(a);TentaGL.ViewTrans.pop(a)}},draw:function(a){}};Util.Inheritance.inherit(TentaGL.BillboardSprite,TentaGL.Sprite);
TentaGL.ButtonSprite=function(a){TentaGL.Sprite.call(this,a);this.resetMouseState();this.setEnabled(!0)};
TentaGL.ButtonSprite.prototype={constructor:TentaGL.ButtonSprite,isaButtonSprite:!0,resetMouseState:function(){this._isRightPressed=this._isLeftPressed=!1;this._mouseOverStart=-1},updateMouseState:function(a,b){if(a.getSpriteAtMouse(b)==this&&this._enabled){-1==this._mouseOverStart&&(this._mouseOverStart=Date.now(),this.onMouseOver(b));if(b.isLeftPressed())this._isLeftPressed=!0;else{if(this._isLeftPressed)this.onClick(b);this._isLeftPressed=!1}if(b.isRightPressed())this._isRightPressed=!0;else{if(this._isRightPressed)this.onRightClick(b);
this._isRightPressed=!1}}else{if(0<=this._mouseOverStart)this.onMouseExit(b);this.resetMouseState()}},isPressed:function(){return this._isLeftPressed},timeMouseOvered:function(){return-1==this._mouseOverStart?-1:Date.now()-this._mouseOverStart},isMouseOvered:function(){return 0<=this._mouseOverStart},isEnabled:function(){return this._enabled},setEnabled:function(a){this._enabled=a},onClick:function(a){},onRightClick:function(a){},onMouseOver:function(a){},onMouseExit:function(a){}};
Util.Inheritance.inherit(TentaGL.ButtonSprite,TentaGL.Sprite);TentaGL.ButtonSprite.create=function(a,b,c,d,e){a=new TentaGL.ButtonSprite(a);e||(e=new TentaGL.MaterialProps);a.draw=function(a){try{TentaGL.ShaderLib.use(a,d),TentaGL.MaterialLib.use(a,c),e.useMe(a),TentaGL.ModelLib.render(a,b)}catch(g){}};return a};TentaGL.CompositeSprite=function(a,b){TentaGL.Sprite.call(this,a);this._components=[];for(var c in b)this.addComponent(b[c])};
TentaGL.CompositeSprite.prototype={constructor:TentaGL.CompositeSprite,isaCompositeSprite:!0,addComponent:function(a){if(a.getCompositeParent())throw Error("CompositeSprite component cycle detected.");this._components.push(a);a.setCompositeParent(this);a.setParent(this)},getComponents:function(){return this._components},draw:function(a){for(var b=0;b<this._components.length;b++)this._components[b].render(a)}};Util.Inheritance.inherit(TentaGL.CompositeSprite,TentaGL.Sprite);
TentaGL.LabelledIconSprite=function(a,b,c,d,e){TentaGL.CompositeSprite.call(this,a);this._createIcon(b);this._createLabel(c,d,e)};
TentaGL.LabelledIconSprite.prototype={constructor:TentaGL.LabelledIconSprite,isaLabelledIconSprite:!0,_createIcon:function(a){this._icon=new TentaGL.ImageIconSprite([0,0,0],a);this._icon.setAlignment(TentaGL.Align.CENTER,TentaGL.Align.CENTER);this.addComponent(this._icon)},_createLabel:function(a,b,c){this._label=new TentaGL.TextIconSprite([0,.3,.001],a,c,.5);this._label.setAlignment(TentaGL.Align.CENTER,TentaGL.Align.BOTTOM);this.addComponent(this._label);this._labelBG=new TentaGL.ImageIconSprite([0,
.3,5E-4],b);this._labelBG.setAlignment(TentaGL.Align.CENTER,TentaGL.Align.BOTTOM);this._fitLabelBG();this.addComponent(this._labelBG)},_fitLabelBG:function(){this._labelBG.setScaleXYZ([this._label.getIconWidth()/this._labelBG.getIconWidth()+.1,this._label.getIconHeight()/this._labelBG.getIconHeight(),1])},getIcon:function(){return this._icon.getTextureName()},setIcon:function(a){this._icon.setTextureName(a)},getText:function(){return this._label.getText()},setText:function(a){this._label.setText(a);
this._fitLabelBG()},getLabelBG:function(){return this._labelBG.getTextureName()},setLabelBG:function(a){this._labelBG.setTextureName(a)},getIconWidth:function(){return this._icon.getIconWidth()},getIconHeight:function(){return this._icon.getIconHeight()},handlePickEvent:function(a){var b=a.getSource();b!=this._label&&b!=this._labelBG&&b!=this._icon||this.firePickEvent(a.getContext())},render:function(a){if(this.isVisible()&&TentaGL.SceneNode.filter(this)){TentaGL.ViewTrans.push(a);var b=TentaGL.ViewTrans.getCamera(a);
b.getEye();this.billboardWorldPlane(vec3.negate(vec3.create(),b.getLook()),b.getUp());this._fitLabelBG();TentaGL.ViewTrans.mul(a,this.getModelTransform());this.draw(a);TentaGL.ViewTrans.pop(a)}}};Util.Inheritance.inherit(TentaGL.LabelledIconSprite,TentaGL.CompositeSprite);Util.Inheritance.inherit(TentaGL.LabelledIconSprite,TentaGL.PickEventListener);TentaGL.IconSprite=function(a){TentaGL.Sprite.call(this,a);this._hAlign=TentaGL.Align.LEFT;this._vAlign=TentaGL.Align.BOTTOM};
TentaGL.IconSprite.prototype={constructor:TentaGL.IconSprite,isaIconSprite:!0,getIconWidth:function(){},getIconHeight:function(){},getIconAspect:function(){return this.getIconWidth()/this.getIconHeight()},setAlignment:function(a,b){this._hAlign=a;this._vAlign=b;this._updateAlignment()},_updateAlignment:function(){var a=void 0,b=void 0;this._hAlign==TentaGL.Align.LEFT?a=0:this._hAlign==TentaGL.Align.CENTER?a=this.getIconWidth()/2:this._hAlign==TentaGL.Align.RIGHT&&(a=this.getIconWidth());this._vAlign==
TentaGL.Align.BOTTOM?b=0:this._vAlign==TentaGL.Align.CENTER?b=this.getIconHeight()/2:this._vAlign==TentaGL.Align.TOP&&(b=this.getIconHeight());this.setAnchorXYZ([a,b,0])},scaleIconDims:function(){this.setScaleXYZ([this.getIconWidth(),this.getIconHeight(),1])},scaleToWidth:function(a){var b=this.getIconWidth()/this.getIconHeight();this.setScaleXYZ([a,a/b,1])},scaleToHeight:function(a){var b=this.getIconWidth()/this.getIconHeight();this.setScaleXYZ([a*b,a,1])},render:function(a){if(this.isVisible()&&
TentaGL.SceneNode.filter(this)){TentaGL.ViewTrans.push(a);this._updateAlignment();var b=TentaGL.ViewTrans.getCamera(a);b.getEye();this.billboardWorldPlane(vec3.negate(vec3.create(),b.getLook()),b.getUp());TentaGL.ViewTrans.mul(a,this.getModelTransform());this.useOpacity(a);this.draw(a);TentaGL.ViewTrans.pop(a)}},draw:function(a){}};Util.Inheritance.inherit(TentaGL.IconSprite,TentaGL.Sprite);
TentaGL.ImageIconSprite=function(a,b){TentaGL.IconSprite.call(this,a);this._texName=b;this._texHeight=this._texWidth=1};
TentaGL.ImageIconSprite.prototype={constructor:TentaGL.ImageIconSprite,isaImageIconSprite:!0,getTextureName:function(){return this._texName},setTextureName:function(a){this._texName=a},getTexture:function(a){return TentaGL.MaterialLib.get(a,this._texName)},getPixelData:function(a){return this.getTexture(a).getPixelData()},getIconWidth:function(){return this._texWidth/this._texHeight},getIconHeight:function(){return 1},getTextureWidth:function(){return this._texWidth},getTextureHeight:function(){return this._texHeight},
draw:function(a){TentaGL.MaterialLib.use(a,this._texName);var b=this.getTexture(a);this._texWidth=b.getWidth();this._texHeight=b.getHeight();var b=this.getIconWidth(),c=this.getIconHeight();TentaGL.ViewTrans.scale(a,[b,c]);TentaGL.ModelLib.render(a,"unitPlane")}};Util.Inheritance.inherit(TentaGL.ImageIconSprite,TentaGL.IconSprite);TentaGL.TextSprite=function(a,b,c,d,e){TentaGL.Sprite.call(this,a);d||(d=!1);this._blitFont=c;this._charH=e;this._yFlipped=d;this.setText(b)};
TentaGL.TextSprite.prototype={constructor:TentaGL.TextSprite,isaTextSprite:!0,getText:function(){return this._text},setText:function(a){this._text=a;a=this._blitFont.getStringDimensions(a,this._charH);this._width=a[0];this._height=a[1]},getBlitteredFont:function(){return this._blitFont},setBlitteredFont:function(a){this._blitFont=a},getLineHeight:function(){if(void 0===this._charH)this._blitFont.getLineHeight();else return this._charH},setLineHeight:function(a){this._charH=a},getWidth:function(){return this._width},
getHeight:function(){return this._height},draw:function(a){this._blitFont.renderString(a,this._text,[0,0,0],this._yFlipped,this._charH)}};Util.Inheritance.inherit(TentaGL.TextSprite,TentaGL.Sprite);TentaGL.TextIconSprite=function(a,b,c,d){TentaGL.IconSprite.call(this);TentaGL.TextSprite.call(this,a,b,c);d||(d=1);this._lineHeight=d};
TentaGL.TextIconSprite.prototype={constructor:TentaGL.TextIconSprite,isaTextIconSprite:!0,getIconWidth:function(){return this.getBlitteredFont().getStringDimensions(this._text,this._lineHeight)[0]},getIconHeight:function(){return this.getBlitteredFont().getStringDimensions(this._text,this._lineHeight)[1]},getLineHeight:function(){return this._lineHeight},setLineHeight:function(a){this._lineHeight=a},draw:function(a){var b=this.getBlitteredFont().getStringDimensions(this._text,this._lineHeight);TentaGL.ViewTrans.translate(a,
[0,b[1]-this._lineHeight,0]);this.getBlitteredFont().renderString(a,this._text,[0,0,0],this._yFlipped,this._lineHeight)}};Util.Inheritance.inherit(TentaGL.TextIconSprite,TentaGL.IconSprite);Util.Inheritance.inherit(TentaGL.TextIconSprite,TentaGL.TextSprite);
TentaGL.ViewTrans={set:function(a,b){a._modelViewTrans=b},get:function(a){return a._modelViewTrans},mul:function(a,b){mat4.mul(a._modelViewTrans,a._modelViewTrans,b)},translate:function(a,b){b[2]||(b[2]=0);var c=mat4.create();mat4.translate(c,c,b);this.mul(a,c)},rotate:function(a,b,c){var d=quat.create();quat.setAxisAngle(d,b,c);b=mat4.create();mat4.fromQuat(b,d);this.mul(a,b)},scale:function(a,b){void 0===b[2]&&(b[2]=1);var c=mat4.create();mat4.scale(c,c,b);this.mul(a,c)},premul:function(a,b){mat4.mul(a._modelViewTrans,
b,a._modelViewTrans)},push:function(a){a._transformStack.push(mat4.clone(a._modelViewTrans))},pop:function(a){a._modelViewTrans=a._transformStack.pop()},reset:function(a){this.set(a,mat4.create());a._transformStack=[];this.setProjection(a,mat4.create());a._normalTrans=mat3.create();a._mvpTrans=mat4.create()},setView:function(a,b){this.set(b);a._viewTrans=b},getView:function(a){return a._viewTrans},mulView:function(a,b){mat4.mul(a._viewTrans,a._viewTrans,b)},premulView:function(a,b){mat4.mul(a._viewTrans,
b,a._viewTrans)},setProjection:function(a,b){a._projTrans=b},getProjection:function(a){return a._projTrans},mulProjection:function(a,b){mat4.mul(a._projTrans,a._projTrans,b)},premulProjection:function(a,b){mat4.mul(a._projTrans,b,a._projTrans)},getNormal:function(a){return mat3.normalFromMat4(mat3.create(),a._modelViewTrans)},getProjectionNormal:function(a){return mat3.normalFromMat4(mat3.create(),this.getMVP(a))},getMVP:function(a){return mat4.mul(mat4.create(),a._projTrans,a._modelViewTrans)},updateMVPUniforms:function(a){var b=
TentaGL.ShaderLib.current(a);b.setNormalTrans&&(mat3.normalFromMat4(a._normalTrans,a._modelViewTrans),b.setNormalTrans(a,a._normalTrans));b.setMVPTrans&&(mat4.mul(a._mvpTrans,a._projTrans,a._modelViewTrans),b.setMVPTrans(a,a._mvpTrans));b.setMVTrans&&b.setMVTrans(a,a._modelViewTrans);b.setVTrans&&b.setVTrans(a,a._viewTrans)},getCamera:function(a){return a._camera},setCamera:function(a,b,c){a._camera=b;this.set(a,b.getViewTransform());this.setView(a,b.getViewTransform());this.setProjection(a,b.getProjectionTransform(c))}};
TentaGL.BlitteredFont=function(a,b,c,d,e,f){a&&this._createChars(a,b,c,d);void 0===e&&(e=1);void 0===f&&(f=1);this._hPad=e;this._vPad=f;this._texIDPrefix="bfont"+TentaGL.BlitteredFont._count+":";TentaGL.BlitteredFont._count++};TentaGL.BlitteredFont._count=0;
TentaGL.BlitteredFont.prototype={constructor:TentaGL.BlitteredFont,isaBlitteredFont:!0,clean:function(a){for(var b in this._charPixData)TentaGL.MaterialLib.remove(a,this._texIDPrefix+b)},_createChars:function(a,b,c,d){this._charPixData={};this._charWidths={};this._monospaced=b;this._charW=c;this._charH=d;for(var e=32;128>e;e++){var f=Math.floor((e-32)/16),g=1+(e-32)%16*(c+2),h=a.getHeight()-(1+d+f*(2+d)),f=String.fromCharCode(e),g=a.crop(g,h,c,d);if(b||32==e)this._charWidths[f]=b||32!=e?c:c/2;else{for(var m=
0,k=g.getWidth()-1,l=!1;m<k&&!l;){for(h=0;h<g.getHeight();h++)if(0!=g.getPixelAt(m,h)[3]){l=!0;break}l||m++}for(l=!1;k>m&&!l;){for(h=0;h<g.getHeight();h++)if(0!=g.getPixelAt(k,h)[3]){l=!0;break}l||k--}h=k-m+1;g=g.crop(m,0,h,d);this._charWidths[f]=h}this._charPixData[f]=g;g.toCanvas()}},isMonospaced:function(){return this._monospaced},getLineHeight:function(){return this._charH},getCharPixelData:function(a){return this._charPixData[a]},getCharWidth:function(a){return this._charWidths[a]},getHorizontalPadding:function(){return this._hPad},
getVerticalPadding:function(){return this._vPad},_createTextures:function(a){for(var b in this._charPixData){var c=this._texIDPrefix+b,d=TentaGL.Texture.fromPixelData(a,this._charPixData[b]);TentaGL.MaterialLib.add(a,c,d)}},getStringDimensions:function(a,b){if(!this._charWidths)return[0,0];var c=0,d=0,e=this.getLineHeight(),f=this.getVerticalPadding(),g=this.getHorizontalPadding(),h=1;b&&(h=b/e);for(var m=a.split("\n"),k=0;k<m.length;k++){for(var l=m[k],p=0,n=0;n<l.length;n++)var r=l.charAt(n),r=
this.getCharWidth(r),p=p+(r+g);p>c&&(c=p);d+=e+f}return[c*h,d*h]},renderString:function(a,b,c,d,e){if(this._charPixData){TentaGL.MaterialLib.has(a,this._texIDPrefix+" ")||this._createTextures(a);var f=this.getLineHeight(),g=this.getVerticalPadding(),h=this.getHorizontalPadding();TentaGL.ViewTrans.push(a);TentaGL.ViewTrans.translate(a,c);e&&(c=e/f,TentaGL.ViewTrans.scale(a,[c,c]));b=b.split("\n");for(c=0;c<b.length;c++){e=b[c];TentaGL.ViewTrans.push(a);for(var m=0;m<e.length;m++){var k=e.charAt(m),
l=this._texIDPrefix+k,k=this.getCharWidth(k);TentaGL.MaterialLib.use(a,l);TentaGL.ViewTrans.push(a);TentaGL.ViewTrans.scale(a,[k,f]);TentaGL.ViewTrans.updateMVPUniforms(a);d?TentaGL.ModelLib.render(a,"unitSprite"):TentaGL.ModelLib.render(a,"unitPlane");TentaGL.ViewTrans.pop(a);TentaGL.ViewTrans.translate(a,[k+h,0])}TentaGL.ViewTrans.pop(a);d?TentaGL.ViewTrans.translate(a,[0,f+g]):TentaGL.ViewTrans.translate(a,[0,-(f+g)])}TentaGL.ViewTrans.pop(a)}}};
TentaGL.BlitteredFont.fromURL=function(a,b,c,d,e,f,g){var h=new TentaGL.BlitteredFont(void 0,b,c,d,e,f);TentaGL.PixelData.fromURL(a,function(a){g&&(a=g(a));h._createChars(a,b,c,d)});return h};
TentaGL.BlitteredFont.fromFont=function(a,b,c,d,e){var f="monospace"==a.getType(),g=a.getStringDimensions("W"),h=Math.floor(g[0]),g=Math.floor(g[1]);c=new TentaGL.BlitteredFont(void 0,f,h,g,c,d);d=1.5<b.getRed()+b.getGreen()+b.getBlue()?new TentaGL.Color.RGBA(0,0,0,1):new TentaGL.Color.RGBA(1,1,1,1);for(var m=TentaGL.Canvas2D.create(16*(h+2),6*(g+2),d),k=32;128>k;k++){var l=1+(k-32)%16*(h+2),p=1+Math.floor((k-32)/16)*(g+2),n=String.fromCharCode(k),r=TentaGL.Canvas2D.create(h,g,d);TentaGL.Canvas2D.drawString(r,
n,a,b,0,0);TentaGL.Canvas2D.drawImage(m,r,l,p)}a=TentaGL.PixelData.fromCanvas(m);a=a.filter(new TentaGL.RGBAFilter.OneColor(b,.5));e&&(a=e(a));c._createChars(a,f,h,g);return c};TentaGL.Font=function(a,b,c){this._name=a;this._type=b;this._size=c;this._italic=this._bold=!1;this._vPad=1};
TentaGL.Font.prototype={constructor:TentaGL.Font,getName:function(){return this._name},getType:function(){return this._type},getSize:function(){return this._size},getVerticalPadding:function(){return this._vPad},setVerticalPadding:function(a){this._vPad=a},isBold:function(){return this._bold},setBold:function(a){this._bold=a},isItalic:function(){return this._italic},setItalic:function(a){this._italic=a},toCSS:function(){var a="";this._italic&&(a+="italic ");this._bold&&(a+="bold ");a+=this._size+
"px ";return a+=this._name+","+this._type},getStringDimensions:function(a){var b=document.createElement("canvas").getContext("2d");b.font=this.toCSS();var c=0,d=0;a=a.split("\n");for(var e in a){var f=a[e],d=d+this._size,f=b.measureText(f).width;f>c&&(c=f);d+=this._vPad}d+=this._size/4;return[c,d]}};
TentaGL.ShaderVar=function(a,b){this._name=a.name;this._size=a.size;this._type=a.type;this._sizeBytes=a.size*TentaGL.glSizeBytes(a.type);this._sizeUnits=TentaGL.glSizeUnits(a.type);this._isArray=1<this._size;this._glProg=b};
TentaGL.ShaderVar.prototype={constructor:TentaGL.ShaderVar,getName:function(){return this._name},getSize:function(){return this._size},isArray:function(){return this._isArray},getSizeBytes:function(){return this._sizeBytes},getSizeUnits:function(){return this._sizeUnits},getType:function(){return this._type},getUnitType:function(){return TentaGL.glUnitType(this._type)},getTypeName:function(){return TentaGL.glTypeName(this._type)},isBuiltIn:function(){return"gl_"==this._substring(0,3).valueOf()}};
TentaGL.Attribute=function(a,b,c){TentaGL.ShaderVar.call(this,a,b);this._location=c};
TentaGL.Attribute.prototype={constructor:TentaGL.Attribute,getLocation:function(){return this._location},set:function(a,b,c){a.vertexAttribPointer(this._location,this.getSizeUnits(),this.getUnitType(),!1,b,c)},setGetter:function(a){this._getterFunc=a},getValues:function(a){a=this._getterFunc.call(a);if(a.length!=this.getSizeUnits())throw Error("Vertex attribute "+this.getName()+" is wrong size: "+a.length+". Expected: "+this.getSizeUnits());return a},getProfile:function(){this._profile||(this._profile=
new TentaGL.AttrProfile(TentaGL.UNKNOWN,this.getUnitType(),this.getSizeUnits(),this._getterFunc));return this._profile}};Util.Inheritance.inherit(TentaGL.Attribute,TentaGL.ShaderVar);TentaGL.Uniform=function(a,b,c){TentaGL.ShaderVar.call(this,a,b);this._location=c};TentaGL.Uniform.prototype={constructor:TentaGL.Uniform,getLocation:function(){return this._location},get:function(a){a.getUniform(this._glProg,this._location)},set:function(a,b){TentaGL.Uniform.setters[this._type].call(this,a,b)}};
Util.Inheritance.inherit(TentaGL.Uniform,TentaGL.ShaderVar);TentaGL.Uniform.setters=[];TentaGL.Uniform.setters[GL_FLOAT]=function(a,b){a.uniform1fv(this._location,b)};TentaGL.Uniform.setters[GL_FLOAT_VEC2]=function(a,b){a.uniform2fv(this._location,b)};TentaGL.Uniform.setters[GL_FLOAT_VEC3]=function(a,b){a.uniform3fv(this._location,b)};TentaGL.Uniform.setters[GL_FLOAT_VEC4]=function(a,b){a.uniform4fv(this._location,b)};TentaGL.Uniform.setters[GL_INT]=function(a,b){a.uniform1iv(this._location,b)};
TentaGL.Uniform.setters[GL_INT_VEC2]=function(a,b){a.uniform2iv(this._location,b)};TentaGL.Uniform.setters[GL_INT_VEC3]=function(a,b){a.uniform3iv(this._location,b)};TentaGL.Uniform.setters[GL_INT_VEC4]=function(a,b){a.uniform4iv(this._location,b)};TentaGL.Uniform.setters[GL_BOOL]=function(a,b){a.uniform1iv(this._location,b)};TentaGL.Uniform.setters[GL_BOOL_VEC2]=function(a,b){a.uniform2iv(this._location,b)};TentaGL.Uniform.setters[GL_BOOL_VEC3]=function(a,b){a.uniform3iv(this._location,b)};
TentaGL.Uniform.setters[GL_BOOL_VEC4]=function(a,b){a.uniform4iv(this._location,b)};TentaGL.Uniform.setters[GL_FLOAT_MAT2]=function(a,b){a.uniformMatrix2fv(this._location,!1,b)};TentaGL.Uniform.setters[GL_FLOAT_MAT3]=function(a,b){a.uniformMatrix3fv(this._location,!1,b)};TentaGL.Uniform.setters[GL_FLOAT_MAT4]=function(a,b){a.uniformMatrix4fv(this._location,!1,b)};TentaGL.Uniform.setters[GL_SAMPLER_2D]=function(a,b){a.uniform1iv(this._location,b)};
TentaGL.AttrProfile=function(a,b,c,d){if(!d)throw Error("Could not create AttrProfile without getter.");this._unitType=b;this._sizeUnits=c;this._getterFunc=d;if(a===TentaGL.UNKNOWN){a=!1;for(var e in TentaGL.AttrProfiles)if(this.equals(TentaGL.AttrProfiles[e])){this._id=e;a=!0;break}if(!a)throw Error("AttrProfile doesn't match any registered profiles: "+this.toString());}else this._id=a};
TentaGL.AttrProfile.prototype={constructor:TentaGL.AttrProfile,id:function(){return this._id},unitType:function(){return this._unitType},sizeUnits:function(){return this._sizeUnits},sizeBytes:function(){return this._sizeUnits*TentaGL.glSizeBytes(this._unitType)},getterFunc:function(){return this._getterFunc},equals:function(a){return this._getterFunc===a._getterFunc},getValues:function(a){a=this._getterFunc.call(a);if(a.length!=this.sizeUnits())throw Error("Vertex attribute is wrong size: "+a.length+
". Expected: "+this.sizeUnits());return a},toString:function(){return"AttrProfile(Unit type: "+TentaGL.glTypeName(this._unitType)+", Units Size: "+this._sizeUnits+", Getter Function: "+this._getterFunc+")"}};TentaGL.UNKNOWN=0;TentaGL.POS_4F=1;TentaGL.NORMAL_3F=2;TentaGL.TEX_2F=3;TentaGL.TANG_3F=4;TentaGL.BONE_I=5;TentaGL.AttrProfiles={};TentaGL.AttrProfiles[TentaGL.POS_4F]=new TentaGL.AttrProfile(TentaGL.POS_4F,GL_FLOAT,4,TentaGL.Vertex.prototype.getXYZ);
TentaGL.AttrProfiles[TentaGL.NORMAL_3F]=new TentaGL.AttrProfile(TentaGL.NORMAL_3F,GL_FLOAT,3,TentaGL.Vertex.prototype.getNormal);TentaGL.AttrProfiles[TentaGL.TEX_2F]=new TentaGL.AttrProfile(TentaGL.TEX_2F,GL_FLOAT,2,TentaGL.Vertex.prototype.getTexST);TentaGL.AttrProfiles[TentaGL.TANG_3F]=new TentaGL.AttrProfile(TentaGL.TANG_3F,GL_FLOAT,3,TentaGL.Vertex.prototype.getTangental);
TentaGL.getDefaultAttrProfileSet=function(){TentaGL._defaultAttrProfileSet||(TentaGL._defaultAttrProfileSet=TentaGL.AttrProfiles.createSet([TentaGL.POS_4F,TentaGL.NORMAL_3F,TentaGL.TEX_2F,TentaGL.TANG_3F]));return TentaGL._defaultAttrProfileSet};TentaGL.AttrProfiles.createSet=function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];b[d]=TentaGL.AttrProfiles[d]}return b};TentaGL.AttrProfiles.getStride=function(a){var b=0,c;for(c in a)b+=a[c].sizeBytes();return b};
TentaGL.ShaderLib={clean:function(a){for(var b in a._shaderLib)a._shaderLib[b].clean(a);a._shaderLib={};a._shaderStack=[]},reset:function(a){this.clean(a);TentaGL.DefaultShader.load(a,TentaGL.DefaultShader.SHADER_ID);TentaGL.PickShader.load(a,TentaGL.Picker.SHADER_ID);this.use(a,TentaGL.DefaultShader.SHADER_ID)},getDefaultShaderPath:function(a){a._shaderDir||(a._shaderDir="./shaders/");return a._shaderDir},setDefaultShaderPath:function(a,b){a._shaderDir=b},add:function(a,b,c){return a._shaderLib[b]=
c},remove:function(a,b){a._shaderLib[b].clean(a);delete a._shaderLib[b]},use:function(a,b){if(!TentaGL.Picker.isPicking(a)&&a._shaderLibCurrentName!==b){var c=a._shaderLib[b];c.useMe(a);c.setOpacity&&c.setOpacity(a,1);a._shaderLibCurrentProgram=c;a._shaderLibCurrentName=b;TentaGL.MaterialLib.useNone(a);return c}},current:function(a){return a._shaderLibCurrentProgram},currentName:function(a){return a._shaderLibCurrentName},push:function(a){a._shaderStack.push(a._shaderLibCurrentName)},pop:function(a){var b=
a._shaderStack.pop();this.use(a,b)}};
TentaGL.ShaderLoader={_numLoading:0,load:function(a,b,c){var d=this;this._numLoading++;var e=new XMLHttpRequest;e.open("get",a);e.onerror=function(a){console.log("AJAX error: ",a);d._numLoading--};e.onreadystatechange=function(a){4==this.readyState&&200==this.status&&d._loadFragSrc(e.responseText,b,c)};e.send()},_loadFragSrc:function(a,b,c){var d=this,e=new XMLHttpRequest;e.open("get",b);e.onerror=function(a){console.log("AJAX error: ",a);d._numLoading--};e.onreadystatechange=function(b){4==this.readyState&&
200==this.status&&(c(a,e.responseText),d._numLoading--)};e.send()},isLoading:function(){return 0<this._numLoading},getNumLoading:function(){return this._numLoading}};TentaGL.ShaderProgram=function(a,b,c){b=this._compileShader(a,GL_VERTEX_SHADER,b);c=this._compileShader(a,GL_FRAGMENT_SHADER,c);this._glProg=this._linkProgram(a,b,c);this._uniforms=this._initUniforms(a);this._attributes=this._initAttributes(a);this._showErrors=!0};
TentaGL.ShaderProgram.prototype={constructor:TentaGL.ShaderProgram,_compileShader:function(a,b,c){if(b!=GL_VERTEX_SHADER&&b!=GL_FRAGMENT_SHADER)throw Error("Invalid shader type constant: "+b);var d=a.createShader(b);a.shaderSource(d,c);a.compileShader(d);if(!a.getShaderParameter(d,GL_COMPILE_STATUS))throw a=a.getShaderInfoLog(d),c="",b==GL_VERTEX_SHADER?c="vertex":b==GL_FRAGMENT_SHADER&&(c="fragment"),Error("Failed to compile "+c+" shader :\n"+a);return d},_linkProgram:function(a,b,c){var d=a.createProgram();
a.attachShader(d,b);a.attachShader(d,c);a.linkProgram(d);if(!a.getProgramParameter(d,GL_LINK_STATUS))throw b=a.getProgramInfoLog(d),a=a.getParameter(a.MAX_VARYING_VECTORS),console.log("max varyings: "+a),Error("Failed to link shader program:\n"+b);return d},getLocation:function(){return this._glProg},clean:function(a){a.deleteProgram(this._glProg)},useMe:function(a){var b=TentaGL.ShaderLib.current(a);void 0!==b&&b._disableAllAttrs(a);a.useProgram(this._glProg);this._enableAllAttrs(a)},getAttribLocation:function(a,
b){return a.getAttribLocation(this._glProg,b)},getUniformLocation:function(a,b){return a.getUniformLocation(this._glProg,b)},_initUniforms:function(a){var b={},c=a.getProgramParameter(this._glProg,GL_ACTIVE_UNIFORMS);console.log("# Active Uniforms: "+c);for(var d=0;d<c;d++){var e=a.getActiveUniform(this._glProg,d),f=e.name,g=a.getUniformLocation(this._glProg,f),g=new TentaGL.Uniform(e,this._glProg,g);console.log("Uniform "+d+": "+f+", type "+TentaGL.glTypeName(e.type)+", size "+e.size+", byteSize "+
g.getSizeBytes()+", unitSize "+g.getSizeUnits());b[f]=g}return b},_initAttributes:function(a){var b={},c=a.getProgramParameter(this._glProg,GL_ACTIVE_ATTRIBUTES);console.log("# Active Attributes: "+c);for(var d=0;d<c;d++){var e=a.getActiveAttrib(this._glProg,d),f=e.name,g=a.getAttribLocation(this._glProg,f),g=new TentaGL.Attribute(e,this._glProg,g);console.log("Attribute "+d+": "+e.name+", type "+TentaGL.glTypeName(e.type)+", size "+e.size+", byteSize "+g.getSizeBytes()+", unitSize "+g.getSizeUnits());
b[f]=g}return b},hasUniform:function(a){return this._uniforms[a]?!0:!1},getUniform:function(a){!this._uniforms[a]&&this._showErrors&&console.log("Uniform variable "+a+" doesn't exist.");return this._uniforms[a]},getAttribute:function(a){return this._attributes[a]},getUniforms:function(){var a=[],b;for(b in this._uniforms)a.push(this._uniforms[b]);return a},getAttributes:function(){var a=[],b;for(b in this._attributes)a.push(this._attributes[b]);return a},getUniNames:function(){var a=[],b;for(b in this._uniforms)a.push(b);
return a},getAttrNames:function(){var a=[],b;for(b in this._attributes)a.push(b);return a},getUniValue:function(a,b){return this._uniforms[b].get(a)},setUniValue:function(a,b,c){(b=this.getUniform(b))&&b.set(a,c)},bindAttr:function(a,b,c,d){this._attributes[b].set(a,c,d)},setAttrGetter:function(a,b){this._attributes[a].setGetter(b)},getAttrStride:function(){if(void 0===this._totalStride){this._totalStride=0;for(var a in this._attributes)this._totalStride+=this._attributes[a].getSizeBytes()}return this._totalStride},
_enableAllAttrs:function(a){for(var b in this._attributes)a.enableVertexAttribArray(this._attributes[b].getLocation())},_disableAllAttrs:function(a){for(var b in this._attributes)a.disableVertexAttribArray(this._attributes[b].getLocation())}};TentaGL.ShaderProgram.srcFromURL=function(a,b,c){a=new XMLHttpRequest;a.open("get",b,!1);a.send();b=a.responseText;a.open("get",c,!1);a.send();return[b,a.responseText]};
TentaGL.DefaultShader=function(a){var b=TentaGL.ShaderLib.getDefaultShaderPath(a),c=this;TentaGL.ShaderLoader.load(b+"default.vert",b+"default.frag",function(b,e){console.log("\nCreating DefaultShader");TentaGL.ShaderProgram.call(c,a,b,e);c.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.getXYZ)})};TentaGL.DefaultShader.SHADER_ID="_default";TentaGL.DefaultShader.prototype={constructor:TentaGL.DefaultShader,isaDefaultShader:!0};
TentaGL.DefaultShader.load=function(a,b){var c=new TentaGL.DefaultShader(a);TentaGL.ShaderLib.add(a,b,c);return c};Util.Inheritance.inherit(TentaGL.DefaultShader,TentaGL.ShaderProgram);
TentaGL.LinearGradientShader=function(a){var b=TentaGL.ShaderLib.getDefaultShaderPath(a),c=this;TentaGL.ShaderLoader.load(b+"gradientLinear.vert",b+"gradientLinear.frag",function(b,e){console.log("\nCreating linear gradient shader");TentaGL.ShaderProgram.call(c,a,b,e);c.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.getXYZ);c.setAttrGetter("vertexNormal",TentaGL.Vertex.prototype.getNormal);c.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.getTexST);c._mvpUni=c.getUniform("mvpTrans");
c._normalUni=c.getUniform("normalTrans");c._startPtUni=c.getUniform("p");c._gradVectorUni=c.getUniform("u");c._colorsUni=c.getUniform("colors[0]");c._breakPtsUni=c.getUniform("breakPts[0]");c._breakPtCountUni=c.getUniform("breakPtCount")})};
TentaGL.LinearGradientShader.prototype={constructor:TentaGL.LinearGradientShader,isaLinearGradientShader:!0,setMVPTrans:function(a,b){this._mvpUni.set(a,b)},setNormalTrans:function(a,b){this._normalUni.set(a,b)},setStartPoint:function(a,b){this._startPtUni.set(a,b)},setGradVector:function(a,b){this._gradVectorUni.set(a,b)},setColors:function(a,b){for(var c=[],d=0;d<b.length;d++)c.push(b[d].getRed()),c.push(b[d].getGreen()),c.push(b[d].getBlue()),c.push(b[d].getAlpha());this._colorsUni.set(a,c)},setBreakPoints:function(a,
b){this._breakPtsUni.set(a,b);this._breakPtCountUni.set(a,[b.length])}};TentaGL.LinearGradientShader.load=function(a,b){var c=new TentaGL.LinearGradientShader(a);TentaGL.ShaderLib.add(a,b,c);return c};Util.Inheritance.inherit(TentaGL.LinearGradientShader,TentaGL.ShaderProgram);
TentaGL.NormalShader=function(a){var b=TentaGL.ShaderLib.getDefaultShaderPath(a),c=this;TentaGL.ShaderLoader.load(b+"normal.vert",b+"normal.frag",function(b,e){TentaGL.ShaderProgram.call(c,a,b,e);console.log("\nCreating NormalShader...");c.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.getXYZ);c.setAttrGetter("vertexNormal",TentaGL.Vertex.prototype.getNormal);c.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.getTexST);c._mvpUni=c.getUniform("mvpTrans");c._normalUni=c.getUniform("normalTrans");
c._texUni=c.getUniform("tex");c._useTexUni=c.getUniform("useTex")})};TentaGL.NormalShader.prototype={constructor:TentaGL.NormalShader,isaSimpleShader:!0,setMVPTrans:function(a,b){this._mvpUni.set(a,b)},setNormalTrans:function(a,b){this._normalUni.set(a,b)},setColor:function(a,b){this._useTexUni.set(a,[0])},setTex:function(a,b){this._texUni.set(a,[b]);this._useTexUni.set(a,[1])}};TentaGL.NormalShader.load=function(a,b){var c=new TentaGL.NormalShader(a);TentaGL.ShaderLib.add(a,b,c);return c};
Util.Inheritance.inherit(TentaGL.NormalShader,TentaGL.ShaderProgram);
TentaGL.PerVertexPhongShader=function(a){var b=TentaGL.ShaderLib.getDefaultShaderPath(a),c=this;TentaGL.ShaderLoader.load(b+"phongPerVertex.vert",b+"phongPerVertex.frag",function(b,e){console.log("\nCreating PerVertexPhongShader");TentaGL.ShaderProgram.call(c,a,b,e);c.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.getXYZ);c.setAttrGetter("vertexNormal",TentaGL.Vertex.prototype.getNormal);c.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.getTexST);c.setAttrGetter("vertexTang",TentaGL.Vertex.prototype.getTangental);
c._opacityUni=c.getUniform("opacity");c._mvpUni=c.getUniform("mvpTrans");c._mvUni=c.getUniform("mvTrans");c._vUni=c.getUniform("vTrans");c._normalUni=c.getUniform("normalTrans");c._colorUni=c.getUniform("solidColor");c._texUni=c.getUniform("tex");c._useTexUni=c.getUniform("useTex");c._materialUni={};c._materialUni.diff=c.getUniform("m.diff");c._materialUni.spec=c.getUniform("m.spec");c._materialUni.amb=c.getUniform("m.amb");c._materialUni.emis=c.getUniform("m.emis");c._materialUni.shininess=c.getUniform("m.shininess");
c._lightsUni=[];for(var f=0;f<TentaGL.PerVertexPhongShader.MAX_LIGHTS;f++){var g=c._lightsUni[f]={},h="lights["+f+"]";g.type=c.getUniform(h+".type");g.pos=c.getUniform(h+".pos");g.dir=c.getUniform(h+".dir");g.diff=c.getUniform(h+".diff");g.spec=c.getUniform(h+".spec");g.amb=c.getUniform(h+".amb");g.attenA=c.getUniform(h+".attenA");g.attenB=c.getUniform(h+".attenB");g.attenC=c.getUniform(h+".attenC");g.cutOffAngleCos=c.getUniform(h+".cutOffAngleCos");g.spotExp=c.getUniform(h+".spotExp")}c._numLightsUni=
c.getUniform("numLights")})};TentaGL.PerVertexPhongShader.MAX_LIGHTS=16;TentaGL.PerVertexPhongShader.LIGHT_AMB=1;TentaGL.PerVertexPhongShader.LIGHT_PT=2;TentaGL.PerVertexPhongShader.LIGHT_DIR=3;TentaGL.PerVertexPhongShader.LIGHT_SPOT=4;
TentaGL.PerVertexPhongShader.prototype={constructor:TentaGL.PerVertexPhongShader,isaPerVertexPhongShader:!0,setOpacity:function(a,b){this._opacityUni.set(a,[b])},setMVPTrans:function(a,b){this._mvpUni.set(a,b)},setMVTrans:function(a,b){this._mvUni.set(a,b)},setVTrans:function(a,b){this._vUni.set(a,b)},setNormalTrans:function(a,b){this._normalUni.set(a,b)},setColor:function(a,b){this._colorUni.set(a,b);this._useTexUni.set(a,[0])},setTex:function(a,b){this._texUni.set(a,[b]);this._useTexUni.set(a,[1])},
setMaterialProps:function(a,b){this._materialUni.diff.set(a,b.getDiffuse().getRGBA());this._materialUni.spec.set(a,b.getSpecular().getRGBA());this._materialUni.amb.set(a,b.getAmbient().getRGBA());this._materialUni.emis.set(a,b.getEmission().getRGBA());this._materialUni.shininess.set(a,[b.getShininess()])},setLights:function(a,b){var c=Math.min(b.length,TentaGL.PerVertexPhongShader.MAX_LIGHTS);this._numLightsUni.set(a,[b.length]);for(var d=0;d<c;d++){var e=b[d],f=this._lightsUni[d];e.isaAmbientLight&&
f.type.set(a,[TentaGL.PerVertexPhongShader.LIGHT_AMB]);e.isaPointLight&&f.type.set(a,[TentaGL.PerVertexPhongShader.LIGHT_PT]);e.isaDirectionalLight&&f.type.set(a,[TentaGL.PerVertexPhongShader.LIGHT_DIR]);e.isaSpotLight&&f.type.set(a,[TentaGL.PerVertexPhongShader.LIGHT_SPOT]);e.isaPointLight?f.pos.set(a,e.getXYZ()):f.pos.set(a,[0,0,0,0]);e.isaDirectionalLight?f.dir.set(a,e.getDirection()):f.dir.set(a,[0,0,0]);f.diff.set(a,e.getDiffuse().getRGBA());f.spec.set(a,e.getSpecular().getRGBA());f.amb.set(a,
e.getAmbient().getRGBA());if(e.isaPointLight){var g=e.getAttenuation();f.attenA.set(a,[g[0]]);f.attenB.set(a,[g[1]]);f.attenC.set(a,[g[2]])}else f.attenA.set(a,[0]),f.attenB.set(a,[0]),f.attenC.set(a,[0]);e.isaSpotLight?(f.cutOffAngleCos.set(a,[Math.cos(e.getCutOffAngle())]),f.spotExp.set(a,[e.getSpotExponent()])):(f.cutOffAngleCos.set(a,[0]),f.spotExp.set(a,[0]))}for(d=c;d<TentaGL.PerVertexPhongShader.MAX_LIGHTS;d++)f=this._lightsUni[d],f.type.set(a,[0]),f.pos.set(a,[0,0,0,0]),f.dir.set(a,[0,0,0]),
f.diff.set(a,[0,0,0,0]),f.spec.set(a,[0,0,0,0]),f.amb.set(a,[0,0,0,0]),f.attenA.set(a,[0]),f.attenB.set(a,[0]),f.attenC.set(a,[0]),f.cutOffAngleCos.set(a,[0]),f.spotExp.set(a,[0])}};TentaGL.PerVertexPhongShader.load=function(a,b){var c=new TentaGL.PerVertexPhongShader(a);TentaGL.ShaderLib.add(a,b,c);return c};Util.Inheritance.inherit(TentaGL.PerVertexPhongShader,TentaGL.ShaderProgram);
TentaGL.PerVertexPhongShaderMac=function(a){var b=TentaGL.ShaderLib.getDefaultShaderPath(a),c=this;TentaGL.ShaderLoader.load(b+"phongPerVertexMac.vert",b+"phongPerVertexMac.frag",function(b,e){console.log("\nCreating PerVertexPhongShaderMac");TentaGL.ShaderProgram.call(c,a,b,e);c.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.getXYZ);c.setAttrGetter("vertexNormal",TentaGL.Vertex.prototype.getNormal);c.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.getTexST);c.setAttrGetter("vertexTang",
TentaGL.Vertex.prototype.getTangental);c._opacityUni=c.getUniform("opacity");c._mvpUni=c.getUniform("mvpTrans");c._mvUni=c.getUniform("mvTrans");c._vUni=c.getUniform("vTrans");c._normalUni=c.getUniform("normalTrans");c._colorUni=c.getUniform("solidColor");c._texUni=c.getUniform("tex");c._useTexUni=c.getUniform("useTex");c._materialUni={};c._materialUni.diff=c.getUniform("m.diff");c._materialUni.spec=c.getUniform("m.spec");c._materialUni.amb=c.getUniform("m.amb");c._materialUni.emis=c.getUniform("m.emis");
c._materialUni.shininess=c.getUniform("m.shininess");c._lightUni={};c._lightUni.type=c.getUniform("light.type");c._lightUni.pos=c.getUniform("light.pos");c._lightUni.dir=c.getUniform("light.dir");c._lightUni.diff=c.getUniform("light.diff");c._lightUni.spec=c.getUniform("light.spec");c._lightUni.amb=c.getUniform("light.amb");c._lightUni.attenA=c.getUniform("light.attenA");c._lightUni.attenB=c.getUniform("light.attenB");c._lightUni.attenC=c.getUniform("light.attenC");c._lightUni.cutOffAngleCos=c.getUniform("light.cutOffAngleCos");
c._lightUni.spotExp=c.getUniform("light.spotExp")})};TentaGL.PerVertexPhongShaderMac.LIGHT_AMB=1;TentaGL.PerVertexPhongShaderMac.LIGHT_PT=2;TentaGL.PerVertexPhongShaderMac.LIGHT_DIR=3;TentaGL.PerVertexPhongShaderMac.LIGHT_SPOT=4;
TentaGL.PerVertexPhongShaderMac.prototype={constructor:TentaGL.PerVertexPhongShader,isaPerVertexPhongShaderMac:!0,setOpacity:function(a,b){this._opacityUni.set(a,[b])},setMVPTrans:function(a,b){this._mvpUni.set(a,b)},setMVTrans:function(a,b){this._mvUni.set(a,b)},setVTrans:function(a,b){this._vUni.set(a,b)},setNormalTrans:function(a,b){this._normalUni.set(a,b)},setColor:function(a,b){this._colorUni.set(a,b);this._useTexUni.set(a,[0])},setTex:function(a,b){this._texUni.set(a,[b]);this._useTexUni.set(a,
[1])},setMaterialProps:function(a,b){this._materialUni.diff.set(a,b.getDiffuse().getRGBA());this._materialUni.spec.set(a,b.getSpecular().getRGBA());this._materialUni.amb.set(a,b.getAmbient().getRGBA());this._materialUni.emis.set(a,b.getEmission().getRGBA());this._materialUni.shininess.set(a,[b.getShininess()])},setLights:function(a,b){var c=b[0];c.isaAmbientLight&&this._lightUni.type.set(a,[TentaGL.PerVertexPhongShader.LIGHT_AMB]);c.isaPointLight&&this._lightUni.type.set(a,[TentaGL.PerVertexPhongShader.LIGHT_PT]);
c.isaDirectionalLight&&this._lightUni.type.set(a,[TentaGL.PerVertexPhongShader.LIGHT_DIR]);c.isaSpotLight&&this._lightUni.type.set(a,[TentaGL.PerVertexPhongShader.LIGHT_SPOT]);c.isaPointLight?this._lightUni.pos.set(a,c.getXYZ()):this._lightUni.pos.set(a,[0,0,0,0]);c.isaDirectionalLight?this._lightUni.dir.set(a,c.getDirection()):this._lightUni.dir.set(a,[0,0,0]);this._lightUni.diff.set(a,c.getDiffuse().getRGBA());this._lightUni.spec.set(a,c.getSpecular().getRGBA());this._lightUni.amb.set(a,c.getAmbient().getRGBA());
if(c.isaPointLight){var d=c.getAttenuation();this._lightUni.attenA.set(a,[d[0]]);this._lightUni.attenB.set(a,[d[1]]);this._lightUni.attenC.set(a,[d[2]])}else this._lightUni.attenA.set(a,[0]),this._lightUni.attenB.set(a,[0]),this._lightUni.attenC.set(a,[0]);c.isaSpotLight?(this._lightUni.cutOffAngleCos.set(a,[Math.cos(c.getCutOffAngle())]),this._lightUni.spotExp.set(a,[c.getSpotExponent()])):(this._lightUni.cutOffAngleCos.set(a,[0]),this._lightUni.spotExp.set(a,[0]))}};
TentaGL.PerVertexPhongShaderMac.load=function(a,b){var c=new TentaGL.PerVertexPhongShaderMac(a);TentaGL.ShaderLib.add(a,b,c);return c};Util.Inheritance.inherit(TentaGL.PerVertexPhongShaderMac,TentaGL.ShaderProgram);
TentaGL.PhongShader=function(a){var b=TentaGL.ShaderLib.getDefaultShaderPath(a),c=this;TentaGL.ShaderLoader.load(b+"phong.vert",b+"phong.frag",function(b,e){console.log("\nCreating PhongShader");TentaGL.ShaderProgram.call(c,a,b,e);c.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.getXYZ);c.setAttrGetter("vertexNormal",TentaGL.Vertex.prototype.getNormal);c.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.getTexST);c.setAttrGetter("vertexTang",TentaGL.Vertex.prototype.getTangental);c._opacityUni=
c.getUniform("opacity");c._mvpUni=c.getUniform("mvpTrans");c._mvUni=c.getUniform("mvTrans");c._vUni=c.getUniform("vTrans");c._normalUni=c.getUniform("normalTrans");c._colorUni=c.getUniform("solidColor");c._texUni=c.getUniform("tex");c._useTexUni=c.getUniform("useTex");c._bumpTexUni=c.getUniform("bumpTex");c._useBumpUni=c.getUniform("useBumpTex");c._materialUni={};c._materialUni.diff=c.getUniform("m.diff");c._materialUni.spec=c.getUniform("m.spec");c._materialUni.amb=c.getUniform("m.amb");c._materialUni.emis=
c.getUniform("m.emis");c._materialUni.shininess=c.getUniform("m.shininess");c._lightsUni=[];for(var f=0;f<TentaGL.PhongShader.MAX_LIGHTS;f++){var g=c._lightsUni[f]={},h="lights["+f+"]";g.type=c.getUniform(h+".type");g.pos=c.getUniform(h+".pos");g.dir=c.getUniform(h+".dir");g.diff=c.getUniform(h+".diff");g.spec=c.getUniform(h+".spec");g.amb=c.getUniform(h+".amb");g.attenA=c.getUniform(h+".attenA");g.attenB=c.getUniform(h+".attenB");g.attenC=c.getUniform(h+".attenC");g.cutOffAngleCos=c.getUniform(h+
".cutOffAngleCos");g.spotExp=c.getUniform(h+".spotExp")}c._numLightsUni=c.getUniform("numLights")})};TentaGL.PhongShader.MAX_LIGHTS=16;TentaGL.PhongShader.LIGHT_AMB=1;TentaGL.PhongShader.LIGHT_PT=2;TentaGL.PhongShader.LIGHT_DIR=3;TentaGL.PhongShader.LIGHT_SPOT=4;
TentaGL.PhongShader.prototype={constructor:TentaGL.PhongShader,isaPhongShader:!0,setOpacity:function(a,b){this._opacityUni.set(a,[b])},setMVPTrans:function(a,b){this._mvpUni.set(a,b)},setMVTrans:function(a,b){this._mvUni.set(a,b)},setVTrans:function(a,b){this._vUni.set(a,b)},setNormalTrans:function(a,b){this._normalUni.set(a,b)},setColor:function(a,b){this._colorUni.set(a,b);this._useTexUni.set(a,[0]);this._useBumpUni.set(a,[0])},setTex:function(a,b){this._texUni.set(a,[b]);this._useTexUni.set(a,
[1]);this._useBumpUni.set(a,[0])},setBump:function(a,b){this._bumpTexUni.set(a,[b]);this._useBumpUni.set(a,[1])},setMaterialProps:function(a,b){this._materialUni.diff.set(a,b.getDiffuse().getRGBA());this._materialUni.spec.set(a,b.getSpecular().getRGBA());this._materialUni.amb.set(a,b.getAmbient().getRGBA());this._materialUni.emis.set(a,b.getEmission().getRGBA());this._materialUni.shininess.set(a,[b.getShininess()])},setLights:function(a,b){var c=Math.min(b.length,TentaGL.PhongShader.MAX_LIGHTS);this._numLightsUni.set(a,
[b.length]);for(var d=0;d<c;d++){var e=b[d],f=this._lightsUni[d];e.isaAmbientLight&&f.type.set(a,[TentaGL.PhongShader.LIGHT_AMB]);e.isaPointLight&&f.type.set(a,[TentaGL.PhongShader.LIGHT_PT]);e.isaDirectionalLight&&f.type.set(a,[TentaGL.PhongShader.LIGHT_DIR]);e.isaSpotLight&&f.type.set(a,[TentaGL.PhongShader.LIGHT_SPOT]);e.isaPointLight?f.pos.set(a,e.getXYZ()):f.pos.set(a,[0,0,0,0]);e.isaDirectionalLight?f.dir.set(a,e.getDirection()):f.dir.set(a,[0,0,0]);f.diff.set(a,e.getDiffuse().getRGBA());f.spec.set(a,
e.getSpecular().getRGBA());f.amb.set(a,e.getAmbient().getRGBA());if(e.isaPointLight){var g=e.getAttenuation();f.attenA.set(a,[g[0]]);f.attenB.set(a,[g[1]]);f.attenC.set(a,[g[2]])}else f.attenA.set(a,[0]),f.attenB.set(a,[0]),f.attenC.set(a,[0]);e.isaSpotLight?(f.cutOffAngleCos.set(a,[Math.cos(e.getCutOffAngle())]),f.spotExp.set(a,[e.getSpotExponent()])):(f.cutOffAngleCos.set(a,[0]),f.spotExp.set(a,[0]))}for(d=c;d<TentaGL.PhongShader.MAX_LIGHTS;d++)f=this._lightsUni[d],f.type.set(a,[0]),f.pos.set(a,
[0,0,0,0]),f.dir.set(a,[0,0,0]),f.diff.set(a,[0,0,0,0]),f.spec.set(a,[0,0,0,0]),f.amb.set(a,[0,0,0,0]),f.attenA.set(a,[0]),f.attenB.set(a,[0]),f.attenC.set(a,[0]),f.cutOffAngleCos.set(a,[0]),f.spotExp.set(a,[0])}};TentaGL.PhongShader.load=function(a,b){var c=new TentaGL.PhongShader(a);TentaGL.ShaderLib.add(a,b,c);return c};Util.Inheritance.inherit(TentaGL.PhongShader,TentaGL.ShaderProgram);
TentaGL.PhongShaderMac=function(a){var b=TentaGL.ShaderLib.getDefaultShaderPath(a),c=this;TentaGL.ShaderLoader.load(b+"phongMac.vert",b+"phongMac.frag",function(b,e){console.log("\nCreating PhongShaderMac");TentaGL.ShaderProgram.call(c,a,b,e);c.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.getXYZ);c.setAttrGetter("vertexNormal",TentaGL.Vertex.prototype.getNormal);c.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.getTexST);c.setAttrGetter("vertexTang",TentaGL.Vertex.prototype.getTangental);
c._opacityUni=c.getUniform("opacity");c._mvpUni=c.getUniform("mvpTrans");c._mvUni=c.getUniform("mvTrans");c._vUni=c.getUniform("vTrans");c._normalUni=c.getUniform("normalTrans");c._colorUni=c.getUniform("solidColor");c._texUni=c.getUniform("tex");c._useTexUni=c.getUniform("useTex");c._bumpTexUni=c.getUniform("bumpTex");c._useBumpUni=c.getUniform("useBumpTex");c._materialUni={};c._materialUni.diff=c.getUniform("m.diff");c._materialUni.spec=c.getUniform("m.spec");c._materialUni.amb=c.getUniform("m.amb");
c._materialUni.emis=c.getUniform("m.emis");c._materialUni.shininess=c.getUniform("m.shininess");c._lightUni={};c._lightUni.type=c.getUniform("light.type");c._lightUni.pos=c.getUniform("light.pos");c._lightUni.dir=c.getUniform("light.dir");c._lightUni.diff=c.getUniform("light.diff");c._lightUni.spec=c.getUniform("light.spec");c._lightUni.amb=c.getUniform("light.amb");c._lightUni.attenA=c.getUniform("light.attenA");c._lightUni.attenB=c.getUniform("light.attenB");c._lightUni.attenC=c.getUniform("light.attenC");
c._lightUni.cutOffAngleCos=c.getUniform("light.cutOffAngleCos");c._lightUni.spotExp=c.getUniform("light.spotExp")})};TentaGL.PhongShaderMac.LIGHT_AMB=1;TentaGL.PhongShaderMac.LIGHT_PT=2;TentaGL.PhongShaderMac.LIGHT_DIR=3;TentaGL.PhongShaderMac.LIGHT_SPOT=4;
TentaGL.PhongShaderMac.prototype={constructor:TentaGL.PhongShaderMac,isaPhongShaderMac:!0,setOpacity:function(a,b){this._opacityUni.set(a,[b])},setMVPTrans:function(a,b){this._mvpUni.set(a,b)},setMVTrans:function(a,b){this._mvUni.set(a,b)},setVTrans:function(a,b){this._vUni.set(a,b)},setNormalTrans:function(a,b){this._normalUni.set(a,b)},setColor:function(a,b){this._colorUni.set(a,b);this._useTexUni.set(a,[0]);this._useBumpUni.set(a,[0])},setTex:function(a,b){this._texUni.set(a,[b]);this._useTexUni.set(a,
[1]);this._useBumpUni.set(a,[0])},setBump:function(a,b){this._bumpTexUni.set(a,[b]);this._useBumpUni.set(a,[1])},setMaterialProps:function(a,b){this._materialUni.diff.set(a,b.getDiffuse().getRGBA());this._materialUni.spec.set(a,b.getSpecular().getRGBA());this._materialUni.amb.set(a,b.getAmbient().getRGBA());this._materialUni.emis.set(a,b.getEmission().getRGBA());this._materialUni.shininess.set(a,[b.getShininess()])},setLights:function(a,b){var c=b[0];c.isaAmbientLight&&this._lightUni.type.set(a,[TentaGL.PhongShaderMac.LIGHT_AMB]);
c.isaPointLight&&this._lightUni.type.set(a,[TentaGL.PhongShaderMac.LIGHT_PT]);c.isaDirectionalLight&&this._lightUni.type.set(a,[TentaGL.PhongShaderMac.LIGHT_DIR]);c.isaSpotLight&&this._lightUni.type.set(a,[TentaGL.PhongShaderMac.LIGHT_SPOT]);c.isaPointLight?this._lightUni.pos.set(a,c.getXYZ()):this._lightUni.pos.set(a,[0,0,0,0]);c.isaDirectionalLight?this._lightUni.dir.set(a,c.getDirection()):this._lightUni.dir.set(a,[0,0,0]);this._lightUni.diff.set(a,c.getDiffuse().getRGBA());this._lightUni.spec.set(a,
c.getSpecular().getRGBA());this._lightUni.amb.set(a,c.getAmbient().getRGBA());if(c.isaPointLight){var d=c.getAttenuation();this._lightUni.attenA.set(a,[d[0]]);this._lightUni.attenB.set(a,[d[1]]);this._lightUni.attenC.set(a,[d[2]])}else this._lightUni.attenA.set(a,[0]),this._lightUni.attenB.set(a,[0]),this._lightUni.attenC.set(a,[0]);c.isaSpotLight?(this._lightUni.cutOffAngleCos.set(a,[Math.cos(c.getCutOffAngle())]),this._lightUni.spotExp.set(a,[c.getSpotExponent()])):(this._lightUni.cutOffAngleCos.set(a,
[0]),this._lightUni.spotExp.set(a,[0]))}};TentaGL.PhongShaderMac.load=function(a,b){var c=new TentaGL.PhongShaderMac(a);TentaGL.ShaderLib.add(a,b,c);return c};Util.Inheritance.inherit(TentaGL.PhongShaderMac,TentaGL.ShaderProgram);
TentaGL.PickShader=function(a){var b=TentaGL.ShaderLib.getDefaultShaderPath(a),c=this;TentaGL.ShaderLoader.load(b+"picker.vert",b+"picker.frag",function(b,e){console.log("\nCreating PickShader...");TentaGL.ShaderProgram.call(c,a,b,e);c.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.getXYZ);c.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.getTexST);c._mvpUni=c.getUniform("mvpTrans");c._texUni=c.getUniform("tex");c._pickIDUni=c.getUniform("pickID")})};
TentaGL.PickShader.prototype={constructor:TentaGL.PickShader,isaPickShader:!0,setMVPTrans:function(a,b){this._mvpUni.set(a,b)},setTex:function(a,b){this._texUni.set(a,[b])},setPickID:function(a,b){this._pickIDUni.set(a,b)}};TentaGL.PickShader.load=function(a,b){var c=new TentaGL.PickShader(a);TentaGL.ShaderLib.add(a,b,c);return c};Util.Inheritance.inherit(TentaGL.PickShader,TentaGL.ShaderProgram);
TentaGL.RadialGradientShader=function(a){var b=TentaGL.ShaderLib.getDefaultShaderPath(a),c=this;TentaGL.ShaderLoader.load(b+"gradientRadial.vert",b+"gradientRadial.frag",function(b,e){console.log("\nCreating linear gradient shader");TentaGL.ShaderProgram.call(c,a,b,e);c.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.getXYZ);c.setAttrGetter("vertexNormal",TentaGL.Vertex.prototype.getNormal);c.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.getTexST);c._mvpUni=c.getUniform("mvpTrans");
c._normalUni=c.getUniform("normalTrans");c._startPtUni=c.getUniform("p");c._gradVectorUni=c.getUniform("u");c._colorsUni=c.getUniform("colors[0]");c._breakPtsUni=c.getUniform("breakPts[0]");c._breakPtCountUni=c.getUniform("breakPtCount")})};
TentaGL.RadialGradientShader.prototype={constructor:TentaGL.RadialGradientShader,isaRadialGradientShader:!0,setMVPTrans:function(a,b){this._mvpUni.set(a,b)},setNormalTrans:function(a,b){this._normalUni.set(a,b)},setStartPoint:function(a,b){this._startPtUni.set(a,b)},setGradVector:function(a,b){this._gradVectorUni.set(a,b)},setColors:function(a,b){for(var c=[],d=0;d<b.length;d++)c.push(b[d].getRed()),c.push(b[d].getGreen()),c.push(b[d].getBlue()),c.push(b[d].getAlpha());this._colorsUni.set(a,c)},setBreakPoints:function(a,
b){this._breakPtsUni.set(a,b);this._breakPtCountUni.set(a,[b.length])}};TentaGL.RadialGradientShader.load=function(a,b){var c=new TentaGL.RadialGradientShader(a);TentaGL.ShaderLib.add(a,b,c);return c};Util.Inheritance.inherit(TentaGL.RadialGradientShader,TentaGL.ShaderProgram);
TentaGL.SimpleShader=function(a){var b=TentaGL.ShaderLib.getDefaultShaderPath(a),c=this;TentaGL.ShaderLoader.load(b+"simple.vert",b+"simple.frag",function(b,e){console.log("\nCreating SimpleShader");TentaGL.ShaderProgram.call(c,a,b,e);c.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.getXYZ);c.setAttrGetter("vertexNormal",TentaGL.Vertex.prototype.getNormal);c.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.getTexST);c._opacityUni=c.getUniform("opacity");c._mvpUni=c.getUniform("mvpTrans");
c._normalUni=c.getUniform("normalTrans");c._colorUni=c.getUniform("solidColor");c._texUni=c.getUniform("tex");c._useTexUni=c.getUniform("useTex")})};
TentaGL.SimpleShader.prototype={constructor:TentaGL.SimpleShader,isaSimpleShader:!0,setOpacity:function(a,b){this._opacityUni.set(a,[b])},setMVPTrans:function(a,b){this._mvpUni.set(a,b)},setNormalTrans:function(a,b){this._normalUni.set(a,b)},setColor:function(a,b){this._colorUni.set(a,b);this._useTexUni.set(a,[0])},setTex:function(a,b){this._texUni.set(a,[b]);this._useTexUni.set(a,[1])}};TentaGL.SimpleShader.load=function(a,b){var c=new TentaGL.SimpleShader(a);TentaGL.ShaderLib.add(a,b,c);return c};
Util.Inheritance.inherit(TentaGL.SimpleShader,TentaGL.ShaderProgram);
TentaGL.CircleShader=function(a){var b=TentaGL.ShaderLib.getDefaultShaderPath(a),c=this;TentaGL.ShaderLoader.load(b+"simple.vert",b+"circle.frag",function(b,e){console.log("\nCreating CircleShader");TentaGL.ShaderProgram.call(c,a,b,e);c.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.getXYZ);c.setAttrGetter("vertexNormal",TentaGL.Vertex.prototype.getNormal);c.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.getTexST);c._opacityUni=c.getUniform("opacity");c._mvpUni=c.getUniform("mvpTrans");
c._normalUni=c.getUniform("normalTrans");c._colorUni=c.getUniform("solidColor");c._texUni=c.getUniform("tex");c._useTexUni=c.getUniform("useTex")})};
TentaGL.CircleShader.prototype={constructor:TentaGL.CircleShader,isaCircleShader:!0,setOpacity:function(a,b){this._opacityUni.set(a,[b])},setMVPTrans:function(a,b){this._mvpUni.set(a,b)},setNormalTrans:function(a,b){this._normalUni.set(a,b)},setColor:function(a,b){this._colorUni.set(a,b);this._useTexUni.set(a,[0])},setTex:function(a,b){this._texUni.set(a,[b]);this._useTexUni.set(a,[1])}};
TentaGL.CircleShader.load=function(a,b){var c=new TentaGL.CircleShader(a);TentaGL.ShaderLib.add(a,b,c);a._circleShaderProgramName=b;return c};Util.Inheritance.inherit(TentaGL.CircleShader,TentaGL.ShaderProgram);TentaGL.Timer=function(a){this._startTime=a;this._accumulated=0;this._countdown=void 0;this._state=void 0!==a?TentaGL.Timer.RUNNING:TentaGL.Timer.STOPPED};TentaGL.Timer.STOPPED=1;TentaGL.Timer.RUNNING=2;TentaGL.Timer.PAUSED=3;
TentaGL.Timer.millisToHHmmssS=function(a){var b=Math.floor(a/1E3),c=Math.floor(b/60),d=Math.floor(c/60);a=""+Math.floor(a/100)%10;b=""+b%60;2>b.length&&(b="0"+b);var e=""+c%60;2>e.length&&(e="0"+e);var f="";1<=d&&(f+=d+":");1<=c&&(f+=e+":");return f+(b+"."+a)};
TentaGL.Timer.prototype={constructor:TentaGL.Timer,isaTimer:!0,isRunning:function(){return this._state==TentaGL.Timer.RUNNING},isPaused:function(){return this._state==TentaGL.Timer.PAUSED},isStopped:function(){return this._state==TentaGL.Timer.STOPPED},start:function(){this._startTime=Date.now();this._accumulated=0;this._state=TentaGL.Timer.RUNNING;return this._startTime},pause:function(){if(this._state==TentaGL.Timer.RUNNING){var a=Date.now();this._accumulated+=a-this._startTime;this._state=TentaGL.Timer.PAUSED}else throw Error("Cannot pause a Timer that isn't running.");
},resume:function(){if(this._state==TentaGL.Timer.PAUSED)this._startTime=Date.now(),this._state=TentaGL.Timer.RUNNING;else throw Error("Cannot resume a Timer not in a paused state.");},stop:function(){var a=Date.now();this._accumulated+=a-this._startTime;this._state=TentaGL.Timer.STOPPED},timeElapsed:function(){var a=this._accumulated;if(this._state==TentaGL.Timer.RUNNING)var b=Date.now(),a=a+(b-this._startTime);return a},timeElapsedHHmmssS:function(){return TentaGL.Timer.millisToHHmmssS(this.timeElapsed())},
setCountdown:function(a){this._countdown=a},timeLeft:function(){var a=this._countdown-this.timeElapsed();return a=Math.max(0,a)},timeLeftHHmmssS:function(){return TentaGL.Timer.millisToHHmmssS(this.timeLeft())}};TentaGL.Align={CENTER:1,LEFT:2,RIGHT:3,TOP:4,BOTTOM:5,FRONT:6,BACK:7};
TentaGL.Canvas2D={create:function(a,b,c){var d=document.createElement("canvas");d.width=a;d.height=b;c&&this.drawRect(d,0,0,a,b,!1,0,c);return d},removeAlpha:function(a){for(var b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=0;e<d.length;e+=4)255>d[e+3]&&(d[e+3]=0);b.putImageData(c,0,0);return a},drawString:function(a,b,c,d,e,f){e||(e=0);f||(f=0);var g=a.getContext("2d");g.save();g.webkitImageSmoothingEnabled=!1;g.font=c.toCSS();g.lineWidth=1;g.fillStyle=d.toCSS();b=b.split("\n");
for(var h in b)d=b[h],g.translate(0,c.getSize()),g.fillText(d,e,f),g.translate(0,c.getVerticalPadding());g.restore();return a},createString:function(a,b,c){var d=b.getStringDimensions(a),e=this.create(d[0],d[1]),f=e.getContext("2d");1==c.getRed()&&1==c.getGreen()&&1==c.getBlue()?f.fillStyle="black":f.fillStyle="white";f.fillRect(0,0,d[0],d[1]);this.drawString(e,a,b,c,0,0);return e},drawCircle:function(a,b,c,d,e,f,g){var h=a.getContext("2d");h.save();h.beginPath();h.arc(b,c,d,0,TentaGL.TAU);g&&(h.fillStyle=
g.toCSS(),h.fill());e&&(h.strokeStyle=e.toCSS(),h.lineWidth=f,h.stroke());h.restore();return a},createCircle:function(a,b,c,d){var e=2*a+c,e=this.create(e,e);this.drawCircle(e,a+c/2,a+c/2,a,b,c,d);return e},drawRect:function(a,b,c,d,e,f,g,h){var m=a.getContext("2d");m.save();h&&(m.fillStyle=h.toCSS(),m.fillRect(b,c,d,e));f&&(m.strokeStyle=f.toCSS(),m.lineWidth=g,m.strokeRect(b,c,d,e));m.restore();return a},createRect:function(a,b,c,d,e){var f=this.create(a+d,b+d);this.drawRect(f,d/2,d/2,a,b,c,d,e);
return f},drawRoundedRect:function(a,b,c,d,e,f,g,h,m){var k=a.getContext("2d");k.save();k.beginPath();k.moveTo(b+f,c);k.lineTo(b+d-f,c);k.arc(b+d-f,c+f,f,3*TentaGL.TAU/4,0);k.lineTo(b+d,c+e-f);k.arc(b+d-f,c+e-f,f,0,1*TentaGL.TAU/4);k.lineTo(b+f,c+e);k.arc(b+f,c+e-f,f,1*TentaGL.TAU/4,2*TentaGL.TAU/4);k.lineTo(b,c+f);k.arc(b+f,c+f,f,2*TentaGL.TAU/4,3*TentaGL.TAU/4);m&&(k.fillStyle=m.toCSS(),k.fill());g&&(k.strokeStyle=g.toCSS(),k.lineWidth=h,k.stroke());k.restore();return a},createRoundedRect:function(a,
b,c,d,e,f){var g=this.create(a+e,b+e);this.drawRoundedRect(g,e/2,e/2,a,b,c,d,e,f);return g},drawImage:function(a,b,c,d,e,f){var g=a.getContext("2d");e&&f?g.drawImage(b,c,d,e,f):g.drawImage(b,c,d);return a},createImage:function(a,b,c){var d=this.create(b?b:a.width,c?c:a.height);this.drawImage(d,a,0,0,b,c);return d},crop:function(a,b,c,d,e){var f=this.create(d,e);f.getContext("2d").drawImage(a,b,c,d,e,0,0);return f}};
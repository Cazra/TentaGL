GL_DEPTH_BUFFER_BIT=256;GL_STENCIL_BUFFER_BIT=1024;GL_COLOR_BUFFER_BIT=16384;GL_POINTS=0;GL_LINES=1;GL_LINE_LOOP=2;GL_LINE_STRIP=3;GL_TRIANGLES=4;GL_TRIANGLE_STRIP=5;GL_TRIANGLE_FAN=6;GL_ZERO=0;GL_ONE=1;GL_SRC_COLOR=768;GL_ONE_MINUS_SRC_COLOR=769;GL_SRC_ALPHA=770;GL_ONE_MINUS_SRC_ALPHA=771;GL_DST_ALPHA=772;GL_ONE_MINUS_DST_ALPHA=773;GL_DST_COLOR=774;GL_ONE_MINUS_DST_COLOR=775;GL_SRC_ALPHA_SATURATE=776;GL_FUNC_ADD=32774;GL_BLEND_EQUATION_RGB=GL_BLEND_EQUATION=32777;GL_BLEND_EQUATION_ALHPA=34877;
GL_FUNC_SUBTRACT=32778;GL_FUNC_REVERSE_SUBTRACT=32779;GL_BLEND_DST_RGB=32968;GL_BLEND_SRC_RGB=32969;GL_BLEND_DST_ALPHA=32970;GL_BLEND_SRC_ALPHA=32971;GL_CONSTANT_COLOR=32769;GL_ONE_MINUS_CONSTANT_COLOR=32770;GL_CONSTANT_ALPHA=32771;GL_ONE_MINUS_CONSTANT_ALPHA=32772;GL_BLEND_COLOR=32773;GL_ARRAY_BUFFER=34962;GL_ELEMENT_ARRAY_BUFFER=34963;GL_ARRAY_BUFFER_BINDING=34964;GL_ELEMENT_ARRAY_BUFFER_BINDING=34965;GL_STREAM_DRAW=35040;GL_STATIC_DRAW=35044;GL_DYNAMIC_DRAW=35048;GL_BUFFER_SIZE=34660;
GL_BUFFER_USAGE=34661;GL_CURRENT_VERTEX_ATTRIB=34342;GL_FRONT=1028;GL_BACK=1029;GL_FRONT_AND_BACK=1032;GL_CULL_FACE=2884;GL_BLEND=3042;GL_DITHER=3024;GL_STENCIL_TEST=2960;GL_DEPTH_TEST=2929;GL_SCISSOR_TEST=3089;GL_POLYGON_OFFSET_FILL=32823;GL_SAMPLE_ALPHA_TO_COVERAGE=32926;GL_SAMPLE_COVERAGE=32928;GL_NO_ERROR=0;GL_INVALID_ENUM=1280;GL_INVALID_VALUE=1281;GL_INVALID_OPERATION=1282;GL_OUT_OF_MEMORY=1285;GL_CW=2304;GL_CCW=2305;GL_LINE_WIDTH=2849;GL_ALIASED_POINT_SIZE_RANGE=33901;
GL_ALIASED_LINE_WIDTH_RANGE=33902;GL_CULL_FACE_MODE=2885;GL_FRONT_FACE=2886;GL_DEPTH_RANGE=2928;GL_DEPTH_WRITEMASK=2930;GL_DEPTH_CLEAR_VALUE=2931;GL_DEPTH_FUNC=2932;GL_STENCIL_CLEAR_VALUE=2961;GL_STENCIL_FUNC=2962;GL_STENCIL_FAIL=2964;GL_STENCIL_PASS_DEPTH_FAIL=2965;GL_STENCIL_PASS_DEPTH_PASS=2966;GL_STENCIL_REF=2967;GL_STENCIL_VALUE_MASK=2963;GL_STENCIL_WRITEMASK=2968;GL_STENCIL_BACK_FUNC=34816;GL_STENCIL_BACK_FAIL=34817;GL_STENCIL_BACK_PASS_DEPTH_FAIL=34818;GL_STENCIL_BACK_PASS_DEPTH_PASS=34819;
GL_STENCIL_REF=36003;GL_STENCIL_BACK_VALUE_MASK=36004;GL_STENCIL_BACK_WRITEMASK=36005;GL_VIEWPORT=2978;GL_SCISSOR_BOX=3088;GL_COLOR_CLEAR_VALUE=3106;GL_COLOR_WRITEMASK=3107;GL_UNPACK_ALIGNMENT=3317;GL_PACK_ALIGNMENT=3333;GL_MAX_TEXTURE_SIZE=3379;GL_MAX_VIEWPORT_DIMS=3386;GL_SUBPIXEL_BITS=3408;GL_RED_BITS=3410;GL_GREEN_BITS=3411;GL_BLUE_BITS=3412;GL_ALPHA_BITS=3413;GL_DEPTH_BITS=3414;GL_STENCIL_BITS=3415;GL_POLYGON_OFFSET_UNITS=10752;GL_POLYGON_OFFSET_FACTOR=32824;GL_TEXTURE_BINDING_2D=32873;
GL_SAMPLE_BUFFERS=32936;GL_SAMPLES=32937;GL_SAMPLE_COVERAGE_VALUE=32938;GL_SAMPLE_COVERAGE_INVERT=32939;GL_COMPRESSED_TEXTURE_FORMATS=34467;GL_DONT_CARE=4352;GL_FASTEST=4353;GL_NICEST=4354;GL_GENERATE_MIPMAP_HINT=33170;GL_BYTE=5120;GL_UNSIGNED_BYTE=5121;GL_SHORT=5122;GL_UNSIGNED_SHORT=5123;GL_INT=5124;GL_UNSIGNED_INT=5125;GL_FLOAT=5126;GL_FLOAT_VEC2=35664;GL_FLOAT_VEC3=35665;GL_FLOAT_VEC4=35666;GL_INT_VEC2=35667;GL_INT_VEC3=35668;GL_INT_VEC4=35669;GL_BOOL=35670;GL_BOOL_VEC2=35671;GL_BOOL_VEC3=35672;
GL_BOOL_VEC4=35673;GL_FLOAT_MAT2=35674;GL_FLOAT_MAT3=35675;GL_FLOAT_MAT4=35676;GL_SAMPLER_2D=35678;GL_SAMPLER_CUBE=35680;GL_DEPTH_COMPONENT=6402;GL_ALPHA=6406;GL_RGB=6407;GL_RGBA=6408;GL_LUMINANCE=6409;GL_LUMINANCE_ALPHA=6410;GL_UNSIGNED_SHORT_4_4_4_4=32819;GL_UNSIGNED_SHORT_5_5_5_1=32820;GL_UNSIGNED_SHORT_5_6_5=33635;GL_FRAGMENT_SHADER=35632;GL_VERTEX_SHADER=35633;GL_MAX_VERTEX_ATTRIBS=34921;GL_MAX_VERTEX_UNIFORM_VECTORS=36347;GL_MAX_VARYING_VECTORS=36348;GL_MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661;
GL_MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660;GL_MAX_TEXTURE_IMAGE_UNITS=34930;GL_MAX_FRAGMENT_UNIFORM_VECTORS=36349;GL_SHADER_TYPE=35663;GL_DELETE_STATUS=35712;GL_LINK_STATUS=35714;GL_VALIDATE_STATUS=35715;GL_ATTACHED_SHADERS=35717;GL_ACTIVE_UNIFORMS=35718;GL_ACTIVE_ATTRIBUTES=35721;GL_SHADING_LANGUAGE_VERSION=35724;GL_CURRENT_PROGRAM=35725;GL_NEVER=512;GL_LESS=513;GL_EQUAL=514;GL_LEQUAL=515;GL_GREATER=516;GL_NOTEQUAL=517;GL_GEQUAL=518;GL_ALWAYS=519;GL_KEEP=7680;GL_REPLACE=7681;GL_INCR=7682;GL_DECR=7683;
GL_INVERT=5386;GL_INCR_WRAP=34055;GL_DECR_WRAP=34056;GL_VENDOR=7936;GL_RENDERER=7937;GL_VERSION=7938;GL_NEAREST=9728;GL_LINEAR=9729;GL_NEAREST_MIPMAP_NEAREST=9984;GL_LINEAR_MIPMAP_NEAREST=9985;GL_NEAREST_MIPMAP_LINEAR=9986;GL_LINEAR_MIPMAP_LINEAR=9987;GL_TEXTURE_MAG_FILTER=10240;GL_TEXTURE_MIN_FILTER=10241;GL_TEXTURE_WRAP_S=10242;GL_TEXTURE_WRAP_T=10243;GL_TEXTURE_2D=3553;GL_TEXTURE=5890;GL_TEXTURE_CUBE_MAP=34067;GL_TEXTURE_BINDING_CUBE_MAP=34068;GL_TEXTURE_CUBE_MAP_POSITIVE_X=34069;
GL_TEXTURE_CUBE_MAP_NEGATIVE_X=34070;GL_TEXTURE_CUBE_MAP_POSITIVE_Y=34071;GL_TEXTURE_CUBE_MAP_NEGATIVE_Y=34072;GL_TEXTURE_CUBE_MAP_POSITIVE_Z=34073;GL_TEXTURE_CUBE_MAP_NEGATIVE_Z=34074;GL_MAX_CUBE_MAP_TEXTURE_SIZE=34076;GL_TEXTURE0=33984;GL_TEXTURE1=33985;GL_TEXTURE2=33986;GL_TEXTURE3=33987;GL_TEXTURE4=33988;GL_TEXTURE5=33989;GL_TEXTURE6=33990;GL_TEXTURE7=33991;GL_TEXTURE8=33992;GL_TEXTURE9=33993;GL_TEXTURE10=33994;GL_TEXTURE11=33995;GL_TEXTURE12=33996;GL_TEXTURE13=33997;GL_TEXTURE14=33998;
GL_TEXTURE15=33999;GL_TEXTURE16=34E3;GL_TEXTURE17=34001;GL_TEXTURE18=34002;GL_TEXTURE19=34003;GL_TEXTURE20=34004;GL_TEXTURE21=34005;GL_TEXTURE22=34006;GL_TEXTURE23=34007;GL_TEXTURE24=34008;GL_TEXTURE25=34009;GL_TEXTURE26=34010;GL_TEXTURE27=34011;GL_TEXTURE28=34012;GL_TEXTURE29=34013;GL_TEXTURE30=34014;GL_TEXTURE31=34015;GL_ACTIVE_TEXTURE=34016;GL_REPEAT=10497;GL_CLAMP_TO_EDGE=33071;GL_MIRRORED_REPEAT=33648;GL_VERTEX_ATTRIB_ARRAY_ENABLED=34338;GL_VERTEX_ATTRIB_ARRAY_SIZE=34339;
GL_VERTEX_ATTRIB_ARRAY_STRIDE=34340;GL_VERTEX_ATTRIB_ARRAY_TYPE=34341;GL_VERTEX_ATTRIB_ARRAY_NORMALIZED=34922;GL_VERTEX_ATTRIB_ARRAY_POINTER=34373;GL_VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975;GL_IMPLEMENTATION_COLOR_READ_TYPE=35738;GL_IMPLEMENTATION_COLOR_READ_FORMAT=35739;GL_COMPILE_STATUS=35713;GL_LOW_FLOAT=36336;GL_MEDIUM_FLOAT=36337;GL_HIGH_FLOAT=36338;GL_LOW_INT=36339;GL_MEDIUM_INT=36340;GL_HIGH_INT=36341;GL_FRAMEBUFFER=36160;GL_RENDERBUFFER=36161;GL_RGBA4=32854;GL_RGB5_1=32855;GL_RGB565=36194;
GL_DEPTH_COMPONENT16=33189;GL_STENCIL_INDEX=6401;GL_STENCIL_INDEX8=36168;GL_DEPTH_STENCIL=34041;GL_RENDERBUFFER_WIDTH=36162;GL_RENDERBUFFER_HEIGHT=36163;GL_RENDERBUFFER_INTERNAL_FORMAT=36164;GL_RENDERBUFFER_RED_SIZE=36176;GL_RENDERBUFFER_GREEN_SIZE=36177;GL_RENDERBUFFER_BLUE_SIZE=36178;GL_RENDERBUFFER_ALPHA_SIZE=36179;GL_RENDERBUFFER_DEPTH_SIZE=36180;GL_RENDERBUFFER_STENCIL_SIZE=36181;GL_FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048;GL_FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049;
GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050;GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051;GL_COLOR_ATTACHMENT0=36064;GL_DEPTH_ATTACHMENT=36096;GL_STENCIL_ATTACHMENT=36128;GL_DEPTH_STENCIL_ATTACHMENT=33306;GL_NONE=0;GL_FRAMEBUFFER_COMPLETE=36053;GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054;GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055;GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057;GL_FRAMEBUFFER_UNSUPPORTED=36061;GL_FRAMEBUFFER_BINDING=36006;GL_RENDERBUFFER_BINDING=36007;
GL_MAX_RENDERBUFFER_SIZE=34024;GL_INVALID_FRAMEBUFFER_OPERATION=1286;GL_UNPACK_FLIP_Y_WEBGL=37440;GL_UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441;GL_CONTEXT_LOST_WEBGL=37442;GL_UNPACK_COLORSPACE_CONVERSION_WEBGL=37443;GL_BROWSER_DEFAULT_WEBGL=37444;
var TentaGL={versionMajor:0,versionMinor:21,createGL:function(c,d){d=d||{alpha:!1};try{var e=c.getContext("webgl",d)||c.getContext("experimental-webgl",d)||c.getContext("webkit-3d",d)||c.getContext("moz-webgl",d);TentaGL.Blend.reset(e);TentaGL.ClippingArea.reset(e);TentaGL.ColorBuffer.reset(e);TentaGL.Cull.reset(e);TentaGL.DepthBuffer.reset(e);TentaGL.DrawMode.reset(e);TentaGL.Scissor.reset(e);TentaGL.Stencil.reset(e);TentaGL.Viewport.reset(e);TentaGL.ViewTrans.reset(e);this._normalTrans=mat3.create();
this._mvpTrans=mat4.create();return e}catch(f){throw Error("Error creating WebGL context: "+f.toString());}},createCanvas:function(c){var d=document.createElement("canvas");c.appendChild(d);d.width=c.offsetWidth;d.height=c.offsetHeight;return d},clear:function(c,d){TentaGL.ColorBuffer.setClearColor(c,d);c.clear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT)},glTypeName:function(c){return TentaGL._glTypeName[c]},glSizeUnits:function(c){return TentaGL._glSizeUnits[c]},glSizeBytes:function(c){var d=TentaGL.glSizeUnits(c);
c=TentaGL.glUnitType(c);return d*TentaGL._glSizeBytes[c]},glUnitType:function(c){return TentaGL._glUnitTypes[c]},_defaultRenderFilter:function(c){return!0},_glTypeName:[]};TentaGL._glTypeName[GL_BYTE]="BYTE";TentaGL._glTypeName[GL_UNSIGNED_BYTE]="UNSIGNED_BYTE";TentaGL._glTypeName[GL_SHORT]="SHORT";TentaGL._glTypeName[GL_UNSIGNED_SHORT]="UNSIGNED_SHORT";TentaGL._glTypeName[GL_INT]="INT";TentaGL._glTypeName[GL_UNSIGNED_INT]="UNSIGNED_INT";TentaGL._glTypeName[GL_FLOAT]="FLOAT";
TentaGL._glTypeName[GL_FLOAT_VEC2]="FLOAT_VEC2";TentaGL._glTypeName[GL_FLOAT_VEC3]="FLOAT_VEC3";TentaGL._glTypeName[GL_FLOAT_VEC4]="FLOAT_VEC4";TentaGL._glTypeName[GL_INT_VEC2]="INT_VEC2";TentaGL._glTypeName[GL_INT_VEC3]="INT_VEC3";TentaGL._glTypeName[GL_INT_VEC4]="INT_VEC4";TentaGL._glTypeName[GL_BOOL]="BOOL";TentaGL._glTypeName[GL_BOOL_VEC2]="BOOL_VEC2";TentaGL._glTypeName[GL_BOOL_VEC3]="BOOL_VEC3";TentaGL._glTypeName[GL_BOOL_VEC4]="BOOL_VEC4";TentaGL._glTypeName[GL_FLOAT_MAT2]="FLOAT_MAT2";
TentaGL._glTypeName[GL_FLOAT_MAT3]="FLOAT_MAT3";TentaGL._glTypeName[GL_FLOAT_MAT4]="FLOAT_MAT4";TentaGL._glTypeName[GL_SAMPLER_2D]="SAMPLER_2D";TentaGL._glTypeName[GL_SAMPLER_CUBE]="SAMPLER_CUBE";TentaGL._glSizeUnits=[];TentaGL._glSizeUnits[GL_BYTE]=1;TentaGL._glSizeUnits[GL_UNSIGNED_BYTE]=1;TentaGL._glSizeUnits[GL_SHORT]=1;TentaGL._glSizeUnits[GL_UNSIGNED_SHORT]=1;TentaGL._glSizeUnits[GL_INT]=1;TentaGL._glSizeUnits[GL_UNSIGNED_INT]=1;TentaGL._glSizeUnits[GL_FLOAT]=1;
TentaGL._glSizeUnits[GL_FLOAT_VEC2]=2;TentaGL._glSizeUnits[GL_FLOAT_VEC3]=3;TentaGL._glSizeUnits[GL_FLOAT_VEC4]=4;TentaGL._glSizeUnits[GL_INT_VEC2]=2;TentaGL._glSizeUnits[GL_INT_VEC3]=3;TentaGL._glSizeUnits[GL_INT_VEC4]=4;TentaGL._glSizeUnits[GL_BOOL]=1;TentaGL._glSizeUnits[GL_BOOL_VEC2]=2;TentaGL._glSizeUnits[GL_BOOL_VEC3]=3;TentaGL._glSizeUnits[GL_BOOL_VEC4]=4;TentaGL._glSizeUnits[GL_FLOAT_MAT2]=4;TentaGL._glSizeUnits[GL_FLOAT_MAT3]=9;TentaGL._glSizeUnits[GL_FLOAT_MAT4]=16;
TentaGL._glSizeBytes=[];TentaGL._glSizeBytes[GL_BYTE]=1;TentaGL._glSizeBytes[GL_UNSIGNED_BYTE]=1;TentaGL._glSizeBytes[GL_SHORT]=2;TentaGL._glSizeBytes[GL_UNSIGNED_SHORT]=2;TentaGL._glSizeBytes[GL_INT]=4;TentaGL._glSizeBytes[GL_UNSIGNED_INT]=4;TentaGL._glSizeBytes[GL_FLOAT]=4;TentaGL._glSizeBytes[GL_BOOL]=4;TentaGL._glUnitTypes=[];TentaGL._glUnitTypes[GL_BYTE]=GL_BYTE;TentaGL._glUnitTypes[GL_UNSIGNED_BYTE]=GL_UNSIGNED_BYTE;TentaGL._glUnitTypes[GL_SHORT]=GL_SHORT;
TentaGL._glUnitTypes[GL_UNSIGNED_SHORT]=GL_UNSIGNED_SHORT;TentaGL._glUnitTypes[GL_INT]=GL_INT;TentaGL._glUnitTypes[GL_UNSIGNED_INT]=GL_UNSIGNED_INT;TentaGL._glUnitTypes[GL_FLOAT]=GL_FLOAT;TentaGL._glUnitTypes[GL_FLOAT_VEC2]=GL_FLOAT;TentaGL._glUnitTypes[GL_FLOAT_VEC3]=GL_FLOAT;TentaGL._glUnitTypes[GL_FLOAT_VEC4]=GL_FLOAT;TentaGL._glUnitTypes[GL_INT_VEC2]=GL_INT;TentaGL._glUnitTypes[GL_INT_VEC3]=GL_INT;TentaGL._glUnitTypes[GL_INT_VEC4]=GL_INT;TentaGL._glUnitTypes[GL_BOOL]=GL_BOOL;
TentaGL._glUnitTypes[GL_BOOL_VEC2]=GL_BOOL;TentaGL._glUnitTypes[GL_BOOL_VEC3]=GL_BOOL;TentaGL._glUnitTypes[GL_BOOL_VEC4]=GL_BOOL;TentaGL._glUnitTypes[GL_FLOAT_MAT2]=GL_FLOAT;TentaGL._glUnitTypes[GL_FLOAT_MAT3]=GL_FLOAT;TentaGL._glUnitTypes[GL_FLOAT_MAT4]=GL_FLOAT;var Util;Util||(Util={});Util.Debug={arrayString:function(c){for(var d="[",e=!0,f=0;f<c.length;f++)e?e=!1:d+=", ",d+=c[f];return d+"]"},objString:function(c){var d="{",e=!0,f;for(f in c)e?e=!1:d+=", ",d+=f+":"+c[f];return d+"}"}};
TentaGL.DOM={getAbsolutePosition:function(c){for(var d=0,e=0;"BODY"!=c.nodeName;)d+=c.offsetLeft,e+=c.offsetTop,c=c.parentNode;return[d,e]},extractScriptText:function(c){var d=document.getElementById(c);if(!d)throw Error("Script ID "+c+" doesn't exist in the document.");c="";var e=d.firstChild;for(console.log(d);e;)e.nodeType==Node.TEXT_NODE&&(c+=e.textContent),e=e.nextSibling;return c}};
Util.Downloader={invisInput:void 0,saveAsText:function(c,d){var e=document.createElement("a");e.href="data:text;charset=utf-8,"+encodeURIComponent(d);e.download=c;e.click()},openDialog:function(c,d){var e=document.createElement("INPUT");e.setAttribute("type","file");d&&e.setAttribute("accept",d);e.style.display="none";var f=document.getElementsByTagName("body")[0];f.appendChild(e);e.onchange=function(d){var k=new FileReader;k.onload=function(d){c(d.target.result);f.removeChild(e)};k.readAsText(d.target.files[0])};
e.click()}};Util||(Util={});Util.Inheritance={inherit:function(c,d){for(var e in d.prototype)c.prototype[e]||(c.prototype[e]=d.prototype[e])}};TentaGL.Renderable={};TentaGL.Renderable.prototype={isaRenderable:!0,render:function(c){}};
TentaGL.Blend={setEnabled:function(c,d){c._blendEnabled==d||TentaGL.Picker.isPicking(c)||((c._blendEnabled=d)?c.enable(GL_BLEND):c.disable(GL_BLEND))},isEnabled:function(c){return c._blendEnabled},enabled:function(c,d){void 0!==d&&this.setEnabled(c,d);return c._blendEnabled},setEquation:function(c,d,e,f){c._blendEquation!=d&&(c._blendEquation=d,c.blendEquation(d));if(c._blendSrcFunc!=e||c._blendDstFunc!=f)c._blendSrcFunc=e,c._blendDstFunc=f,c.blendFunc(e,f)},getEquation:function(c){return c._blendEquation},
equation:function(c,d,e,f){void 0!==d&&this.setEquation(c,d,e,f);return c._blendEquation},getSrcFunc:function(c){return c._blendSrcFunc},getDstFunc:function(c){return c._blendDstFunc},color:function(c,d){void 0===d||d.equals(c._blendColor)||(c._blendColor=d.clone(),c.blendColor(d.r(),d.g(),d.b(),d.a()));return c._blendColor.clone()},reset:function(c){c._blendEnabled=!1;c._blendEquation=GL_FUNC_ADD;c._blendSrcFunc=GL_ONE;c._blendDstFunc=GL_ZERO;c._blendColor=TentaGL.Color.RGBA(0,0,0,0);c._blendStack=
[]},push:function(c){c._blendStack.push({_blendEnabled:c._blendEnabled,_blendEquation:c._blendEquation,_blendSrcFunc:c._blendSrcFunc,_blendDstFunc:c._blendDstFunc,_blendColor:c._blendColor})},pop:function(c){var d=c._blendStack.pop();this.enabled(c,d._blendEnabled);this.equation(c,d._blendEquation,d._blendSrcFunc,d._blendDstFunc);this.color(c,d._blendColor)}};
TentaGL.ColorBuffer={reset:function(c){c._cbClear=TentaGL.Color.RGBA(0,0,0,0);c._cbWriteRed=!0;c._cbWriteGreen=!0;c._cbWriteBlue=!0;c._cbWriteAlpha=!0;c._cbStack=[]},setClearColor:function(c,d){TentaGL.Picker.isPicking(c)||(c._cbClear=d.clone(),c.clearColor(d.r(),d.g(),d.b(),d.a()))},getClearColor:function(c){return c._cbClear.clone()},clearColor:function(c,d){d&&this.setClearColor(c,d);return c._cbClear.clone()},setWriteable:function(c,d,e,f,g){c._cbWriteRed=d;c._cbWriteGreen=e;c._cbWriteBlue=f;
c._cbWriteAlpha=g;c.colorMask(d,e,f,g)},mask:function(c,d,e,f,g){void 0!==d&&(c._cbWriteRed=d,c._cbWriteGreen=e,c._cbWriteBlue=f,c._cbWriteAlpha=g,c.colorMask(d,e,f,g));return[c._cbWriteRed,c._cbWriteGreen,c._cbWriteBlue,c._cbWriteAlpha]},clear:function(c,d){d&&this.setClearColor(c,d);c.clear(GL_COLOR_BUFFER_BIT)},push:function(c){c._cbStack.push({_cbClear:c._cbClear,_cbWriteRed:c._cbWriteRed,_cbWriteGreen:c._cbWriteGreen,_cbWriteBlue:c._cbWriteBlue,_cbWriteAlpha:c._cbWriteAlpha})},pop:function(c){var d=
c._cbStack.pop();this.clearColor(c,d._cbClear);this.setWriteable(c,d._cbWriteRed,d._cbWriteGreen,d._cbWriteBlue,d._cbWriteAlpha)}};
TentaGL.Cull={setMode:function(c,d){c._cullMode!=d&&(c._cullMode=d,d==GL_NONE?c.disable(GL_CULL_FACE):(c.enable(GL_CULL_FACE),c.cullFace(d)))},getMode:function(c){return c._cullMode},mode:function(c,d){void 0!==d&&this.setMode(c,d);return c._cullMode},frontFace:function(c,d){void 0!==d&&d!=c._frontFace&&(c._frontFace=d,c.frontFace(d));return c._frontFace},reset:function(c){c._cullMode=GL_NONE;c._frontFace=GL_CCW;c._cullStack=[]},push:function(c){c._cullStack.push({_cullMode:c._cullMode,_frontFace:c._frontFace})},
pop:function(c){var d=c._cullStack.pop();this.mode(c,d._cullMode);this.frontFace(c,d._frontFace)}};
TentaGL.DepthBuffer={reset:function(c){c._depthEnabled=!1;c._depthFunc=GL_LESS;c._depthWrite=!0;c._depthRange=[0,1];c._depthClearVal=1;c._depthStack=[]},setEnabled:function(c,d){c._depthEnabled!=d&&((c._depthEnabled=d)?c.enable(GL_DEPTH_TEST):c.disable(GL_DEPTH_TEST))},isTestEnabled:function(c){return c._depthEnabled},enabled:function(c,d){void 0!==d&&this.setEnabled(c,d);return c._depthEnabled},setFunc:function(c,d){c._depthFunc!=d&&(c._depthFunc=d,c.depthFunc(d))},getFunc:function(c){return c._depthFunc},
func:function(c,d){void 0!==d&&this.setFunc(c,d);return c._depthFunc},setMaskEnabled:function(c,d){c._depthWrite!=d&&(c._depthWrite=d,c.depthMask(d))},isMaskEnabled:function(c){return c._depthWrite},mask:function(c,d){void 0!==d&&this.setMaskEnabled(c,d);return c._depthWrite},setRange:function(c,d){var e=TentaGL.Math.clamp(d[0],0,1),f=TentaGL.Math.clamp(d[1],0,1);if(e!=c._depthRange[0]||f!=c._depthRange[1])c._depthRange[0]=e,c._depthRange[1]=f,c.depthRange(e,f)},range:function(c,d){void 0!==d&&this.setRange(c,
d);return c._depthRange},getRangeNear:function(c){return c._depthRange[0]},getRangeFar:function(c){return c._depthRange[1]},setClearValue:function(c,d){d=TentaGL.Math.clamp(d,0,1);c._depthClearVal!=d&&(c._depthClearVal=d,c.clearDepth(d))},getClearValue:function(){return gl._depthClearVal},clearValue:function(c,d){void 0!==d&&this.setClearValue(c,d);return c._depthClearVal},clear:function(c){c.clear(GL_DEPTH_BUFFER_BIT)},createBuffer:function(c,d,e){var f=c.createRenderbuffer();c.bindRenderbuffer(GL_RENDERBUFFER,
f);c.renderbufferStorage(GL_RENDERBUFFER,GL_DEPTH_COMPONENT16,d,e);c.bindRenderbuffer(GL_RENDERBUFFER,null);return f},push:function(c){var d={_depthEnabled:c._depthEnabled,_depthFunc:c._depthFunc,_depthWrite:c._depthWrite,_depthRange:c._depthRange.slice(0),_depthClearVal:c._depthClearVal};c._depthStack.push(d)},pop:function(c){var d=c._depthStack.pop();this.enabled(c,d._depthEnabled);this.func(c,d._depthFunc);this.mask(c,d._depthWrite);this.range(c,d._depthRange);this.clearValue(c,d._depthClearVal)}};
TentaGL.DrawMode={reset:function(c){c._drawMode=GL_TRIANGLES},mode:function(c,d){void 0!==d&&c._drawMode!=d&&(c._drawMode=d);return c._drawMode}};TentaGL.RenderMode={};TentaGL.RenderMode.set3DOpaque=function(c){TentaGL.Blend.setEnabled(c,!1);TentaGL.DepthBuffer.setEnabled(c,!0);TentaGL.DepthBuffer.setMaskEnabled(c,!0);TentaGL.Cull.setMode(c,GL_NONE)};
TentaGL.RenderMode.set3DTrans=function(c){TentaGL.Blend.setEnabled(c,!0);TentaGL.Blend.setEquation(c,GL_FUNC_ADD,GL_SRC_ALPHA,GL_ONE_MINUS_SRC_ALPHA);TentaGL.DepthBuffer.setEnabled(c,!0);TentaGL.DepthBuffer.setMaskEnabled(c,!1);TentaGL.Cull.setMode(c,GL_NONE)};TentaGL.RenderMode.set2D=function(c){TentaGL.Blend.setEnabled(c,!0);TentaGL.Blend.setEquation(c,GL_FUNC_ADD,GL_SRC_ALPHA,GL_ONE_MINUS_SRC_ALPHA);TentaGL.DepthBuffer.setEnabled(c,!1);TentaGL.Cull.setMode(c,GL_NONE)};
TentaGL.Scissor={reset:function(c){c._scissorEnabled=!1;c._scissorXYWH=[0,0,c.canvas.width,c.canvas.height];c._scissorStack=[]},enabled:function(c,d){void 0!==d&&c._scissorEnabled!=d&&((c._scissorEnabled=d)?c.enable(GL_SCISSOR_TEST):c.disable(GL_SCISSOR_TEST));return c._scissorEnabled},xywh:function(c,d){void 0!==d&&(c._scissorXYWH=d.slice(0),c.scissor(d[0],d[1],d[2],d[3]));return c._scissorXYWH.slice(0)},push:function(c){var d={_scissorEnabled:c._scissorEnabled,_scissorXYWH:c._scissorXYWH.slice(0)};
c._scissorStack.push(d)},pop:function(c){this.xywh(c,c._scissorStack.pop())}};
TentaGL.Stencil={enabled:function(c,d){void 0!==d&&d!=c._stencilEnabled&&((c._stencilEnabled=d)?c.enable(GL_STENCIL_TEST):c.disable(GL_STENCIL_TEST));return c._stencilEnabled},clearValue:function(c,d){void 0!==d&&d!=c._stencilClearVal&&(c._stencilClearVal=d,c.clearStencil(d));return c._stencilClearVal},clear:function(c,d){void 0!==d&&this.clearValue(c,d);c.clear(GL_STENCIL_BUFFER_BIT)},func:function(c,d,e,f){void 0!==d&&(void 0===f&&(f=255),c._stencilFunc=d,c._stencilRef=e,c._stencilMask=f,c.stencilFunc(d,
e,f));return c._stencilFunc},getRef:function(c){return c._stencilRef},mask:function(c,d){void 0!==d&&(c._stencilWriteMask=d,c.stencilMask(d));return c._stencilWriteMask},op:function(c,d,e,f){void 0!==d&&(c._stencilFailS=d,c._stencilFailDP=e,c._stencilPassDP=f,c.stencilOp(d,e,f));return[c._stencilFailS,c._stencilFailDP,c._stencilPassDP]},createStencilBuffer:function(c,d,e){var f=c.createRenderbuffer();c.bindRenderbuffer(c.RENDERBUFFER,f);c.renderbufferStorage(c.RENDERBUFFER,c.STENCIL_INDEX8,d,e);c.bindRenderbuffer(c.RENDERBUFFER,
null);return f},reset:function(c){c._stencilEnabled=!1;c._stencilClearVal=0;c._stencilFunc=GL_ALWAYS;c._stencilRef=0;c._stencilMask=255;c._stencilWriteMask=255;c._stencilFailS=GL_KEEP;c._stencilFailDP=GL_KEEP;c._stencilPassDP=GL_KEEP;c._stencilStack=[]},push:function(c){c._stencilStack.push({_stencilEnabled:c._stencilEnabled,_stencilClearVal:c._stencilClearVal,_stencilFunc:c._stencilFunc,_stencilRef:c._stencilRef,_stencilMask:c._stencilMask,_stencilWriteMask:c._stencilWriteMask,_stencilFailS:c._stencilFailS,
_stencilFailDP:c._stencilFailDP,_stencilPassDP:c._stencilPassDP})},pop:function(c){var d=c._stencilStack.pop();this.enabled(c,d._stencilEnabled);this.clearValue(c,d._stencilClearVal);this.func(c,d._stencilFunc,d._stencilRef,d._stencilMask);this.mask(c,d._stencilWriteMask);this.op(c,d._stencilFailS,d._stencilFailDP,d._stencilPassDP)}};
TentaGL.Viewport={xywh:function(c,d){void 0!==d&&(c._viewportXYWH=d.slice(0),c.viewport(d[0],d[1],d[2],d[3]));return c._viewportXYWH.slice(0)},getX:function(c){return c._viewX},getY:function(c){return c._viewY},getWidth:function(c){return c._viewWidth},getHeight:function(c){return c._viewHeight},reset:function(c){c._viewportXYWH=[0,0,c.canvas.width,c.canvas.height];c._viewportStack=[]},push:function(c){var d={_viewportXYWH:c._viewportXYWH.slice(0)};c._viewportStack.push(d)},pop:function(c){var d=
c._viewportStack.pop();this.xywh(c,d._viewportXYWH)}};TentaGL.TAU=2*Math.PI;
TentaGL.Math={toPolar:function(c){var d=vec3.fromValues(c[0],c[1],c[2]),e=vec3.length(d),d=vec3.normalize(d,d),d=Math.asin(this.clamp(d[1],-1,1)),f;0==c[0]?f=0<c[2]?.75*TentaGL.TAU:.25*TentaGL.TAU:(f=Math.atan(-c[2]/c[0]),0>c[0]&&(f+=TentaGL.TAU/2));return vec3.fromValues(e,f,d)},toCartesian:function(c){var d=c[0]*Math.cos(c[1])*Math.cos(c[2]),e=c[0]*Math.sin(c[2]);c=0-c[0]*Math.sin(c[1])*Math.cos(c[2]);return vec3.fromValues(d,e,c)},clamp:function(c,d,e){return Math.min(e,Math.max(c,d))},wrap:function(c,
d,e){e-=d;c=(c-d)%e;0>c&&(c+=e);return c+d},linearMap:function(c,d,e){return e[0]+(c-d[0])/(d[1]-d[0])*(e[1]-e[0])},ptsMinX:function(c){for(var d,e=0;e<c.length;e++){var f=c[e];if(!d||f[0]<d[0])d=f}return d},ptsMaxX:function(c){for(var d,e=0;e<c.length;e++){var f=c[e];if(!d||f[0]>d[0])d=f}return d},ptsMinY:function(c){for(var d,e=0;e<c.length;e++){var f=c[e];if(!d||f[1]<d[1])d=f}return d},ptsMaxY:function(c){for(var d,e=0;e<c.length;e++){var f=c[e];if(!d||f[1]>d[1])d=f}return d},ptsMinZ:function(c){for(var d,
e=0;e<c.length;e++){var f=c[e];if(!d||f[2]<d[2])d=f}return d},ptsMaxZ:function(c){for(var d,e=0;e<c.length;e++){var f=c[e];if(!d||f[2]>d[2])d=f}return d},vectorAngle:function(c,d){var e=vec3.normalize(vec3.create(),c),f=vec3.normalize(vec3.create(),d);return Math.acos(vec3.dot(e,f))},tweenVector:function(c,d,e){var f=vec3.normalize(vec3.create(),c),g=vec3.normalize(vec3.create(),d);c=vec3.cross(vec3.create(),c,d);nMag=vec3.length(c);g=Math.acos(vec3.dot(f,g));0>nMag?g=TentaGL.TAU-g:0==nMag&&(c=[0,
0,1]);c=vec3.normalize(c,c);e=quat.setAxisAngle(quat.create(),c,g*e);return vec3.transformQuat(vec3.create(),f,e)},vectorsParallel:function(c,d){c[2]||(c=vec2.copy([],c),c[2]=0);d[2]||(d=vec2.copy([],d),d[2]=0);var e=vec3.normalize([],c),f=vec3.normalize([],d),e=vec3.dot(e,f);return 1==e||-1==e},matChangeBasis:function(c,d,e){var f=mat3.create();f[0]=c[0];f[1]=c[1];f[2]=c[2];f[3]=d[0];f[4]=d[1];f[5]=d[2];f[6]=e[0];f[7]=e[1];f[8]=e[2];return f},getQuatFromTo:function(c,d){var e=vec3.normalize(this._vec3_1,
c),f=vec3.normalize(this._vec3_2,d),g=vec3.cross(this._vec3_3,e,f);vec3.normalize(g,g);f=TentaGL.Math.clamp(vec3.dot(e,f),-1,1);e=vec3.length(g);f=Math.acos(f);0>e&&(f=0-f);g=quat.setAxisAngle(quat.create(),g,f);return quat.normalize(g,g)},getOrientation:function(c,d,e,f){c=this.getQuatFromTo(c,e);d=vec3.transformQuat(vec3.create(),d,c);f=this.getQuatFromTo(d,f);quat.mul(c,f,c);return c},getPowerOfTwo:function(c){for(var d=1;d<c;)d*=2;return d},_vec3_1:vec3.create(),_vec3_2:vec3.create(),_vec3_3:vec3.create()};
TentaGL.Math.Shape2D=function(){};TentaGL.Math.Shape2D.prototype={constructor:TentaGL.Math.Shape2D,isaShape2D:!0,containsPt:function(c){},getBounds2D:function(){},render:function(c,d){}};Util.Inheritance.inherit(TentaGL.Math.Shape2D,TentaGL.Renderable);TentaGL.Math.Ellipse2D=function(c,d,e){void 0===e&&(e=d);this._pt=c;this._rx=d;this._ry=e};
TentaGL.Math.Ellipse2D.prototype={constructor:TentaGL.Math.Ellipse2D,isaEllipse2D:!0,clone:function(){return new TentaGL.Math.Ellipse2D(this._pt.slice(0),this._rx,this._ry)},x:function(c){void 0!==c&&(this._pt[0]=c);return this._pt[0]},y:function(c){void 0!==c&&(this._pt[1]=c);return this._pt[1]},xy:function(c){void 0!==c&&(this._pt=vec2.clone(c));return vec2.clone(this._pt)},radius:function(c){void 0!==c&&(this._ry=this._rx=c);return this._rx},radiusX:function(c){void 0!==c&&(this._rx=c);return this._rx},
radiusY:function(c){void 0!==c&&(this._ry=c);return this._ry},containsPt:function(c){c=c.slice(0);c[0]-=this._pt[0];c[1]-=this._pt[1];var d=mat3.create();mat3.scale(d,d,[1/this._rx,1/this._ry,0]);vec2.transformMat3(c,c,d);return 1>=c[0]*c[0]+c[1]*c[1]},getBounds2D:function(){return new TentaGL.Math.Rect2D([this._pt[0]-this._rx,this._pt[1]-this._ry,2*this._rx,2*this._ry])},render:function(c,d){TentaGL.ShaderLib.push(c);TentaGL.ViewTrans.push(c);TentaGL.ShaderLib.use(c,c._circleShaderProgramName);d&&
TentaGL.MaterialLib.use(c,d);TentaGL.ViewTrans.translate(c,this._pt);TentaGL.ViewTrans.scale(c,[2*this._rx,2*this._ry]);TentaGL.ViewTrans.translate(c,[-.5,-.5]);TentaGL.ModelLib.render(c,"unitPlane");TentaGL.ViewTrans.pop(c);TentaGL.ShaderLib.pop(c)}};TentaGL.Math.Ellipse2D.fromRect=function(c){var d=c.width()/2,e=c.height()/2,f=c.x()+d;c=c.y()+e;return new TentaGL.Math.Ellipse2D([f,c],d,e)};Util.Inheritance.inherit(TentaGL.Math.Ellipse2D,TentaGL.Math.Shape2D);
TentaGL.Math.Line2D=function(c,d){this._p1=vec2.copy([],c);this._p2=vec2.copy([],d);this._updateMetrics()};
TentaGL.Math.Line2D.prototype={constructor:TentaGL.Math.Line2D,isaLine2D:!0,clone:function(){return new TentaGL.Math.Line2D(this._p1,this._p2)},_updateMetrics:function(){this._length=vec2.dist(this._p1,this._p2)},getPt1:function(){return this._p1},getPt2:function(){return this._p2},pt1:function(c){c&&(this._p1=vec2.copy([],c),this._updateMetrics());return this._p1.slice(0)},pt2:function(c){c&&(this._p2=vec2.copy([],c),this._updateMetrics());return this._p2.slice(0)},getLength:function(){return this._length},
getVec2:function(){return vec2.sub([],this._p2,this._p1)},getAngle:function(){var c=this.getVec2();return Math.atan2(c[1],c[0])},distToPt:function(c){var d=this.getVec2(),e=vec2.sub(vec2.create(),c,this._p1);c=vec2.sub(vec2.create(),c,this._p2);if(0>=vec2.dot(d,e))return vec2.len(e);if(0<=vec2.dot(d,c))return vec2.len(c);d=vec2.normalize([],d);c=vec2.normalize([],e);d=vec2.cross([],d,c);return vec2.len(e)*vec3.len(d)},distToLine:function(c){if(this.intersects(c))return 0;var d=this.distToPt(c._p1),
e=this.distToPt(c._p2),f=c.distToPt(this._p1);c=c.distToPt(this._p2);return Math.min(d,e,f,c)},containsPt:function(c,d){d||(d=0);return this.distToPt(c)<=d},intersects:function(c){return void 0!=this.intersection(c)},intersection:function(c,d){d||(d=0);var e=vec2.sub([],c._p1,this._p1),f=this.getVec2(),g=c.getVec2();if(TentaGL.Math.vectorsParallel(f,g)){var e=this._p1,f=vec2.add([],e,f),k=c._p1,g=vec2.add([],k,g),l=this.containsPt(k,d),m=this.containsPt(g,d),p=c.containsPt(e,d),n=c.containsPt(f,d);
if(l&&m)return new TentaGL.Math.Line2D(k,g);if(l&&p)return new TentaGL.Math.Line2D(k,e);if(l&&n)return new TentaGL.Math.Line2D(k,f);if(m&&p)return new TentaGL.Math.Line2D(g,e);if(m&&n)return new TentaGL.Math.Line2D(g,f);if(p&&n)return new TentaGL.Math.Line2D(e,f)}else if(k=[],k=k.concat(f),k=k.concat(vec2.negate([],g)),k=mat2.invert([],k),k=vec2.transformMat2([],e,k),e=k[0],k=k[1],0<=e&&1>=e&&0<=k&&1>=k)return vec2.add([],this._p1,vec2.scale([],f,e))},transformMat3:function(c){var d=vec3.clone(this._p1),
d=vec3.transformMat3(vec3.create(),d,c),e=vec3.clone(this._p2);vec3.transformMat3(e,e,c);return new TentaGL.Math.Line2D(d,e)},transformMat4:function(c){var d=vec3.clone(this._p1);vec3.transformMat4(d,d,c);var e=vec3.clone(this._p2);vec3.transformMat4(e,e,c);return new TentaGL.Math.Line2D(d,e)},relativeCCW:function(c){var d=this.getVec2();c=vec3.sub(vec3.create(),c,this._p1);d=vec3.cross(c,d,c);return 0<d[2]?-1:0>d[2]?1:0},ptIsAbove:function(c,d){var e=this.relativeCCW(c);d&&(e*=-1);return 0>e},ptIsBelow:function(c,
d){var e=this.relativeCCW(c);d&&(e*=-1);return 0<e},render:function(c,d){var e=vec3.clone(this._p1);e[2]=0;var f=vec3.clone(this._p2);f[2]=0;var g=f[0]-e[0],f=f[1]-e[1];TentaGL.ViewTrans.push(c);var k=mat4.create();mat4.translate(k,k,[e[0],e[1],0]);mat4.scale(k,k,[g,f,0]);TentaGL.ViewTrans.mul(c,k);d&&TentaGL.MaterialLib.use(c,d);TentaGL.ModelLib.render(c,"unitLine");TentaGL.ViewTrans.pop(c)}};TentaGL.Math.Rect2D=function(c,d,e){void 0===e&&(e=d);this._xy=c;this._w=d;this._h=e};
TentaGL.Math.Rect2D.prototype={constructor:TentaGL.Math.Rect2D,isaRect2D:!0,clone:function(){return new TentaGL.Math.Rect2D(this._xy.slice(0),this._w,this._h)},toRect3D:function(){return new TentaGL.Math.Rect3D([this._xy[0],this._xy[1],0],this._w,this._h,0)},xy:function(c){void 0!==c&&(this._xy=c);return this._xy},x:function(c){void 0!==c&&(this._xy[0]=c);return this._xy[0]},y:function(c){void 0!==c&&(this._xy[1]=c);return this._xy[1]},width:function(c){void 0!==c&&(this._w=c);return this._w},height:function(c){void 0!==
c&&(this._h=c);return this._h},xywh:function(c){void 0!==c&&(this._xy=c.slice(0,2),this._w=c[2],this._h=c[3]);return[this._xy[0],this._xy[1],this._w,this._h]},containsPt:function(c){return!(c[0]<this._xy[0]||c[1]<this._xy[1]||c[0]>this._xy[0]+this._w||c[1]>this._xy[1]+this._h)},getBounds2D:function(){return this.clone()},intersection:function(c){if(this.intersectsRect(c)){var d=Math.max(this._xy[0],c._xy[0]),e=Math.min(this._xy[0]+this._w,c._xy[0]+c._w),f=Math.max(this._xy[1],c._xy[1]);c=Math.min(this._xy[1]+
this._h,c._xy[1]+c._h);return new TentaGL.Math.Rect2D([d,f],e-d,c-f)}},intersectsRect:function(c){return!(this._xy[0]>c._xy[0]+c._w||this._xy[0]+this._w<c._xy[0]||this._xy[1]>c._xy[1]+c._h||this._xy[1]+this._h<c._xy[1])},intersectsLine:function(c){if(this.containsPt(c.getPt1())||this.containsPt(c.getPt2()))return!0;var d=this._xy[1]+this._h,e=this._xy[1],f=this._xy[0],g=this._xy[0]+this._w;return c.intersects(new TentaGL.Math.Line2D([f,d],[g,d]))||c.intersects(new TentaGL.Math.Line2D([f,e],[g,e]))||
c.intersects(new TentaGL.Math.Line2D([f,d],[f,e]))||c.intersects(new TentaGL.Math.Line2D([g,d],[g,e]))},render:function(c,d){TentaGL.ViewTrans.push(c);d&&TentaGL.MaterialLib.use(c,d);TentaGL.ViewTrans.translate(c,this._xy);TentaGL.ViewTrans.scale(c,[this._w,this._h]);TentaGL.ModelLib.render(c,"unitPlane");TentaGL.ViewTrans.pop(c)}};Util.Inheritance.inherit(TentaGL.Math.Rect2D,TentaGL.Math.Shape2D);
TentaGL.Math.Triangle2D=function(c,d,e){this._a=vec2.copy([],c);this._b=vec2.copy([],d);this._c=vec2.copy([],e);this._updateMetrics()};
TentaGL.Math.Triangle2D.prototype={constructor:TentaGL.Math.Triangle2D,isaTriangle2D:!0,_updateMetrics:function(){this._angleA=this._computeAngle(this._a,this._b,this._c);this._angleB=this._computeAngle(this._b,this._a,this._c);this._angleC=this._computeAngle(this._c,this._a,this._b);this._lenA=vec2.dist(this._b,this._c);this._lenB=vec2.dist(this._a,this._c);this._lenC=vec2.dist(this._a,this._b)},_computeAngle:function(c,d,e){d=vec2.sub([],d,c);vec2.normalize(d,d);c=vec2.sub([],e,c);vec2.normalize(c,
c);return Math.acos(vec2.dot(d,c))},ptA:function(c){c&&(this._a=vec2.copy([],c),this._updateMetrics());return this._a.slice(0)},ptB:function(c){c&&(this._b=vec2.copy([],c),this._updateMetrics());return this._b.slice(0)},ptC:function(c){c&&(this._c=vec2.copy([],c),this._updateMetrics());return this._c.slice(0)},getAngleA:function(){return this._angleA},getAngleB:function(){return this._angleB},getAngleC:function(){return this._angleC},getSideA:function(){return new TentaGL.Math.Line2D(this._b,this._c)},
getSideB:function(){return new TentaGL.Math.Line2D(this._a,this._c)},getSideC:function(){return new TentaGL.Math.Line2D(this._a,this._b)},getLengthA:function(){return this._lenA},getLengthB:function(){return this._lenB},getLengthC:function(){return this._lenC},getPerimeter:function(){return this._lenA+this._lenB+this._lenC},getArea:function(){var c=this.getPerimeter()/2;return Math.sqrt(c*(c-this._lenA)*(c-this._lenB)*(c-this._lenC))},containsPt:function(c){c=vec3.sub([],c,this._a);var d=vec3.sub([],
this._b,this._a),e=vec3.sub([],this._c,this._a),f=[],f=f.concat(d),f=f.concat(e);mat2.invert(f,f);vec2.transformMat2(c,c,f);c=c[0]+c[1];return 0<=c&&1>=c},getBounds2D:function(){var c=Math.min(this._a[0],this._b[0],this._c[0]),d=Math.max(this._a[0],this._b[0],this._c[0])-c,e=Math.min(this._a[1],this._b[1],this._c[1]),f=Math.max(this._a[1],this._b[1],this._c[1])-e;return new TentaGL.Math.Rect2D([c,e],d,f)},render:function(c,d){var e=vec2.copy([],this._a);e[2]=0;var f=vec2.copy([],this._b);f[2]=0;var g=
vec2.copy([],this._c);g[2]=0;var k=vec2.sub([],this._b,this._a),l=vec2.sub([],this._c,this._a),k=vec2.cross([],k,l),l=new TentaGL.Model(GL_TRIANGLES,GL_NONE),e=new TentaGL.Vertex(e);e.normal(k);e.texST([0,0]);l.addVertex(e);f=new TentaGL.Vertex(f);f.normal(k);f.texST([1,0]);l.addVertex(f);g=new TentaGL.Vertex(g);g.normal(k);g.texST([.5,1]);l.addVertex(g);l.addFace(0,1,2);l.render(c,d)}};Util.Inheritance.inherit(TentaGL.Math.Triangle2D,TentaGL.Math.Shape2D);TentaGL.Math.Shape3D=function(){};
TentaGL.Math.Shape3D.prototype={constructor:TentaGL.Math.Shape3D,isaShape3D:!0,containsPt:function(c,d){},getBounds3D:function(){},render:function(c,d){}};Util.Inheritance.inherit(TentaGL.Math.Shape3D,TentaGL.Renderable);TentaGL.Math.Line3D=function(c,d){this._p1=vec3.clone(c);this._p1[3]=1;this._p2=vec3.clone(d);this._p2[3]=1;this._length=vec3.dist(c,d)};
TentaGL.Math.Line3D.prototype={constructor:TentaGL.Math.Line3D,isaLine3D:!0,clone:function(){return new TentaGL.Math.Line3D(this._p1,this._p2)},getPt1:function(){return this._p1},getPt2:function(){return this._p2},getLength:function(){return this._length},getVec3:function(){return vec3.sub([],this._p2,this._p1)},getQuat:function(){var c=this.getVec3();return TentaGL.Math.getQuatFromTo([1,0,0],c)},distToPt:function(c){var d=this.getVec3(),e=vec3.sub(vec3.create(),c,this._p1);c=vec3.sub(vec3.create(),
c,this._p2);if(0>=vec3.dot(d,e))return vec3.len(e);if(0<=vec3.dot(d,c))return vec3.len(c);d=vec3.normalize(vec3.create(),d);c=vec3.normalize(vec3.create(),e);d=vec3.cross(vec3.create(),d,c);return vec3.len(e)*vec3.len(d)},distToLine:function(c){var d=vec4.clone(this._p1),e=this.getVec3(),f=vec4.clone(c._p1);f[3]=1;c=c.getVec3();var g=TentaGL.Math.getQuatFromTo(e,[1,0,0]),g=mat4.fromQuat(mat4.create(),g),k=mat4.create();mat4.translate(k,k,vec3.negate([],d));var l=mat4.create(),m=1/vec3.length(e);mat4.scale(l,
l,[m,m,m]);m=mat4.mul(mat4.create(),g,k);mat4.mul(m,l,m);var p=vec4.transformMat4(vec4.create(),f,m),n=vec3.transformMat4(vec3.create(),c,m);console.log(e,c,f,m,k,l,g,vec3.length(e));m=mat2.create();m[0]=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];m[1]=n[0];m[2]=n[0];m[3]=1;mat2.invert(m,m);g=vec2.fromValues(-vec3.dot(p,n),-p[0]);g=vec2.transformMat2(vec2.create(),g,m);d=vec3.add(vec3.create(),d,vec3.scale(vec3.create(),e,g[1]));f=vec3.add(vec3.create(),f,vec3.scale(vec3.create(),c,g[0]));return vec3.dist(d,f)},
containsPt:function(c,d){d||(d=0);return this.distToPt(c)<=d},getBounds3D:function(){var c,d;this._p1[0]<=this._p2[0]?(c=this._p1[0],d=this._p2[0]):(c=this._p2[0],d=this._p1[0]);var e,f;this._p1[1]<=this._p2[1]?(e=this._p1[1],f=this._p2[1]):(e=this._p2[1],f=this._p1[1]);var g,k;this._p1[2]<=this._p2[2]&&(g=this._p1[2],k=this._p2[2]);return new TentaGL.Math.Rect3D([c,e,g],d-c,f-e,k-g)},render:function(c,d){var e=vec3.clone(this._p1);vec3.clone(this._p2);var f=this.getVec3();TentaGL.ViewTrans.push(c);
TentaGL.ViewTrans.translate(c,e);TentaGL.ViewTrans.scale(c,f);TentaGL.ViewTrans.updateMVPUniforms(c);d&&TentaGL.MaterialLib.use(c,d);TentaGL.ModelLib.render(c,"unitLine");TentaGL.ViewTrans.pop(c)}};Util.Inheritance.inherit(TentaGL.Math.Line3D,TentaGL.Math.Shape3D);TentaGL.Math.Plane=function(c,d){d||(d=[0,0,0]);this._normal=vec3.clone(c);this._nHat=vec3.normalize(vec3.create(),this._normal);this._pt=vec3.clone(d)};
TentaGL.Math.Plane.prototype={constructor:TentaGL.Math.Plane,isaInfinitePlane:!0,getNormal:function(){return this._normal},getUnitNormal:function(){return this._nHat},getPoint:function(){return this._pt},distToPt:function(c){var d=vec3.sub([],c,this._pt);c=vec3.len(d);if(0==c)return 0;d=vec3.normalize(vec3.create(),d);d=vec3.dot(d,this._nHat);return Math.abs(c*d)},getCoefficients:function(){var c=this._normal[0],d=this._normal[1],e=this._normal[2];return[c,d,e,-c*this._pt[0]-d*this._pt[1]-e*this._pt[2]]},
getParallelVectors:function(){var c=this._pt,d;if(0==this._normal[0])d=[c[0]+1,c[1],c[2]];else if(0==this._normal[1])d=[c[0],c[1]+1,c[2]];else if(0==this._normal[2])d=[c[0],c[1],c[2]+1];else{d=this.getCoefficients();var e=c[0]+1;d=[e,0,(-d[0]*e-d[3])/d[2]]}c=vec3.sub([],d,c);d=vec3.cross([],c,this._normal);return[c,d]},containsPt:function(c,d){d||(d=0);var e=this.getCoefficients();return Math.abs(e[0]*c[0]+e[1]*c[1]+e[2]*c[2]+e[3])<d},ptRelative:function(c){c=vec3.sub([],c,this._pt);vec3.normalize(c,
c);c=vec3.dot(this._nHat,c);return 0<c?1:0>c?-1:0},ptIsAbove:function(c){return 1==ptRelative(c)},ptIsBelow:function(c){return-1==ptRelative(c)},lineIntersection:function(c){var d=this.getPoint(),e=c.getPt1(),f=this.getNormal(),g=c.getVec3(),d=vec3.dot(f,vec3.sub([],d,e)),f=vec3.dot(f,g);if(0==f){if(0==d)return c}else return c=d/f,vec4.fromValues(e[0]+c*g[0],e[1]+c*g[1],e[2]+c*g[2],1)},segmentIntersection:function(c){var d=this.getPoint(),e=c.getPt1(),f=this.getNormal(),g=c.getVec3(),d=vec3.dot(f,
vec3.sub(vec3.create(),d,e)),f=vec3.dot(f,g);if(0==f){if(0==d)return c}else if(c=d/f,c=vec4.fromValues(e[0]+c*g[0],e[1]+c*g[1],e[2]+c*g[2],1),e=0!=g[0]?(c[0]-e[0])/g[0]:0!=g[1]?(c[1]-e[1])/g[1]:(c[2]-e[2])/g[2],0<=e&&1>=e)return c},getBounds3D:function(){},getQuad:function(){var c=this.getParallelVectors();return new TentaGL.Math.Quad(this._pt,c[0],c[1])},render:function(c,d){TentaGL.ViewTrans.push(c);d&&TentaGL.MaterialLib.use(c,d);var e=TentaGL.ViewTrans.getCamera(c).getViewVolumeCorners(c.canvas.width,
c.canvas.height),f=[];f.push(new TentaGL.Math.Line3D(e[0],e[1]));f.push(new TentaGL.Math.Line3D(e[1],e[2]));f.push(new TentaGL.Math.Line3D(e[2],e[3]));f.push(new TentaGL.Math.Line3D(e[3],e[0]));f.push(new TentaGL.Math.Line3D(e[4],e[5]));f.push(new TentaGL.Math.Line3D(e[5],e[6]));f.push(new TentaGL.Math.Line3D(e[6],e[7]));f.push(new TentaGL.Math.Line3D(e[7],e[4]));f.push(new TentaGL.Math.Line3D(e[0],e[4]));f.push(new TentaGL.Math.Line3D(e[1],e[5]));f.push(new TentaGL.Math.Line3D(e[2],e[6]));f.push(new TentaGL.Math.Line3D(e[3],
e[7]));for(var e=[],g=0;g<f.length;g++){var k=this.segmentIntersection(f[g]);void 0===k||k.isaLine3D||e.push(k)}if(2<e.length){f=new TentaGL.Model(GL_TRIANGLES,GL_NONE);k=this.getParallelVectors();for(g=0;g<e.length;g++){var l=new TentaGL.Vertex(e[g]);l.normal(this._normal);l.texST([0,0]);f.addVertex(l)}var l=[],m=mat4.create();mat4.translate(m,m,vec3.negate([],this._pt));g=TentaGL.Math.getQuatFromTo(this._normal,[0,0,1]);mat4.mul(m,mat4.fromQuat([],g),m);for(g=0;g<e.length;g++)l.push(vec3.transformMat4([],
e[g],m)),l[g][2]=0,l[g][3]=g;for(var p=[0,0,0],g=0;g<l.length;g++)vec3.add(p,p,vec3.scale([],l[g],1/l.length));l.sort(function(c,d){var e=vec3.sub([],c,p),f=vec3.cross([],[1,0,0],e)[2],e=TentaGL.Math.vectorAngle([1,0,0],e);0>f&&(e=TentaGL.TAU-e);var g=vec3.sub([],d,p),f=vec3.cross([],[1,0,0],g)[2],g=TentaGL.Math.vectorAngle([1,0,0],g);0>f&&(g=TentaGL.TAU-g);return g-e});for(g=2;g<l.length;g++)f.addFace(l[0][3],l[g-1][3],l[g][3]);for(g=0;g<e.length;g++)l=f.getVertex(g),l.tangental([k[0]]);f.render(c)}TentaGL.ViewTrans.pop(c)}};
Util.Inheritance.inherit(TentaGL.Math.Plane,TentaGL.Math.Shape3D);TentaGL.Math.Quad=function(c,d,e){this._pts=[];this._pts[0]=c;this._u=d;this._v=e;this._update()};
TentaGL.Math.Quad.prototype={constructor:TentaGL.Math.Quad,isaQuad:!0,_update:function(){this._pts[1]=vec3.add(vec3.create(),this._pts[0],this._u);this._pts[2]=vec3.add(vec3.create(),this._pts[1],this._v);this._pts[3]=vec3.add(vec3.create(),this._pts[0],this._v);this._n=vec3.cross(vec3.create(),this._u,this._v);vec3.normalize(this._n,this._n);this._initModel()},_initModel:function(){this._model=new TentaGL.Model(GL_TRIANGLES,GL_NONE);var c=new TentaGL.Vertex(this._pts[0]);c.normal(this._n);c.texST([0,
0]);this._model.addVertex(c);c=new TentaGL.Vertex(this._pts[1]);c.normal(this._n);c.texST(1,0);this._model.addVertex(c);c=new TentaGL.Vertex(this._pts[2]);c.normal(this._n);c.texST(1,1);this._model.addVertex(c);c=new TentaGL.Vertex(this._pts[3]);c.normal(this._n);c.texST(0,1);this._model.addVertex(c);this._model.addFaceQuad(0,1,2,3)},getPt:function(c){c=TentaGL.Math.clamp(c,0,3);return this._pts[c]},pt:function(c){void 0!==xy&&(this._pts[0]=c,this._update());return this._pts[0]},u:function(c){void 0!==
c&&(this._u=c,this._update());return this._u},v:function(c){void 0!==c&&(this._v=c,this._update());return this._v},containsPt:function(c,d){d||(d=0);var e=mat3.create(),f=this._pts[0];e[0]=this._u[0];e[1]=this._u[1];e[2]=this._u[2];e[3]=this._v[0];e[4]=this._v[1];e[5]=this._v[2];e[6]=f[0];e[7]=f[1];e[8]=f[2];f=mat3.invert(mat3.create(),e);e=vec3.create();vec3.transformMat3(e,c,f);var f=e[0],g=e[1];return 0<=f&&1>=f&&0<=g&&1>=g&&Math.abs(e[2]-1)<=d},getBounds3D:function(){for(var c=this._pts[0][0],
d=this._pts[0][0],e=this._pts[0][1],f=this._pts[0][1],g=this._pts[0][2],k=this._pts[0][2],l=1;3>=l;l++){var m=this._pts[l];m[0]<c&&(c=m[0]);m[0]>d&&(d=m[0]);m[1]<f&&(f=m[1]);m[1]>e&&(e=m[1]);m[2]<k&&(k=m[2]);m[2]>g&&(g=m[2])}return new TentaGL.Math.Rect3D([c,f,k],d-c,e-f,g-k)},render:function(c,d){d&&TentaGL.MaterialLib.use(c,d);this._model.render(c)}};Util.Inheritance.inherit(TentaGL.Math.Quad,TentaGL.Math.Shape3D);
TentaGL.Math.Rect3D=function(c,d,e,f){this._pt=c.slice(0);this._w=d;this._h=e;this._d=f};
TentaGL.Math.Rect3D.prototype={constructor:TentaGL.Math.Rect3D,isaRect3D:!0,clone:function(){return new TentaGL.Math.Rect3D(this._pt,this._w,this._h,this._d)},xyz:function(c){void 0!==c&&(this._pt=c.slice(0));return c.slice(0)},x:function(c){void 0!==c&&(this._pt[0]=c);return this._pt[0]},y:function(c){void 0!==c&&(this._pt[1]=c);return this._pt[1]},z:function(c){void 0!==c&&(this._pt[2]=c);return this._pt[2]},width:function(c){void 0!==c&&(this._w=c);return this._w},height:function(c){void 0!==c&&
(this._h=c);return this._h},depth:function(c){void 0!==c&&(this._d=c);return this._d},getEdges:function(){var c=[],d=this._pt[0],e=this._pt[1],f=this._pt[2],g=d+this._w,k=e+this._h,l=f+this._d;c.push(new TentaGL.Math.Line3D([d,e,f],[g,e,f]));c.push(new TentaGL.Math.Line3D([d,e,f],[d,k,f]));c.push(new TentaGL.Math.Line3D([d,e,f],[d,e,l]));c.push(new TentaGL.Math.Line3D([d,k,f],[g,k,f]));c.push(new TentaGL.Math.Line3D([d,k,f],[d,k,l]));c.push(new TentaGL.Math.Line3D([g,e,f],[g,k,f]));c.push(new TentaGL.Math.Line3D([d,
e,l],[d,k,l]));c.push(new TentaGL.Math.Line3D([d,e,l],[g,e,l]));c.push(new TentaGL.Math.Line3D([g,e,f],[g,e,l]));c.push(new TentaGL.Math.Line3D([g,k,l],[d,k,l]));c.push(new TentaGL.Math.Line3D([g,k,l],[g,e,l]));c.push(new TentaGL.Math.Line3D([g,k,l],[g,k,f]));return c},containsPt:function(c,d){return!(c[0]<this.x()||c[0]>this.x()+this.width()||c[1]<this.y()||c[1]>this.y()+this.height()||c[2]<this.z()||c[2]>this.z()+this.depth())},getBounds3D:function(){return this.clone()},render:function(c,d){TentaGL.ViewTrans.push(c);
d&&TentaGL.MaterialLib.use(c,d);TentaGL.ViewTrans.translate(c,this._pt);TentaGL.ViewTrans.scale(c,[this._w,this._h,this._d]);TentaGL.ModelLib.render(c,"unitCube");TentaGL.ViewTrans.pop(c)}};Util.Inheritance.inherit(TentaGL.Math.Rect3D,TentaGL.Math.Shape3D);TentaGL.Math.Sphere=function(c,d){d||(d=[0,0,0]);this._pt=vec3.clone(d);this._radius=c};
TentaGL.Math.Sphere.prototype={constructor:TentaGL.Math.Sphere,isaSphere:!0,clone:function(){return new TentaGL.Math.Sphere(this._radius,this._pt)},getRadius:function(){return this._radius},getPoint:function(){return this._pt},distToPt:function(c){c=vec3.sub(vec3.create(),c,this._pt);return Math.abs(vec3.len(c)-this._radius)},containsPt:function(c){c=vec3.sub(vec3.create(),c,this._pt);return vec3.len(c)<=this._radius},getBounds3D:function(){var c=2*this._radius;return new TentaGL.Math.Rect3D([this._pt[0]-
this._radius,this._pt[1]-this._radius,this._pt[2]-this._radius],c,c,c)},surfaceContainsPt:function(c,d){d||(d=0);var e=vec3.sub(vec3.create(),c,this._pt);return Math.abs(vec3.len(e)-this._radius)<=d},intersectsSphere:function(c){var d=vec3.sqrDist(this._pt,c._pt);c=this._radius+c._radius;return d<=c*c},intersectsPlane:function(c){return c.distToPt(this._pt)<=this._radius},render:function(c,d){var e=vec3.clone(this._pt),f=this._radius;TentaGL.ViewTrans.push(c);var g=mat4.create();mat4.translate(g,
g,e);mat4.scale(g,g,[f,f,f]);TentaGL.ViewTrans.mul(c,g);TentaGL.ViewTrans.updateMVPUniforms(c);d&&TentaGL.MaterialLib.use(c,d);TentaGL.ModelLib.render(c,"unitSphere");TentaGL.ViewTrans.pop(c)}};Util.Inheritance.inherit(TentaGL.Math.Sphere,TentaGL.Math.Shape3D);
TentaGL.Application=function(c,d){console.log("TentaGL version "+TentaGL.versionMajor+"."+TentaGL.versionMinor);this._container=c;var e=TentaGL.createCanvas(c);this._gl=TentaGL.createGL(e,d);this._canvas=this._gl.canvas;this._keyboard=new TentaGL.Keyboard(c);this._mouse=new TentaGL.Mouse(e);this._picker=new TentaGL.Picker(this);this._levelManager=new TentaGL.LevelManager;c.onresize=function(){console.log(c.offsetWidth,c.offsetHeight)};this._resizeListeners=[]};
TentaGL.Application.prototype={construct:TentaGL.Application,start:function(){this.initResources();this.run(0)},initResources:function(){var c=this.getGL();TentaGL.ShaderLib.reset(c);TentaGL.ModelLib.reset(c);TentaGL.MaterialLib.reset(c);this.initShaders();this.initMaterials();this.initModels();this.reset()},run:function(c){this._isRunning=!0;if(!(this._tryEndApp()||this._tryResetApp()||this.isPaused())){this._lastTimestamp||(this._lastFPSTimestamp=this._lastTimestamp=c,this._fpsCount=0);1E3<c-this._lastFPSTimestamp&&
(console.log("running. FPS: "+this._fpsCount),this._lastFPSTimestamp=c,this._fpsCount=0);var d=this.getGL();TentaGL.ViewTrans.reset(d);TentaGL.SceneNode.resetRenderFilter();this._keyboard.poll();this._mouse.poll();this.update();this._lastTimestamp=c;this._fpsCount++;this._nextFrameID=requestAnimationFrame(this.run.bind(this))}},_tryEndApp:function(){return this._endFlag?(console.log("Ending application"),this._isRunning=this._endFlag=!1,!0):!1},_tryResetApp:function(){return this._hardResetFlag?(console.log("Reseting application"),
this._hardResetFlag=!1,this.start(),!0):!1},isPaused:function(){return this._isPaused},isRunning:function(){return this._isRunning},end:function(){this._endFlag=!0},hardReset:function(){this._hardResetFlag=!0},setPaused:function(c){c?this._isPaused=!0:this._isPaused&&(this._isPaused=!1,this._isRunning&&this.run(0))},setLevel:function(c){this._levelManager.set(c)},getLevel:function(){return this._levelManager.get()},getLevelManager:function(){return this._levelManager},getContainer:function(){return this._container},
getCanvas:function(){return this._canvas},getGL:function(){return this._gl},getPicker:function(){return this._picker},getWidth:function(){return this._canvas.offsetWidth},getHeight:function(){return this._canvas.offsetHeight},getAspectRatio:function(){return this.getWidth()/this.getHeight()},resize:function(c,d){var e=this.getCanvas(),f=this.getContainer(),g=this.getWidth(),k=this.getHeight();e.width=c;e.height=d;TentaGL.Viewport.xywh(this.getGL(),[0,0,c,d]);f.style.width=c;f.style.height=d;var e=
new TentaGL.AppResizeEvent(this,c,d,g,k),l;for(l in this._resizeListeners)this._resizeListeners[l].handleAppResizeEvent(e)},addAppResizeListener:function(c){this._resizeListeners.push(c)},removeAppResizeListener:function(c){c=this._resizeListeners.indexOf(c);if(-1==c)throw Error("Failed to unsubscribe AppResizeListener.");this._resizeListeners.splice(c,1)},keyboard:function(){return this._keyboard},mouse:function(){return this._mouse},initShaders:function(){},initMaterials:function(){},initModels:function(){},
reset:function(){},update:function(){}};TentaGL.Level=function(c){this._app=c};TentaGL.Level.prototype={constructor:TentaGL.Level,isaLevel:!0,getApp:function(){return this._app},keyboard:function(){return this._app.keyboard()},mouse:function(){return this._app.mouse()},picker:function(){return this._app.getPicker()},clean:function(c){},reset:function(c){},update:function(c){},render:function(c){}};TentaGL.LevelManager=function(){this._nextLevel=this._curLevel=void 0};
TentaGL.LevelManager.prototype={constructor:TentaGL.LevelManager,isaLevelManager:!0,get:function(){return this._curLevel},set:function(c){this._nextLevel=c},run:function(c){this._nextLevel&&(this._curLevel&&this._curLevel.clean(c),this._nextLevel.reset(c),this._curLevel=this._nextLevel,this._nextLevel=void 0);this._curLevel.update(c);this._curLevel.render(c)}};
TentaGL.AudioLoader={_numLoading:0,load:function(c,d,e){var f=this;this._numLoading++;e||(e=function(){f._numLoading--;throw Error("Could not load image at "+c+".");});var g=new Audio;g.onloadeddata=function(){d(g);f._numLoading--};g.src=c;g.load()},isLoading:function(){return 0<this._numLoading}};TentaGL.Camera=function(){};
TentaGL.Camera.prototype={constructor:TentaGL.Camera,getTransform:function(c){return mat4.mul(mat4.create(),this.getProjectionTransform(c),this.getViewTransform())},getViewTransform:function(){return mat4.create()},getProjectionTransform:function(c){return mat4.create()}};TentaGL.Camera2D=function(c,d,e,f){void 0==f&&(f=!0);this._yFlipped=f;this._eye=[c[0],c[1]];this._width=d;this._height=e;this._anchor=[Math.floor(this._width/2),Math.floor(this._height/2)];this._angle=0;this._zoom=1};
TentaGL.Camera2D.prototype={constructor:TentaGL.Camera2D,isYFlipped:function(){return this._yFlipped},eye:function(c){void 0!==c&&(this._eye=vec2.copy([],c));return this._eye},getWidth:function(){return this._width},getHeight:function(){return this._height},anchor:function(c){void 0!==c&&(this._anchor=vec2.copy([],c));return this._anchor},moveAnchor:function(c){var d=[c[0]-this._anchor[0],c[1]-this._anchor[1]],e=mat4.invert(mat4.create(),this._getRotateScaleTransform());dfWorld=vec2.transformMat4(vec2.create(),
d,e);this._eye[0]+=dfWorld[0];this._eye[1]+=dfWorld[1];this._anchor[0]=c[0];this._anchor[1]=c[1]},angle:function(c){void 0!==c&&(this._angle=c);return this._angle},zoom:function(c){void 0!==c&&(this._zoom=c);return this._zoom},controlWithMouse:function(c,d,e){var f=c.getX()*this.getWidth()/d,g=c.getY()*this.getHeight()/e;this._yFlipped||(g=this.getHeight()-g);if(0<c.scrollUpAmount()){this.moveAnchor([f,g]);for(var k=0;k<c.scrollUpAmount();k++)this.zoom(10*this.zoom()/9)}if(0<c.scrollDownAmount())for(this.moveAnchor([f,
g]),k=0;k<c.scrollDownAmount();k++)this.zoom(9*this.zoom()/10);c.isLeftPressed()&&this.drag(c.getXY(),d,e);c.justLeftReleased()&&this.endDrag()},drag:function(c,d,e){this._yFlipped||(c[1]=e-c[1]);this._dragPrev||this._updatePrevDragPt(c,d,e);var f=this.screenToWorld(c,d,e),g=this._dragPrev[1]-f[1];this._eye[0]=this._dragEyeStart[0]+(this._dragPrev[0]-f[0]);this._eye[1]=this._dragEyeStart[1]+g;f=c[0]*this.getWidth()/d;g=c[1]*this.getHeight()/e;this.moveAnchor([f,g]);this._updatePrevDragPt(c,d,e)},
_updatePrevDragPt:function(c,d,e){this._dragPrev=this.screenToWorld(c,d,e);this._dragEyeStart=vec2.clone(this._eye)},endDrag:function(){this._dragEyeStart=this._dragPrev=void 0},_getRotateScaleTransform:function(){var c=mat4.create(),d=mat4.create();mat4.rotateZ(d,d,this._angle);mat4.mul(c,d,c);d=mat4.create();mat4.scale(d,d,[this._zoom,this._zoom,1]);mat4.mul(c,d,c);return c},getViewTransform:function(){var c=mat4.create(),d=mat4.create();mat4.translate(d,d,[-this._eye[0],-this._eye[1],0]);mat4.mul(c,
d,c);d=this._getRotateScaleTransform();mat4.mul(c,d,c);d=mat4.create();mat4.translate(d,d,[this._anchor[0],this._anchor[1],0]);mat4.mul(c,d,c);return c},getProjectionTransform:function(){var c=mat4.create();c[0]=2/this.getWidth();c[5]=2/this.getHeight();c[12]=-1;this._yFlipped?(c[5]*=-1,c[13]=1):c[13]=-1;return c},screenToWorld:function(c,d,e){c=[c[0],c[1]];c[0]*=this.getWidth()/d;c[1]*=this.getHeight()/e;d=this.getViewTransform();mat4.invert(d,d);vec2.transformMat4(c,c,d);return c},worldToScreen:function(c,
d,e){result=[c[0],c[1]];c=this.getViewTransform();vec2.transformMat4(result,result,c);result[0]*=d/this.getWidth();result[1]*=e/this.getHeight();return result}};Util.Inheritance.inherit(TentaGL.Camera2D,TentaGL.Camera);
TentaGL.Camera3D=function(c,d,e){this._eye=vec3.copy([],c);void 0===d&&(d=[0,0,0]);this._center=vec3.copy([],d);void 0===e&&(e=[0,1,0]);this._up=vec3.copy([],e);this._correctUpVector();this._mode=TentaGL.Camera3D.PERSP;this._fovBase=TentaGL.TAU/8;this._znear=this._zoom=1;this._zfar=1E3};TentaGL.Camera3D.PERSP=1;TentaGL.Camera3D.ORTHO=2;
TentaGL.Camera3D.prototype={constructor:TentaGL.Camera3D,_correctUpVector:function(){var c=this.getLookVector(),d=vec3.cross(vec3.create(),c,this._up);vec3.cross(this._up,d,c);vec3.normalize(this._up,this._up)},eye:function(c){void 0!==c&&(this._eye=vec3.copy([],c),this._correctUpVector());return this._eye},center:function(c){void 0!==c&&(this._center=vec3.copy([],c),this._correctUpVector());return this._center},getLook:function(){var c=this.getLookVector();return vec3.normalize(c,c)},getLookVector:function(){return vec3.sub([],
this._center,this._eye)},getDist:function(){return vec3.length(this.getLookVector())},setDist:function(c){var d=this.getLookVector();vec3.negate(d,d);vec3.scale(d,d,c/vec3.length(d));vec3.add(this._eye,this._center,d)},getUp:function(){return vec3.clone(this._up)},setUp:function(c){this._up=vec3.copy([],c);this._correctUpVector()},getRight:function(){var c=vec3.cross([],this.getLook(),this.getUp());vec3.normalize(c,c);return c},mode:function(c){if(void 0!==c){if(c!=TentaGL.Camera3D.PERSP&&c!=TentaGL.Camera3D.ORTHO)throw Error("Mode "+
c+" not supported.");this._mode=c}return this._mode},fovy:function(c){void 0!==c&&(this._fovBase=c);return this._fovBase},getZoomedFOVY:function(){return this._fovBase*this._zoom},zoom:function(c){if(void 0!==c){if(0>=c||1<c)throw Error("Invalid zoom value: "+c);this._zoom=c}return this._zoom},getZNear:function(){return this._znear},getZFar:function(){return this._zfar},setClippingPlanes:function(c,d){if(0>=c||d<=c)throw Error("Invalid values for zNear and zFar planes: "+zNear+", "+zFar);this._znear=
c;this._zfar=d},getTransform:function(c){return mat4.mul(mat4.create(),this.getProjectionTransform(c),this.getViewTransform())},getViewTransform:function(){return mat4.lookAt(mat4.create(),this._eye,this._center,this._up)},getProjectionTransform:function(c){return this._mode==TentaGL.Camera3D.PERSP?mat4.perspective(mat4.create(),this.getZoomedFOVY(),c,this.getZNear(),this.getZFar()):mat4.create()},projectToPlane:function(c,d,e,f){c=this.projectToClip(c,e,f);c=new TentaGL.Math.Line3D(c[0],c[1]);if((d=
d.lineIntersection(c))&&!d.isaLine3D)return d},projectToClip:function(c,d,e){var f=d/e;c=[(c[0]-d/2)/f,-1*(c[1]-e/2),0];vec3.scale(c,c,2/e);e=[c[0],c[1],-1,1];c=[c[0],c[1],1,1];f=this.getTransform(f);mat4.invert(f,f);vec4.transformMat4(e,e,f);vec4.transformMat4(c,c,f);e[3]=1/e[3];e[0]*=e[3];e[1]*=e[3];e[2]*=e[3];c[3]=1/c[3];c[0]*=c[3];c[1]*=c[3];c[2]*=c[3];return[e,c]},getViewVolumeCorners:function(c,d){var e=this.projectToClip([0,d],c,d),f=this.projectToClip([c,d],c,d),g=this.projectToClip([c,0],
c,d),k=this.projectToClip([0,0],c,d);return[e[0],f[0],g[0],k[0],e[1],f[1],g[1],k[1]]}};Util.Inheritance.inherit(TentaGL.Camera3D,TentaGL.Camera);
TentaGL.ArcballCamera=function(c,d,e){TentaGL.Camera3D.call(this,c,d,e);c=this.getLookVector();this._dist=this._origDist=vec3.length(c);this._origLook=vec3.normalize([],c);this._origCenter=vec3.clone(this._center);this._origUp=vec3.clone(this._up);this._origRight=vec3.cross([],this._origLook,this._origUp);this._orientation=TentaGL.Math.getOrientation([0,0,-1],[0,1,0],this._origLook,this._origUp);this._origOrientation=quat.clone(this._orientation)};
TentaGL.ArcballCamera.prototype={constructor:TentaGL.ArcballCamera,projectMouseToUnitSphere:function(c,d,e){var f=1/(Math.max(e,d)/2);c=[c[0]-d/2,-1*(c[1]-e/2),0];vec3.scale(c,c,f);1<vec3.length(c)&&vec3.normalize(c,c);f=1-(c[0]*c[0]+c[1]*c[1]);c[2]=0>f?0:Math.sqrt(f);return c},getEye:function(){var c=this.getLook();vec3.negate(c,c);vec3.scale(c,c,this._dist);return vec3.add(this._eye,this._center,c)},getLook:function(){var c=mat4.invert(mat4.create(),mat4.fromQuat(mat4.create(),quat.invert(quat.create(),
this._orientation))),c=vec3.transformMat4([],[0,0,-1],c);return vec3.normalize(c,c)},getUp:function(){var c=mat4.invert(mat4.create(),mat4.fromQuat(mat4.create(),quat.invert(quat.create(),this._orientation))),c=vec3.transformMat4([],[0,1,0],c);vec3.normalize(c,c);return c},getRight:function(){var c=mat4.invert(mat4.create(),mat4.fromQuat(mat4.create(),quat.invert(quat.create(),this._orientation))),c=vec3.transformMat4([],[1,0,0],c);return vec3.normalize(c,c)},getOrientation:function(){return quat.clone(this._orientation)},
setOrientation:function(c){this._orientation=c},dist:function(c){void 0!==c&&(this._dist=c);return this._dist},controlWithMouse:function(c,d,e){if(0<c.scrollUpAmount())for(var f=0;f<c.scrollUpAmount();f++)this.dist(9*this.dist()/10);if(0<c.scrollDownAmount())for(f=0;f<c.scrollDownAmount();f++)this.dist(10*this.dist()/9);c.justLeftPressed()&&(this._preVec=this.projectMouseToUnitSphere(c.getXY(),d,e),this._preOrientation=quat.clone(quat.invert(quat.create(),this._orientation)));if(c.isLeftPressed()||
c.justLeftReleased())f=this.projectMouseToUnitSphere(c.getXY(),d,e),f=TentaGL.Math.getQuatFromTo(this._preVec,f),quat.mul(this._orientation,f,this._preOrientation),quat.invert(this._orientation,this._orientation);c.justRightPressed()&&(this._prePan=this._getPanPoint(c.getXY(),d,e),this._preCenter=vec3.clone(this._center));c.isRightPressed()&&(this._center=vec3.clone(this._preCenter),this._curPan=this._getPanPoint(c.getXY(),d,e),c=vec3.sub([],this._prePan,this._curPan),d=mat4.create(),mat4.translate(d,
d,c),vec3.transformMat4(this._center,this._preCenter,d))},_getPanPoint:function(c,d,e){var f=new TentaGL.Math.Plane(this.getLook(),this.center());return this.projectToPlane(c,f,d,e)},resetOrientation:function(){this._center=vec3.clone(this._origCenter);this._dist=this._origDist;this._orientation=quat.clone(this._origOrientation)},getViewTransform:function(){var c=mat4.create();mat4.translate(c,c,[0,0,0-this._dist]);var c=mat4.mul(mat4.create(),c,mat4.fromQuat(mat4.create(),quat.invert(quat.create(),
this._orientation))),d=mat4.create();mat4.translate(d,d,vec3.negate([],this._center));return c=mat4.mul(c,c,d)}};Util.Inheritance.inherit(TentaGL.ArcballCamera,TentaGL.Camera3D);TentaGL.Picker=function(c){this._app=c;this._bytes=new Uint8Array(4)};TentaGL.Picker.SHADER_ID="pickShader";TentaGL.Picker.isPicking=function(c){return c._isPicking};
TentaGL.Picker.prototype={constructor:TentaGL.Picker,update:function(c,d,e){this._pixels=void 0;this._origFilter=TentaGL.SceneNode.getRenderFilter();TentaGL.ShaderLib.push(c);TentaGL.Blend.setEnabled(c,!1);TentaGL.ColorBuffer.setClearColor(c,TentaGL.Color.RGBA(0,0,0,0));TentaGL.MaterialLib.useNone(c);TentaGL.ShaderLib.use(c,TentaGL.Picker.SHADER_ID);c._isPicking=!0;this._nextID=1;this._sprites=[];this._gl=c;TentaGL.SceneNode.setRenderFilter(this._filterFunction.bind(this));e&&(d(c),TentaGL.MaterialLib.useNone(c),
this._nextID=1);e=this._app.getWidth();var f=this._app.getHeight(),g=e*f*4;g>this._bytes.length&&(this._bytes=new Uint8Array(g));g=new TentaGL.BufferTexture(c,e,f);g.renderToMe(c,d);this._pixels=g.getPixelData(c,0,0,e,f,this._bytes);g.clean(c);c._isPicking=!1;TentaGL.ShaderLib.pop(c);TentaGL.SceneNode.setRenderFilter(this._origFilter)},_filterFunction:function(c){if(this._origFilter(c)){var d=this._nextID;this._nextID++;var e=new TentaGL.Color.Hex(d);this._sprites[d]=c;c=e.rgba();TentaGL.ShaderLib.current(this._gl).setPickID(this._gl,
c);return!0}return!1},_getPixelAt:function(c,d,e){return this._pixels.getPixelAt(c,d,e)},getSpriteAt:function(c,d){if(this._pixels){var e=this._getPixelAt(c,d),e=TentaGL.Color.rgba2Hex(e[0],e[1],e[2],e[3]);return this._sprites[e]}},getSpriteAtMouse:function(c){var d=c.getX();c=this._app.getHeight()-c.getY();return this.getSpriteAt(d,c)}};TentaGL.AppResizeListener=function(){};TentaGL.AppResizeListener.prototype={constructor:TentaGL.AppResizeListener,isaAppResizeListener:!0,handleAppResizeEvent:function(c){}};
TentaGL.Event=function(c,d){this._source=c;this._type=d};TentaGL.Event.prototype={constructor:TentaGL.Event,getSource:function(){return this._source},getType:function(){return this._type}};TentaGL.AppResizeEvent=function(c,d,e,f,g){TentaGL.Event.call(this,c,0);this._width=d;this._height=e;this._oldWidth=f;this._oldHeight=g};
TentaGL.AppResizeEvent.prototype={constructor:TentaGL.AppResizeEvent,getWidth:function(){return this._width},getHeight:function(){return this._height},getOldWidth:function(){return this._oldWidth},getOldHeight:function(){return this._oldHeight}};Util.Inheritance.inherit(TentaGL.AppResizeEvent,TentaGL.Event);TentaGL.Model=function(c,d){c||(c=GL_TRIANGLES);d||(d=GL_NONE);this._mode=c;this._cull=d;this._vertices=[];this._indices=[]};
TentaGL.Model.prototype={constructor:TentaGL.Model,getDrawMode:function(){return this._mode},setDrawMode:function(c){this._mode=c},getCullMode:function(){return this._cull},setCullMode:function(c){this._cull=c},numIndices:function(){return this._indices.length},getIndices:function(){return this._indices.slice(0)},addVertex:function(c){this._vertices.push(c);return this},numVertices:function(){return this._vertices.length},getVertex:function(c){if(0>c||c>=this._vertices.length)throw Error("Index "+
c+" out of bounds.");return this._vertices[c]},getVertices:function(){return this._vertices.slice(0)},indexOfVertex:function(c){for(var d=0;d<this._vertices.length;d++)if(this._vertices[d]==c)return d;return-1},numLines:function(){return Math.floor(this._indices.length/2)},addLine:function(c,d){if(0>c||c>=this._vertices.length)throw Error("Index "+c+" out of bounds.");if(0>d||d>=this._vertices.length)throw Error("Index "+d+" out of bounds.");this._indices.push(c);this._indices.push(d);var e=this._vertices[c],
f=this._vertices[d];e.tangental(e.computeTangental(f,f));f.tangental(f.computeTangental(e,e))},addLineStrip:function(c){if(2>c.length)throw Error("Not enough indices in line strip array.");for(var d=c[0],e=1;e<c.length;e++)this.addLine(d,c[e])},addLineLoop:function(c){if(2>c.length)throw Error("Not enough indices in line strip array.");for(var d=c[0],e=1;e<c.length;e++)this.addLine(d,c[e]);this.addLine(c[c.length-1],c[0])},getLines:function(){for(var c=[],d=1;d<v.length;d+=2)c.push([this._indices[d-
1],this._indices[d]]);return c},numFaces:function(){return Math.floor(this._indices.length/3)},addFace:function(c,d,e){if(0>c||c>=this._vertices.length)throw Error("Index "+c+" out of bounds.");if(0>d||d>=this._vertices.length)throw Error("Index "+d+" out of bounds.");if(0>e||e>=this._vertices.length)throw Error("Index "+e+" out of bounds.");this._indices.push(c);this._indices.push(d);this._indices.push(e);c=this._vertices[c];d=this._vertices[d];e=this._vertices[e];c.tangental(c.computeTangental(d,
e));d.tangental(d.computeTangental(e,c));e.tangental(e.computeTangental(c,d))},addFaceQuad:function(c,d,e,f){this.addFace(c,d,e);this.addFace(c,e,f)},addFaceStrip:function(c){if(3>c.length)throw Error("Not enough indices in triangle strip array.");for(var d=!0,e=2;e<c.length;e++)d?this.addFace(c[e-2],c[e-1],c[e]):this.addFace(c[e-1],c[e-2],c[e]),d=!d},addFaceFan:function(c){if(3>c.length)throw Error("Not enough indices in triangle strip array.");for(var d=2;d<c.length;d++)this.addFace(c[0],c[d-1],
c[d])},getFaces:function(){if(void 0===this._faces){this._faces=[];for(var c=2;c<this._indices.length;c+=3)this._faces.push([this._indices[c-2],this._indices[c-1],this._indices[c]])}return this._faces},getFacesContainingVertex:function(c){for(var d=[],e=this.getFaces(),f=0;f<e.length;f++){var g=e[f];g[0]!=c&&g[1]!=c&&g[2]!=c||d.push(f)}return d},generateVertexNormals:function(){for(var c=this.getFaceNormals(),d=0;d<this._vertices.length;d++){for(var e=this._vertices[d],f=this.getFacesContainingVertex(d),
g=[0,0,0],k=0;k<f.length;k++)vec3.add(g,g,c[f[k]]);vec3.normalize(g,g);e.normal(g)}},generate2DTexCoordsSpherical:function(){for(var c=0;c<this._vertices.length;c++){var d=this._vertices[c],e=TentaGL.Math.toPolar(d.xyz()),f=TentaGL.Math.wrap(e[1],0,TentaGL.TAU),f=TentaGL.Math.linearMap(f,[0,TentaGL.TAU],[0,1]),e=TentaGL.Math.linearMap(e[2],[-Math.PI/2,Math.PI/2],[0,1]);d.texST([f,e])}},generateSurfaceTangentals:function(){if(this._mode==GL_LINES)for(var c=0;c<this._indices.length;c+=2){var d=this._indices[c],
e=this._indices[c+1],d=this._vertices[d],e=this._vertices[e];d.tangental(d.computeTangental(e,e));e.tangental(e.computeTangental(d,d))}else for(c=0;c<this._indices.length;c+=3){var d=this._indices[c],e=this._indices[c+1],f=this._indices[c+2],d=this._vertices[d],e=this._vertices[e],f=this._vertices[f];d.tangental(d.computeTangental(e,f));e.tangental(e.computeTangental(f,d));f.tangental(f.computeTangental(d,e))}},getFaceNormals:function(){if(void 0===this._faceNormals){this._faceNormals=[];for(var c=
2;c<this._indices.length;c+=3){var d=this._vertices[this._indices[c-2]],e=this._vertices[this._indices[c-1]],f=this._vertices[this._indices[c]],e=vec3.fromValues(e.getX()-d.getX(),e.getY()-d.getY(),e.getZ()-d.getZ()),d=vec3.fromValues(f.getX()-d.getX(),f.getY()-d.getY(),f.getZ()-d.getZ()),d=vec3.cross(vec3.create(),e,d);this._faceNormals.push(d)}}return this._faceNormals},getFaceNormal:function(c){if(0>c||c>=this.numFaces())throw Error("Face index out of bounds: "+c);return this.getFaceNormals()[c]},
getModelCentroid:function(){if(void 0===this._centroid){for(var c=0,d=0,e=0,f=0;f<this._vertices.length;f++)var g=this._vertices[f],c=c+g.getX(),d=d+g.getY(),e=e+g.getZ();c/=this._vertices.length;d/=this._vertices.length;e/=this._vertices.length;this._centroid=vec4.fromValues(c,d,e,1)}return this._centroid},getFaceCentroids:function(){if(void 0===this._faceCentroids){this._faceCentroids=[];for(var c=2;c<this._indices.length;c+=3){var d=this._vertices[this._indices[c-2]],e=this._vertices[this._indices[c-
1]],f=this._vertices[this._indices[c]],g=(d.getX()+e.getX()+f.getX())/3,k=(d.getY()+e.getY()+f.getY())/3,d=(d.getZ()+e.getZ()+f.getZ())/3;this._faceCentroids.push(vec4.fromValues(g,k,d,1))}}return this._faceCentroids},getFaceCentroid:function(c){if(0>c||c>=this.numFaces())throw Error("Face index out of bounds: "+c);return this.getFaceCentroids()[c]},clone:function(){return this.transform(mat4.create())},transform:function(c){for(var d=new TentaGL.Model,e=0;e<this._vertices.length;e++)d.addVertex(this._vertices[e].transform(c));
for(e=0;e<this._indices.length;e+=3)d.addFace(this._indices[e],this._indices[e+1],this._indices[e+2]);return d},cloneCentered:function(){var c=this.getModelCentroid();return this.transform(mat4.translate(mat4.create(),mat4.create(),[-c[0],-c[1],-c[2]]))},translate:function(c){var d=mat4.create();mat4.translate(d,d,c);return this.transform(d)},scale:function(c){var d=mat4.create();mat4.scale(d,d,c);return this.transform(d)},rotate:function(c,d){var e=quat.setAxisAngle(quat.create(),c,d);return this.transform(mat4.fromQuat(mat4.create(),
e))},scaleTexST:function(c,d){var e=this.clone(),f;for(f in e._vertices){var g=e._vertices[f],k=g.texST();g.texST([k[0]*c,k[1]*d])}return e},flipTexT:function(){var c=this.clone(),d;for(d in c._vertices){var e=c._vertices[d],f=e.texST();e.texST([f[0],1-f[1]])}return c},merge:function(c){for(var d=this.clone(),e=d.numVertices(),f=0;f<c._vertices.length;f++)d.addVertex(c._vertices[f]);for(f=0;f<c._indices.length;f+=3)d.addFace(e+c._indices[f],e+c._indices[f+1],e+c._indices[f+2]);return d},render:function(c,
d){d&&TentaGL.MaterialLib.use(c,d);var e=new TentaGL.VBOData(c,this);TentaGL.ViewTrans.updateMVPUniforms(c);e.render(c);e.clean(c)}};
TentaGL.Model.Cone=function(c,d,e){var f=new TentaGL.Model;e||(e=TentaGL.TAU/20);for(var g=Math.floor(TentaGL.TAU/e)+1,k=0;k<g;k++){var l=TentaGL.Math.toCartesian([c,k*e,0]),m=l[0],p=l[2],l=(m/c+1)/2,n=(p/c+1)/2,m=new TentaGL.Vertex([m,0,p]);m.normal([0,-1,0]);m.texST([l,n]);f.addVertex(m)}for(k=0;k<g;k++){var l=k*e,q=TentaGL.Math.toCartesian([c,l,0]),n=q[0],p=q[2],m=(k+.5)*e,t=TentaGL.Math.toCartesian([c,m,0]),r=t[0],w=t[2],q=vec3.sub(vec3.create(),[0,d,0],q),u=vec3.fromValues(n,0,p),u=vec3.cross(vec3.create(),
u,q),q=vec3.cross(vec3.create(),q,u);vec3.normalize(q,q);t=vec3.sub(vec3.create(),[0,d,0],t);r=vec3.fromValues(r,0,w);r=vec3.cross(vec3.create(),r,t);r=vec3.cross(vec3.create(),t,r);vec3.normalize(r,r);n=new TentaGL.Vertex([n,0,p]);n.texST([l/TentaGL.TAU,0]);n.normal(q);l=new TentaGL.Vertex([0,d,0]);l.texST([m/TentaGL.TAU,1]);l.normal(r);f.addVertex(n);f.addVertex(l)}q=TentaGL.Math.toCartesian([c,0,0]);n=q[0];p=q[2];q=vec3.sub(vec3.create(),[0,d,0],q);u=vec3.fromValues(n,0,p);u=vec3.cross(vec3.create(),
u,q);q=vec3.cross(vec3.create(),q,u);vec3.normalize(q,q);n=new TentaGL.Vertex([n,0,p]);n.texST([TentaGL.TAU,0]);n.normal(q);f.addVertex(n);for(c=2;c<g;c++)d=0,e=c-1,k=c,f.addFace(d,k,e);for(c=0;c<2*g;c+=2)d=g+(c+0),e=g+(c+2),k=g+(c+1),f.addFace(d,e,k);return f};
TentaGL.Model.Cube=function(c,d,e){var f=new TentaGL.Model,g=0,k=function(c,d,e){var k=vec3.cross([],d,e),q=new TentaGL.Vertex(c);q.normal(k);q.texST([0,0]);f.addVertex(q);q=new TentaGL.Vertex(vec3.add([],c,d));q.normal(k);q.texST([1,0]);f.addVertex(q);d=new TentaGL.Vertex(vec3.add([],c,vec3.add([],d,e)));d.normal(k);d.texST([1,1]);f.addVertex(d);c=new TentaGL.Vertex(vec3.add([],c,e));c.normal(k);c.texST([0,1]);f.addVertex(c);f.addFaceQuad(g,g+1,g+2,g+3);g+=4};k([0,d,e],[c,0,0],[0,0,-e]);k([0,0,0],
[c,0,0],[0,0,e]);k([0,0,e],[c,0,0],[0,d,0]);k([c,0,0],[-c,0,0],[0,d,0]);k([c,0,e],[0,0,-e],[0,d,0]);k([0,0,0],[0,0,e],[0,d,0]);return f};
TentaGL.Model.Cylinder=function(c,d,e){var f=new TentaGL.Model(!1);e||(e=TentaGL.TAU/20);for(var g=Math.floor(TentaGL.TAU/e)+1,k=0;k<g;k++){var l=k*e,m=TentaGL.Math.toCartesian([c,l,0]),p=m[0],m=m[2],l=(p/c+1)/2,n=(m/c+1)/2,q=new TentaGL.Vertex([p,0,m]);q.normal([0,-1,0]);q.texST([l,n]);f.addVertex(q)}for(k=0;k<g;k++)l=k*e,m=TentaGL.Math.toCartesian([c,l,0]),p=m[0],m=m[2],l/=TentaGL.TAU,q=new TentaGL.Vertex([p,0,m]),q.normal([p,0,m]),q.texST([l,0]),f.addVertex(q);for(k=0;k<g;k++)l=k*e,m=TentaGL.Math.toCartesian([c,
l,0]),p=m[0],m=m[2],l/=TentaGL.TAU,q=new TentaGL.Vertex([p,d,m]),q.normal([p,0,m]),q.texST([l,1]),f.addVertex(q);for(k=0;k<g;k++)l=k*e,m=TentaGL.Math.toCartesian([c,l,0]),p=m[0],m=m[2],l=(p/c+1)/2,n=(m/c+1)/2,q=new TentaGL.Vertex([p,d,m]),q.normal([0,1,0]),q.texST([l,n]),f.addVertex(q);for(c=2;c<g;c++)d=0,e=c-1,k=c,f.addFace(d,k,e);for(c=0;c<g-1;c++)d=1*g+(c+0),e=1*g+(c+1),k=2*g+(c+1),f.addFaceQuad(d,e,k,2*g+(c+0));for(c=2;c<g;c++)d=3*g,e=3*g+c-1,k=3*g+c,f.addFace(d,e,k);return f};
TentaGL.Model.Line=function(c,d){var e=new TentaGL.Model(GL_LINES),f=new TentaGL.Vertex(c);f.normal([0,0,1]);f.texST([0,0]);e.addVertex(f);f=new TentaGL.Vertex(d);f.normal([0,0,1]);f.texST([1,0]);e.addVertex(f);e.addLine(0,1);return e};
TentaGL.Model.Plane=function(c,d,e){var f=new TentaGL.Model(GL_TRIANGLES,GL_NONE);e=e||!1;var g=vec3.cross([],[c,0,0],[0,d,0]);e?(e=new TentaGL.Vertex([0,0,0]),e.normal(g),e.texST([0,1]),f.addVertex(e),e=new TentaGL.Vertex([0,-d,0]),e.normal(g),e.texST([0,0]),f.addVertex(e),e=new TentaGL.Vertex([c,-d,0]),e.normal(g),e.texST([1,0]),f.addVertex(e),c=new TentaGL.Vertex([c,0,0]),c.normal(g),c.texST([1,1])):(e=new TentaGL.Vertex([0,0,0]),e.normal(g),e.texST([0,0]),f.addVertex(e),e=new TentaGL.Vertex([c,
0,0]),e.normal(g),e.texST([1,0]),f.addVertex(e),e=new TentaGL.Vertex([c,d,0]),e.normal(g),e.texST([1,1]),f.addVertex(e),c=new TentaGL.Vertex([0,d,0]),c.normal(g),c.texST([0,1]));f.addVertex(c);f.addFaceQuad(0,1,2,3);return f};TentaGL.Model.PolyLine=function(c,d){for(var e=new TentaGL.Model(GL_LINES),f=0;f<c.length;f++){var g=new TentaGL.Vertex(c[f]);g.normal([0,0,1]);g.texST([f,0]);e.addVertex(g);0<f&&e.addLine(f-1,f)}d&&e.addLine(c.length-1,0);return e};
TentaGL.Model.Sphere=function(c,d,e){var f=new TentaGL.Model;d||(d=TentaGL.TAU/20);e||(e=TentaGL.TAU/20);for(var g=Math.floor(TentaGL.TAU/2/d)+1,k=Math.floor(TentaGL.TAU/e)+1,l=0;l<g;l++)for(var m=l*d-TentaGL.TAU/4,p=0;p<k;p++){var n=p*e,q=TentaGL.Math.toCartesian([c,n,m]),n=n/TentaGL.TAU,t=m/(TentaGL.TAU/2)+.5,r=new TentaGL.Vertex(q);r.normal(q);r.texST([n,t]);f.addVertex(r)}for(l=0;l<g-1;l++)for(p=0;p<k-1;p++)f.addFaceQuad((l+0)*k+(p+0),(l+0)*k+(p+1),(l+1)*k+(p+1),(l+1)*k+(p+0));return f};
TentaGL.Model.Triangle=function(c,d,e){var f=new TentaGL.Model,g=new TentaGL.Vertex(c),k=new TentaGL.Vertex(d),l=new TentaGL.Vertex(e);f.addVertex(g);f.addVertex(k);f.addVertex(l);d=vec3.subtract([],d,c);c=vec3.subtract([],e,c);c=vec3.cross(vec3.create(),d,c);g.normal(c);k.normal(c);l.normal(c);g.texST([0,0]);k.texST([1,0]);l.texST([1,1]);f.addFace(0,1,2);return f};
TentaGL.ModelLib={clean:function(c){for(var d in c._vboData)c._vboData[d].clean(c);c._vboData={}},reset:function(c){this.clean(c);this.add(c,"unitPlane",new TentaGL.Model.Plane(1,1));this.add(c,"unitLine",new TentaGL.Model.Line([0,0,0],[1,1,1]));this.add(c,"unitCube",new TentaGL.Model.Cube(1,1,1));this.add(c,"unitCylinder",new TentaGL.Model.Cylinder(1,1));this.add(c,"unitSphere",new TentaGL.Model.Sphere(1));this.add(c,"unitSprite",(new TentaGL.Model.Plane(1,1)).flipTexT());this.add(c,"unitCone",new TentaGL.Model.Cone(1,
1))},add:function(c,d,e,f){f||(f=TentaGL.getDefaultAttrProfileSet());e=new TentaGL.VBOData(c,e,f);return c._vboData[d]=e},get:function(c,d){if(void 0===c._vboData[d])throw Error("ModelLib does not contain VBOData for "+d+".");return c._vboData[d]},remove:function(c,d){c._vboData[d].clean(c);delete c._vboData[d]},render:function(c,d){TentaGL.ViewTrans.updateMVPUniforms(c);this.get(c,d).render(c)}};
TentaGL.Model.ObjReader={_numLoading:0,fromURL:function(c,d){var e=this,f=new XMLHttpRequest;f.open("get",c);f.onerror=function(c){console.log("AJAX error: ",c);e._numLoading--};f.onreadystatechange=function(c){4==this.readyState&&200==this.status&&(e._processResponse(f.responseText,d),e._numLoading--)};f.send();this._numLoading++},_processResponse:function(c,d){for(var e=[],f="",g=new TentaGL.Model,k=0,l="",m=c.split("\n"),p=0;p<m.length;p++){for(var n=m[p].trim(),n=n.replace("\t"," ");-1!=n.indexOf("  ");)n=
n.replace("  "," ");if(""!=n&&"#"!=n.charAt(0)){n=n.split(" ");n[0]!=l&&(k=0);if("g"==n[0])e[f]=g,g=new TentaGL.Model,f=n[1];else if("v"==n[0]){var q=parseFloat(n[1]),t=parseFloat(n[2]),r=parseFloat(n[3]);g.addVertex(new TentaGL.Vertex([q,t,r]))}else if("vn"==n[0])l=g.getVertex(k),q=parseFloat(n[1]),t=parseFloat(n[2]),r=parseFloat(n[3]),l.normal([q,t,r]);else if("vt"==n[0])l=g.getVertex(k),q=parseFloat(n[1]),t=parseFloat(n[2]),l.texST([q,t]);else if("f"==n[0])l=parseInt(n[1])-1,q=parseInt(n[2])-1,
t=parseInt(n[3])-1,5==n.length?(r=parseInt(n[4])-1,g.addFaceQuad(l,q,t,r)):g.addFace(l,q,t);else if("usemtl"!=n[0])throw Error("Could not read wavefront object. Error at line "+(p+1));k++;l=n[0]}}e[f]=g;d(e)},isLoading:function(){return 0<this._numLoading},getNumLoading:function(){return this._numLoading}};
TentaGL.VBOData=function(c,d,e){e||(e=TentaGL.getDefaultAttrProfileSet());var f=[];this._byteOffsets={};for(var g=d.getVertices(),k=0;k<g.length;k++){var l=g[k],m=0,p;for(p in e){var n=e[p],q=n.getValues(l);this._byteOffsets[p]=m;m+=n.sizeBytes();for(n=0;n<q.length;n++)f.push(q[n])}}this._attrBuffer=c.createBuffer();c.bindBuffer(GL_ARRAY_BUFFER,this._attrBuffer);c.bufferData(GL_ARRAY_BUFFER,new Float32Array(f),GL_STATIC_DRAW);f=d.getIndices();this._numIndices=d.numIndices();this._elemBuffer=c.createBuffer();
c.bindBuffer(GL_ELEMENT_ARRAY_BUFFER,this._elemBuffer);c.bufferData(GL_ELEMENT_ARRAY_BUFFER,new Uint16Array(f),GL_STATIC_DRAW);this._attrSet=e;this._stride=TentaGL.AttrProfiles.getStride(e);this._mode=d.getDrawMode();this._cull=d.getCullMode()};
TentaGL.VBOData.prototype={constructor:TentaGL.VBOData,getAttrBuffer:function(){return this._attrBuffer},getElemBuffer:function(){return this._elemBuffer},numIndices:function(){return this._numIndices},getOffset:function(c){var d=c.id();if(void 0===this._byteOffsets[d])throw Error("VBOData does not contain data for AttrProfile: "+c.toString());return this._byteOffsets[d]},getStride:function(){return this._stride},getShader:function(){return this._shader},getDrawMode:function(){return this._mode},
getCullMode:function(){return this._cull},clean:function(c){c.deleteBuffer(this._attrBuffer);c.deleteBuffer(this._elemBuffer)},render:function(c){var d=TentaGL.ShaderLib.current(c),e=this.getAttrBuffer(),f=this.getElemBuffer(),g=this.getStride();c.bindBuffer(GL_ARRAY_BUFFER,e);d=d.getAttributes();for(e=0;e<d.length;e++){var k=d[e],l=this.getOffset(k.getProfile());c.vertexAttribPointer(k.getLocation(),k.getSizeUnits(),k.getUnitType(),!1,g,l)}g=TentaGL.DrawMode.mode(c);this.getDrawMode()==GL_LINES&&
(g=GL_LINES);TentaGL.Cull.setMode(c,this.getCullMode());c.bindBuffer(GL_ELEMENT_ARRAY_BUFFER,f);c.drawElements(g,this.numIndices(),GL_UNSIGNED_SHORT,0)}};TentaGL.Vertex=function(c){this._xyz=vec3.copy([],c);this._xyz[3]=1;this._texST=[0,0];this._normal=[0,0,0];this._tangental=[0,0,0]};
TentaGL.Vertex.prototype={constructor:TentaGL.Vertex,xyz:function(c){void 0!==c&&(this._xyz=vec3.copy([],c),this._xyz[3]=1);return vec4.clone(this._xyz)},texST:function(c){void 0!==c&&(this._texST=vec2.copy([],c));return vec2.clone(this._texST)},normal:function(c){void 0!==c&&(this._normal=vec3.copy([],c));return vec3.clone(this._normal)},computeTangental:function(c,d){var e=vec3.sub([],c.xyz(),this.xyz()),f=vec3.sub([],d.xyz(),this.xyz()),g=c._texST[1]-this._texST[1],k=d._texST[1]-this._texST[1],
l=k*(c._texST[0]-this._texST[0])-g*(d._texST[0]-this._texST[0]);if(0==l)return[1,0,0];var m=vec3.create();vec3.scale(m,e,k);vec3.sub(m,m,vec3.scale([],f,g));vec3.scale(m,m,1/l);return 0==vec3.length(m)?[1,0,0]:m},tangental:function(c){void 0!==c&&(this._tangental=vec3.copy([],c));return vec3.clone(this._tangental)},clone:function(){return this.transform(mat4.create())},transform:function(c){var d=vec4.transformMat4([],this.xyz(),c),d=new TentaGL.Vertex(d),e=vec3.copy([],this.normal());e[3]=0;vec4.transformMat4(e,
e,c);d.normal(e);e=vec3.copy([],this.tangental());e[3]=0;vec4.transformMat4(e,e,c);d.tangental(e);d.texST(this._texST);return d}};TentaGL.ImageLoader={_numLoading:0,load:function(c,d,e){var f=this;this._numLoading++;e||(e=function(){f._numLoading--;throw Error("Could not load image at "+c+".");});var g=new Image;g.onload=function(){d(g);f._numLoading--};g.src=c},isLoading:function(){return 0<this._numLoading}};TentaGL.PixelData=function(c,d,e){this._pixels=c;this._width=d;this._height=e};
TentaGL.PixelData.prototype={constructor:TentaGL.PixelData,clone:function(){for(var c=new Uint8Array(this._pixels.length),d=0;d<this._pixels.length;d++)c[d]=this._pixels[d];return new TentaGL.PixelData(c,this._width,this._height)},getWidth:function(){return this._width},getHeight:function(){return this._height},getData:function(){return this._pixels},getPixelAt:function(c,d,e){e&&(d=this.height-1-d);c=4*(this._width*d+c);return[this._pixels[c],this._pixels[c+1],this._pixels[c+2],this._pixels[c+3]]},
setPixelAt:function(c,d,e,f){f&&(d=this.height-1-d);c=4*(this._width*d+c);this._pixels[c]=e[0];this._pixels[c+1]=e[1];this._pixels[c+2]=e[2];this._pixels[c+3]=e[3]},filter:function(c){for(var d=this.clone(),e=0;e<this._pixels.length;e+=4)c.filter(d._pixels,this._pixels,e,this._width,this._height);return d},crop:function(c,d,e,f){for(var g=new Uint8Array(e*f*4),k=c;k<c+e;k++)for(var l=d;l<d+f;l++){var m=4*(this._width*l+k),p=4*(e*(l-d)+(k-c));g[p]=this._pixels[m];g[p+1]=this._pixels[m+1];g[p+2]=this._pixels[m+
2];g[p+3]=this._pixels[m+3]}return new TentaGL.PixelData(g,e,f)},toCanvas:function(){for(var c=document.createElement("canvas"),d=c.width=this.getWidth(),e=c.height=this.getHeight(),f=c.getContext("2d"),g=f.createImageData(d,e),k=0;k<this._pixels.length;k+=4){var l=TentaGL.PixelData.indexToXY(k,d),l=TentaGL.PixelData.xyToIndex(l[0],e-l[1]-1,d);g.data[l]=this._pixels[k];g.data[l+1]=this._pixels[k+1];g.data[l+2]=this._pixels[k+2];g.data[l+3]=this._pixels[k+3]}f.putImageData(g,0,0);(d=document.getElementById("imgDebug"))&&
d.appendChild(c);return c}};TentaGL.PixelData.fromGLTexture=function(c,d,e,f,g,k,l){var m=c.createFramebuffer();c.bindFramebuffer(GL_FRAMEBUFFER,m);c.framebufferTexture2D(GL_FRAMEBUFFER,GL_COLOR_ATTACHMENT0,GL_TEXTURE_2D,d,0);l||(l=new Uint8Array(g*k*4));c.readPixels(e,f,g,k,GL_RGBA,GL_UNSIGNED_BYTE,l);c.bindFramebuffer(GL_FRAMEBUFFER,null);c.deleteFramebuffer(m);return new TentaGL.PixelData(l,g,k)};
TentaGL.PixelData.fromURL=function(c,d){TentaGL.ImageLoader.load(c,function(c){var f=document.createElement("canvas");f.width=c.width;f.height=c.height;f.getContext("2d").drawImage(c,0,0);c=TentaGL.PixelData.fromCanvas(f);d(c)})};
TentaGL.PixelData.fromCanvas=function(c){var d=document.getElementById("imgDebug");d&&d.appendChild(c);var d=c.width,e=c.height;c=c.getContext("2d").getImageData(0,0,d,e).data;for(var f=new Uint8Array(d*e*4),g=0;g<d;g++)for(var k=0;k<e;k++){var l=4*(k*d+g),m=4*((e-1-k)*d+g);f[m]=c[l];f[m+1]=c[l+1];f[m+2]=c[l+2];f[m+3]=c[l+3]}return new TentaGL.PixelData(f,d,e)};TentaGL.PixelData.indexToXY=function(c,d){c/=4;var e=Math.floor(c/d);return[c-e*d,e]};
TentaGL.PixelData.xyToIndex=function(c,d,e){return 4*(e*d+c)};TentaGL.RGBAFilter={};TentaGL.RGBAFilter.prototype={constructor:TentaGL.RGBAFilter,filter:function(c,d,e,f,g){},setPixel:function(c,d,e,f,g,k){c[d]=e;c[d+1]=f;c[d+2]=g;c[d+3]=k}};TentaGL.RGBAFilter.AddColor=function(c){this._color=c};
TentaGL.RGBAFilter.AddColor.prototype={constructor:TentaGL.RGBAFilter.AddColor,getColor:function(){return this._color},filter:function(c,d,e,f,g){f=d[e];g=d[e+1];var k=d[e+2];d=d[e+3];f=TentaGL.Math.clamp(f+this._color.getRedByte(),0,255);g=TentaGL.Math.clamp(g+this._color.getGreenByte(),0,255);k=TentaGL.Math.clamp(k+this._color.getBlueByte(),0,255);this.setPixel(c,e,f,g,k,d)}};TentaGL.RGBAFilter.AddColor.RGBBytes=function(c,d,e){c=TentaGL.Color.RGBABytes(c,d,e);return new TentaGL.RGBAFilter.AddColor(c)};
Util.Inheritance.inherit(TentaGL.RGBAFilter.AddColor,TentaGL.RGBAFilter);TentaGL.RGBAFilter.AlphaMap=function(c){this._alphaData=c.getData()};TentaGL.RGBAFilter.AlphaMap.prototype={constructor:TentaGL.RGBAFilter.AlphaMap,getAlphaData:function(){return this._alphaData},filter:function(c,d,e,f,g){this.setPixel(c,e,d[e],d[e+1],d[e+2],this._alphaData[e])}};Util.Inheritance.inherit(TentaGL.RGBAFilter.AlphaMap,TentaGL.RGBAFilter);TentaGL.RGBAFilter.AlphaRemoval=function(){};
TentaGL.RGBAFilter.AlphaRemoval.prototype={constructor:TentaGL.RGBAFilter.AlphaRemoval,filter:function(c,d,e,f,g){f=d[e];g=d[e+1];var k=d[e+2];d=d[e+3];255>d&&(d=0);this.setPixel(c,e,f,g,k,d)}};Util.Inheritance.inherit(TentaGL.RGBAFilter.AlphaRemoval,TentaGL.RGBAFilter);TentaGL.RGBAFilter.ClipMap=function(c){this._clipData=c.getData()};
TentaGL.RGBAFilter.ClipMap.prototype={constructor:TentaGL.RGBAFilter.ClipMap,getClipData:function(){return this._clipData},filter:function(c,d,e,f,g){f=d[e];g=d[e+1];var k=d[e+2];d=d[e+3];0==this._clipData[e+3]&&(d=0);this.setPixel(c,e,f,g,k,d)}};Util.Inheritance.inherit(TentaGL.RGBAFilter.ClipMap,TentaGL.RGBAFilter);
TentaGL.RGBAFilter.Convolution=function(c){var d=c[0].length;this._sideLen=d;for(var e=0,f=0;f<d;f++)for(var g=0;g<d;g++)e+=c[f][g];console.log(e);if(0<e)for(f=0;f<d;f++)for(g=0;g<d;g++)c[f][g]/=e;console.log(c);this._matrix=c};
TentaGL.RGBAFilter.Convolution.prototype={constructor:TentaGL.RGBAFilter.Convolution,getMatrix:function(){return this._matrix},getSideLength:function(){return this._sideLen},filter:function(c,d,e,f,g){for(var k=0,l=0,m=0,p=d[e+3],n=this._sideLen,q=TentaGL.PixelData.indexToXY(e,f),t=q[0],q=q[1],r=Math.floor(n/2),w=0;w<n;w++){var u=q+w-r;u>=g&&(u=g-1);0>u&&(u=0);for(var y=0;y<n;y++){var z=this._matrix[w][y],x=t+y-r;x>=f&&(x=f-1);0>x&&(x=0);var x=TentaGL.PixelData.xyToIndex(x,u,f),A=d[x+3]/255,k=k+d[x]*
z*A,l=l+d[x+1]*z*A,m=m+d[x+2]*z*A}}k=TentaGL.Math.clamp(k,-256,255);0>k&&(k+=256);l=TentaGL.Math.clamp(l,-256,255);0>l&&(l+=256);m=TentaGL.Math.clamp(m,-256,255);0>m&&(m+=256);this.setPixel(c,e,k,l,m,p)}};Util.Inheritance.inherit(TentaGL.RGBAFilter.Convolution,TentaGL.RGBAFilter);TentaGL.RGBAFilter.Convolution.Blur3=function(){return new TentaGL.RGBAFilter.Convolution([[1,1,1],[1,1,1],[1,1,1]])};
TentaGL.RGBAFilter.Convolution.GaussianBlur3=function(){return new TentaGL.RGBAFilter.Convolution([[1,2,1],[2,4,2],[1,2,1]])};TentaGL.RGBAFilter.Convolution.Sharpen3=function(){return new TentaGL.RGBAFilter.Convolution([[0,-1,0],[-1,5,-1],[0,-1,0]])};TentaGL.RGBAFilter.Convolution.EdgeDetect3=function(){return new TentaGL.RGBAFilter.Convolution([[1,0,-1],[0,0,0],[-1,0,1]])};TentaGL.RGBAFilter.Convolution.EdgeDetect3_2=function(){return new TentaGL.RGBAFilter.Convolution([[0,1,0],[1,-4,1],[0,1,0]])};
TentaGL.RGBAFilter.Convolution.EdgeDetect3_3=function(){return new TentaGL.RGBAFilter.Convolution([[-1,-1,-1],[-1,8,-1],[-1,-1,-1]])};TentaGL.RGBAFilter.Grayscale=function(){};TentaGL.RGBAFilter.Grayscale.prototype={constructor:TentaGL.RGBAFilter.Grayscale,filter:function(c,d,e,f,g){f=d[e]/255;g=d[e+1]/255;var k=d[e+2]/255;d=d[e+3]/255;d=TentaGL.Color.HSBAtoRGBA(0,0,.2126*f+.7152*g+.0722*k,d);f=255*d[0]&255;g=255*d[1]&255;k=255*d[2]&255;d=255*d[3]&255;this.setPixel(c,e,f,g,k,d)}};
Util.Inheritance.inherit(TentaGL.RGBAFilter.Grayscale,TentaGL.RGBAFilter);TentaGL.RGBAFilter.Invert=function(){};TentaGL.RGBAFilter.Invert.prototype={constructor:TentaGL.RGBAFilter.Invert,filter:function(c,d,e,f,g){f=d[e];g=d[e+1];var k=d[e+2];d=d[e+3];this.setPixel(c,e,255-f,255-g,255-k,d)}};Util.Inheritance.inherit(TentaGL.RGBAFilter.Invert,TentaGL.RGBAFilter);TentaGL.RGBAFilter.MaskMap=function(c){this._maskData=c.getData()};
TentaGL.RGBAFilter.MaskMap.prototype={constructor:TentaGL.RGBAFilter.MaskMap,getMaskData:function(){return this._maskData},filter:function(c,d,e,f,g){f=d[e];g=d[e+1];var k=d[e+2];d=d[e+3];0<this._maskData[e+3]&&(d=0);this.setPixel(c,e,f,g,k,d)}};Util.Inheritance.inherit(TentaGL.RGBAFilter.MaskMap,TentaGL.RGBAFilter);TentaGL.RGBAFilter.MulColor=function(c){this._color=c};
TentaGL.RGBAFilter.MulColor.prototype={constructor:TentaGL.RGBAFilter.MulColor,getColor:function(){return this._color},filter:function(c,d,e,f,g){f=d[e];g=d[e+1];var k=d[e+2];d=d[e+3];f*=this._color.r();g*=this._color.g();k*=this._color.b();d*=this._color.a();this.setPixel(c,e,f,g,k,d)}};TentaGL.RGBAFilter.MulColor.RGBA=function(c,d,e,f){c=TentaGL.Color.RGBA(c,d,e,f);return new TentaGL.RGBAFilter.MulColor(c)};Util.Inheritance.inherit(TentaGL.RGBAFilter.MulColor,TentaGL.RGBAFilter);
TentaGL.RGBAFilter.OneColor=function(c,d){d||(d=0);this._color=c;this._tolerance=d};
TentaGL.RGBAFilter.OneColor.prototype={constructor:TentaGL.RGBAFilter.OneColor,getColor:function(){return this._color},getTolerance:function(){return this._tolerance},filter:function(c,d,e,f,g){var k=d[e];g=d[e+1];f=d[e+2];d=d[e+3];d=Math.abs(k-this._color.getRedByte())/255;g=Math.abs(g-this._color.getGreenByte())/255;f=Math.abs(f-this._color.getBlueByte())/255;d*d+g*g+f*f>this._tolerance*this._tolerance?d=f=g=k=0:(k=this._color.getRedByte(),g=this._color.getGreenByte(),f=this._color.getBlueByte(),
d=255);this.setPixel(c,e,k,g,f,d)}};Util.Inheritance.inherit(TentaGL.RGBAFilter.OneColor,TentaGL.RGBAFilter);TentaGL.RGBAFilter.OutlineColor=function(c){this._color=c};
TentaGL.RGBAFilter.OutlineColor.prototype={constructor:TentaGL.RGBAFilter.OutlineColor,getColor:function(){return this._color},filter:function(c,d,e,f,g){var k=d[e],l=d[e+1],m=d[e+2],p=d[e+3];if(255!=p)for(var n=TentaGL.PixelData.indexToXY(e,f),q=n[0],n=n[1],t=-1;1>=t;t++){var r=n+t;if(!(r>=g||0>r))for(var w=-1;1>=w;w++){var u=q+w;if(!(u>=f||0>u)&&(u=TentaGL.PixelData.xyToIndex(u,r,f),255==d[u+3]))return k=this._color.getRedByte(),l=this._color.getGreenByte(),m=this._color.getBlueByte(),this.setPixel(c,
e,k,l,m,255)}}this.setPixel(c,e,k,l,m,p)}};TentaGL.RGBAFilter.OutlineColor.RGBBytes=function(c,d,e){c=TentaGL.Color.RGBABytes(c,d,e);return new TentaGL.RGBAFilter.OutlineColor(c)};Util.Inheritance.inherit(TentaGL.RGBAFilter.OutlineColor,TentaGL.RGBAFilter);TentaGL.RGBAFilter.SubColor=function(c){this._color=c};
TentaGL.RGBAFilter.SubColor.prototype={constructor:TentaGL.RGBAFilter.SubColor,getColor:function(){return this._color},filter:function(c,d,e,f,g){f=d[e];g=d[e+1];var k=d[e+2];d=d[e+3];f=TentaGL.Math.clamp(f-this._color.getRedByte(),0,255);g=TentaGL.Math.clamp(g-this._color.getGreenByte(),0,255);k=TentaGL.Math.clamp(k-this._color.getBlueByte(),0,255);this.setPixel(c,e,f,g,k,d)}};TentaGL.RGBAFilter.SubColor.RGBBytes=function(c,d,e){c=TentaGL.Color.RGBABytes(c,d,e);return new TentaGL.RGBAFilter.SubColor(c)};
Util.Inheritance.inherit(TentaGL.RGBAFilter.SubColor,TentaGL.RGBAFilter);TentaGL.RGBAFilter.TransparentColor=function(c){this._tColor=c};TentaGL.RGBAFilter.TransparentColor.prototype={constructor:TentaGL.RGBAFilter.TransparentColor,getTransparentColor:function(){return this._tColor},filter:function(c,d,e,f,g){f=d[e];g=d[e+1];var k=d[e+2];d=d[e+3];var l=this._tColor.getRedByte(),m=this._tColor.getGreenByte(),p=this._tColor.getBlueByte();f==l&&g==m&&k==p&&(d=0);this.setPixel(c,e,f,g,k,d)}};
TentaGL.RGBAFilter.TransparentColor.RGBBytes=function(c,d,e){c=TentaGL.Color.RGBABytes(c,d,e);return new TentaGL.RGBAFilter.TransparentColor(c)};Util.Inheritance.inherit(TentaGL.RGBAFilter.TransparentColor,TentaGL.RGBAFilter);
TentaGL.Keyboard=function(c){this._isPressed=[];this._justPressed=[];this._justReleased=[];this._repPressed=[];this._pressedSinceLast=[];this._releasedSinceLast=[];var d=this;c.addEventListener("keydown",function(c){d._pressedSinceLast[c.keyCode]=!0;c.preventDefault()},!1);c.addEventListener("keyup",function(c){d._releasedSinceLast[c.keyCode]=!0;c.preventDefault()},!1)};
TentaGL.Keyboard.prototype={constructor:TentaGL.Keyboard,poll:function(){this._justPressed=[];this._justReleased=[];this._repPressed=[];for(var c in this._pressedSinceLast)this._isPressed[c]||(this._justPressed[c]=!0),this._isPressed[c]=!0,this._repPressed[c]=!0;for(c in this._releasedSinceLast)this._justReleased[c]=!0,this._isPressed[c]=!1;this._pressedSinceLast=[];this._releasedSinceLast=[]},isPressed:function(c){return this._isPressed[c]||!1},justPressed:function(c){return this._justPressed[c]||
!1},justReleased:function(c){return this._justReleased[c]||!1},isPressedRepeating:function(c){return this._repPressed[c]||!1}};
var KeyCode={BACK_SPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,
NUMPAD9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,EQUALS:187,COMMA:188,MINUS:189,PERIOD:190,SLASH:191,BACK_QUOTE:192,BRACELEFT:219,BACK_SLASH:220,BRACERIGHT:221,QUOTE:222};
TentaGL.Mouse=function(c){this._canvas=c;this._xy=[0,0];this._xyPage=[0,0];this._mouseMoved=this._mouseMovedSinceLast=!1;this._pressedSinceLast=[];this._releasedSinceLast=[];this._isPressed=[];this._justPressed=[];this._justReleased=[];this._clickCount=[];this._clickCount[TentaGL.Mouse.LEFT]=0;this._clickCount[TentaGL.Mouse.MIDDLE]=0;this._clickCount[TentaGL.Mouse.MIDDLE]=0;this._lastClickTime=[];this._lastClickTime[TentaGL.Mouse.LEFT]=0;this._lastClickTime[TentaGL.Mouse.MIDDLE]=0;this._lastClickTime[TentaGL.Mouse.MIDDLE]=
0;this._multiClickTime=400;this._wheelTicksZ=this._wheelTicksY=this._wheelTicksX=this._wheelTicksZSinceLast=this._wheelTicksYSinceLast=this._wheelTicksXSinceLast=0;var d=this;c.onmousemove=function(e){var f=TentaGL.DOM.getAbsolutePosition(this),g=c.getBoundingClientRect(),f=TentaGL.Math.clamp(Math.floor(g.left),0,c.width),g=TentaGL.Math.clamp(Math.floor(g.top),0,c.height),f=[e.clientX-f,e.clientY-g];e=[e.pageX,e.pageY];d._xy=f;d._xyPage=e;d._mouseMovedSinceLast=!0};c.oncontextmenu=function(c){return!1};
c.onmousedown=function(c){d._pressedSinceLast[c.which]=!0;var f=Date.now(),g=f-d._lastClickTime[c.which];d._lastClickTime[c.which]=f;g<d._multiClickTime?d._clickCount[c.which]++:d._clickCount[c.which]=1};c.onmouseup=function(c){d._releasedSinceLast[c.which]=!0};c.onwheel=c.onmousewheel=function(c){var f=c.wheelDeltaY;void 0===f&&(f=-c.deltaY);var g=c.wheelDeltaX;void 0===g&&(g=-c.deltaX);var k=c.deltaZ;0>f?d._wheelTicksYSinceLast--:0<f&&d._wheelTicksYSinceLast++;0>g?d._wheelTicksXSinceLast--:0<g&&
d._wheelTicksXSinceLast++;0>k?d._wheelTicksZSinceLast--:0<k&&d._wheelTicksZSinceLast++;c.preventDefault()};c.onclick=function(c){d._fileOpenDialogCB&&(d._fileOpenDialogCB(),d._fileOpenDialogCB=void 0)}};TentaGL.Mouse.LEFT=1;TentaGL.Mouse.MIDDLE=2;TentaGL.Mouse.RIGHT=3;
TentaGL.Mouse.prototype={constructor:TentaGL.Mouse,poll:function(){this._justPressed=[];this._justReleased=[];this._wheelTicksX=this._wheelTicksXSinceLast;this._wheelTicksY=this._wheelTicksYSinceLast;this._wheelTicksZ=this._wheelTicksZSinceLast;this._wheelTicksZSinceLast=this._wheelTicksYSinceLast=this._wheelTicksXSinceLast=0;this._mouseMoved=this._mouseMovedSinceLast;this._mouseMovedSinceLast=!1;for(var c in this._pressedSinceLast)this._isPressed[c]||(this._justPressed[c]=!0),this._isPressed[c]=
!0;for(c in this._releasedSinceLast)this._isPressed[c]=!1,this._justReleased[c]=!0;this._pressedSinceLast=[];this._releasedSinceLast=[]},getXY:function(){return[this._xy[0],this._xy[1]]},getX:function(){return this._xy[0]},getY:function(){return this._xy[1]},getPageXY:function(){return[this._xyPage[0],this._xyPage[1]]},getPageX:function(){return this._xyPage[0]},getPageY:function(){return this._xyPage[1]},hasMoved:function(){return this._mouseMoved},isLeftPressed:function(){return this._isPressed[TentaGL.Mouse.LEFT]||
!1},justLeftPressed:function(){return this._justPressed[TentaGL.Mouse.LEFT]||!1},justLeftReleased:function(){return this._justReleased[TentaGL.Mouse.LEFT]||!1},leftClickCount:function(){return this._clickCount[TentaGL.Mouse.LEFT]},isMiddlePressed:function(){return this._isPressed[TentaGL.Mouse.MIDDLE]||!1},justMiddlePressed:function(){return this._justPressed[TentaGL.Mouse.MIDDLE]||!1},justMiddleReleased:function(){return this._justReleased[TentaGL.Mouse.MIDDLE]||!1},middleClickCount:function(){return this._clickCount[TentaGL.Mouse.MIDDLE]},
isRightPressed:function(){return this._isPressed[TentaGL.Mouse.RIGHT]||!1},justRightPressed:function(){return this._justPressed[TentaGL.Mouse.RIGHT]||!1},justRightReleased:function(){return this._justReleased[TentaGL.Mouse.RIGHT]||!1},rightClickCount:function(){return this._clickCount[TentaGL.Mouse.RIGHT]},scrollUpAmount:function(){return Math.abs(Math.max(this._wheelTicksY,0))},scrollDownAmount:function(){return Math.abs(Math.min(this._wheelTicksY,0))},scrollLeftAmount:function(){return Math.abs(Math.min(this._wheelTicksX,
0))},scrollRightAmount:function(){return Math.abs(Math.max(this._wheelTicksX,0))},getCanvasWidth:function(){return this._canvas.width},getCanvasHeight:function(){return this._canvas.height},getCanvas:function(){return this._canvas},setClickCallback:function(c){this._fileOpenDialogCB=c}};TentaGL.Light=function(c,d,e){c||(c=TentaGL.Color.RGBA(1,1,1,1));d||(d=TentaGL.Color.RGBA(1,1,1,1));e||(e=TentaGL.Color.RGBA(0,0,0,1));this._diffuse=c;this._specular=d;this._ambient=e};
TentaGL.Light.prototype={constructor:TentaGL.Light,isaLight:!0,diffuse:function(c){c&&(this._diffuse=c.clone());return this._diffuse},specular:function(c){c&&(this._specular=c.clone());return this._specular},ambient:function(c){c&&(this._ambient=c.clone());return this._ambient},render:function(c){}};Util.Inheritance.inherit(TentaGL.Light,TentaGL.Renderable);TentaGL.AmbientLight=function(c){TentaGL.Light.call(this,TentaGL.Color.RGBA(0,0,0,1),TentaGL.Color.RGBA(0,0,0,1),c)};
TentaGL.AmbientLight.prototype={constructor:TentaGL.AmbientLight,isaAmbientLight:!0};Util.Inheritance.inherit(TentaGL.AmbientLight,TentaGL.Light);TentaGL.DirectionalLight=function(c,d,e,f){TentaGL.Light.call(this,d,e,f);this._direction=c};
TentaGL.DirectionalLight.prototype={constructor:TentaGL.DirectionalLight,isaDirectionalLight:!0,direction:function(c){c&&(this._direction=vec3.copy([],c));return this._direction},render:function(c){TentaGL.ViewTrans.push(c);var d=TentaGL.Math.getQuatFromTo([0,1,0],this._direction);TentaGL.ViewTrans.mul(c,mat4.fromQuat([],d));TentaGL.ViewTrans.scale(c,[1,vec3.length(this._direction),1]);TentaGL.MaterialLib.use(c,"default");TentaGL.ModelLib.render(c,"unitCylinder");TentaGL.ViewTrans.pop(c)}};
Util.Inheritance.inherit(TentaGL.DirectionalLight,TentaGL.Light);TentaGL.PointLight=function(c,d,e,f){TentaGL.Light.call(this,d,e,f);this._xyz=vec4.clone(c);this._xyz[3]=1;this._attenuation=[1,0,0]};
TentaGL.PointLight.prototype={constructor:TentaGL.PointLight,isaPointLight:!0,xyz:function(c){void 0!==c&&(this._xyz=vec3.copy([],c),this._xyz[3]=1);return this._xyz},x:function(c){void 0!==c&&(this._xyz[0]=c);return this._xyz[0]},y:function(c){void 0!==c&&(this._xyz[1]=c);return this._xyz[1]},z:function(c){void 0!==c&&(this._xyz[2]=c);return this._xyz[2]},attenuation:function(c){void 0!==c&&(this._attenuation=c.slice(0));return this._attenuation},render:function(c){(new TentaGL.Math.Sphere(1,this._xyz)).render(c)}};
Util.Inheritance.inherit(TentaGL.PointLight,TentaGL.Light);TentaGL.SpotLight=function(c,d,e,f,g,k,l){TentaGL.PointLight.call(this,c,g,k,l);TentaGL.DirectionalLight.call(this,d,g,k,l);this._angle=e;this._spotExp=f};TentaGL.SpotLight.prototype={constructor:TentaGL.SpotLight,isaSpotLight:!0,cutOffAngle:function(c){void 0!==c&&(this._angle=c);return this._angle},spotExponent:function(c){void 0!==c&&(this._spotExp=c);return this._spotExp}};Util.Inheritance.inherit(TentaGL.SpotLight,TentaGL.PointLight);
Util.Inheritance.inherit(TentaGL.SpotLight,TentaGL.DirectionalLight);TentaGL.LightManager=function(c){this._lights=[];this._maxLights=c};
TentaGL.LightManager.prototype={constructor:TentaGL.LightManager,isaLightManager:!0,add:function(c){if(this._lights.length==this._maxLights)throw Error("Too many lights.");this._lights.push(c)},get:function(c){return this._lights[c]},getAll:function(){for(var c=[],d=0;d<this._lights.length;d++)c.push(this._lights[d]);return c},remove:function(c){c=this._lights.indexOf(c);if(0>c)throw Error("Could not remove light.");this._lights.splice(c,1)},removeAll:function(){this._lights=[]},getCount:function(){return this._lights.length},
getMaxCount:function(){return this._maxLights},useMe:function(c){var d=TentaGL.ShaderLib.current(c);d.setLights&&d.setLights(c,this.getAll())},render:function(c){for(var d=0;d<this._lights.length;d++)this._lights[d].render(c)}};TentaGL.Material=function(){};TentaGL.Material.prototype={isaMaterial:!0,clean:function(c){},useMe:function(c){},isLoaded:function(){}};
TentaGL.BufferTexture=function(c,d,e,f){this._width=d;this._height=e;this._clearColor=f||TentaGL.Color.RGBA(0,0,0,0);this._frameBuffer=c.createFramebuffer();c.bindFramebuffer(GL_FRAMEBUFFER,this._frameBuffer);this._tex=TentaGL.Texture.create(c,null,d,e);c.framebufferTexture2D(GL_FRAMEBUFFER,GL_COLOR_ATTACHMENT0,GL_TEXTURE_2D,this._tex,0);this._depth=TentaGL.DepthBuffer.createBuffer(c,d,e);c.framebufferRenderbuffer(GL_FRAMEBUFFER,GL_DEPTH_ATTACHMENT,GL_RENDERBUFFER,this._depth);c.bindTexture(GL_TEXTURE_2D,
null);c.bindRenderbuffer(GL_RENDERBUFFER,null);c.bindFramebuffer(GL_FRAMEBUFFER,null)};
TentaGL.BufferTexture.prototype={constructor:TentaGL.BufferTexture,isaBufferTexture:!0,clean:function(c){c.deleteFramebuffer(this._frameBuffer);c.deleteTexture(this._tex);c.deleteRenderbuffer(this._depth)},isLoaded:function(){return!0},renderToMe:function(c,d){TentaGL.Viewport.push(c);c.bindFramebuffer(GL_FRAMEBUFFER,this._frameBuffer);TentaGL.Viewport.xywh(c,[0,0,this._width,this._height]);TentaGL.clear(c,this._clearColor);d(c);c.bindFramebuffer(GL_FRAMEBUFFER,null);TentaGL.Viewport.pop(c)},getPixelData:function(c,
d,e,f,g,k){d=d||0;e=e||0;f=f||this._width-d;g=g||this._height-e;return TentaGL.PixelData.fromGLTexture(c,this._tex,d,e,f,g,k)},useMe:function(c){c.activeTexture(GL_TEXTURE0);c.bindTexture(GL_TEXTURE_2D,this._tex);TentaGL.ShaderLib.current(c).setTex(c,0)}};Util.Inheritance.inherit(TentaGL.BufferTexture,TentaGL.Material);TentaGL.BumpMappedTexture=function(c,d){this._color=c;this._bump=d};
TentaGL.BumpMappedTexture.prototype={constructor:TentaGL.BumpMappedTexture,isaBumpMappedTexture:!0,getColorTextureName:function(){return this._color},getColorTexture:function(c){return TentaGL.MaterialLib.get(c,this._color)},getBumpTextureName:function(){return this._bump},getBumpTexture:function(c){return TentaGL.MaterialLib.get(c,this._bump)},useMe:function(c){var d=TentaGL.ShaderLib.current(c);this.getColorTexture(c).useMe(c);d.setBump&&(c.activeTexture(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,this.getBumpTexture(c).getLocation()),
d.setBump(c,1))}};Util.Inheritance.inherit(TentaGL.BumpMappedTexture,TentaGL.Material);TentaGL.Color=function(c){c||(c=[0,0,0,1]);this._rgba=c};
TentaGL.Color.prototype={constructor:TentaGL.Color,isaColor:!0,clean:function(c){},isLoaded:function(){return!0},clone:function(){return TentaGL.Color.RGBA(this.r(),this.g(),this.b(),this.a())},rgba:function(c){void 0!==c&&(void 0===c[3]&&(c[3]=1),this._rgba=vec4.copy([],c));return this._rgba.slice(0)},r:function(c){void 0!==c&&(this._rgba[0]=c);return this._rgba[0]},g:function(c){void 0!==c&&(this._rgba[1]=c);return this._rgba[1]},b:function(c){void 0!==c&&(this._rgba[2]=c);return this._rgba[2]},
a:function(c){void 0!==c&&(this._rgba[3]=c);return this._rgba[3]},rgbaBytes:function(c){return c?(vec4.scale(this._rgba,c,1/255),c):[this.getRedByte(),this.getGreenByte(),this.getBlueByte(),this.getAlphaByte()]},getRedByte:function(){return 255*this._rgba[0]&255},getGreenByte:function(){return 255*this._rgba[1]&255},getBlueByte:function(){return 255*this._rgba[2]&255},getAlphaByte:function(){return 255*this._rgba[3]&255},hex:function(c){if(void 0!==c)return this.rgba([(c>>>16&255)/255,(c>>>8&255)/
255,(c&255)/255,(c>>>24&255)/255]),c;c=Math.floor(255*this.a())<<24;c+=Math.floor(255*this.r())<<16;c+=Math.floor(255*this.g())<<8;c+=Math.floor(255*this.b());return c>>>0},setHSBA:function(c,d,e,f){void 0===f&&(f=1);c=TentaGL.Color.HSBAtoRGBA(c,d,e,f);this.rgba(c)},getHSBA:function(){var c=this.r(),d=this.g(),e=this.b(),f=this.a();return TentaGL.Color.RGBAtoHSBA(c,d,e,f)},hsba:function(c){if(c){void 0===c[3]&&(c[3]=1);var d=c[0],e=c[2],f=c[3],g=6*(d-Math.floor(d)),d=c[1]*e,k=d*(1-Math.abs(g%2-1)),
e=e-d;0<=g&&1>g?this.rgba([d+e,k+e,e,f]):1<=g&&2>g?this.rgba([k+e,d+e,e,f]):2<=g&&3>g?this.rgba([e,d+e,k+e,f]):3<=g&&4>g?this.rgba([e,k+e,d+e,f]):4<=g&&5>g?this.rgba([k+e,e,d+e,f]):5<=g&&6>g?this.rgba([d+e,e,k+e,f]):this.rgba([e,e,e,f]);return c}var g=this.r(),k=this.g(),e=this.b(),f=this.a(),l=Math.max(g,k,e),d=Math.min(g,k,e),d=l-d;c=0;c=0==d?0:l==g?(k-e)/d%6:(l=k)?(e-g)/d+2:(g-k)/d+4;e=l;g=0;0!=d&&(g=d/e);return[c/6,g,e,f]},hue:function(c){var d=this.hsba();void 0!==c&&(d[0]=c,this.hsba(c,d[1],
d[2],d[3]));return d[0]},saturation:function(c){var d=this.hsba();void 0!==c&&(d[1]=c,this.hsba(d[0],c,d[2],d[3]));return d[1]},brightness:function(c){var d=this.hsba();void 0!==c&&(d[2]=c,this.hsba(d[0],d[1],c,d[3]));return d[2]},useMe:function(c){var d=TentaGL.ShaderLib.current(c);d.setColor&&d.setColor(c,this._rgba)},equals:function(c){return this.r()==c.r()&&this.g()==c.g()&&this.b()==c.b()&&this.a()==c.a()},toCSS:function(){return"rgb("+this.getRedByte()+","+this.getGreenByte()+","+this.getBlueByte()+
")"}};Util.Inheritance.inherit(TentaGL.Color,TentaGL.Material);TentaGL.Color.RGBA=function(c,d,e,f){return new TentaGL.Color([c,d,e,f])};TentaGL.Color.RGBABytes=function(c,d,e,f){void 0===f&&(f=255);return new TentaGL.Color([c/255,d/255,e/255,f/255])};TentaGL.Color.Hex=function(c){var d=new TentaGL.Color;d.hex(c);return d};TentaGL.Color.HSBA=function(c){c=new TentaGL.Color;c.hsba([h,s,b,a]);return c};TentaGL.Color.rgba2Hex=function(c,d,e,f){c=(f<<24)+(c<<16);c+=d<<8;c+=e;return c>>>0};
TentaGL.Color.RGBAtoHSBA=function(c,d,e,f){void 0===f&&(f=1);var g=Math.max(c,d,e),k=Math.min(c,d,e),k=g-k,l=0,l=0==k?0:g==c?(d-e)/k%6:(g=d)?(e-c)/k+2:(c-d)/k+4;c=g;d=0;0!=k&&(d=k/c);return[l/6,d,c,f]};TentaGL.Color.HSBAtoRGBA=function(c,d,e,f){void 0===f&&(f=1);c=6*(c-Math.floor(c));d*=e;var g=d*(1-Math.abs(c%2-1));e-=d;return 0<=c&&1>c?[d+e,g+e,e,f]:1<=c&&2>c?[g+e,d+e,e,f]:2<=c&&3>c?[e,d+e,g+e,f]:3<=c&&4>c?[e,g+e,d+e,f]:4<=c&&5>c?[g+e,e,d+e,f]:5<=c&&6>c?[d+e,e,g+e,f]:[e,e,e,f]};
TentaGL.Color.hexToRGBA=function(c){return vec4.fromValues((c>>>16&255)/255,(c>>>8&255)/255,(c&255)/255,(c>>>24&255)/255)};TentaGL.Color.BLACK=TentaGL.Color.Hex(4278190080);TentaGL.Color.BLUE=TentaGL.Color.Hex(4278190335);TentaGL.Color.CYAN=TentaGL.Color.Hex(4278255615);TentaGL.Color.GREEN=TentaGL.Color.Hex(4278255360);TentaGL.Color.GREY=TentaGL.Color.Hex(4287137928);TentaGL.Color.MAGENTA=TentaGL.Color.Hex(4294902015);TentaGL.Color.RED=TentaGL.Color.Hex(4294901760);TentaGL.Color.WHITE=TentaGL.Color.Hex(4294967295);
TentaGL.Color.YELLOW=TentaGL.Color.Hex(4294967040);TentaGL.Gradient=function(c,d){this._pt=vec2.clone(c);this._vec=vec2.clone(d);this._breakPts=[]};
TentaGL.Gradient.prototype={constructor:TentaGL.Gradient,isaGradient:!0,getStartPoint:function(){return this._pt},getVector:function(){return this._vec},getRadius:function(){return vec2.length(this._vec)},addBreakPt:function(c,d){if(0==this._breakPts.length)this._breakPts[0]=[c,d];else{for(var e=0,f=0;f<this._breakPts.length;f++)c>this._breakPts[f][0]&&(e=f+1);this._breakPts.splice(e,0,[c,d])}return this},getBreakPt:function(c){return this._breakPts[c][0]},getBreakPts:function(){for(var c=[],d=0;d<
this._breakPts.length;d++)c.push(this._breakPts[d][0]);return c},getColor:function(c){return this._breakPts[c][1]},getColors:function(){for(var c=[],d=0;d<this._breakPts.length;d++)c.push(this._breakPts[d][1]);return c},useMe:function(c){var d=TentaGL.ShaderLib.current(c);d.setStartPoint&&(d.setStartPoint(c,this._pt),d.setGradVector(c,this._vec),d.setColors(c,this.getColors()),d.setBreakPoints(c,this.getBreakPts()))}};Util.Inheritance.inherit(TentaGL.Gradient,TentaGL.Material);
TentaGL.Texture=function(c){this._tex=TentaGL.Texture.create(c);this._height=this._width=1;this._minFilter=this._magFilter=GL_NEAREST;this._wrapT=this._wrapS=GL_CLAMP_TO_EDGE};
TentaGL.Texture.prototype={constructor:TentaGL.Texture,isaTexture:!0,clean:function(c){c.deleteTexture(this._tex)},getLocation:function(){return this._tex},getWidth:function(){return this._width},getHeight:function(){return this._height},magFilter:function(c,d){c.bindTexture(c.TEXTURE_2D,this._tex);void 0!==d&&c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,d);return c.getTexParameter(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER)},minFilter:function(c,d){c.bindTexture(c.TEXTURE_2D,this._tex);void 0!==d&&c.texParameteri(c.TEXTURE_2D,
c.TEXTURE_MIN_FILTER,d);return c.getTexParameter(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER)},wrapS:function(c,d){c.bindTexture(c.TEXTURE_2D,this._tex);void 0!==d&&c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,d);return c.getTexParameter(c.TEXTURE_2D,c.TEXTURE_WRAP_S)},wrapT:function(c,d){c.bindTexture(c.TEXTURE_2D,this._tex);void 0!==d&&c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,d);return c.getTexParameter(c.TEXTURE_2D,c.TEXTURE_WRAP_T)},getPixelData:function(c,d,e,f,g,k){d=d||0;e=e||0;f=f||this._width-
d;g=g||this._height-e;return TentaGL.PixelData.fromGLTexture(c,this._tex,d,e,f,g,k)},setPixelData:function(c,d){var e=d.getData(),f=d.getWidth(),g=d.getHeight();c.bindTexture(c.TEXTURE_2D,this._tex);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,f,g,0,c.RGBA,c.UNSIGNED_BYTE,e);this._width=f;this._height=g;TentaGL.MaterialLib.useNone(c)},useMe:function(c){TentaGL.ShaderLib.current(c).setTex&&(c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,this._tex),TentaGL.ShaderLib.current(c).setTex(c,0))},render:function(c,
d,e){TentaGL.ViewTrans.push(c);this.useMe(c);var f;e?f=e/this.getHeight()*this.getWidth():(f=this.getWidth(),e=this.getHeight());TentaGL.ViewTrans.scale(c,[f,e]);d?TentaGL.ModelLib.render(c,"unitSprite"):TentaGL.ModelLib.render(c,"unitPlane");TentaGL.ViewTrans.pop(c)}};Util.Inheritance.inherit(TentaGL.Texture,TentaGL.Material);
TentaGL.Texture.create=function(c,d,e,f){d=d||null;e=e||1;f=f||1;var g=c.createTexture();c.bindTexture(GL_TEXTURE_2D,g);c.texImage2D(GL_TEXTURE_2D,0,GL_RGBA,e,f,0,GL_RGBA,GL_UNSIGNED_BYTE,d);c.texParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_NEAREST);c.texParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_NEAREST);c.texParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_S,GL_CLAMP_TO_EDGE);c.texParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_T,GL_CLAMP_TO_EDGE);return g};
TentaGL.Texture.fromURL=function(c,d,e,f){var g=new TentaGL.Texture(c);TentaGL.PixelData.fromURL(d,function(d){e&&(d=e(d));g.setPixelData(c,d);f&&f(g)});return g};TentaGL.Texture.fromCanvas=function(c,d,e,f){d=TentaGL.PixelData.fromCanvas(d);return TentaGL.Texture.fromPixelData(c,d,e,f)};TentaGL.Texture.fromPixelData=function(c,d,e,f){e&&(d=e(d));e=new TentaGL.Texture(c);e.setPixelData(c,d);f&&f(e);return e};
TentaGL.Texture.fromColor=function(c,d,e,f){d=TentaGL.Canvas2D.createRect(8,8,!1,0,d);return TentaGL.Texture.fromCanvas(c,d,e,f)};
TentaGL.MaterialLib={_materials:{},clean:function(c){for(var d in c._materialLib)c._materialLib[d].clean(c);c._materialLib={}},reset:function(c){this.clean(c);this.add(c,"default",TentaGL.Color.WHITE);this.add(c,"_defaultTooltipBGColor",TentaGL.Color.Hex(4293848763))},get:function(c,d){var e=c._materialLib[d];if(void 0===e)throw Error("Material "+d+" doesn't exist.");return e},has:function(c,d){return void 0!==c._materialLib[d]},add:function(c,d,e){if(void 0!==c._materialLib[d])throw Error("Material "+
d+" already exists.");if(!e.isaMaterial)throw Error("Object for "+d+" isn't a material!");return c._materialLib[d]=e},remove:function(c,d){var e=c._materialLib[d];if(void 0===e)throw Error("Material "+d+" doesn't exist.");e.clean(c);delete c._materialLib[d]},use:function(c,d){if(c._materialLibCurrentName!==d){var e=c._materialLib[d];if(void 0===e)throw Error("Material "+d+" doesn't exist.");e.useMe(c);c._materialLibCurrentName=d}},useNone:function(c){c._materialLibCurrentName=void 0}};
TentaGL.MaterialProps=function(c,d,e,f,g){c||(c=TentaGL.Color.RGBA(1,1,1,1));d||(d=TentaGL.Color.RGBA(1,1,1,1));e||(e=10);f||(f=TentaGL.Color.RGBA(1,1,1,1));g||(g=TentaGL.Color.RGBA(0,0,0,1));this._diffuse=c;this._specular=d;this._shininess=e;this._ambient=f;this._emission=g};
TentaGL.MaterialProps.prototype={constructor:TentaGL.MaterialProps,isaMaterialProps:!0,diffuse:function(c){c&&(this._diffuse=c.clone());return this._diffuse},specular:function(c){c&&(this._specular=c.clone());return this._specular},shininess:function(c){void 0!==c&&(this._shininess=c);return this._shininess},ambient:function(c){c&&(this._ambient=c.clone());return this._ambient},emission:function(c){c&&(this._emission=c.clone());return this._emission},useMe:function(c){var d=TentaGL.ShaderLib.current(c);
d.setMaterialProps&&d.setMaterialProps(c,this)}};
TentaGL.ClippingArea={reset:function(c){c._clipLevel=0;c._clipFuncs=[];c._clipFuncsStack=[]},clip:function(c,d){TentaGL.ColorBuffer.push(c);TentaGL.DepthBuffer.push(c);TentaGL.Stencil.push(c);c._clipLevel++;TentaGL.DepthBuffer.clear(c);TentaGL.Stencil.enabled(c,!0);TentaGL.Stencil.func(c,GL_GREATER,c._clipLevel);TentaGL.Stencil.op(c,GL_KEEP,GL_INCR,GL_INCR);TentaGL.Stencil.mask(c,255);TentaGL.ColorBuffer.mask(c,!1,!1,!1,!1);TentaGL.DepthBuffer.mask(c,!1);d(c);c._clipFuncs.push(d);TentaGL.Stencil.pop(c);
TentaGL.DepthBuffer.pop(c);TentaGL.ColorBuffer.pop(c);TentaGL.Stencil.enabled(c,!0);TentaGL.Stencil.func(c,GL_EQUAL,c._clipLevel);TentaGL.Stencil.mask(c,0)},getClip:function(c){return c._clipFuncs.slice(0)},setClip:function(c,d){this.clear(c);if("[object Array]"===Object.prototype.toString.call(d))for(var e=0;e<d.length;e++)this.clip(c,d[e]);else this.clip(c,d)},clear:function(c){TentaGL.Stencil.push(c);TentaGL.Stencil.enabled(c,!0);TentaGL.Stencil.mask(c,255);TentaGL.Stencil.clear(c,0);TentaGL.Stencil.pop(c);
c._clipLevel=0;c._clipFuncs=[]},push:function(c){c._clipFuncsStack.push(c._clipFuncs)},pop:function(c){var d=c._clipFuncsStack.pop();this.setClip(c,d)}};TentaGL.SceneNode=function(c){void 0===c&&(c=[0,0,0]);c[2]||(c[2]=0);this._xyz=vec3.copy([],c);this._scaleXYZ=[1,1,1];this._scaleUni=1;this._quat=quat.create();this._objLook=[0,0,1];this._objUp=[0,1,0];this._transform=mat4.create();this._isVisible=this._tranDirty=!0;this._opacity=1;this._parent=void 0};
TentaGL.SceneNode.prototype={constructor:TentaGL.SceneNode,isaSceneNode:!0,clean:function(c){},getParent:function(){return this._parent},setParent:function(c){this._parent=c},hasParent:function(){return this._parent?!0:!1},removeFromParent:function(){this._parent&&this._parent.remove&&(this._parent.remove(this),this._parent=null)},isVisible:function(){return this._isVisible},setVisible:function(c){this._isVisible=c},opacity:function(c){void 0!==c&&(this._opacity=Math.max(0,Math.min(c,1)));return this._opacity},
useOpacity:function(c){var d=TentaGL.ShaderLib.current(c);d.setOpacity&&d.setOpacity(c,this._opacity)},getWorldXYZ:function(){var c=this.getWorldTransform();return[c[12],c[13],c[14]]},xyz:function(c){void 0!==c&&(this._xyz=vec3.copy([],c),this._tranDirty=!0);return this._xyz},x:function(c){if(void 0!==c)this._xyz[0]=c,this._tranDirty=!0;else return this._xyz[0]},y:function(c){if(void 0!==c)this._xyz[1]=c,this._tranDirty=!0;else return this._xyz[1]},z:function(c){if(void 0!==c)this._xyz[2]=c,this._tranDirty=
!0;else return this._xyz[2]},getQuat:function(){return this._quat},getWorldQuat:function(){return this._getWorldQuat(quat.create())},_getWorldQuat:function(c){quat.mul(c,this.getQuat(),c);return this._parent?this._parent._getWorldQuat(c):c},setQuat:function(c){this._quat=c;this._tranDirty=!0},getParentWorldQuat:function(){return this._parent?this._parent.getWorldQuat():quat.create()},rotate:function(c,d){var e=quat.setAxisAngle(quat.create(),c,d);this.setQuat(quat.mul(this._quat,e,this._quat))},mulQuat:function(c){this.setQuat(quat.mul(this._quat,
c,this._quat))},getBaseLook:function(){return this._objLook},getWorldBaseLook:function(){var c=this.getParentWorldQuat();return vec3.transformQuat(vec3.create(),this._objLook,c)},setBaseLook:function(c){vec3.normalize(this._objLook,c);this._correctUpVector()},getLook:function(){return vec3.transformQuat(vec3.create(),this._objLook,this._quat)},getWorldLook:function(){var c=this.getWorldQuat();return vec3.transformQuat(vec3.create(),this.getBaseLook(),c)},getBaseRight:function(){return vec3.cross(vec3.create(),
this._objLook,this._objUp)},getWorldBaseRight:function(){var c=this.getParentWorldQuat();return vec3.transformQuat(vec3.create(),this.getBaseRight(),c)},getRight:function(){return vec3.transformQuat(vec3.create(),this.getBaseRight(),this._quat)},getWorldRight:function(){var c=this.getWorldQuat();return vec3.transformQuat(vec3.create(),this.getBaseRight(),c)},getUp:function(){return vec3.transformQuat(vec3.create(),this._objUp,this._quat)},getWorldUp:function(){var c=this.getWorldQuat();return vec3.transformQuat(vec3.create(),
this.getBaseUp(),c)},getBaseUp:function(){return this._objUp},getWorldBaseUp:function(){var c=this.getParentWorldQuat();return vec3.transformQuat(vec3.create(),this._objUp,c)},setBaseUp:function(c){vec3.normalize(this._objUp,c);this._correctUpVector()},_correctUpVector:function(){var c=this._objLook,d=this._objUp,e=vec3.cross(vec3.create(),c,d);this._objUp=vec3.cross(d,e,c)},getBaseLookVectors:function(){return[this.getBaseLook(),this.getBaseUp(),this.getBaseRight()]},getLookVectors:function(){this.getQuat();
var c=vec3.transformQuat(vec3.create(),this._objLook,this._quat),d=vec3.transformQuat(vec3.create(),this._objUp,this._quat),e=vec3.transformQuat(vec3.create(),this.getBaseRight,this._quat);return[c,d,e]},getWorldLookVectors:function(){this.getWorldQuat();var c=vec3.transformQuat(vec3.create(),this._objLook,this._quat),d=vec3.transformQuat(vec3.create(),this._objUp,this._quat),e=vec3.transformQuat(vec3.create(),this.getBaseRight,this._quat);return[c,d,e]},orient:function(c,d){this.setQuat(TentaGL.Math.getOrientation(this.getBaseLook(),
this.getBaseUp(),c,d))},orientWorld:function(c,d){var e=this.getParentWorldQuat();quat.invert(e,e);c=vec3.transformQuat(vec3.create(),c,e);d=vec3.transformQuat(vec3.create(),d,e);this.setQuat(TentaGL.Math.getOrientation(this.getBaseLook(),this.getBaseUp(),c,d))},lookAt:function(c){var d=this.xyz();c=vec3.fromValues(c[0]-d[0],c[1]-d[1],c[2]-d[2]);d=vec3.cross(vec3.create(),c,this.getBaseUp());d=vec3.cross(vec3.create(),d,c);this.orient(c,d)},lookAtWorld:function(c){var d=this.getWorldXYZ();c=vec3.fromValues(c[0]-
d[0],c[1]-d[1],c[2]-d[2]);d=vec3.cross(vec3.create(),c,this.getWorldBaseUp());d=vec3.cross(vec3.create(),d,c);this.orientWorld(c,d)},billboardPoint:function(c,d){var e=this.xyz(),e=vec3.fromValues(c[0]-e[0],c[1]-e[1],c[2]-e[2]),f=vec3.cross(vec3.create(),e,d);d=vec3.cross(vec3.create(),f,e);this.orient(e,d)},billboardWorldPoint:function(c,d){var e=this.getWorldXYZ(),e=vec3.fromValues(c[0]-e[0],c[1]-e[1],c[2]-e[2]),f=vec3.cross(vec3.create(),e,d);d=vec3.cross(vec3.create(),f,e);this.orientWorld(e,
d)},billboardAxis:function(c){var d=this.xyz(),e=this.getBaseLook(),f=this.getBaseUp();c=vec3.fromValues(c[0]-d[0],c[1]-d[1],c[2]-d[2]);var d=TentaGL.Math.getQuatFromTo(e,c),g=vec3.transformQuat(vec3.create(),f,d),k=vec3.cross(vec3.create(),c,f),k=vec3.cross(vec3.create(),k,c),g=TentaGL.Math.getQuatFromTo(g,k);quat.mul(d,g,d);g=TentaGL.Math.getQuatFromTo(k,f);quat.mul(d,g,d);c=vec3.transformQuat(c,e,d);this.orient(c,f)},billboardWorldAxis:function(c){var d=this.getWorldXYZ(),e=this.getWorldBaseLook(),
f=this.getWorldBaseUp();c=vec3.fromValues(c[0]-d[0],c[1]-d[1],c[2]-d[2]);var d=TentaGL.Math.getQuatFromTo(e,c),g=vec3.transformQuat(vec3.create(),f,d),k=vec3.cross(vec3.create(),c,f),k=vec3.cross(vec3.create(),k,c),g=TentaGL.Math.getQuatFromTo(g,k);quat.mul(d,g,d);g=TentaGL.Math.getQuatFromTo(k,f);quat.mul(d,g,d);c=vec3.transformQuat(c,e,d);this.orientWorld(c,f)},billboardPlane:function(c,d){this.orient(c,d)},billboardWorldPlane:function(c,d){this.orientWorld(c,d)},scale:function(c){void 0!==c&&(c[2]||
(c[2]=0),this._scaleXYZ=vec3.copy([],c),this._tranDirty=!0);return this._ScaleXYZ},scaleX:function(c){void 0!==c&&(this._scaleXYZ[0]=c,this._tranDirty=!0);return this._scaleXYZ[0]},scaleY:function(c){void 0!==c&&(this._scaleXYZ[1]=c,this._tranDirty=!0);return this._scaleXYZ[1]},scaleZ:function(c){void 0!==c&&(this._scaleXYZ[2]=c,this._tranDirty=!0);return this._scaleXYZ[2]},scaleU:function(c){void 0!==c&&(this._scaleUni=c,this._tranDirty=!0);return this._scaleUni},getWorldScaleU:function(){var c=
this.scaleU();this._parent&&(c*=this._parent.getWorldScaleU());return c},getModelTransform:function(){this._tranDirty&&(this._transform=this.getTRSTransform(),this._tranDirty=!1);return this._transform},getTRSTransform:function(){var c=this.x(),d=this.y(),e=this.z(),f=this.scaleU(),g=this.scaleX()*f,k=this.scaleY()*f,f=this.scaleZ()*f,l=this._transform;mat4.fromQuat(l,this.getQuat());l[0]*=g;l[1]*=g;l[2]*=g;l[4]*=k;l[5]*=k;l[6]*=k;l[8]*=f;l[9]*=f;l[10]*=f;l[12]=c;l[13]=d;l[14]=e;l[15]=1;return l},
getWorldTransform:function(){return this._getWorldTransform(mat4.create())},_getWorldTransform:function(c){mat4.mul(c,this.getModelTransform(),c);this._parent&&this._parent._getWorldTransform(c);return c},render:function(c){this.isVisible()&&TentaGL.SceneNode.filter(this)&&(TentaGL.ViewTrans.push(c),TentaGL.ViewTrans.mul(c,this.getModelTransform()),this.useOpacity(c),this.draw(c),TentaGL.ViewTrans.pop(c))},renderComposite:function(c){this.isVisible()&&(TentaGL.ViewTrans.push(c),TentaGL.ViewTrans.mul(c,
this.getModelTransform()),this.useOpacity(c),this.draw(c),TentaGL.ViewTrans.pop(c))},draw:function(c){}};TentaGL.SceneNode.defaultRenderFilter=function(c){return!0};TentaGL.SceneNode.getRenderFilter=function(){TentaGL.SceneNode._renderFilter||TentaGL.SceneNode.resetRenderFilter();return TentaGL.SceneNode._renderFilter};TentaGL.SceneNode.setRenderFilter=function(c){TentaGL.SceneNode._renderFilter=c};TentaGL.SceneNode.resetRenderFilter=function(){TentaGL.SceneNode.setRenderFilter(TentaGL.SceneNode.defaultRenderFilter)};
TentaGL.SceneNode.filter=function(c){return TentaGL.SceneNode.getRenderFilter()(c)};Util.Inheritance.inherit(TentaGL.SceneNode,TentaGL.Renderable);TentaGL.SceneGroup=function(c){TentaGL.SceneNode.call(this,c);this._children=[]};
TentaGL.SceneGroup.prototype={constructor:TentaGL.SceneGroup,clean:function(c){for(var d in this._children)this._children[d].clean(c);this.clear()},indexOf:function(c){return this._children.indexOf(c)},get:function(c){return this._children[c]},getChildren:function(){return this._children.slice(0)},add:function(c){this._children.push(c);c.setParent(this)},size:function(){return this._children.length},remove:function(c){c=this._children.indexOf(c);if(-1==c)return!1;this._children.splice(c,1);return!0},
clear:function(){this._children=[]},moveBack:function(c){c=this._children.indexOf(c);if(0<c){var d=this._children[c-1];this._children[c-1]=this._children[c];this._children[c]=d}},moveForward:function(c){-1!=index&&index<this._children.length&&(c=this._children[index+1],this._children[index+1]=this._children[index],this._children[index]=c)},moveToFront:function(c){this.remove(c)&&this._children.push(c)},moveToBack:function(c){this.remove(c)&&this._children.unshift(c)},renderSorted:function(c){if(this.isVisible()){var d=
TentaGL.ViewTrans.getCamera(c).getViewTransform();this._children.sort(function(c,f){var g=c.getWorldXYZ();vec3.transformMat4(g,g,d);var k=f.getWorldXYZ();vec3.transformMat4(k,k,d);return g[2]-k[2]});this.render(c)}},draw:function(c){for(var d=0;d<this.size();d++)this._children[d].render(c)}};Util.Inheritance.inherit(TentaGL.SceneGroup,TentaGL.SceneNode);TentaGL.Sprite=function(c){TentaGL.SceneNode.call(this,c);this._anchorXYZ=vec4.fromValues(0,0,0,1)};
TentaGL.Sprite.prototype={constructor:TentaGL.Sprite,isaSprite:!0,getAnchorX:function(){return this._anchorXYZ[0]},getAnchorY:function(){return this._anchorXYZ[1]},getAnchorZ:function(){return this._anchorXYZ[2]},anchor:function(c){void 0!==c&&(c[2]||(c[2]=0),this._anchorXYZ=vec4.fromValues(c[0],c[1],c[2],1));return this._anchorXYZ},getWidth:function(){return 0},getHeight:function(){return 0},getDepth:function(){return 0},getDimensions:function(){return[this.getWidth(),this.getHeight(),this.getDepth()]},
getBounds2D:function(){return new TentaGL.Math.Rect2D([this._xyz[0],this._xyz[1]],this.getWidth(),this.getHeight())},getBounds3D:function(){return new TentaGL.Math.Rect3D(this._xyz,this.getWidth(),this.getHeight(),this.getDepth())},getTRSTransform:function(){var c=this.x(),d=this.y(),e=this.z(),f=0-this.getAnchorX(),g=0-this.getAnchorY(),k=0-this.getAnchorZ(),l=this.scaleU(),m=this.scaleX()*l,p=this.scaleY()*l,l=this.scaleZ()*l,n=this._transform;mat4.fromQuat(n,this.getQuat());n[0]*=m;n[1]*=m;n[2]*=
m;n[4]*=p;n[5]*=p;n[6]*=p;n[8]*=l;n[9]*=l;n[10]*=l;n[12]=f*n[0]+g*n[4]+k*n[8]+c;n[13]=f*n[1]+g*n[5]+k*n[9]+d;n[14]=f*n[2]+g*n[6]+k*n[10]+e;n[15]=1;return n},draw:function(c){}};Util.Inheritance.inherit(TentaGL.Sprite,TentaGL.SceneNode);TentaGL.Sprite.create=function(c,d,e,f,g){c=new TentaGL.Sprite(c);g||(g=new TentaGL.MaterialProps);c.draw=function(c){try{TentaGL.ShaderLib.use(c,f),TentaGL.MaterialLib.use(c,e),g.useMe(c),TentaGL.ModelLib.render(c,d)}catch(l){}};return c};
TentaGL.BillboardSprite=function(c){TentaGL.Sprite.call(this,c)};TentaGL.BillboardSprite.prototype={constructor:TentaGL.BillboardSprite,isaBillboardSprite:!0,render:function(c){if(this.isVisible()&&TentaGL.SceneNode.filter(this)){TentaGL.ViewTrans.push(c);var d=TentaGL.ViewTrans.getCamera(c),e=d.getEye();this.billboardWorldPoint(e,d.getUp());TentaGL.ViewTrans.mul(c,this.getModelTransform());this.useOpacity(c);this.draw(c);TentaGL.ViewTrans.pop(c)}},draw:function(c){}};
Util.Inheritance.inherit(TentaGL.BillboardSprite,TentaGL.Sprite);TentaGL.IconSprite=function(c){TentaGL.Sprite.call(this,c);this._hAlign=TentaGL.Align.LEFT;this._vAlign=TentaGL.Align.BOTTOM};
TentaGL.IconSprite.prototype={constructor:TentaGL.IconSprite,isaIconSprite:!0,getIconWidth:function(){},getIconHeight:function(){},getIconAspect:function(){return this.getIconWidth()/this.getIconHeight()},setAlignment:function(c,d){this._hAlign=c;this._vAlign=d;this._updateAlignment()},_updateAlignment:function(){var c=void 0,d=void 0;this._hAlign==TentaGL.Align.LEFT?c=0:this._hAlign==TentaGL.Align.CENTER?c=this.getIconWidth()/2:this._hAlign==TentaGL.Align.RIGHT&&(c=this.getIconWidth());this._vAlign==
TentaGL.Align.BOTTOM?d=0:this._vAlign==TentaGL.Align.CENTER?d=this.getIconHeight()/2:this._vAlign==TentaGL.Align.TOP&&(d=this.getIconHeight());this.anchor([c,d,0])},scaleIconDims:function(){this.scale([this.getIconWidth(),this.getIconHeight(),1])},scaleToWidth:function(c){var d=this.getIconWidth()/this.getIconHeight();this.scale([c,c/d,1])},scaleToHeight:function(c){var d=this.getIconWidth()/this.getIconHeight();this.scale([c*d,c,1])},render:function(c){if(this.isVisible()&&TentaGL.SceneNode.filter(this)){TentaGL.ViewTrans.push(c);
this._updateAlignment();var d=TentaGL.ViewTrans.getCamera(c);d.getEye();this.billboardWorldPlane(vec3.negate(vec3.create(),d.getLook()),d.getUp());TentaGL.ViewTrans.mul(c,this.getModelTransform());this.useOpacity(c);this.draw(c);TentaGL.ViewTrans.pop(c)}},renderComposite:function(c){if(this.isVisible()){TentaGL.ViewTrans.push(c);this._updateAlignment();var d=TentaGL.ViewTrans.getCamera(c);d.getEye();this.billboardWorldPlane(vec3.negate(vec3.create(),d.getLook()),d.getUp());TentaGL.ViewTrans.mul(c,
this.getModelTransform());this.useOpacity(c);this.draw(c);TentaGL.ViewTrans.pop(c)}},draw:function(c){}};Util.Inheritance.inherit(TentaGL.IconSprite,TentaGL.Sprite);TentaGL.ImageIconSprite=function(c,d){TentaGL.IconSprite.call(this,c);this._texName=d;this._texHeight=this._texWidth=1};
TentaGL.ImageIconSprite.prototype={constructor:TentaGL.ImageIconSprite,isaImageIconSprite:!0,getTextureName:function(){return this._texName},setTextureName:function(c){this._texName=c},getTexture:function(c){return TentaGL.MaterialLib.get(c,this._texName)},getPixelData:function(c){return this.getTexture(c).getPixelData()},getIconWidth:function(){return this._texWidth/this._texHeight},getIconHeight:function(){return 1},getTextureWidth:function(){return this._texWidth},getTextureHeight:function(){return this._texHeight},
draw:function(c){TentaGL.MaterialLib.use(c,this._texName);var d=this.getTexture(c);this._texWidth=d.getWidth();this._texHeight=d.getHeight();var d=this.getIconWidth(),e=this.getIconHeight();TentaGL.ViewTrans.scale(c,[d,e]);TentaGL.ModelLib.render(c,"unitPlane")}};Util.Inheritance.inherit(TentaGL.ImageIconSprite,TentaGL.IconSprite);TentaGL.LabelledIconSprite=function(c,d,e,f,g){TentaGL.Sprite.call(this,c);this._createIcon(d);this._createLabel(e,f,g)};
TentaGL.LabelledIconSprite.prototype={constructor:TentaGL.LabelledIconSprite,isaLabelledIconSprite:!0,_createIcon:function(c){c=this._icon=new TentaGL.ImageIconSprite([0,0,0],c);c.setAlignment(TentaGL.Align.CENTER,TentaGL.Align.CENTER);c.setParent(this)},_createLabel:function(c,d,e){c=this._label=new TentaGL.TextIconSprite([0,.3,.001],c,e,.5);c.setAlignment(TentaGL.Align.CENTER,TentaGL.Align.BOTTOM);c.setParent(this);d=this._labelBG=new TentaGL.ImageIconSprite([0,.3,5E-4],d);d.setAlignment(TentaGL.Align.CENTER,
TentaGL.Align.BOTTOM);this._fitLabelBG();d.setParent(this)},_fitLabelBG:function(){this._labelBG.scale([this._label.getIconWidth()/this._labelBG.getIconWidth()+.1,this._label.getIconHeight()/this._labelBG.getIconHeight(),1])},getIcon:function(){return this._icon.getTextureName()},setIcon:function(c){this._icon.setTextureName(c)},getText:function(){return this._label.getText()},setText:function(c){this._label.setText(c);this._fitLabelBG()},getLabelBG:function(){return this._labelBG.getTextureName()},
setLabelBG:function(c){this._labelBG.setTextureName(c)},getIconWidth:function(){return this._icon.getIconWidth()},getIconHeight:function(){return this._icon.getIconHeight()},render:function(c){if(this.isVisible()&&TentaGL.SceneNode.filter(this)){TentaGL.ViewTrans.push(c);var d=TentaGL.ViewTrans.getCamera(c);d.getEye();this.billboardWorldPlane(vec3.negate(vec3.create(),d.getLook()),d.getUp());this._fitLabelBG();TentaGL.ViewTrans.mul(c,this.getModelTransform());this._icon.renderComposite(c);this._label.renderComposite(c);
this._labelBG.renderComposite(c);TentaGL.ViewTrans.pop(c)}}};Util.Inheritance.inherit(TentaGL.LabelledIconSprite,TentaGL.Sprite);TentaGL.TextSprite=function(c,d,e,f,g){TentaGL.Sprite.call(this,c);f||(f=!1);this._blitFont=e;this._charH=g;this._yFlipped=f;this.setText(d)};
TentaGL.TextSprite.prototype={constructor:TentaGL.TextSprite,isaTextSprite:!0,getText:function(){return this._text},setText:function(c){this._text=c;c=this._blitFont.getStringDimensions(c,this._charH);this._width=c[0];this._height=c[1]},getBlitteredFont:function(){return this._blitFont},setBlitteredFont:function(c){this._blitFont=c},getLineHeight:function(){if(void 0===this._charH)this._blitFont.getLineHeight();else return this._charH},setLineHeight:function(c){this._charH=c},getWidth:function(){return this._width},
getHeight:function(){return this._height},draw:function(c){this._blitFont.renderString(c,this._text,[0,0,0],this._yFlipped,this._charH)}};Util.Inheritance.inherit(TentaGL.TextSprite,TentaGL.Sprite);TentaGL.TextIconSprite=function(c,d,e,f){TentaGL.IconSprite.call(this);TentaGL.TextSprite.call(this,c,d,e);f||(f=1);this._lineHeight=f};
TentaGL.TextIconSprite.prototype={constructor:TentaGL.TextIconSprite,isaTextIconSprite:!0,getIconWidth:function(){return this.getBlitteredFont().getStringDimensions(this._text,this._lineHeight)[0]},getIconHeight:function(){return this.getBlitteredFont().getStringDimensions(this._text,this._lineHeight)[1]},getLineHeight:function(){return this._lineHeight},setLineHeight:function(c){this._lineHeight=c},draw:function(c){var d=this.getBlitteredFont().getStringDimensions(this._text,this._lineHeight);TentaGL.ViewTrans.translate(c,
[0,d[1]-this._lineHeight,0]);this.getBlitteredFont().renderString(c,this._text,[0,0,0],this._yFlipped,this._lineHeight)}};Util.Inheritance.inherit(TentaGL.TextIconSprite,TentaGL.IconSprite);Util.Inheritance.inherit(TentaGL.TextIconSprite,TentaGL.TextSprite);
TentaGL.ViewTrans={set:function(c,d){c._modelViewTrans=d},get:function(c){return c._modelViewTrans},mul:function(c,d){mat4.mul(c._modelViewTrans,c._modelViewTrans,d)},translate:function(c,d){d[2]||(d[2]=0);var e=mat4.create();mat4.translate(e,e,d);this.mul(c,e)},rotate:function(c,d,e){var f=quat.create();quat.setAxisAngle(f,d,e);d=mat4.create();mat4.fromQuat(d,f);this.mul(c,d)},scale:function(c,d){void 0===d[2]&&(d[2]=1);var e=mat4.create();mat4.scale(e,e,d);this.mul(c,e)},premul:function(c,d){mat4.mul(c._modelViewTrans,
d,c._modelViewTrans)},push:function(c){c._transformStack.push(mat4.clone(c._modelViewTrans))},pop:function(c){c._modelViewTrans=c._transformStack.pop()},reset:function(c){this.set(c,mat4.create());c._transformStack=[];this.setProjection(c,mat4.create());c._normalTrans=mat3.create();c._mvpTrans=mat4.create()},setView:function(c,d){this.set(d);c._viewTrans=d},getView:function(c){return c._viewTrans},mulView:function(c,d){mat4.mul(c._viewTrans,c._viewTrans,d)},premulView:function(c,d){mat4.mul(c._viewTrans,
d,c._viewTrans)},setProjection:function(c,d){c._projTrans=d},getProjection:function(c){return c._projTrans},mulProjection:function(c,d){mat4.mul(c._projTrans,c._projTrans,d)},premulProjection:function(c,d){mat4.mul(c._projTrans,d,c._projTrans)},getNormal:function(c){return mat3.normalFromMat4(mat3.create(),c._modelViewTrans)},getProjectionNormal:function(c){return mat3.normalFromMat4(mat3.create(),this.getMVP(c))},getMVP:function(c){return mat4.mul(mat4.create(),c._projTrans,c._modelViewTrans)},updateMVPUniforms:function(c){var d=
TentaGL.ShaderLib.current(c);d.setNormalTrans&&(mat3.normalFromMat4(c._normalTrans,c._modelViewTrans),d.setNormalTrans(c,c._normalTrans));d.setMVPTrans&&(mat4.mul(c._mvpTrans,c._projTrans,c._modelViewTrans),d.setMVPTrans(c,c._mvpTrans));d.setMVTrans&&d.setMVTrans(c,c._modelViewTrans);d.setVTrans&&d.setVTrans(c,c._viewTrans)},getCamera:function(c){return c._camera},setCamera:function(c,d,e){c._camera=d;this.set(c,d.getViewTransform());this.setView(c,d.getViewTransform());this.setProjection(c,d.getProjectionTransform(e))}};
TentaGL.BlitteredFont=function(c,d,e,f,g,k){c&&this._createChars(c,d,e,f);void 0===g&&(g=1);void 0===k&&(k=1);this._hPad=g;this._vPad=k;this._texIDPrefix="bfont"+TentaGL.BlitteredFont._count+":";TentaGL.BlitteredFont._count++};TentaGL.BlitteredFont._count=0;
TentaGL.BlitteredFont.prototype={constructor:TentaGL.BlitteredFont,isaBlitteredFont:!0,clean:function(c){for(var d in this._charPixData)TentaGL.MaterialLib.remove(c,this._texIDPrefix+d)},_createChars:function(c,d,e,f){this._charPixData={};this._charWidths={};this._monospaced=d;this._charW=e;this._charH=f;for(var g=32;128>g;g++){var k=Math.floor((g-32)/16),l=1+(g-32)%16*(e+2),m=c.getHeight()-(1+f+k*(2+f)),k=String.fromCharCode(g),l=c.crop(l,m,e,f);if(d||32==g)this._charWidths[k]=d||32!=g?e:e/2;else{for(var p=
0,n=l.getWidth()-1,q=!1;p<n&&!q;){for(m=0;m<l.getHeight();m++)if(0!=l.getPixelAt(p,m)[3]){q=!0;break}q||p++}for(q=!1;n>p&&!q;){for(m=0;m<l.getHeight();m++)if(0!=l.getPixelAt(n,m)[3]){q=!0;break}q||n--}m=n-p+1;l=l.crop(p,0,m,f);this._charWidths[k]=m}this._charPixData[k]=l;l.toCanvas()}},isMonospaced:function(){return this._monospaced},getLineHeight:function(){return this._charH},getCharPixelData:function(c){return this._charPixData[c]},getCharWidth:function(c){return this._charWidths[c]},getHorizontalPadding:function(){return this._hPad},
getVerticalPadding:function(){return this._vPad},_createTextures:function(c){for(var d in this._charPixData){var e=this._texIDPrefix+d,f=TentaGL.Texture.fromPixelData(c,this._charPixData[d]);TentaGL.MaterialLib.add(c,e,f)}},getStringDimensions:function(c,d){if(!this._charWidths)return[0,0];var e=0,f=0,g=this.getLineHeight(),k=this.getVerticalPadding(),l=this.getHorizontalPadding(),m=1;d&&(m=d/g);for(var p=c.split("\n"),n=0;n<p.length;n++){for(var q=p[n],t=0,r=0;r<q.length;r++)var w=q.charAt(r),w=
this.getCharWidth(w),t=t+(w+l);t>e&&(e=t);f+=g+k}return[e*m,f*m]},renderString:function(c,d,e,f,g){if(this._charPixData){TentaGL.MaterialLib.has(c,this._texIDPrefix+" ")||this._createTextures(c);var k=this.getLineHeight(),l=this.getVerticalPadding(),m=this.getHorizontalPadding();TentaGL.ViewTrans.push(c);TentaGL.ViewTrans.translate(c,e);g&&(e=g/k,TentaGL.ViewTrans.scale(c,[e,e]));d=d.split("\n");for(e=0;e<d.length;e++){g=d[e];TentaGL.ViewTrans.push(c);for(var p=0;p<g.length;p++){var n=g.charAt(p),
q=this._texIDPrefix+n,n=this.getCharWidth(n);TentaGL.MaterialLib.use(c,q);TentaGL.ViewTrans.push(c);TentaGL.ViewTrans.scale(c,[n,k]);TentaGL.ViewTrans.updateMVPUniforms(c);f?TentaGL.ModelLib.render(c,"unitSprite"):TentaGL.ModelLib.render(c,"unitPlane");TentaGL.ViewTrans.pop(c);TentaGL.ViewTrans.translate(c,[n+m,0])}TentaGL.ViewTrans.pop(c);f?TentaGL.ViewTrans.translate(c,[0,k+l]):TentaGL.ViewTrans.translate(c,[0,-(k+l)])}TentaGL.ViewTrans.pop(c)}}};
TentaGL.BlitteredFont.fromURL=function(c,d,e,f,g,k,l){var m=new TentaGL.BlitteredFont(void 0,d,e,f,g,k);TentaGL.PixelData.fromURL(c,function(c){l&&(c=l(c));m._createChars(c,d,e,f)});return m};
TentaGL.BlitteredFont.fromFont=function(c,d,e,f,g){var k="monospace"==c.getType(),l=c.getStringDimensions("W"),m=Math.floor(l[0]),l=Math.floor(l[1]);e=new TentaGL.BlitteredFont(void 0,k,m,l,e,f);f=1.5<d.r()+d.g()+d.b()?new TentaGL.Color.RGBA(0,0,0,1):new TentaGL.Color.RGBA(1,1,1,1);for(var p=TentaGL.Canvas2D.create(16*(m+2),6*(l+2),f),n=32;128>n;n++){var q=1+(n-32)%16*(m+2),t=1+Math.floor((n-32)/16)*(l+2),r=String.fromCharCode(n),w=TentaGL.Canvas2D.create(m,l,f);TentaGL.Canvas2D.drawString(w,r,c,
d,0,0);TentaGL.Canvas2D.drawImage(p,w,q,t)}c=TentaGL.PixelData.fromCanvas(p);c=c.filter(new TentaGL.RGBAFilter.OneColor(d,.5));g&&(c=g(c));e._createChars(c,k,m,l);return e};TentaGL.Font=function(c,d,e){this._name=c;this._type=d;this._size=e;this._italic=this._bold=!1;this._vPad=1};
TentaGL.Font.prototype={constructor:TentaGL.Font,getName:function(){return this._name},getType:function(){return this._type},getSize:function(){return this._size},getVerticalPadding:function(){return this._vPad},setVerticalPadding:function(c){this._vPad=c},isBold:function(){return this._bold},setBold:function(c){this._bold=c},isItalic:function(){return this._italic},setItalic:function(c){this._italic=c},toCSS:function(){var c="";this._italic&&(c+="italic ");this._bold&&(c+="bold ");c+=this._size+
"px ";return c+=this._name+","+this._type},getStringDimensions:function(c){var d=document.createElement("canvas").getContext("2d");d.font=this.toCSS();var e=0,f=0;c=c.split("\n");for(var g in c){var k=c[g],f=f+this._size,k=d.measureText(k).width;k>e&&(e=k);f+=this._vPad}f+=this._size/4;return[e,f]}};
TentaGL.ShaderVar=function(c,d){this._name=c.name;this._size=c.size;this._type=c.type;this._sizeBytes=c.size*TentaGL.glSizeBytes(c.type);this._sizeUnits=TentaGL.glSizeUnits(c.type);this._isArray=1<this._size;this._glProg=d};
TentaGL.ShaderVar.prototype={constructor:TentaGL.ShaderVar,getName:function(){return this._name},getSize:function(){return this._size},isArray:function(){return this._isArray},getSizeBytes:function(){return this._sizeBytes},getSizeUnits:function(){return this._sizeUnits},getType:function(){return this._type},getUnitType:function(){return TentaGL.glUnitType(this._type)},getTypeName:function(){return TentaGL.glTypeName(this._type)},isBuiltIn:function(){return"gl_"==this._substring(0,3).valueOf()}};
TentaGL.Attribute=function(c,d,e){TentaGL.ShaderVar.call(this,c,d);this._location=e};
TentaGL.Attribute.prototype={constructor:TentaGL.Attribute,getLocation:function(){return this._location},set:function(c,d,e){c.vertexAttribPointer(this._location,this.getSizeUnits(),this.getUnitType(),!1,d,e)},setGetter:function(c){this._getterFunc=c},getValues:function(c){c=this._getterFunc.call(c);if(c.length!=this.getSizeUnits())throw Error("Vertex attribute "+this.getName()+" is wrong size: "+c.length+". Expected: "+this.getSizeUnits());return c},getProfile:function(){this._profile||(this._profile=
new TentaGL.AttrProfile(TentaGL.UNKNOWN,this.getUnitType(),this.getSizeUnits(),this._getterFunc));return this._profile}};Util.Inheritance.inherit(TentaGL.Attribute,TentaGL.ShaderVar);TentaGL.Uniform=function(c,d,e){TentaGL.ShaderVar.call(this,c,d);this._location=e};TentaGL.Uniform.prototype={constructor:TentaGL.Uniform,getLocation:function(){return this._location},get:function(c){c.getUniform(this._glProg,this._location)},set:function(c,d){TentaGL.Uniform.setters[this._type].call(this,c,d)}};
Util.Inheritance.inherit(TentaGL.Uniform,TentaGL.ShaderVar);TentaGL.Uniform.setters=[];TentaGL.Uniform.setters[GL_FLOAT]=function(c,d){c.uniform1fv(this._location,d)};TentaGL.Uniform.setters[GL_FLOAT_VEC2]=function(c,d){c.uniform2fv(this._location,d)};TentaGL.Uniform.setters[GL_FLOAT_VEC3]=function(c,d){c.uniform3fv(this._location,d)};TentaGL.Uniform.setters[GL_FLOAT_VEC4]=function(c,d){c.uniform4fv(this._location,d)};TentaGL.Uniform.setters[GL_INT]=function(c,d){c.uniform1iv(this._location,d)};
TentaGL.Uniform.setters[GL_INT_VEC2]=function(c,d){c.uniform2iv(this._location,d)};TentaGL.Uniform.setters[GL_INT_VEC3]=function(c,d){c.uniform3iv(this._location,d)};TentaGL.Uniform.setters[GL_INT_VEC4]=function(c,d){c.uniform4iv(this._location,d)};TentaGL.Uniform.setters[GL_BOOL]=function(c,d){c.uniform1iv(this._location,d)};TentaGL.Uniform.setters[GL_BOOL_VEC2]=function(c,d){c.uniform2iv(this._location,d)};TentaGL.Uniform.setters[GL_BOOL_VEC3]=function(c,d){c.uniform3iv(this._location,d)};
TentaGL.Uniform.setters[GL_BOOL_VEC4]=function(c,d){c.uniform4iv(this._location,d)};TentaGL.Uniform.setters[GL_FLOAT_MAT2]=function(c,d){c.uniformMatrix2fv(this._location,!1,d)};TentaGL.Uniform.setters[GL_FLOAT_MAT3]=function(c,d){c.uniformMatrix3fv(this._location,!1,d)};TentaGL.Uniform.setters[GL_FLOAT_MAT4]=function(c,d){c.uniformMatrix4fv(this._location,!1,d)};TentaGL.Uniform.setters[GL_SAMPLER_2D]=function(c,d){c.uniform1iv(this._location,d)};
TentaGL.AttrProfile=function(c,d,e,f){if(!f)throw Error("Could not create AttrProfile without getter.");this._unitType=d;this._sizeUnits=e;this._getterFunc=f;if(c===TentaGL.UNKNOWN){c=!1;for(var g in TentaGL.AttrProfiles)if(this.equals(TentaGL.AttrProfiles[g])){this._id=g;c=!0;break}if(!c)throw Error("AttrProfile doesn't match any registered profiles: "+this.toString());}else this._id=c};
TentaGL.AttrProfile.prototype={constructor:TentaGL.AttrProfile,id:function(){return this._id},unitType:function(){return this._unitType},sizeUnits:function(){return this._sizeUnits},sizeBytes:function(){return this._sizeUnits*TentaGL.glSizeBytes(this._unitType)},getterFunc:function(){return this._getterFunc},equals:function(c){return this._getterFunc===c._getterFunc},getValues:function(c){c=this._getterFunc.call(c);if(c.length!=this.sizeUnits())throw Error("Vertex attribute is wrong size: "+c.length+
". Expected: "+this.sizeUnits());return c},toString:function(){return"AttrProfile(Unit type: "+TentaGL.glTypeName(this._unitType)+", Units Size: "+this._sizeUnits+", Getter Function: "+this._getterFunc+")"}};TentaGL.UNKNOWN=0;TentaGL.POS_4F=1;TentaGL.NORMAL_3F=2;TentaGL.TEX_2F=3;TentaGL.TANG_3F=4;TentaGL.BONE_I=5;TentaGL.AttrProfiles={};TentaGL.AttrProfiles[TentaGL.POS_4F]=new TentaGL.AttrProfile(TentaGL.POS_4F,GL_FLOAT,4,TentaGL.Vertex.prototype.xyz);
TentaGL.AttrProfiles[TentaGL.NORMAL_3F]=new TentaGL.AttrProfile(TentaGL.NORMAL_3F,GL_FLOAT,3,TentaGL.Vertex.prototype.normal);TentaGL.AttrProfiles[TentaGL.TEX_2F]=new TentaGL.AttrProfile(TentaGL.TEX_2F,GL_FLOAT,2,TentaGL.Vertex.prototype.texST);TentaGL.AttrProfiles[TentaGL.TANG_3F]=new TentaGL.AttrProfile(TentaGL.TANG_3F,GL_FLOAT,3,TentaGL.Vertex.prototype.tangental);
TentaGL.getDefaultAttrProfileSet=function(){TentaGL._defaultAttrProfileSet||(TentaGL._defaultAttrProfileSet=TentaGL.AttrProfiles.createSet([TentaGL.POS_4F,TentaGL.NORMAL_3F,TentaGL.TEX_2F,TentaGL.TANG_3F]));return TentaGL._defaultAttrProfileSet};TentaGL.AttrProfiles.createSet=function(c){for(var d={},e=0;e<c.length;e++){var f=c[e];d[f]=TentaGL.AttrProfiles[f]}return d};TentaGL.AttrProfiles.getStride=function(c){var d=0,e;for(e in c)d+=c[e].sizeBytes();return d};
TentaGL.ShaderLib={clean:function(c){for(var d in c._shaderLib)c._shaderLib[d].clean(c);c._shaderLib={};c._shaderStack=[]},reset:function(c){this.clean(c);TentaGL.DefaultShader.load(c,TentaGL.DefaultShader.SHADER_ID);TentaGL.PickShader.load(c,TentaGL.Picker.SHADER_ID);this.use(c,TentaGL.DefaultShader.SHADER_ID)},getDefaultShaderPath:function(c){c._shaderDir||(c._shaderDir="./shaders/");return c._shaderDir},setDefaultShaderPath:function(c,d){c._shaderDir=d},add:function(c,d,e){return c._shaderLib[d]=
e},remove:function(c,d){c._shaderLib[d].clean(c);delete c._shaderLib[d]},use:function(c,d){if(!TentaGL.Picker.isPicking(c)&&c._shaderLibCurrentName!==d){var e=c._shaderLib[d];e.useMe(c);e.setOpacity&&e.setOpacity(c,1);c._shaderLibCurrentProgram=e;c._shaderLibCurrentName=d;TentaGL.MaterialLib.useNone(c);return e}},current:function(c){return c._shaderLibCurrentProgram},currentName:function(c){return c._shaderLibCurrentName},push:function(c){c._shaderStack.push(c._shaderLibCurrentName)},pop:function(c){var d=
c._shaderStack.pop();this.use(c,d)}};
TentaGL.ShaderLoader={_numLoading:0,load:function(c,d,e){var f=this;this._numLoading++;var g=new XMLHttpRequest;g.open("get",c);g.onerror=function(c){console.log("AJAX error: ",c);f._numLoading--};g.onreadystatechange=function(c){4==this.readyState&&200==this.status&&f._loadFragSrc(g.responseText,d,e)};g.send()},_loadFragSrc:function(c,d,e){var f=this,g=new XMLHttpRequest;g.open("get",d);g.onerror=function(c){console.log("AJAX error: ",c);f._numLoading--};g.onreadystatechange=function(d){4==this.readyState&&
200==this.status&&(e(c,g.responseText),f._numLoading--)};g.send()},isLoading:function(){return 0<this._numLoading},getNumLoading:function(){return this._numLoading}};TentaGL.ShaderProgram=function(c,d,e){d=this._compileShader(c,GL_VERTEX_SHADER,d);e=this._compileShader(c,GL_FRAGMENT_SHADER,e);this._glProg=this._linkProgram(c,d,e);this._uniforms=this._initUniforms(c);this._attributes=this._initAttributes(c);this._showErrors=!0};
TentaGL.ShaderProgram.prototype={constructor:TentaGL.ShaderProgram,_compileShader:function(c,d,e){if(d!=GL_VERTEX_SHADER&&d!=GL_FRAGMENT_SHADER)throw Error("Invalid shader type constant: "+d);var f=c.createShader(d);c.shaderSource(f,e);c.compileShader(f);if(!c.getShaderParameter(f,GL_COMPILE_STATUS))throw c=c.getShaderInfoLog(f),e="",d==GL_VERTEX_SHADER?e="vertex":d==GL_FRAGMENT_SHADER&&(e="fragment"),Error("Failed to compile "+e+" shader :\n"+c);return f},_linkProgram:function(c,d,e){var f=c.createProgram();
c.attachShader(f,d);c.attachShader(f,e);c.linkProgram(f);if(!c.getProgramParameter(f,GL_LINK_STATUS))throw d=c.getProgramInfoLog(f),c=c.getParameter(c.MAX_VARYING_VECTORS),console.log("max varyings: "+c),Error("Failed to link shader program:\n"+d);return f},getLocation:function(){return this._glProg},clean:function(c){c.deleteProgram(this._glProg)},useMe:function(c){var d=TentaGL.ShaderLib.current(c);void 0!==d&&d._disableAllAttrs(c);c.useProgram(this._glProg);this._enableAllAttrs(c)},getAttribLocation:function(c,
d){return c.getAttribLocation(this._glProg,d)},getUniformLocation:function(c,d){return c.getUniformLocation(this._glProg,d)},_initUniforms:function(c){var d={},e=c.getProgramParameter(this._glProg,GL_ACTIVE_UNIFORMS);console.log("# Active Uniforms: "+e);for(var f=0;f<e;f++){var g=c.getActiveUniform(this._glProg,f),k=g.name,l=c.getUniformLocation(this._glProg,k),l=new TentaGL.Uniform(g,this._glProg,l);console.log("Uniform "+f+": "+k+", type "+TentaGL.glTypeName(g.type)+", size "+g.size+", byteSize "+
l.getSizeBytes()+", unitSize "+l.getSizeUnits());d[k]=l}return d},_initAttributes:function(c){var d={},e=c.getProgramParameter(this._glProg,GL_ACTIVE_ATTRIBUTES);console.log("# Active Attributes: "+e);for(var f=0;f<e;f++){var g=c.getActiveAttrib(this._glProg,f),k=g.name,l=c.getAttribLocation(this._glProg,k),l=new TentaGL.Attribute(g,this._glProg,l);console.log("Attribute "+f+": "+g.name+", type "+TentaGL.glTypeName(g.type)+", size "+g.size+", byteSize "+l.getSizeBytes()+", unitSize "+l.getSizeUnits());
d[k]=l}return d},hasUniform:function(c){return this._uniforms[c]?!0:!1},getUniform:function(c){!this._uniforms[c]&&this._showErrors&&console.log("Uniform variable "+c+" doesn't exist.");return this._uniforms[c]},getAttribute:function(c){return this._attributes[c]},getUniforms:function(){var c=[],d;for(d in this._uniforms)c.push(this._uniforms[d]);return c},getAttributes:function(){var c=[],d;for(d in this._attributes)c.push(this._attributes[d]);return c},getUniNames:function(){var c=[],d;for(d in this._uniforms)c.push(d);
return c},getAttrNames:function(){var c=[],d;for(d in this._attributes)c.push(d);return c},getUniValue:function(c,d){return this._uniforms[d].get(c)},setUniValue:function(c,d,e){(d=this.getUniform(d))&&d.set(c,e)},bindAttr:function(c,d,e,f){this._attributes[d].set(c,e,f)},setAttrGetter:function(c,d){this._attributes[c].setGetter(d)},getAttrStride:function(){if(void 0===this._totalStride){this._totalStride=0;for(var c in this._attributes)this._totalStride+=this._attributes[c].getSizeBytes()}return this._totalStride},
_enableAllAttrs:function(c){for(var d in this._attributes)c.enableVertexAttribArray(this._attributes[d].getLocation())},_disableAllAttrs:function(c){for(var d in this._attributes)c.disableVertexAttribArray(this._attributes[d].getLocation())}};TentaGL.ShaderProgram.srcFromURL=function(c,d,e){c=new XMLHttpRequest;c.open("get",d,!1);c.send();d=c.responseText;c.open("get",e,!1);c.send();return[d,c.responseText]};
TentaGL.DefaultShader=function(c){var d=TentaGL.ShaderLib.getDefaultShaderPath(c),e=this;TentaGL.ShaderLoader.load(d+"default.vert",d+"default.frag",function(d,g){console.log("\nCreating DefaultShader");TentaGL.ShaderProgram.call(e,c,d,g);e.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.xyz)})};TentaGL.DefaultShader.SHADER_ID="_default";TentaGL.DefaultShader.prototype={constructor:TentaGL.DefaultShader,isaDefaultShader:!0};
TentaGL.DefaultShader.load=function(c,d){var e=new TentaGL.DefaultShader(c);TentaGL.ShaderLib.add(c,d,e);return e};Util.Inheritance.inherit(TentaGL.DefaultShader,TentaGL.ShaderProgram);TentaGL.GradientShader=function(){};
TentaGL.GradientShader.prototype={constructor:TentaGL.GradientShader,isaGradientShader:!0,setMVPTrans:function(c,d){this._mvpUni.set(c,d)},setNormalTrans:function(c,d){this._normalUni.set(c,d)},setStartPoint:function(c,d){this._startPtUni.set(c,d)},setGradVector:function(c,d){this._gradVectorUni.set(c,d)},setColors:function(c,d){for(var e=[],f=0;f<d.length;f++)e.push(d[f].r()),e.push(d[f].g()),e.push(d[f].b()),e.push(d[f].a());this._colorsUni.set(c,e)},setBreakPoints:function(c,d){this._breakPtsUni.set(c,
d);this._breakPtCountUni.set(c,[d.length])}};Util.Inheritance.inherit(TentaGL.GradientShader,TentaGL.ShaderProgram);
TentaGL.LinearGradientShader=function(c){var d=TentaGL.ShaderLib.getDefaultShaderPath(c),e=this;TentaGL.ShaderLoader.load(d+"simple.vert",d+"gradientLinear.frag",function(d,g){console.log("\nCreating linear gradient shader");TentaGL.ShaderProgram.call(e,c,d,g);e.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.xyz);e.setAttrGetter("vertexNormal",TentaGL.Vertex.prototype.normal);e.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.texST);e._mvpUni=e.getUniform("mvpTrans");e._normalUni=e.getUniform("normalTrans");
e._startPtUni=e.getUniform("p");e._gradVectorUni=e.getUniform("u");e._colorsUni=e.getUniform("colors[0]");e._breakPtsUni=e.getUniform("breakPts[0]");e._breakPtCountUni=e.getUniform("breakPtCount")})};TentaGL.LinearGradientShader.prototype={constructor:TentaGL.LinearGradientShader,isaLinearGradientShader:!0};TentaGL.LinearGradientShader.load=function(c,d){var e=new TentaGL.LinearGradientShader(c);TentaGL.ShaderLib.add(c,d,e);return e};Util.Inheritance.inherit(TentaGL.LinearGradientShader,TentaGL.GradientShader);
TentaGL.RadialGradientShader=function(c){var d=TentaGL.ShaderLib.getDefaultShaderPath(c),e=this;TentaGL.ShaderLoader.load(d+"simple.vert",d+"gradientRadial.frag",function(d,g){console.log("\nCreating linear gradient shader");TentaGL.ShaderProgram.call(e,c,d,g);e.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.xyz);e.setAttrGetter("vertexNormal",TentaGL.Vertex.prototype.normal);e.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.texST);e._mvpUni=e.getUniform("mvpTrans");e._normalUni=e.getUniform("normalTrans");
e._startPtUni=e.getUniform("p");e._gradVectorUni=e.getUniform("u");e._colorsUni=e.getUniform("colors[0]");e._breakPtsUni=e.getUniform("breakPts[0]");e._breakPtCountUni=e.getUniform("breakPtCount")})};TentaGL.RadialGradientShader.prototype={constructor:TentaGL.RadialGradientShader,isaRadialGradientShader:!0};TentaGL.RadialGradientShader.load=function(c,d){var e=new TentaGL.RadialGradientShader(c);TentaGL.ShaderLib.add(c,d,e);return e};Util.Inheritance.inherit(TentaGL.RadialGradientShader,TentaGL.GradientShader);
TentaGL.NormalShader=function(c){var d=TentaGL.ShaderLib.getDefaultShaderPath(c),e=this;TentaGL.ShaderLoader.load(d+"normal.vert",d+"normal.frag",function(d,g){TentaGL.ShaderProgram.call(e,c,d,g);console.log("\nCreating NormalShader...");e.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.xyz);e.setAttrGetter("vertexNormal",TentaGL.Vertex.prototype.normal);e.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.texST);e._mvpUni=e.getUniform("mvpTrans");e._normalUni=e.getUniform("normalTrans");
e._texUni=e.getUniform("tex");e._useTexUni=e.getUniform("useTex")})};TentaGL.NormalShader.prototype={constructor:TentaGL.NormalShader,isaSimpleShader:!0,setMVPTrans:function(c,d){this._mvpUni.set(c,d)},setNormalTrans:function(c,d){this._normalUni.set(c,d)},setColor:function(c,d){this._useTexUni.set(c,[0])},setTex:function(c,d){this._texUni.set(c,[d]);this._useTexUni.set(c,[1])}};TentaGL.NormalShader.load=function(c,d){var e=new TentaGL.NormalShader(c);TentaGL.ShaderLib.add(c,d,e);return e};
Util.Inheritance.inherit(TentaGL.NormalShader,TentaGL.ShaderProgram);
TentaGL.PickShader=function(c){var d=TentaGL.ShaderLib.getDefaultShaderPath(c),e=this;TentaGL.ShaderLoader.load(d+"picker.vert",d+"picker.frag",function(d,g){console.log("\nCreating PickShader...");TentaGL.ShaderProgram.call(e,c,d,g);e.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.xyz);e.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.texST);e._mvpUni=e.getUniform("mvpTrans");e._texUni=e.getUniform("tex");e._pickIDUni=e.getUniform("pickID")})};
TentaGL.PickShader.prototype={constructor:TentaGL.PickShader,isaPickShader:!0,setMVPTrans:function(c,d){this._mvpUni.set(c,d)},setTex:function(c,d){this._texUni.set(c,[d])},setPickID:function(c,d){this._pickIDUni.set(c,d)}};TentaGL.PickShader.load=function(c,d){var e=new TentaGL.PickShader(c);TentaGL.ShaderLib.add(c,d,e);return e};Util.Inheritance.inherit(TentaGL.PickShader,TentaGL.ShaderProgram);TentaGL.PlaneShader=function(){};
TentaGL.PlaneShader.prototype={constructor:TentaGL.PlaneShader,isaPlaneShader:!0,setSFunc:function(c,d){this._sFuncUni.set(c,d)},setTFunc:function(c,d){this._tFuncUni.set(c,d)}};Util.Inheritance.inherit(TentaGL.PlaneShader,TentaGL.ShaderProgram);
TentaGL.SimpleShader=function(c){var d=TentaGL.ShaderLib.getDefaultShaderPath(c),e=this;TentaGL.ShaderLoader.load(d+"simple.vert",d+"simple.frag",function(d,g){console.log("\nCreating SimpleShader");TentaGL.ShaderProgram.call(e,c,d,g);e.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.xyz);e.setAttrGetter("vertexNormal",TentaGL.Vertex.prototype.normal);e.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.texST);e._opacityUni=e.getUniform("opacity");e._mvpUni=e.getUniform("mvpTrans");e._normalUni=
e.getUniform("normalTrans");e._colorUni=e.getUniform("solidColor");e._texUni=e.getUniform("tex");e._useTexUni=e.getUniform("useTex")})};
TentaGL.SimpleShader.prototype={constructor:TentaGL.SimpleShader,isaSimpleShader:!0,setOpacity:function(c,d){this._opacityUni.set(c,[d])},setMVPTrans:function(c,d){this._mvpUni.set(c,d)},setNormalTrans:function(c,d){this._normalUni.set(c,d)},setColor:function(c,d){this._colorUni.set(c,d);this._useTexUni.set(c,[0])},setTex:function(c,d){this._texUni.set(c,[d]);this._useTexUni.set(c,[1])}};TentaGL.SimpleShader.load=function(c,d){var e=new TentaGL.SimpleShader(c);TentaGL.ShaderLib.add(c,d,e);return e};
Util.Inheritance.inherit(TentaGL.SimpleShader,TentaGL.ShaderProgram);
TentaGL.CircleShader=function(c){var d=TentaGL.ShaderLib.getDefaultShaderPath(c),e=this;TentaGL.ShaderLoader.load(d+"simple.vert",d+"circle.frag",function(d,g){console.log("\nCreating CircleShader");TentaGL.ShaderProgram.call(e,c,d,g);e.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.xyz);e.setAttrGetter("vertexNormal",TentaGL.Vertex.prototype.normal);e.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.texST);e._opacityUni=e.getUniform("opacity");e._mvpUni=e.getUniform("mvpTrans");e._normalUni=
e.getUniform("normalTrans");e._colorUni=e.getUniform("solidColor");e._texUni=e.getUniform("tex");e._useTexUni=e.getUniform("useTex")})};TentaGL.CircleShader.prototype={constructor:TentaGL.CircleShader,isaCircleShader:!0};TentaGL.CircleShader.load=function(c,d){var e=new TentaGL.CircleShader(c);TentaGL.ShaderLib.add(c,d,e);c._circleShaderProgramName=d;return e};Util.Inheritance.inherit(TentaGL.CircleShader,TentaGL.SimpleShader);TentaGL.LightsShader=function(){};TentaGL.LightsShader.LIGHT_AMB=1;
TentaGL.LightsShader.LIGHT_PT=2;TentaGL.LightsShader.LIGHT_DIR=3;TentaGL.LightsShader.LIGHT_SPOT=4;
TentaGL.LightsShader.prototype={constructor:TentaGL.LightsShader,isaLightsShader:!0,setMaterialProps:function(c,d){this._materialUni.diff.set(c,d.diffuse().rgba());this._materialUni.spec.set(c,d.specular().rgba());this._materialUni.amb.set(c,d.ambient().rgba());this._materialUni.emis.set(c,d.emission().rgba());this._materialUni.shininess.set(c,[d.shininess()])},setLights:function(c,d,e){e=this.getMaxLights();var f=Math.min(d.length,e);this._numLightsUni&&this._numLightsUni.set(c,[d.length]);for(var g=
0;g<f;g++){var k=d[g],l=this._lightsUni[g];k.isaAmbientLight&&l.type.set(c,[TentaGL.LightsShader.LIGHT_AMB]);k.isaPointLight&&l.type.set(c,[TentaGL.LightsShader.LIGHT_PT]);k.isaDirectionalLight&&l.type.set(c,[TentaGL.LightsShader.LIGHT_DIR]);k.isaSpotLight&&l.type.set(c,[TentaGL.LightsShader.LIGHT_SPOT]);k.isaPointLight?l.pos.set(c,k.xyz()):l.pos.set(c,[0,0,0,0]);k.isaDirectionalLight?l.dir.set(c,k.direction()):l.dir.set(c,[0,0,0]);l.diff.set(c,k.diffuse().rgba());l.spec.set(c,k.specular().rgba());
l.amb.set(c,k.ambient().rgba());if(k.isaPointLight){var m=k.attenuation();l.attenA.set(c,[m[0]]);l.attenB.set(c,[m[1]]);l.attenC.set(c,[m[2]])}else l.attenA.set(c,[0]),l.attenB.set(c,[0]),l.attenC.set(c,[0]);k.isaSpotLight?(l.cutOffAngleCos.set(c,[Math.cos(k.cutOffAngle())]),l.spotExp.set(c,[k.spotExponent()])):(l.cutOffAngleCos.set(c,[0]),l.spotExp.set(c,[0]))}for(g=f;g<e;g++)l=this._lightsUni[g],l.type.set(c,[0]),l.pos.set(c,[0,0,0,0]),l.dir.set(c,[0,0,0]),l.diff.set(c,[0,0,0,0]),l.spec.set(c,[0,
0,0,0]),l.amb.set(c,[0,0,0,0]),l.attenA.set(c,[0]),l.attenB.set(c,[0]),l.attenC.set(c,[0]),l.cutOffAngleCos.set(c,[0]),l.spotExp.set(c,[0])},getMaxLights:function(){}};Util.Inheritance.inherit(TentaGL.LightsShader,TentaGL.SimpleShader);
TentaGL.PerVertexPhongShader=function(c){var d=TentaGL.ShaderLib.getDefaultShaderPath(c),e=this;TentaGL.ShaderLoader.load(d+"phongPerVertex.vert",d+"phongPerVertex.frag",function(d,g){console.log("\nCreating PerVertexPhongShader");TentaGL.ShaderProgram.call(e,c,d,g);e.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.xyz);e.setAttrGetter("vertexNormal",TentaGL.Vertex.prototype.normal);e.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.texST);e.setAttrGetter("vertexTang",TentaGL.Vertex.prototype.tangental);
e._opacityUni=e.getUniform("opacity");e._mvpUni=e.getUniform("mvpTrans");e._mvUni=e.getUniform("mvTrans");e._vUni=e.getUniform("vTrans");e._normalUni=e.getUniform("normalTrans");e._colorUni=e.getUniform("solidColor");e._texUni=e.getUniform("tex");e._useTexUni=e.getUniform("useTex");e._materialUni={};e._materialUni.diff=e.getUniform("m.diff");e._materialUni.spec=e.getUniform("m.spec");e._materialUni.amb=e.getUniform("m.amb");e._materialUni.emis=e.getUniform("m.emis");e._materialUni.shininess=e.getUniform("m.shininess");
e._lightsUni=[];for(var k=0;k<TentaGL.PerVertexPhongShader.MAX_LIGHTS;k++){var l=e._lightsUni[k]={},m="lights["+k+"]";l.type=e.getUniform(m+".type");l.pos=e.getUniform(m+".pos");l.dir=e.getUniform(m+".dir");l.diff=e.getUniform(m+".diff");l.spec=e.getUniform(m+".spec");l.amb=e.getUniform(m+".amb");l.attenA=e.getUniform(m+".attenA");l.attenB=e.getUniform(m+".attenB");l.attenC=e.getUniform(m+".attenC");l.cutOffAngleCos=e.getUniform(m+".cutOffAngleCos");l.spotExp=e.getUniform(m+".spotExp")}e._numLightsUni=
e.getUniform("numLights")})};TentaGL.PerVertexPhongShader.MAX_LIGHTS=16;TentaGL.PerVertexPhongShader.prototype={constructor:TentaGL.PerVertexPhongShader,isaPerVertexPhongShader:!0,setMVTrans:function(c,d){this._mvUni.set(c,d)},setVTrans:function(c,d){this._vUni.set(c,d)},getMaxLights:function(){return TentaGL.PerVertexPhongShader.MAX_LIGHTS}};TentaGL.PerVertexPhongShader.load=function(c,d){var e=new TentaGL.PerVertexPhongShader(c);TentaGL.ShaderLib.add(c,d,e);return e};
Util.Inheritance.inherit(TentaGL.PerVertexPhongShader,TentaGL.LightsShader);
TentaGL.PerVertexPhongShaderMac=function(c){var d=TentaGL.ShaderLib.getDefaultShaderPath(c),e=this;TentaGL.ShaderLoader.load(d+"phongPerVertexMac.vert",d+"phongPerVertexMac.frag",function(d,g){console.log("\nCreating PerVertexPhongShaderMac");TentaGL.ShaderProgram.call(e,c,d,g);e.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.xyz);e.setAttrGetter("vertexNormal",TentaGL.Vertex.prototype.normal);e.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.texST);e.setAttrGetter("vertexTang",TentaGL.Vertex.prototype.tangental);
e._opacityUni=e.getUniform("opacity");e._mvpUni=e.getUniform("mvpTrans");e._mvUni=e.getUniform("mvTrans");e._vUni=e.getUniform("vTrans");e._normalUni=e.getUniform("normalTrans");e._colorUni=e.getUniform("solidColor");e._texUni=e.getUniform("tex");e._useTexUni=e.getUniform("useTex");e._materialUni={};e._materialUni.diff=e.getUniform("m.diff");e._materialUni.spec=e.getUniform("m.spec");e._materialUni.amb=e.getUniform("m.amb");e._materialUni.emis=e.getUniform("m.emis");e._materialUni.shininess=e.getUniform("m.shininess");
e._lightsUni=[];var k=e._lightsUni[0]={};k.type=e.getUniform("light.type");k.pos=e.getUniform("light.pos");k.dir=e.getUniform("light.dir");k.diff=e.getUniform("light.diff");k.spec=e.getUniform("light.spec");k.amb=e.getUniform("light.amb");k.attenA=e.getUniform("light.attenA");k.attenB=e.getUniform("light.attenB");k.attenC=e.getUniform("light.attenC");k.cutOffAngleCos=e.getUniform("light.cutOffAngleCos");k.spotExp=e.getUniform("light.spotExp")})};TentaGL.PerVertexPhongShaderMac.MAX_LIGHTS=1;
TentaGL.PerVertexPhongShaderMac.prototype={constructor:TentaGL.PerVertexPhongShader,isaPerVertexPhongShaderMac:!0,getMaxLights:function(){return TentaGL.PerVertexPhongShaderMac.MAX_LIGHTS}};TentaGL.PerVertexPhongShaderMac.load=function(c,d){var e=new TentaGL.PerVertexPhongShaderMac(c);TentaGL.ShaderLib.add(c,d,e);return e};Util.Inheritance.inherit(TentaGL.PerVertexPhongShaderMac,TentaGL.PerVertexPhongShader);
TentaGL.PhongShader=function(c){var d=TentaGL.ShaderLib.getDefaultShaderPath(c),e=this;TentaGL.ShaderLoader.load(d+"phong.vert",d+"phong.frag",function(d,g){console.log("\nCreating PhongShader");TentaGL.ShaderProgram.call(e,c,d,g);e.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.xyz);e.setAttrGetter("vertexNormal",TentaGL.Vertex.prototype.normal);e.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.texST);e.setAttrGetter("vertexTang",TentaGL.Vertex.prototype.tangental);e._opacityUni=e.getUniform("opacity");
e._mvpUni=e.getUniform("mvpTrans");e._mvUni=e.getUniform("mvTrans");e._vUni=e.getUniform("vTrans");e._normalUni=e.getUniform("normalTrans");e._colorUni=e.getUniform("solidColor");e._texUni=e.getUniform("tex");e._useTexUni=e.getUniform("useTex");e._bumpTexUni=e.getUniform("bumpTex");e._useBumpUni=e.getUniform("useBumpTex");e._materialUni={};e._materialUni.diff=e.getUniform("m.diff");e._materialUni.spec=e.getUniform("m.spec");e._materialUni.amb=e.getUniform("m.amb");e._materialUni.emis=e.getUniform("m.emis");
e._materialUni.shininess=e.getUniform("m.shininess");e._lightsUni=[];for(var k=0;k<TentaGL.PhongShader.MAX_LIGHTS;k++){var l=e._lightsUni[k]={},m="lights["+k+"]";l.type=e.getUniform(m+".type");l.pos=e.getUniform(m+".pos");l.dir=e.getUniform(m+".dir");l.diff=e.getUniform(m+".diff");l.spec=e.getUniform(m+".spec");l.amb=e.getUniform(m+".amb");l.attenA=e.getUniform(m+".attenA");l.attenB=e.getUniform(m+".attenB");l.attenC=e.getUniform(m+".attenC");l.cutOffAngleCos=e.getUniform(m+".cutOffAngleCos");l.spotExp=
e.getUniform(m+".spotExp")}e._numLightsUni=e.getUniform("numLights")})};TentaGL.PhongShader.MAX_LIGHTS=16;
TentaGL.PhongShader.prototype={constructor:TentaGL.PhongShader,isaPhongShader:!0,setMVTrans:function(c,d){this._mvUni.set(c,d)},setVTrans:function(c,d){this._vUni.set(c,d)},setColor:function(c,d){this._colorUni.set(c,d);this._useTexUni.set(c,[0]);this._useBumpUni.set(c,[0])},setTex:function(c,d){this._texUni.set(c,[d]);this._useTexUni.set(c,[1]);this._useBumpUni.set(c,[0])},setBump:function(c,d){this._bumpTexUni.set(c,[d]);this._useBumpUni.set(c,[1])},getMaxLights:function(){return TentaGL.PhongShader.MAX_LIGHTS}};
TentaGL.PhongShader.load=function(c,d){var e=new TentaGL.PhongShader(c);TentaGL.ShaderLib.add(c,d,e);return e};Util.Inheritance.inherit(TentaGL.PhongShader,TentaGL.LightsShader);
TentaGL.PhongShaderMac=function(c){var d=TentaGL.ShaderLib.getDefaultShaderPath(c),e=this;TentaGL.ShaderLoader.load(d+"phongMac.vert",d+"phongMac.frag",function(d,g){console.log("\nCreating PhongShaderMac");TentaGL.ShaderProgram.call(e,c,d,g);e.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.xyz);e.setAttrGetter("vertexNormal",TentaGL.Vertex.prototype.normal);e.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.texST);e.setAttrGetter("vertexTang",TentaGL.Vertex.prototype.tangental);e._opacityUni=
e.getUniform("opacity");e._mvpUni=e.getUniform("mvpTrans");e._mvUni=e.getUniform("mvTrans");e._vUni=e.getUniform("vTrans");e._normalUni=e.getUniform("normalTrans");e._colorUni=e.getUniform("solidColor");e._texUni=e.getUniform("tex");e._useTexUni=e.getUniform("useTex");e._bumpTexUni=e.getUniform("bumpTex");e._useBumpUni=e.getUniform("useBumpTex");e._materialUni={};e._materialUni.diff=e.getUniform("m.diff");e._materialUni.spec=e.getUniform("m.spec");e._materialUni.amb=e.getUniform("m.amb");e._materialUni.emis=
e.getUniform("m.emis");e._materialUni.shininess=e.getUniform("m.shininess");e._lightsUni=[];var k=e._lightsUni[0]={};k.type=e.getUniform("light.type");k.pos=e.getUniform("light.pos");k.dir=e.getUniform("light.dir");k.diff=e.getUniform("light.diff");k.spec=e.getUniform("light.spec");k.amb=e.getUniform("light.amb");k.attenA=e.getUniform("light.attenA");k.attenB=e.getUniform("light.attenB");k.attenC=e.getUniform("light.attenC");k.cutOffAngleCos=e.getUniform("light.cutOffAngleCos");k.spotExp=e.getUniform("light.spotExp")})};
TentaGL.PhongShaderMac.MAX_LIGHTS=1;TentaGL.PhongShaderMac.LIGHT_AMB=1;TentaGL.PhongShaderMac.LIGHT_PT=2;TentaGL.PhongShaderMac.LIGHT_DIR=3;TentaGL.PhongShaderMac.LIGHT_SPOT=4;TentaGL.PhongShaderMac.prototype={constructor:TentaGL.PhongShaderMac,isaPhongShaderMac:!0,getMaxLights:function(){return TentaGL.PhongShaderMac.MAX_LIGHTS}};TentaGL.PhongShaderMac.load=function(c,d){var e=new TentaGL.PhongShaderMac(c);TentaGL.ShaderLib.add(c,d,e);return e};Util.Inheritance.inherit(TentaGL.PhongShaderMac,TentaGL.PhongShader);
TentaGL.PlaneSimpleShader=function(c){var d=TentaGL.ShaderLib.getDefaultShaderPath(c),e=this;TentaGL.ShaderLoader.load(d+"planeSimple.vert",d+"planeSimple.frag",function(d,g){console.log("\nCreating PlaneSimpleShader");TentaGL.ShaderProgram.call(e,c,d,g);e.setAttrGetter("vertexPos",TentaGL.Vertex.prototype.xyz);e.setAttrGetter("vertexNormal",TentaGL.Vertex.prototype.normal);e.setAttrGetter("vertexTexCoords",TentaGL.Vertex.prototype.texST);e._opacityUni=e.getUniform("opacity");e._mvpUni=e.getUniform("mvpTrans");
e._normalUni=e.getUniform("normalTrans");e._colorUni=e.getUniform("solidColor");e._texUni=e.getUniform("tex");e._useTexUni=e.getUniform("useTex");e._sFuncUni=e.getUniform("sFunc");e._tFuncUni=e.getUniform("tFunc")})};TentaGL.PlaneSimpleShader.prototype={constructor:TentaGL.PlaneSimpleShader,isaPlaneSimpleShader:!0};TentaGL.PlaneSimpleShader.load=function(c,d){var e=new TentaGL.PlaneSimpleShader(c);TentaGL.ShaderLib.add(c,d,e);return e};Util.Inheritance.inherit(TentaGL.PlaneSimpleShader,TentaGL.SimpleShader);
Util.Inheritance.inherit(TentaGL.PlaneSimpleShader,TentaGL.PlaneShader);TentaGL.Timer=function(c){this._startTime=c;this._accumulated=0;this._countdown=void 0;this._state=void 0!==c?TentaGL.Timer.RUNNING:TentaGL.Timer.STOPPED};TentaGL.Timer.STOPPED=1;TentaGL.Timer.RUNNING=2;TentaGL.Timer.PAUSED=3;
TentaGL.Timer.millisToHHmmssS=function(c){var d=Math.floor(c/1E3),e=Math.floor(d/60),f=Math.floor(e/60);c=""+Math.floor(c/100)%10;d=""+d%60;2>d.length&&(d="0"+d);var g=""+e%60;2>g.length&&(g="0"+g);var k="";1<=f&&(k+=f+":");1<=e&&(k+=g+":");return k+(d+"."+c)};
TentaGL.Timer.prototype={constructor:TentaGL.Timer,isaTimer:!0,isRunning:function(){return this._state==TentaGL.Timer.RUNNING},isPaused:function(){return this._state==TentaGL.Timer.PAUSED},isStopped:function(){return this._state==TentaGL.Timer.STOPPED},start:function(){this._startTime=Date.now();this._accumulated=0;this._state=TentaGL.Timer.RUNNING;return this._startTime},pause:function(){if(this._state==TentaGL.Timer.RUNNING){var c=Date.now();this._accumulated+=c-this._startTime;this._state=TentaGL.Timer.PAUSED}else throw Error("Cannot pause a Timer that isn't running.");
},resume:function(){if(this._state==TentaGL.Timer.PAUSED)this._startTime=Date.now(),this._state=TentaGL.Timer.RUNNING;else throw Error("Cannot resume a Timer not in a paused state.");},stop:function(){var c=Date.now();this._accumulated+=c-this._startTime;this._state=TentaGL.Timer.STOPPED},timeElapsed:function(){var c=this._accumulated;if(this._state==TentaGL.Timer.RUNNING)var d=Date.now(),c=c+(d-this._startTime);return c},timeElapsedHHmmssS:function(){return TentaGL.Timer.millisToHHmmssS(this.timeElapsed())},
setCountdown:function(c){this._countdown=c},timeLeft:function(){var c=this._countdown-this.timeElapsed();return c=Math.max(0,c)},timeLeftHHmmssS:function(){return TentaGL.Timer.millisToHHmmssS(this.timeLeft())}};TentaGL.Align={CENTER:1,LEFT:2,RIGHT:3,TOP:4,BOTTOM:5,FRONT:6,BACK:7};
TentaGL.Canvas2D={create:function(c,d,e){var f=document.createElement("canvas");f.width=c;f.height=d;e&&this.drawRect(f,0,0,c,d,!1,0,e);return f},removeAlpha:function(c){for(var d=c.getContext("2d"),e=d.getImageData(0,0,c.width,c.height),f=e.data,g=0;g<f.length;g+=4)255>f[g+3]&&(f[g+3]=0);d.putImageData(e,0,0);return c},drawString:function(c,d,e,f,g,k){g||(g=0);k||(k=0);var l=c.getContext("2d");l.save();l.webkitImageSmoothingEnabled=!1;l.font=e.toCSS();l.lineWidth=1;l.fillStyle=f.toCSS();d=d.split("\n");
for(var m in d)f=d[m],l.translate(0,e.getSize()),l.fillText(f,g,k),l.translate(0,e.getVerticalPadding());l.restore();return c},createString:function(c,d,e){var f=d.getStringDimensions(c),g=this.create(f[0],f[1]),k=g.getContext("2d");1==e.r()&&1==e.g()&&1==e.b()?k.fillStyle="black":k.fillStyle="white";k.fillRect(0,0,f[0],f[1]);this.drawString(g,c,d,e,0,0);return g},drawCircle:function(c,d,e,f,g,k,l){var m=c.getContext("2d");m.save();m.beginPath();m.arc(d,e,f,0,TentaGL.TAU);l&&(m.fillStyle=l.toCSS(),
m.fill());g&&(m.strokeStyle=g.toCSS(),m.lineWidth=k,m.stroke());m.restore();return c},createCircle:function(c,d,e,f){var g=2*c+e,g=this.create(g,g);this.drawCircle(g,c+e/2,c+e/2,c,d,e,f);return g},drawRect:function(c,d,e,f,g,k,l,m){var p=c.getContext("2d");p.save();m&&(p.fillStyle=m.toCSS(),p.fillRect(d,e,f,g));k&&(p.strokeStyle=k.toCSS(),p.lineWidth=l,p.strokeRect(d,e,f,g));p.restore();return c},createRect:function(c,d,e,f,g){var k=this.create(c+f,d+f);this.drawRect(k,f/2,f/2,c,d,e,f,g);return k},
drawRoundedRect:function(c,d,e,f,g,k,l,m,p){var n=c.getContext("2d");n.save();n.beginPath();n.moveTo(d+k,e);n.lineTo(d+f-k,e);n.arc(d+f-k,e+k,k,3*TentaGL.TAU/4,0);n.lineTo(d+f,e+g-k);n.arc(d+f-k,e+g-k,k,0,1*TentaGL.TAU/4);n.lineTo(d+k,e+g);n.arc(d+k,e+g-k,k,1*TentaGL.TAU/4,2*TentaGL.TAU/4);n.lineTo(d,e+k);n.arc(d+k,e+k,k,2*TentaGL.TAU/4,3*TentaGL.TAU/4);p&&(n.fillStyle=p.toCSS(),n.fill());l&&(n.strokeStyle=l.toCSS(),n.lineWidth=m,n.stroke());n.restore();return c},createRoundedRect:function(c,d,e,
f,g,k){var l=this.create(c+g,d+g);this.drawRoundedRect(l,g/2,g/2,c,d,e,f,g,k);return l},drawImage:function(c,d,e,f,g,k){var l=c.getContext("2d");g&&k?l.drawImage(d,e,f,g,k):l.drawImage(d,e,f);return c},createImage:function(c,d,e){var f=this.create(d?d:c.width,e?e:c.height);this.drawImage(f,c,0,0,d,e);return f},crop:function(c,d,e,f,g){var k=this.create(f,g);k.getContext("2d").drawImage(c,d,e,f,g,0,0);return k}};
TentaGL.UIComponent=function(c){c||(c=[0,0,0]);TentaGL.Sprite.call(this,c);this._parentComponent=void 0;this.enabled(!0);this._resetMouseState()};
TentaGL.UIComponent.prototype={constructor:TentaGL.UIComponent,isaUIComponent:!0,_resetMouseState:function(){this._isRightPressed=this._isLeftPressed=!1;this._mouseOverStart=-1;this._tooltipPosition=void 0},updateMouseState:function(c,d){if(c.getSpriteAtMouse(d)==this){if(this._enabled){-1==this._mouseOverStart&&(this._mouseOverStart=Date.now(),this.onMouseOver(d));if(d.isLeftPressed())this._isLeftPressed=!0;else{if(this._isLeftPressed)this.onClick(d);this._isLeftPressed=!1}if(d.isRightPressed())this._isRightPressed=
!0;else{if(this._isRightPressed)this.onRightClick(d);this._isRightPressed=!1}}this._tooltipPosition=d.getXY();vec2.add(this._tooltipPosition,this._tooltipPosition,[0,16])}else{if(0<=this._mouseOverStart&&this._enabled)this.onMouseExit(d);this._resetMouseState()}},isPressed:function(){return this._isLeftPressed},timeMouseOvered:function(){return-1==this._mouseOverStart?-1:Date.now()-this._mouseOverStart},isMouseOvered:function(){return 0<=this._mouseOverStart},enabled:function(c){void 0!==c&&(this._enabled=
c);return this._enabled},setTooltip:function(c,d){this._tooltip=d;this._tooltipText=c},onClick:function(c){},onRightClick:function(c){},onMouseOver:function(c){},onMouseExit:function(c){}};Util.Inheritance.inherit(TentaGL.UIComponent,TentaGL.Sprite);TentaGL.ButtonSprite=function(c,d){TentaGL.UIComponent.call(this,c);d||(d=function(){});this.onClick=function(c){d()}};TentaGL.ButtonSprite.prototype={constructor:TentaGL.ButtonSprite,isaButtonSprite:!0};Util.Inheritance.inherit(TentaGL.ButtonSprite,TentaGL.UIComponent);
TentaGL.ButtonSprite.create=function(c,d,e,f,g){c=new TentaGL.ButtonSprite(c);g||(g=new TentaGL.MaterialProps);c.draw=function(c){try{TentaGL.ShaderLib.use(c,f),TentaGL.MaterialLib.use(c,e),g.useMe(c),TentaGL.ModelLib.render(c,d)}catch(l){}TentaGL.ButtonSprite.prototype.draw.call(this,c)};return c};TentaGL.Tooltip=function(c,d,e,f){this._bgMatName=d;this._blitFont=c;this._pad=e;this._delay=f;this.text("")};
TentaGL.Tooltip.getDefault=function(c){if(!c._defaultTooltip){var d=new TentaGL.Font("Arial","sans-serif",10),e=TentaGL.Color.RGBA(.8,.8,.8,1),d=TentaGL.BlitteredFont.fromFont(d,e,1,1,function(c){return c=c.filter(TentaGL.RGBAFilter.OutlineColor.RGBBytes(150,150,200))});c._defaultTooltip=new TentaGL.Tooltip(d,"_defaultTooltipBGColor",4,1E3)}return c._defaultTooltip};
TentaGL.Tooltip.prototype={constructor:TentaGL.Tooltip,isaTooltip:!0,text:function(c){this._text=c;this._dims=this._blitFont.getStringDimensions("")},component:function(c){},getDimensions:function(){return[this._dims[0]+2*this._pad,this._dims[1]+2*this._pad]},padding:function(c){void 0!==c&&(this._pad=c);return this._pad},delay:function(c){void 0!==c&&(this._delay=c);return this._delay},render:function(c,d,e){d&&this.text(d);e&&TentaGL.ViewTrans.translate(c,e);d=this.getDimensions();TentaGL.MaterialLib.use(c,
this._bgMatName);TentaGL.ViewTrans.push(c);TentaGL.ViewTrans.scale(c,d);TentaGL.ModelLib.render(c,"unitSprite");TentaGL.ViewTrans.pop(c);this._blitFont.renderString(c,this._text,[this._pad,this._pad],!0)}};Util.Inheritance.inherit(TentaGL.Tooltip,TentaGL.Renderable);